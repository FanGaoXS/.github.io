<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>FanGaoXS&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="FanGaoXS&#39;s blog">
<meta property="og:url" content="https://fangaoxs.github.io/page/2/index.html">
<meta property="og:site_name" content="FanGaoXS&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="FanGaoXS">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="FanGaoXS's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FanGaoXS&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fangaoxs.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-back-end/go/gorm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/gorm/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/gorm/">GORM框架的学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="什么是ORM？"><a href="#什么是ORM？" class="headerlink" title="什么是ORM？"></a>什么是ORM？</h1><p>ORM是Object Relation Mapping（对象关系映射）<img src="/2023/07/19/back-end/go/gorm/image-20211101182158366.png"></p>
<h1 id="什么是GORM？"><a href="#什么是GORM？" class="headerlink" title="什么是GORM？"></a>什么是GORM？</h1><p>是一个有国人开发的，目前较为流行的，基于Go开发的ORM框架，用于对数据库进行操作。</p>
<p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/">中文官方文档</a></p>
<h1 id="在项目中安装GORM"><a href="#在项目中安装GORM" class="headerlink" title="在项目中安装GORM"></a>在项目中安装GORM</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">go get -u gorm.io/gorm</span><br><span class="line">go get -u gorm.io/driver/mysql		<span class="comment">#根据需求安装适合的数据库驱动</span></span><br><span class="line">		  gorm.io/driver/postgres</span><br><span class="line">		  gorm.io/driver/sqlite</span><br><span class="line">		  gorm.io/driver/sqlserver</span><br><span class="line">		  ...</span><br></pre></td></tr></table></figure>

<h1 id="连接MySQL数据库"><a href="#连接MySQL数据库" class="headerlink" title="连接MySQL数据库"></a>连接MySQL数据库</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	username = <span class="string">&quot;root&quot;</span></span><br><span class="line">	password = <span class="string">&quot;&quot;</span></span><br><span class="line">	host = <span class="string">&quot;127.0.0.1:3306&quot;</span></span><br><span class="line">	dbName = <span class="string">&quot;gorm_demo1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	dsn := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>, username, password, host, dbName)</span><br><span class="line">	<span class="comment">//dsn := &quot;root@tcp(127.0.0.1:3306)/gorm_demo1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	<span class="comment">//连接MySQL数据库</span></span><br><span class="line">	db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="comment">//panic处理错误</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">//连接数据库失败</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用<code>gorm.Open()</code>连接对应的数据库</p>
<h1 id="自动创建表"><a href="#自动创建表" class="headerlink" title="自动创建表"></a>自动创建表</h1><h3 id="创建结构体对象"><a href="#创建结构体对象" class="headerlink" title="创建结构体对象"></a>创建结构体对象</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id 		<span class="type">uint</span></span><br><span class="line">	Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建表并且插入数据"><a href="#创建表并且插入数据" class="headerlink" title="创建表并且插入数据"></a>创建表并且插入数据</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	dsn := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>, username, password, host, dbName)</span><br><span class="line">	<span class="comment">//dsn := &quot;root@tcp(127.0.0.1:3306)/gorm_demo1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	<span class="comment">//连接MySQL数据库</span></span><br><span class="line">	db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="comment">//panic处理错误</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">//连接数据库失败</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//自动创建数据表并且把结构体属性和数据库字段一一对应（自动迁移）</span></span><br><span class="line">	db.AutoMigrate(&amp;User&#123;&#125;)	<span class="comment">//即会自动根据User结构体创建User表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>db.AutoMigrate(结构体指针)</code>会在连接数据库的时候根据结构体的属性自动创建数据表。</p>
<h1 id="定义模型（Model）"><a href="#定义模型（Model）" class="headerlink" title="定义模型（Model）"></a>定义模型（Model）</h1><h2 id="gorm-Model"><a href="#gorm-Model" class="headerlink" title="gorm.Model"></a>gorm.Model</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Model <span class="keyword">struct</span> &#123;</span><br><span class="line">   ID        <span class="type">uint</span> <span class="string">`gorm:&quot;primarykey&quot;`</span></span><br><span class="line">   CreatedAt time.Time</span><br><span class="line">   UpdatedAt time.Time</span><br><span class="line">   DeletedAt DeletedAt <span class="string">`gorm:&quot;index&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>gorm.Model是gorm推荐的模型，可以在自定义的结构体中嵌套（继承）它</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID        <span class="type">uint</span> <span class="string">`gorm:&quot;primarykey&quot;`</span></span><br><span class="line">    CreatedAt time.Time</span><br><span class="line">    UpdatedAt time.Time</span><br><span class="line">    DeletedAt DeletedAt <span class="string">`gorm:&quot;index&quot;`</span></span><br><span class="line">    Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="主键、表名"><a href="#主键、表名" class="headerlink" title="主键、表名"></a>主键、表名</h2><h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><p>GORM默认使用名为ID的字段作为表的主键，也可以使用tag:<code>gorm:primary_key</code>来手动指定表的主键</p>
<h3 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h3><p>表名默认就是结构体名称的复数，例如：User结构体默认的表名是Users</p>
<p>手动指定表名</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableName 手动指定User结构体的表名</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;user&quot;</span>	<span class="comment">//自定义的表名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="字段标签"><a href="#字段标签" class="headerlink" title="字段标签"></a>字段标签</h2><p>声明model时，tag是可选的，参看：<a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/models.html#%E5%AD%97%E6%AE%B5%E6%A0%87%E7%AD%BE">字段标签</a>。tag 名大小写不敏感，但建议使用 <code>camelCase</code> 风格，常用如下：<code>primaryKey</code>指定列为主键，<code>unique</code>指定列为唯一，<code>default</code>指定列的默认值，<code>not null</code>指定列不为null等</p>
<h2 id="时间戳跟踪"><a href="#时间戳跟踪" class="headerlink" title="时间戳跟踪"></a>时间戳跟踪</h2><h3 id="CreatedAt"><a href="#CreatedAt" class="headerlink" title="CreatedAt"></a>CreatedAt</h3><p>如果模型有<code>CreatedAt</code>字段，该字段的值将会是初次创建记录的时间。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.Create(&amp;u)	<span class="comment">//新建时的时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以利用update来修改CreatedAt字段</span></span><br><span class="line">db.Model(&amp;u).Update(<span class="string">&quot;CreatedAt&quot;</span>,time.Now())	</span><br></pre></td></tr></table></figure>

<h3 id="UpdatedAt"><a href="#UpdatedAt" class="headerlink" title="UpdatedAt"></a>UpdatedAt</h3><p>如果模型有<code>UpdatedAt</code>字段，该字段的值会是每次更新记录的时间</p>
<h3 id="DeletedAt"><a href="#DeletedAt" class="headerlink" title="DeletedAt"></a>DeletedAt</h3><p>如果模型有<code>DeletedAt</code>字段，调用<code>Delete</code>删除该记录时，将会设置<code>DeletedAt</code>字段为删除的时间，而不是直接将记录删除（软删除）</p>
<h1 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h1><h2 id="增加（Create）"><a href="#增加（Create）" class="headerlink" title="增加（Create）"></a>增加（Create）</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/create.html">https://gorm.io/zh_CN/docs/create.html</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建新的结构体对象</span></span><br><span class="line">u := &amp;User&#123;</span><br><span class="line">    Model: gorm.Model&#123;&#125;,</span><br><span class="line">    Name:  <span class="string">&quot;test&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//插入记录</span></span><br><span class="line">result := db.Create(&amp;u)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	u.ID				返回成功插入后的主键</span></span><br><span class="line"><span class="comment">    result.Error		返回error报错信息</span></span><br><span class="line"><span class="comment">    result.RowsAffected	返回成功插入的条数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>TIps</strong></p>
<p>可以在数据库实例对象后加<code>.Debug()</code>来查看具体执行的SQL语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Debug().Create(&amp;u)</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="查询（First、Take、Last、Find）"><a href="#查询（First、Take、Last、Find）" class="headerlink" title="查询（First、Take、Last、Find）"></a>查询（First、Take、Last、Find）</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/query.html">https://gorm.io/zh_CN/docs/query.html</a></p>
<h2 id="更新（Save、Update）"><a href="#更新（Save、Update）" class="headerlink" title="更新（Save、Update）"></a>更新（Save、Update）</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/update.html">https://gorm.io/zh_CN/docs/update.html</a></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/delete.html">https://gorm.io/zh_CN/docs/delete.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/gorm/" data-id="clsblyue3000tw0k6adoff4d3" data-title="GORM框架的学习" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gorm/" rel="tag">gorm</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/grpc-web" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/grpc-web/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/grpc-web/">第一个gRPC-web项目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是gRPC-web？"><a href="#1、什么是gRPC-web？" class="headerlink" title="1、什么是gRPC-web？"></a>1、什么是gRPC-web？</h2><p>简单来说，gRPC-web就是gRPC的JavaScript版本的client实现</p>
<h2 id="2、gRPC-web工作流程"><a href="#2、gRPC-web工作流程" class="headerlink" title="2、gRPC-web工作流程"></a>2、gRPC-web工作流程</h2><p>由于浏览器的特性，gRPC-web其实没办法直接向gRPC-server发送HTTP&#x2F;2请求的，只有通过envoy代理，将来自gRPC-web的HTTP&#x2F;1的请求转换为gRPC-server能够接收的HTTP&#x2F;2请求</p>
<p><img src="/2023/07/19/back-end/go/grpc-web/image-20211223101933454.png"></p>
<h2 id="3、安装gRPC-web相关依赖"><a href="#3、安装gRPC-web相关依赖" class="headerlink" title="3、安装gRPC-web相关依赖"></a>3、安装gRPC-web相关依赖</h2><p>在使用下列命令前确保开发环境已经安装<code>node</code></p>
<p>全局安装<code>protoc-gen-grpc-web</code>插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i protoc-gen-grpc-web -g			<span class="comment">#全局安装</span></span><br></pre></td></tr></table></figure>

<p>在web项目中安装（确保项目使用<code>npm init -y</code>初始化）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i protobufjs</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i grpc-web</span><br></pre></td></tr></table></figure>



<h2 id="4、编写proto文件"><a href="#4、编写proto文件" class="headerlink" title="4、编写proto文件"></a>4、编写proto文件</h2><p>编写proto文件，并且通过插件将proto文件编译为js文件</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;      <span class="comment">//语法版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> pb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;./;pb&quot;</span>;    <span class="comment">//生成的go文件的包名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloResponse</span> &#123;</span><br><span class="line">  <span class="type">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个 rpc 服务通过参数和返回类型来指定可以远程调用的方法</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">Hello</span> &#123;</span><br><span class="line">  <span class="comment">// rpc 定义可远程调用服务</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> HelloWorld (HelloRequest) <span class="keyword">returns</span> (HelloResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用插件将proto文件编译为js文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=proto proto/*proto \</span><br><span class="line">    --js_out=import_style=commonjs:./pb \</span><br><span class="line">    --grpc-web_out=import_style=commonjs,mode=grpcwebtext:./pb</span><br></pre></td></tr></table></figure>

<p>语义：</p>
<p><code>--proto_path</code>指proto文件所在的目录</p>
<p><code>--js_out=import_style=commonjs:./pb</code>指利用commonjs将编译后的js文件存放在<code>./pb</code>目录中</p>
<p><code>--grpc-web_out=import_style=commonjs,mode=grpcwebtext:./pb</code>指利用commonjs将编译后的grpc-web的js文件存放在<code>./pb</code>目录，并且模式是grpcwebtext</p>
<p>同样的，也可以添加到Makefile中</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">gen:</span></span><br><span class="line">	protoc --proto_path=proto proto/*proto \</span><br><span class="line">    --js_out=import_style=commonjs:./pb \</span><br><span class="line">    --grpc-web_out=import_style=commonjs,mode=grpcwebtext:./pb</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm pb/*.js</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h2 id="5、启用客户端"><a href="#5、启用客户端" class="headerlink" title="5、启用客户端"></a>5、启用客户端</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从pb中拿到request和response</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">HelloRequest</span>,<span class="title class_">HelloResponse</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./pb/hello_pb.js&#x27;</span></span><br><span class="line"><span class="comment">// 从grpc_web_pb中拿到client</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">HelloClient</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./pb/hello_grpc_web_pb.js&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得client</span></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">HelloClient</span>(<span class="string">&#x27;http://localhost:9001&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建request</span></span><br><span class="line"><span class="keyword">let</span> request = <span class="keyword">new</span> <span class="title class_">HelloRequest</span>();</span><br><span class="line">request.<span class="title function_">setName</span>(<span class="string">&#x27;World!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用request发起请求，得到response响应</span></span><br><span class="line"><span class="comment">// 其中response包含在一个回调函数当中</span></span><br><span class="line">client.<span class="title function_">helloWorld</span>(request, &#123;&#125;, <span class="function">(<span class="params">err,response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;  <span class="comment">//获得response失败</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response err &#x27;</span>,err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 获得response成功</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;receive from server: &#x27;</span>,response)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现，和gRPC-client的go的实现的步骤是差不多的，1、从生成的文件中获得client，然后利用client执行service中的方法，最后获得response。</p>
<h2 id="5、已知缺点"><a href="#5、已知缺点" class="headerlink" title="5、已知缺点"></a>5、已知缺点</h2><p>只支持server往client发送消息流，其余方式的信息流不支持</p>
<h2 id="6、envoy代理"><a href="#6、envoy代理" class="headerlink" title="6、envoy代理"></a>6、envoy代理</h2><p>envoy是一个代理服务，类似于Nginx。</p>
<p>gRPC-web目前支持HTTP&#x2F;1.0和HTTP&#x2F;1.1，但是gRPC请求要求的协议是HTTP2，所以gRPC-web发送过来的请求无法直接被gRPC-server（服务端）接受，所以需要使用envoy做一次代理转换，将来自gRPC-web的请求HTTP&#x2F;1请求转换为gRPC-server能使用的HTTP&#x2F;2请求。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/grpc-web/" data-id="clsblyue4000ww0k61qbz15b5" data-title="第一个gRPC-web项目" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC-web/" rel="tag">GRPC-web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/protobuf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/protobuf/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/protobuf/">初识protobuf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是protobuf？"><a href="#1、什么是protobuf？" class="headerlink" title="1、什么是protobuf？"></a>1、什么是protobuf？</h2><blockquote>
<p>protocol buffers 是一种语言无关、平台无关、可扩展的<strong>序列化</strong>结构数据的方法，它可用于（数据）通信协议、数据存储等。</p>
<p>Protocol Buffers 是一种灵活，高效，自动化机制的结构数据序列化方法－可类比 XML，但是比 XML 更小（3 ~ 10倍）、更快（20 ~ 100倍）、更为简单。</p>
<p>你可以定义数据的结构，然后使用特殊生成的源代码轻松的在各种数据流中使用各种语言进行编写和读取结构数据。你甚至可以更新数据结构，而不破坏由旧数据结构编译的已部署程序。 ——<a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/">https://developers.google.com/protocol-buffers/</a></p>
</blockquote>
<p>简而言之，protobuf是一种<strong>序列化</strong>结构数据的方法，类似于XML、JSON，是一种数据传输格式，它的存储方式是二进制，所以有体量更小，解析速度更快的特点。</p>
<p>proto不能像JSON和XML一样开箱即用，需要利用工具（protoc）来编译成常用语言的所能够使用的文件（如果.java，.go等）。</p>
<p>protobuf更像是一个API合同，能够供服务端（Server）和客户端（Client）同时“阅读”的一种API约定、协议。其实它就是协议的一个缓冲文件，缓冲更好地凸显了它的名字中的<strong>buf</strong>（即buffers）</p>
<h2 id="2、为什么要使用protobuf？"><a href="#2、为什么要使用protobuf？" class="headerlink" title="2、为什么要使用protobuf？"></a>2、为什么要使用protobuf？</h2><ol>
<li>易读且容易理解</li>
<li>不同语言可以互相操作，因为可以利用工具生成不同语言的代码文件</li>
<li>体积小（存储方式是二进制）</li>
<li>更快的传输效率（存储方式是二进制）</li>
<li>相较于JSON和XML有更高效的序列化能力</li>
<li>非常安全（客户端和服务端之间强类型的API合同）</li>
</ol>
<h2 id="3、支持序列化"><a href="#3、支持序列化" class="headerlink" title="3、支持序列化"></a>3、支持序列化</h2><p>序列化的定义：序列化 (Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。序列化使其他代码可以查看或修改，那些不序列化便无法访问的对象实例数据。</p>
<p>可以把proto文件理解为上述所描述的<strong>存储区</strong>，可以从proto文件中反序列化出对象的状态，并且创建该对象。</p>
<p>proto相较于普通的序列化强大的一点是，它可以由开发人员按照一定的规范编写文件，并且可以利用protoc反序列化成其他任意语言能够解释的对象。</p>
<blockquote>
<p>如果有接触过Java的序列化就能更好理解，Java的序列化会将此时的Java对象的状态序列化到文件当中，但是该文件是不可读的，然后可以利用Java的反序列化将当时的Java对象的状态重建。</p>
</blockquote>
<h2 id="4、proto2和proto3"><a href="#4、proto2和proto3" class="headerlink" title="4、proto2和proto3"></a>4、proto2和proto3</h2><p>protobuf有两个大版本，proto2和proto3，目前比较新的都是使用proto3，proto3相较于proto2增加了更多语言的支持。</p>
<h2 id="5、protobuf包含什么？"><a href="#5、protobuf包含什么？" class="headerlink" title="5、protobuf包含什么？"></a>5、protobuf包含什么？</h2><ul>
<li>业务的描述（service）</li>
<li>有效负载消息实体（message）</li>
</ul>
<h2 id="6、第一次使用protobuf"><a href="#6、第一次使用protobuf" class="headerlink" title="6、第一次使用protobuf"></a>6、第一次使用protobuf</h2><h3 id="1、创建新的项目"><a href="#1、创建新的项目" class="headerlink" title="1、创建新的项目"></a>1、创建新的项目</h3><p>其中包含两个目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── go.mod</span><br><span class="line">├── pb				<span class="comment">#proto编译后的文件</span></span><br><span class="line">├── proto			<span class="comment">#proto原始文件</span></span><br></pre></td></tr></table></figure>



<h3 id="2、创建test-proto文件"><a href="#2、创建test-proto文件" class="headerlink" title="2、创建test.proto文件"></a>2、创建test.proto文件</h3><p>确保IDE已经安装了proto相关的插件。</p>
<p>在proto目录下创建</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;.;pb&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> query = <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> page_number = <span class="number">2</span>;</span><br><span class="line">  <span class="type">int32</span> result_per_page = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、利用protoc来编译"><a href="#3、利用protoc来编译" class="headerlink" title="3、利用protoc来编译"></a>3、利用protoc来编译</h3><p>确保go是1.1版本以上并且能够正常使用go mod</p>
<p>安装能够将proto文件编译成go能够使用的文件的插件<code>protoc-gen-go</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install google.golang.org/protobuf/cmd/protoc-gen-go@latest</span><br></pre></td></tr></table></figure>

<p>执行<code>protoc</code>编译命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=proto proto/*.proto --go_out=pb</span><br></pre></td></tr></table></figure>

<p>可以看到pb目录下已经有了经protoc编译后的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── go.mod</span><br><span class="line">├── pb</span><br><span class="line">│   └── test.pb.go</span><br><span class="line">├── proto</span><br><span class="line">│   └── test.proto</span><br></pre></td></tr></table></figure>

<h3 id="4、使用-go文件中的go对象"><a href="#4、使用-go文件中的go对象" class="headerlink" title="4、使用.go文件中的go对象"></a>4、使用.go文件中的go对象</h3><p><strong>OK！</strong>现在已经完成了一次proto文件的编写、以及编译，接下来就可以直接使用.go文件中的go语言能够使用的对象了。</p>
<p>接下来更需要关心的是proto文件的具体编写。</p>
<h2 id="7、编写proto文件"><a href="#7、编写proto文件" class="headerlink" title="7、编写proto文件"></a>7、编写proto文件</h2><p><code>syntax = &quot;proto3&quot;;</code>指定该proto文件的语法是proto3（必须）</p>
<p><code>option go_package = &quot;.;pb&quot;;</code>指定该proto输出到当前目录下的pb文件夹</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">xxx</span> &#123;</span><br><span class="line">  <span class="comment">// 字段规则：required -&gt; 字段只能也必须出现 1 次</span></span><br><span class="line">  <span class="comment">// 字段规则：optional -&gt; 字段可出现 0 次或1次</span></span><br><span class="line">  <span class="comment">// 字段规则：repeated -&gt; 字段可出现任意多次（包括 0）</span></span><br><span class="line">  <span class="comment">// 类型：int32、int64、sint32、sint64、string、32-bit ....</span></span><br><span class="line">  <span class="comment">// 字段编号：0 ~ 536870911（除去 19000 到 19999 之间的数字）</span></span><br><span class="line">  字段规则 类型 名称 = 字段编号;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义消息实体</p>
<h2 id="8、总结"><a href="#8、总结" class="headerlink" title="8、总结"></a>8、总结</h2><ol>
<li>XML、JSON、Protobuf都具有数据传输的能力</li>
<li>XML、JSON注重数据<strong>结构化</strong>，Protobuf注重数据<strong>序列化</strong></li>
<li>Protobuf使用场景更明确，XML、JSON使用场景更丰富且多元（更普遍）。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/protobuf/" data-id="clsblyue5000yw0k6hea97mwh" data-title="初识protobuf" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/protobuf/" rel="tag">protobuf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/python/python3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/python/python3/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/python/python3/">初学python3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="list列表"><a href="#list列表" class="headerlink" title="list列表"></a>list列表</h2><p>list是个有序集合，可以随时添加和删除其中的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classmates = [<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Tracy&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h3 id="append-追加元素"><a href="#append-追加元素" class="headerlink" title="append()追加元素"></a>append()追加元素</h3><h3 id="insert-向指定位置插入元素"><a href="#insert-向指定位置插入元素" class="headerlink" title="insert()向指定位置插入元素"></a>insert()向指定位置插入元素</h3><h3 id="pop-删除末尾元素或者指定位置元素"><a href="#pop-删除末尾元素或者指定位置元素" class="headerlink" title="pop()删除末尾元素或者指定位置元素"></a>pop()删除末尾元素或者指定位置元素</h3><h2 id="tuple元组"><a href="#tuple元组" class="headerlink" title="tuple元组"></a>tuple元组</h2><p>tuple一旦<strong>初始化就不能修改（指向不变）</strong>，比如同样是列出同学的名字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classmates = (<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Tracy&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="dict字典"><a href="#dict字典" class="headerlink" title="dict字典"></a>dict字典</h2><p>类似map，以key-value的方式存储</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;Michael&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Bob&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Tracy&#x27;</span>: <span class="number">85</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="pop-删除元素"><a href="#pop-删除元素" class="headerlink" title="pop()删除元素"></a>pop()删除元素</h3><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>



<h3 id="add-添加元素"><a href="#add-添加元素" class="headerlink" title="add()添加元素"></a>add()添加元素</h3><h3 id="remove-删除元素"><a href="#remove-删除元素" class="headerlink" title="remove()删除元素"></a>remove()删除元素</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/python/python3/" data-id="clsblyue70010w0k67h6qcqye" data-title="初学python3" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/kubenates/kubernetes" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/kubenates/kubernetes/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/kubenates/kubernetes/">kubernates的学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>本篇学习笔记总结自<a target="_blank" rel="noopener" href="https://k8s.easydoc.net/%EF%BC%8Chttps://www.bilibili.com/video/BV1Tg411P7EB/">https://k8s.easydoc.net/，https://www.bilibili.com/video/BV1Tg411P7EB/</a></p>
<h2 id="安装k8s集群"><a href="#安装k8s集群" class="headerlink" title="安装k8s集群"></a>安装k8s集群</h2><h3 id="主节点需要的组件"><a href="#主节点需要的组件" class="headerlink" title="主节点需要的组件"></a>主节点需要的组件</h3><ul>
<li>docker（也可以是其他容器运行时）</li>
<li>kubectl 集群命令行交互工具</li>
<li>kubeadm 集群初始化工具</li>
</ul>
<h3 id="工作节点需要的组件"><a href="#工作节点需要的组件" class="headerlink" title="工作节点需要的组件"></a>工作节点需要的组件</h3><ul>
<li>docker（也可以是其他容器运行时）</li>
<li>kubelet 管理 Pod 和容器，确保他们健康稳定运行。</li>
<li>kube-proxy 网络代理，负责网络相关的工作</li>
</ul>
<h2 id="部署应用到集群"><a href="#部署应用到集群" class="headerlink" title="部署应用到集群"></a>部署应用到集群</h2><h3 id="使用pod"><a href="#使用pod" class="headerlink" title="使用pod"></a>使用pod</h3><h4 id="快速创建"><a href="#快速创建" class="headerlink" title="快速创建"></a>快速创建</h4><p><code>--image=镜像地址</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run &lt;pod_name&gt; --image==&lt;image_url&gt;</span><br></pre></td></tr></table></figure>

<h4 id="通过yaml文件创建单个pod"><a href="#通过yaml文件创建单个pod" class="headerlink" title="通过yaml文件创建单个pod"></a>通过yaml文件创建单个pod</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">	<span class="comment"># pod名称</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># 定义容器，可以多个</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># 容器名字</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1</span> <span class="comment"># 镜像</span></span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &lt;file_path.&lt;yaml&gt;&gt;</span><br></pre></td></tr></table></figure>



<h4 id="通过yaml文件创建多个pod（deployment）"><a href="#通过yaml文件创建多个pod（deployment）" class="headerlink" title="通过yaml文件创建多个pod（deployment）"></a>通过yaml文件创建多个pod（deployment）</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># 部署名字</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">  <span class="comment"># 用来查找关联的 Pod，所有标签都匹配才行</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># 定义 Pod 相关数据</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 定义容器，可以多个</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># 容器名字</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v1</span> <span class="comment"># 镜像</span></span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &lt;file_path.&lt;yaml&gt;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>称之为development（部署）</strong>，并且可以使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get deployment</span><br></pre></td></tr></table></figure>

<p>查询当前的部署情况</p>
<blockquote>
<p><strong>Tips</strong></p>
<p>运行单个pod的yaml文件的kind为<code>Pod</code>，运行多个pod的yaml文件的kind为<code>Deployment</code></p>
</blockquote>
<h3 id="进入pod的bash"><a href="#进入pod的bash" class="headerlink" title="进入pod的bash"></a>进入pod的bash</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod_name&gt; -- bash</span><br></pre></td></tr></table></figure>

<h2 id="资源类型"><a href="#资源类型" class="headerlink" title="资源类型"></a>资源类型</h2><p>常见的资源类型有</p>
<table>
<thead>
<tr>
<th>类型名称</th>
<th>描述</th>
<th>简写</th>
</tr>
</thead>
<tbody><tr>
<td>pod</td>
<td></td>
<td>po</td>
</tr>
<tr>
<td>deployment</td>
<td></td>
<td>deploy</td>
</tr>
<tr>
<td>service</td>
<td></td>
<td>svc</td>
</tr>
<tr>
<td>statefulset</td>
<td></td>
<td>sts</td>
</tr>
<tr>
<td>storage class</td>
<td></td>
<td>sc</td>
</tr>
<tr>
<td>presistent volume</td>
<td></td>
<td>pv</td>
</tr>
<tr>
<td>presistent volume claim</td>
<td></td>
<td>pvc</td>
</tr>
<tr>
<td>config map</td>
<td></td>
<td>cm</td>
</tr>
<tr>
<td>sercet</td>
<td></td>
<td></td>
</tr>
<tr>
<td>name space</td>
<td></td>
<td>ns</td>
</tr>
</tbody></table>
<p>可以使用如下命令查看所有资源，资源名称及其简写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl api-resources </span><br></pre></td></tr></table></figure>



<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h3><p>运行资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply [-f] &lt;file_path&gt;</span><br><span class="line">										<span class="comment"># -f：读取文件，然后运行</span></span><br></pre></td></tr></table></figure>

<p>示例1，启用service资源：</p>
<p>service.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f service.yaml  <span class="comment"># 读取该文件，然后运行资源</span></span><br></pre></td></tr></table></figure>



<p>示例2：启动pod资源：</p>
<p>pod.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">	<span class="comment"># pod名称</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f pod.yaml </span><br></pre></td></tr></table></figure>



<p>同理，还可以运行更多资源，如deployment、statefulset等，具体资源类型由文件的kind决定。</p>
<h3 id="get"><a href="#get" class="headerlink" title="get"></a>get</h3><p>可以列出该类型的所有资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get [资源类型] [-o wide|name|yaml|json]</span><br><span class="line">											<span class="comment"># all：列出所有资源，包括pod、deployment、service等</span></span><br><span class="line">											<span class="comment"># -o wide：详细信息</span></span><br><span class="line">											<span class="comment"># -o name：仅输出资源名称</span></span><br><span class="line">											<span class="comment"># -o yaml：YAML格式化输出</span></span><br><span class="line">											<span class="comment"># -o json：JSON格式化输出</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod						<span class="comment"># 列出所有pod</span></span><br><span class="line">kubectl get pod	-o wide		<span class="comment"># 以详细的方式列出所有pod</span></span><br></pre></td></tr></table></figure>



<h3 id="describe"><a href="#describe" class="headerlink" title="describe"></a>describe</h3><p>查看资源的详细描述</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe [资源类型] &lt;name&gt;		<span class="comment"># 第一种写法：资源类型（如pod、svc）+空格+具体名称</span></span><br><span class="line">kubectl describe [资源类型]/&lt;name&gt; 		<span class="comment"># 第二种写法：资源类型+/+具体名称</span></span><br><span class="line">kubectl describe [资源类型]						<span class="comment"># 第三种写法：资源类型，不加具体名称。查看所有该资源的详细描述</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod test-pod</span><br><span class="line">kubectl describe pod/test-pod</span><br><span class="line">kubectl describe pod</span><br></pre></td></tr></table></figure>



<h3 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h3><p>查看资源的日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs [资源类型]/&lt;name&gt;	[-f] [-<span class="built_in">tail</span> 100]			<span class="comment"># 只能这种写法</span></span><br><span class="line">																		<span class="comment"># -f：循环读取，即可以读取不断改变的log</span></span><br><span class="line">																		<span class="comment"># -tail：读取最尾部xx行</span></span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs pod/test-k8s</span><br></pre></td></tr></table></figure>



<h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><p>删除资源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete [资源类型] &lt;name&gt;</span><br><span class="line">kubectl delete [资源类型]/&lt;name&gt;</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod/test-k8s</span><br></pre></td></tr></table></figure>



<h3 id="rollout"><a href="#rollout" class="headerlink" title="rollout"></a>rollout</h3><p>查看资源的变更历史history</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout <span class="built_in">history</span> [资源类型] &lt;name&gt;</span><br><span class="line">kubectl rollout <span class="built_in">history</span> [资源类型]/&lt;name&gt;</span><br></pre></td></tr></table></figure>



<p>重新部署restart（仅适用于deployment）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout restart deployment/&lt;name&gt;</span><br></pre></td></tr></table></figure>



<p>回退到上一版本undo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deployment/&lt;name&gt;</span><br></pre></td></tr></table></figure>



<p>回退到指定版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl rollout undo deployment/&lt;name&gt; --to-revision=2</span><br></pre></td></tr></table></figure>



<h3 id="port-forward"><a href="#port-forward" class="headerlink" title="port-forward"></a>port-forward</h3><p>将资源转发到本地</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward [资源类型] &lt;name&gt; [local_port]:[remote_port]</span><br><span class="line">kubectl port-forward [资源类型]/&lt;name&gt; [local_port]:[remote_port]</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p>将资源的8090的端口转发到本地的8080</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward svc/test-k8s 8080:8090</span><br></pre></td></tr></table></figure>



<h3 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令修改镜像，--record 表示把这个命令记录到操作历史中</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment test-k8s test-k8s=ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v2-with-error --record</span><br><span class="line"><span class="comment"># 暂停运行，暂停后，对 deployment 的修改不会立刻生效，恢复后才应用设置</span></span><br><span class="line">kubectl rollout pause deployment test-k8s</span><br><span class="line"><span class="comment"># 恢复</span></span><br><span class="line">kubectl rollout resume deployment test-k8s</span><br><span class="line"><span class="comment"># 重启</span></span><br><span class="line">kubectl rollout restart deployment test-k8s</span><br><span class="line"><span class="comment"># 删除全部资源</span></span><br><span class="line">kubectl delete all --all</span><br></pre></td></tr></table></figure>



<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>Service 通过 label 关联对应的 Pod</li>
<li>Servcie 生命周期不跟 Pod 绑定，不会因为 Pod 重创改变 IP</li>
<li>提供了负载均衡功能，自动转发流量到不同 Pod</li>
<li>可对集群外部提供访问端口</li>
<li>集群内部可通过服务名字访问</li>
</ul>
<blockquote>
<p><strong>Tips</strong></p>
<p>service一共有四种type：</p>
<h5 id="ClusterIP"><a href="#ClusterIP" class="headerlink" title="ClusterIP"></a>ClusterIP</h5><p>默认的，仅在集群内可用</p>
<h5 id="NodePort"><a href="#NodePort" class="headerlink" title="NodePort"></a>NodePort</h5><p>暴露端口到节点，提供了集群外部访问的入口<br>端口范围固定 30000 ~ 32767</p>
<h5 id="LoadBalancer"><a href="#LoadBalancer" class="headerlink" title="LoadBalancer"></a>LoadBalancer</h5><p>需要负载均衡器（通常都需要云服务商提供，裸机可以安装 <a target="_blank" rel="noopener" href="https://metallb.universe.tf/">METALLB</a> 测试）<br>会额外生成一个 IP 对外服务<br>K8S 支持的负载均衡器：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/services-networking/service/#internal-load-balancer">负载均衡器</a></p>
<h5 id="Headless"><a href="#Headless" class="headerlink" title="Headless"></a>Headless</h5><p>适合数据库<br>clusterIp 设置为 None 就变成 Headless 了，不会再分配 IP</p>
</blockquote>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>service.yaml:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: test-k8s</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: test-k8s</span><br><span class="line">  <span class="comment"># 默认 ClusterIP 集群内可访问，NodePort 节点可访问，LoadBalancer 负载均衡模式（需要负载均衡器才可用）</span></span><br><span class="line">  <span class="built_in">type</span>: ClusterIP</span><br><span class="line">  ports:</span><br><span class="line">    - port: 8080        <span class="comment"># 本 Service 的端口</span></span><br><span class="line">      targetPort: 8080  <span class="comment"># 容器端口</span></span><br><span class="line"><span class="comment">#      nodePort: 31000   # 节点端口，范围固定 30000 ~ 32767</span></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &lt;service_path&gt;</span><br></pre></td></tr></table></figure>



<h2 id="statefulset"><a href="#statefulset" class="headerlink" title="statefulset"></a>statefulset</h2><p>StatefulSet 是用来管理有状态的应用，例如数据库。StatefulSet 会固定每个 Pod 的名字</p>
<h3 id="特性-1"><a href="#特性-1" class="headerlink" title="特性"></a>特性</h3><ul>
<li>Service 的 <code>ClusterIP</code> 是空的，Pod 名字也是固定的。</li>
<li>Pod 创建和销毁是有序的，创建是顺序的，销毁是逆序的。</li>
<li>Pod 重建不会改变名字，除了IP，所以不要用IP直连</li>
</ul>
<p>访问时，如果直接使用 Service 名字连接，会随机转发请求<br>要连接指定 Pod，可以这样<code>pod-name.service-name</code></p>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>mongo.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># StatefulSet: mongodb</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent 仅本地没有镜像时才远程拉，Always 永远都是从远程拉，Never 永远只用本地镜像，本地没有则报错</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># Service: mongodb</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="comment"># HeadLess</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">27017</span></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &lt;file_path&gt;</span><br></pre></td></tr></table></figure>



<h2 id="pod、deployment、service、statefulset四者的关系"><a href="#pod、deployment、service、statefulset四者的关系" class="headerlink" title="pod、deployment、service、statefulset四者的关系"></a>pod、deployment、service、statefulset四者的关系</h2><p>这四者在yaml文件中通过指定不同的<code>kind</code>来区分，pod是deployment和statefulset运行的最小单元，deployment和statefulset可以通过指定<code>spec.replicas</code>来扩展多个pod，deployment启动的pod默认的名称为<code>deploy名称+无序字符</code>，而statefulset启动的pod的默认名称为<code>statefulset名称+有序数字</code>，如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod</span><br><span class="line">NAME                        READY   STATUS    RESTARTS      AGE</span><br><span class="line">mongodb-0                   1/1     Running   1 (20h ago)   3d17h</span><br><span class="line">test-k8s-75bd6fbdbc-72rxc   1/1     Running   1 (20h ago)   3d17h</span><br><span class="line">test-k8s-75bd6fbdbc-ns5h2   1/1     Running   1 (20h ago)   3d17h</span><br></pre></td></tr></table></figure>

<p>启动service并不会创建pod，只是service会通过label来关联pod或者deploy或者statefulset，可以随之进行端口转发，供外部访问。由于service是通过label关联pod的，所以pod销毁service也不会销毁的。</p>
<h2 id="数据持久化"><a href="#数据持久化" class="headerlink" title="数据持久化"></a>数据持久化</h2><p>k8s集群并不会为你处理数据的存储，我们可以为数据库挂载一个磁盘来确保数据的持久化。可以选择云存储、本地磁盘、NFS。</p>
<ul>
<li>本地磁盘：可以挂载某个节点上的目录，但是这需要限定 pod 在这个节点上运行</li>
<li>云存储：不限定节点，不受集群影响，安全稳定；需要云服务商提供，裸机集群是没有的。</li>
<li>NFS：不限定节点，不受集群影响</li>
</ul>
<h3 id="hostPath"><a href="#hostPath" class="headerlink" title="hostPath"></a>hostPath</h3><p>把节点上的一个目录挂载到 Pod，但是已经不推荐使用了，<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/storage/volumes/#hostpath">文档</a><br>配置方式简单，需要手动指定 Pod 跑在某个固定的节点。<br>仅供单节点测试使用；不适用于多节点集群。<br>minikube 提供了 hostPath 存储，<a target="_blank" rel="noopener" href="https://minikube.sigs.k8s.io/docs/handbook/persistent_volumes/">文档</a></p>
<p>将容器卷的挂载路径（<code>volumeMounts</code>）指向节点的卷路径（<code>volumes</code>）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent 仅本地没有镜像时才远程拉，Always 永远都是从远程拉，Never 永远只用本地镜像，本地没有则报错</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/data/db</span> <span class="comment"># 容器里面的挂载路径</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">mongo-data</span>    <span class="comment"># 卷名字，必须跟下面定义的名字一致</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo-data</span>              <span class="comment"># 卷名字</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/data/mongo-data</span>      <span class="comment"># 节点上的路径</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span>     <span class="comment"># 指向一个目录，不存在时自动创建</span></span><br><span class="line"><span class="comment">#        - name: mongo-data</span></span><br><span class="line"><span class="comment">#            persistentVolumeClaim:</span></span><br><span class="line"><span class="comment">#              claimName: mongodata</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="comment"># HeadLess</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">27017</span></span><br></pre></td></tr></table></figure>



<h2 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h2><p>yaml文件的kind是<code>ConfigMap</code>，<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/configmap/">官方文档</a></p>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><p>configmap.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># config-map的名称</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo-config</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># key-value</span></span><br><span class="line">  <span class="attr">mongo-address:</span> <span class="string">mongodb-0.mongodb:27017</span></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f configmap.yaml</span><br></pre></td></tr></table></figure>

<p>通过get查看并且输出为yaml格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get cm mongo-config -o yaml</span><br></pre></td></tr></table></figure>

<p>接下来就可以在其他地方被读取了，这里以一个App的环境变量为例：</p>
<p>app.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># 部署名字</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># 用来查找关联的 Pod，所有标签都匹配才行</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># 定义 Pod 相关数据</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 等待 mongodb 起来后才启动</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">wait-mongo</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&quot;until nslookup mongodb; do echo waiting for mongo; sleep 2; done&quot;</span>]</span><br><span class="line">      <span class="comment"># 定义容器，可以多个</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-k8s</span> <span class="comment"># 容器名字</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">ccr.ccs.tencentyun.com/k8s-tutorial/test-k8s:v4-configmap</span> <span class="comment"># 镜像</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_USERNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-username</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_PASSWORD</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-password</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_ADDRESS</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="comment"># 从config map资源中取</span></span><br><span class="line">              <span class="attr">configMapKeyRef:</span></span><br><span class="line">                <span class="comment"># 资源名称</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-config</span></span><br><span class="line">                <span class="comment"># 取资源中对应的key的value</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-address</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">test-k8s</span></span><br><span class="line">  <span class="comment"># 默认 ClusterIp 集群内可访问，NodePort 节点可访问，LoadBalancer 负载均衡模式（需要负载均衡器才可用）</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">nodePort:</span> <span class="number">31000</span>   <span class="comment"># 节点端口，范围固定 30000 ~ 32767</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span>        <span class="comment"># 本 Service 的端口</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span>  <span class="comment"># 容器端口</span></span><br></pre></td></tr></table></figure>

<p>可以看到env[2].name的valueFrom中是configMapKeyRef，则代表使用ConfigMap资源中取，并且指定ConfigMap资源的名称和key，即可以读取到内容了。</p>
<p>这里的<code>env:MONGO_ADDRESS</code>是从名叫<code>mongo-config</code>的ConfigMap资源中读取key为<code>mongo-address</code>对应的value，即<code>mongodb-0.mongodb:27017</code>。</p>
<h2 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h2><p>yaml文件的kind是<code>Secret</code>，<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/secret/">官方文档</a></p>
<h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h3><p>secret.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># secret的名称</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line"><span class="comment"># 默认的type是Opaque</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># key-value</span></span><br><span class="line">  <span class="comment"># 需要进行base64加密处理</span></span><br><span class="line">  <span class="attr">mongo-username:</span> <span class="string">bW9uZ291c2Vy</span></span><br><span class="line">  <span class="attr">mongo-password:</span> <span class="string">bW9uZ29wYXNz</span></span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f secret.yaml</span><br></pre></td></tr></table></figure>

<p>以yaml文件格式查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret mongo-secret -o yaml</span><br></pre></td></tr></table></figure>

<p>接下来就可以被其他地方读取了，这里mongo的statefulset为例</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mongo</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">mongo:4.4</span></span><br><span class="line">          <span class="comment"># IfNotPresent：仅本地没有镜像时才远程拉，Always：永远都是从远程拉，Never：永远只用本地镜像，本地没有则报错</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="comment"># 该container的环境变量列表</span></span><br><span class="line">          <span class="attr">env:</span>  </span><br><span class="line">          <span class="comment"># 环境变量名称</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_INITDB_ROOT_USERNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="comment"># &#x27;secretKeyRef&#x27;表示从secret资源中取</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="comment"># 指定secret的名称</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="comment"># 取secret中的key对应的value</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-username</span>                                          </span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MONGO_INITDB_ROOT_PASSWORD</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">secretKeyRef:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">mongo-secret</span></span><br><span class="line">                <span class="attr">key:</span> <span class="string">mongo-password</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mongodb</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mongodb</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="comment"># HeadLess</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">27017</span></span><br></pre></td></tr></table></figure>

<p>可以看到env[0].name的valueFrom中是secretKeyRef，则代表使用Secret资源中取，并且指定Secret资源的名称和key，即可以读取到内容了。</p>
<p>这里的<code>env:MONGO_INITDB_ROOT_USERNAME</code>是从名叫<code>mongo-secret</code>的ConfigMap资源中读取key为<code>mongo-username</code>对应的value，即<code>bW9uZ291c2Vy</code>,<code>env:MONGO_INITDB_ROOT_PASSWORD</code>同理。</p>
<p>可以看到，configMap和secret读取的方式是差不多的。</p>
<blockquote>
<p>Tips</p>
<p>如果type是Opaque的话，那么data需要进行<strong>base64处理</strong></p>
</blockquote>
<h2 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h2><p><code>Helm</code>类似 npm，pip，docker hub, 可以理解为是一个软件库，可以方便快速的为我们的集群安装一些第三方软件。<br>使用 Helm 我们可以非常方便的就搭建出来 MongoDB &#x2F; MySQL 副本集群，YAML 文件别人都给我们写好了，直接使用。<a target="_blank" rel="noopener" href="https://helm.sh/zh/">官网</a>，<a target="_blank" rel="noopener" href="https://artifacthub.io/">应用中心</a></p>
<p>我们可以在应用中心搜索集群，然后添加源并且安装就可以快速创建集群了，不需要自己手动写配置文件，并且我们可以在安装集群的时候手动指定一些参数。</p>
<h3 id="示例：安装mongodb"><a href="#示例：安装mongodb" class="headerlink" title="示例：安装mongodb"></a>示例：安装mongodb</h3><h4 id="1、添加源"><a href="#1、添加源" class="headerlink" title="1、添加源"></a>1、添加源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></pre></td></tr></table></figure>

<h4 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认安装</span></span><br><span class="line">helm install first-mongo bitnami/mongodb	</span><br><span class="line"><span class="comment"># 指定参数安装</span></span><br><span class="line">helm install my-mongo bitnami/mongodb --<span class="built_in">set</span> architecture=<span class="string">&quot;replicaset&quot;</span>,auth.rootPassword=<span class="string">&quot;mongopass&quot;</span>  </span><br></pre></td></tr></table></figure>

<p>具体可以手动指定的参数可以在应用中心中查看</p>
<h4 id="3、查看密码"><a href="#3、查看密码" class="headerlink" title="3、查看密码"></a>3、查看密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl get secret my-mongo-mongodb -o yaml</span><br><span class="line"><span class="comment"># 查看密码并且写入文件</span></span><br><span class="line">kubectl get secret my-mongo-mongodb -o yaml &gt; secret.yaml</span><br></pre></td></tr></table></figure>

<h4 id="4、查看"><a href="#4、查看" class="headerlink" title="4、查看"></a>4、查看</h4><p>可以查看到通过helm，已经自动安装好了包含可以扩展的pod、service、statefulset的集群。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all</span><br></pre></td></tr></table></figure>

<h4 id="5、测试"><a href="#5、测试" class="headerlink" title="5、测试"></a>5、测试</h4><p>临时运行一个包含 mongo client 的 debian 系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run mongodb-client --<span class="built_in">rm</span> --<span class="built_in">tty</span> -i --restart=<span class="string">&#x27;Never&#x27;</span> --image docker.io/bitnami/mongodb:4.4.10-debian-10-r20 --<span class="built_in">command</span> -- bash</span><br></pre></td></tr></table></figure>

<p>在client中利用url、username、password连接mongo server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo --host my-mongo-mongodb-0.my-mongo-mongodb-headless.default.svc.cluster.local:27017 -u root -p mongopass</span><br></pre></td></tr></table></figure>

<h4 id="6、转发集群端口到宿主机"><a href="#6、转发集群端口到宿主机" class="headerlink" title="6、转发集群端口到宿主机"></a>6、转发集群端口到宿主机</h4><p>此时可以通过宿主机的工具来尝试连接mongo server，如Navicat、DateGrip等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl port-forward svc/my-mongo-mongodb-headless 27018:27017</span><br></pre></td></tr></table></figure>

<h4 id="7、删除集群"><a href="#7、删除集群" class="headerlink" title="7、删除集群"></a>7、删除集群</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm delete first-mongo</span><br></pre></td></tr></table></figure>



<h2 id="namespace"><a href="#namespace" class="headerlink" title="namespace"></a>namespace</h2><h3 id="列出所有命名空间"><a href="#列出所有命名空间" class="headerlink" title="列出所有命名空间"></a>列出所有命名空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ns</span><br></pre></td></tr></table></figure>

<h3 id="查看默认的命名空间"><a href="#查看默认的命名空间" class="headerlink" title="查看默认的命名空间"></a>查看默认的命名空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all</span><br></pre></td></tr></table></figure>

<h3 id="查看指定的命名空间"><a href="#查看指定的命名空间" class="headerlink" title="查看指定的命名空间"></a>查看指定的命名空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all -n &lt;namespace&gt;</span><br></pre></td></tr></table></figure>

<h4 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h4><p>查看k8s系统的命名空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get all -n kube-system</span><br></pre></td></tr></table></figure>

<h3 id="创建命名空间"><a href="#创建命名空间" class="headerlink" title="创建命名空间"></a>创建命名空间</h3><p>每次部署或者查询时候都需要指定命名空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create namespace testns</span><br></pre></td></tr></table></figure>

<h3 id="部署应用到指定命名空间"><a href="#部署应用到指定命名空间" class="headerlink" title="部署应用到指定命名空间"></a>部署应用到指定命名空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f app.yml [-n|--namespace] &lt;namespace&gt;</span><br></pre></td></tr></table></figure>

<p>然后查询</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod [-n|--namespace] &lt;namespace&gt;</span><br></pre></td></tr></table></figure>

<p>每次部署应用或者查询时候都需要指定命名空间</p>
<h3 id="kubens"><a href="#kubens" class="headerlink" title="kubens"></a>kubens</h3><p>每次部署或者查询时候都需要指定命名空间有点麻烦，可以利用<code>kubens</code>快速切换命名空间，后续的命令就不需要再利用<code>-n｜--namespace</code>指定命名空间了。</p>
<h4 id="查看所有命名空间"><a href="#查看所有命名空间" class="headerlink" title="查看所有命名空间"></a>查看所有命名空间</h4><p>高亮显示当前所位于的命名空间</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubens</span><br></pre></td></tr></table></figure>

<h4 id="切换到指定命名空间"><a href="#切换到指定命名空间" class="headerlink" title="切换到指定命名空间"></a>切换到指定命名空间</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubens &lt;namespace&gt;</span><br></pre></td></tr></table></figure>

<h4 id="切换回上一命名空间"><a href="#切换回上一命名空间" class="headerlink" title="切换回上一命名空间"></a>切换回上一命名空间</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubens -</span><br></pre></td></tr></table></figure>



<h3 id="kubectx"><a href="#kubectx" class="headerlink" title="kubectx"></a>kubectx</h3><p>快速切换集群</p>
<h2 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h2><p>yaml文件的kind是<code>Ingress</code>，<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/services-networking/ingress/">官方文档</a>，是一个作用类似于Nginx的，能够提供对集群中的服务的外部访问进行管理的API对象</p>
<h3 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">simple-example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">tools.fun</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="comment"># 匹配&#x27;/easydoc&#x27;转发到service1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/easydoc</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service1</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">4200</span></span><br><span class="line">      <span class="comment"># 匹配&#x27;/svnbucket&#x27;转发到service2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/svnbucket</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">service2</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>





<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="Service中type为ClusterIP和NodePort的区别"><a href="#Service中type为ClusterIP和NodePort的区别" class="headerlink" title="Service中type为ClusterIP和NodePort的区别"></a>Service中type为ClusterIP和NodePort的区别</h3><p><code>ClusterIP</code>：通过集群内部的IP暴露服务，选择该值的时候服务只能在集群内部访问。是<code>service</code>默认的type。</p>
<p><code>NodePort</code>：通过每个节点上的IP和静态端口暴露服务。<code>NodePort</code>服务会路由到自动创建的<code>ClusterIP</code>服务，通过请求 <code>&lt;节点 IP&gt;:&lt;节点端口&gt;</code>，你可以从集群的外部访问一个 <code>NodePort</code> 服务。</p>
<h3 id="ConfigMap和Secret的区别"><a href="#ConfigMap和Secret的区别" class="headerlink" title="ConfigMap和Secret的区别"></a>ConfigMap和Secret的区别</h3><p>ConfigMap 是一种 API 对象，用来将<strong>非机密性</strong>的数据保存到键值对中。</p>
<blockquote>
<p><strong>注意：</strong></p>
<p>ConfigMap 并不提供保密或者加密功能。 如果你想存储的数据是机密的，请使用 <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/concepts/configuration/secret/">Secret</a>， 或者使用其他第三方工具来保证你的数据的私密性，而不是用 ConfigMap。</p>
</blockquote>
<p>Secret 是一种包含少量<strong>敏感信息</strong>例如密码、令牌或密钥的对象。</p>
<h3 id="使用dashboard可视化管理"><a href="#使用dashboard可视化管理" class="headerlink" title="使用dashboard可视化管理"></a>使用dashboard可视化管理</h3><p>默认情况下不会部署 Dashboard。可以通过以下命令部署：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.5.0/aio/deploy/recommended.yaml</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl proxy</span><br></pre></td></tr></table></figure>

<p>输入网址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/kubenates/kubernetes/" data-id="clsblyue70011w0k6alw9bp0p" data-title="kubernates的学习" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kubernates/" rel="tag">kubernates</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-front-end/uni-app/uni-app" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/front-end/uni-app/uni-app/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/front-end/uni-app/uni-app/">uni-app学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是uni-app？"><a href="#1、什么是uni-app？" class="headerlink" title="1、什么是uni-app？"></a>1、什么是uni-app？</h2><p><code>uni-app</code> 是一个使用 <a target="_blank" rel="noopener" href="https://vuejs.org/">Vue.js</a> 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、Web（响应式）、以及各种小程序（微信&#x2F;支付宝&#x2F;百度&#x2F;头条&#x2F;QQ&#x2F;钉钉&#x2F;淘宝）、快应用等多个平台。</p>
<p><code>uni-app</code>在手，做啥都不愁。即使不跨端，<code>uni-app</code>也是更好的小程序开发框架（<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35947">详见</a>）、更好的App跨平台框架、更方便的H5开发框架。不管领导安排什么样的项目，你都可以快速交付，不需要转换开发思维、不需要更改开发习惯。</p>
<p>uni-app功能框架：</p>
<p><img src="https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/87a0a0d0-60aa-11eb-8ff1-d5dcf8779628.png"></p>
<h2 id="2、为什么要使用uni-app？"><a href="#2、为什么要使用uni-app？" class="headerlink" title="2、为什么要使用uni-app？"></a>2、为什么要使用uni-app？</h2><p>对于开发者来说，如果你想要写一套代码，然后可以适用iOS、Android、Web（响应式），以及小程序（微信、支付宝），节省了开发时间，提高了开发效率，只是可能程序运行的效率会比微信原生差一些而已。</p>
<p>对于公司来说，如果你想要开发软件并且适用于iOS、Android、Web、以及各种小程序，那么你就得聘请iOS开发、Android开发、Web开发、以及各种小程序开发，这样不仅会提高成本，还可能降低开发效率。（这种说法仅限于为了敏捷开发，注重功能性，忽略质量以及程序运行效率）。所以这个时候只需要一个会uni-app开发的程序员（或者团队）就可以了。</p>
<p>需要注意的是：使用uni-app开发肯定没有iOS原生或者Android原生或者微信小程序原生或者Web原生开发效率高并且质量好（指的是程序的流程程度等），所以uni-app仅适合小而快的开发，而不适合大而精的开发。uni-app在web端还好，如果在iOS和Android是各种套浏览器各种套WebView体验肯定不可能会有原生好。</p>
<p>即使不需要跨端，uni-app也是很好的小程序开发框架</p>
<h2 id="3、学习uni-app需要用到的技术"><a href="#3、学习uni-app需要用到的技术" class="headerlink" title="3、学习uni-app需要用到的技术"></a>3、学习uni-app需要用到的技术</h2><p>前端知识：npm、vue.js、微信小程序开发。可以了解过微信小程序开发，但是必须掌握vue.js</p>
<p>开发工具：uni-app官方推荐的<a target="_blank" rel="noopener" href="https://www.dcloud.io/hbuilderx.html">HBuilderX</a>和<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">微信开发者工具</a>。利用HBuilder开发uni-app如果想要打包成微信开发者工具就必须要到微信开发者工具。</p>
<h2 id="4、第一个uni-app项目"><a href="#4、第一个uni-app项目" class="headerlink" title="4、第一个uni-app项目"></a>4、第一个uni-app项目</h2><ol>
<li><p>下载HBuilderX和微信开发者工具并且安装完成</p>
<p>注意安装完微信开发者工具需要打开然后登录后切记一定要开启“设置”-&gt;“安全”的服务端口：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115704092.png"></p>
</li>
<li><p>打开HBuilderX：选择“文件”-&gt;“新建”-&gt;“项目”，然后创建第一个uni-app项目：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115511406.png"></p>
<p>也可以使用<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/quickstart-cli">vue-cli的方式创建uni-app项目</a></p>
</li>
<li><p>运行到chrome浏览器或者微信小程序模拟：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115821793.png"></p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115902594.png"></p>
<p>等待编译器编译完成即可在chrome或者微信开发者工具中预览</p>
</li>
</ol>
<h2 id="5、uni-app项目的基本结构目录"><a href="#5、uni-app项目的基本结构目录" class="headerlink" title="5、uni-app项目的基本结构目录"></a>5、uni-app项目的基本结构目录</h2><p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407120408702.png"></p>
<h2 id="6、uni-app开发的基本规范"><a href="#6、uni-app开发的基本规范" class="headerlink" title="6、uni-app开发的基本规范"></a>6、uni-app开发的基本规范</h2><ul>
<li>页面文件遵循<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/single-file-components.html">Vue的单文件组件（SFC）</a></li>
<li>组件标签遵循小程序规范（可以自定义组件），<a target="_blank" rel="noopener" href="https://uniapp.dcloud.net.cn/component/README?id=%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6">uni-app组件</a></li>
<li>接口调用（JS API）靠近小程序开发规范，比如将<code>wx.</code>替换为<code>uni.</code>，<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/README">uni-app接口</a></li>
<li>数据绑定以及事件处理遵循vue规范，同时uni-app补充了app以及页面的生命周期</li>
<li>为了兼容多端运行，建议使用flex布局开发</li>
</ul>
<h2 id="7、globalStyle全局外观配置"><a href="#7、globalStyle全局外观配置" class="headerlink" title="7、globalStyle全局外观配置"></a>7、globalStyle全局外观配置</h2><p>可以在项目根目录的pages.json里定义全局的外观配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">//pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uni-app&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;globalStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uni-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>pages里配置单个页面的样式，globalStyle里配置全局页面的样式。具体对应的键和值可以参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=globalstyle">globalStyle文档</a></p>
<h2 id="8、创建一个页面并且配置路径和基本样式"><a href="#8、创建一个页面并且配置路径和基本样式" class="headerlink" title="8、创建一个页面并且配置路径和基本样式"></a>8、创建一个页面并且配置路径和基本样式</h2><p>在pages里创建目录，然后创建目录同名的vue文件，同时切记需要在根目录下的pages.json的pages里配置新的对象（类似vue-router），path就是刚刚创建的页面的路径，style就是创建的页面的基本样式。同vue-router类似，pages数组的第一个代表启动页。同globalStyle一样，单页面的style也可以参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=style">pages文档</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;pages/login/login&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;style&quot;</span> <span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;登录&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;enablePullDownRefresh&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;h5&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;pullToRefresh&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;#F1F1F1&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="comment">// &quot;navigationBarTitleText&quot;: &quot;uni-app&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;globalStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello,uni-app!&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;enablePullDownRefresh&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时还可以给当前页配置特定端的特定样式，比如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;h5&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pullToRefresh&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;#F1F1F1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>配置h5的下拉刷新的按钮是白色，然后其他端的下拉刷新不会受影响</p>
<h2 id="9、配置一个基本的tabBar"><a href="#9、配置一个基本的tabBar" class="headerlink" title="9、配置一个基本的tabBar"></a>9、配置一个基本的tabBar</h2><p>创建三个页面，分别是home（首页）、contact（通讯录）、profile（我的），并且在pages.json中的pages数组中配置他们的path和style</p>
<p>创建pages数组和globalStyle对象同级的tabBar对象：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;tabBar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span><span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/home/home&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;首页&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/contact/contact&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;通讯录&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/profile/profile&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;我的&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要包含基本的list数组，在list数组中配置单击跳转到的页面，pagePath就是路径，text就是显示的文字。切记需要先在pages数组中配置好页面，再在pagePath中配置他们。更多tabBar的配置项请参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=tabbar">tabBar文档</a></p>
<p>查看效果：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407132013585.png"></p>
<h2 id="10、配置condition以便调试具体页面"><a href="#10、配置condition以便调试具体页面" class="headerlink" title="10、配置condition以便调试具体页面"></a>10、配置condition以便调试具体页面</h2><p>在根目录的pages.json中配置跟pages数组和tabBar同级的condition以便调试具体某个页面。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;调试详情页&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/detail/detail&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;id=80&amp;name=test&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;调试我的页面&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/profile/profile&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;id=80&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，query参数在页面的生命周期函数onload中可以取到：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> id = params.<span class="property">id</span></span><br><span class="line">    <span class="keyword">let</span> name = params.<span class="property">name</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;id-&gt;&#x27;</span>,id)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name-&gt;&#x27;</span>,name)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<p>可以配置多个页面，然后在微信开发者工具中调试多个页面：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407152447731.png"></p>
<p>具体condition的配置请参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=condition">condtion文档</a></p>
<h2 id="11、基础内容组件之text"><a href="#11、基础内容组件之text" class="headerlink" title="11、基础内容组件之text"></a>11、基础内容组件之text</h2><p>text类似于html里的span标签，是行内标签。view类似于html里的div标签，是容器组件。</p>
<p>同时text组件有有很多可选属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>唱跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">selectable</span>&gt;</span>唱跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&quot;ensp&quot;</span>&gt;</span>唱    跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 四个空格被解析成了四个中文字符的一半 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&quot;emsp&quot;</span>&gt;</span>唱    跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 四个空格被解析成了四个中文字符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&quot;nbsp&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 30px;&quot;</span>&gt;</span>唱    跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 四个空格被解析成了一个30px的字符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体效果：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407155216577.png"></p>
<p>具体属性说明请参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/component/text">text组件文档</a></p>
<h2 id="12、基础容器组件之view"><a href="#12、基础容器组件之view" class="headerlink" title="12、基础容器组件之view"></a>12、基础容器组件之view</h2><p>view是类似于html里的div标签，是个容器组件。</p>
<p>view也有很多可选属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;box-big&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;box-big-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">class</span>=<span class="string">&quot;box-small&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">hover-class</span>=<span class="string">&quot;box-small-hover&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">hover-stop-propagation</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">:hover-start-time</span>=<span class="string">&quot;2000&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">:hover-stay-time</span>=<span class="string">&quot;3000&quot;</span>&gt;</span>内盒子<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-big</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-big-hover</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: <span class="number">#999999</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-small</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#007AFF</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-small-hover</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: <span class="number">#008000</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>class就是该组件的基本样式，hover-class就是该组件点击后的样式，hover-stop-propagation就是阻止冒泡样式，就是只是当前组件会有点击后的样式，而外层组件则不会，hover-start-time点击后多少毫米开始有样式，hover-stay-time点击后产生的样式会持续多少毫秒。</p>
<p>具体view容器组件可参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/component/view">view容器组件文档</a></p>
<h2 id="13、uni-app样式规范"><a href="#13、uni-app样式规范" class="headerlink" title="13、uni-app样式规范"></a>13、uni-app样式规范</h2><ul>
<li>rpx即响应式px，一种根据屏幕宽度自适应的动态像素单位，以750px宽的屏幕为基准，750rpx恰好为屏幕宽度。实际屏幕宽度增大，则rpx会根据宽度等比变大。比如750rpx在750px宽度的屏幕上显示满屏，此时宽度为750px，同样也会在375px的宽度的屏幕上显示满屏，此时宽度为375px</li>
<li>定义在App.vue中的样式为全局样式，会作用在全局的同名的类选择器或者id选择器上。在当前页面的样式为局部样式，只作用于当前页，同时同名局部样式会覆盖全局样式。</li>
</ul>
<h2 id="14、事件监听"><a href="#14、事件监听" class="headerlink" title="14、事件监听"></a>14、事件监听</h2><p>如果没有给事件传递参数，那么事件就可以拿到事件对象<code>$event</code>；如果传递了参数，同样可以使用<code>$event</code>来获取事件对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不传递参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;buttonClick1&quot;</span>&gt;</span>按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 传递参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;buttonClick2(20,$event)&quot;</span>&gt;</span>按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buttonClick1</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击按钮1&#x27;</span>,e);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buttonClick2</span>(<span class="params">number,$event</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击按钮2&#x27;</span>,number,$event);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="15、应用生命周期和页面生命周期"><a href="#15、应用生命周期和页面生命周期" class="headerlink" title="15、应用生命周期和页面生命周期"></a>15、应用生命周期和页面生命周期</h2><p>不仅仅是小程序，其实Android应用和iOS应用都会涉及到生命周期这个概念。</p>
<p>首选需要分清楚应用和页面的区别：</p>
<ul>
<li>应用是指整个app（iOS、Android）、整个小程序，顾名思义就是整个app的生命周期相关</li>
<li>页面是指这整个app中的某一个页面，所以页面的生命周期就是指该页面的生命周期，然后一个应用又有n多个页面组成。</li>
</ul>
<p>列举了一些uni-app可能会用到的常用的一些生命周期，具体可以参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/frame/lifecycle">生命周期的文档</a>。</p>
<h3 id="应用生命周期："><a href="#应用生命周期：" class="headerlink" title="应用生命周期："></a>应用生命周期：</h3><p>（挂载在App.vue上）</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onLaunch</td>
<td>当<code>uni-app</code> 初始化完成时触发（全局只触发一次）</td>
</tr>
<tr>
<td>onShow</td>
<td>当 <code>uni-app</code> 启动，或从后台进入前台显示</td>
</tr>
<tr>
<td>onHide</td>
<td>当 <code>uni-app</code> 从前台进入后台</td>
</tr>
<tr>
<td>onError</td>
<td>当 <code>uni-app</code> 报错时触发</td>
</tr>
</tbody></table>
<p>App.vue：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onLaunch</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用打开了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onShow</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用显示了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onHide</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用隐藏了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onError</span>: <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用加载失败了&#x27;</span>,error);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="页面生命周期："><a href="#页面生命周期：" class="headerlink" title="页面生命周期："></a>页面生命周期：</h3><p>（挂载在具体某个页面）</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onLoad</td>
<td>监听页面加载，其参数为上个页面传递的数据，参数类型为 Object（用于页面传参），参考<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/router?id=navigateto">示例</a></td>
</tr>
<tr>
<td>onShow</td>
<td>监听页面显示。页面每次出现在屏幕上都触发，包括从下级页面点返回露出当前页面</td>
</tr>
<tr>
<td>onReady</td>
<td>监听页面初次渲染完成。注意如果渲染速度快，会在页面进入动画完成前触发</td>
</tr>
<tr>
<td>onHide</td>
<td>监听页面隐藏</td>
</tr>
<tr>
<td>onUnload</td>
<td>监听页面卸载</td>
</tr>
</tbody></table>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;加载了，上个页面传递来的参数：&#x27;</span>,options);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;显示了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;初次渲染完成了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onHide</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;隐藏了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;被销毁了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是：onLoad的形参能够接收来自上一个页面传递过来的参数（仅仅是上一个页面），onShow和onHide分别是页面显示和页面隐藏时会调用的生命周期函数。</p>
<p><strong>Tips：</strong>由于内存管理机制相关，tabBar在切换时并不会重新加载和渲染页面，而只是会显示和隐藏页面。<strong>所以被tabBar管理的页面，只会执行一次onLoad和onShow。切记切记切记！！！除非强制刷新！！！</strong></p>
<h2 id="16、页面下拉刷新"><a href="#16、页面下拉刷新" class="headerlink" title="16、页面下拉刷新"></a>16、页面下拉刷新</h2><p>想要实现页面下拉刷新有两种方式，一种是在页面真正下拉以达到刷新页面的目的，另一种是使用uni内置的api模拟达到页面刷新的效果。</p>
<h3 id="真实下拉："><a href="#真实下拉：" class="headerlink" title="真实下拉："></a>真实下拉：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">addList</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//往数组中添加元素</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">movieList</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>:<span class="number">5</span>, <span class="attr">name</span>:<span class="string">&#x27;Agent Of Shiled&#x27;</span> &#125;) </span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先定义一个函数模拟向数组中添加元素（实际开发应该是重新获取数据，我这里模拟成了添加一个元素）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环遍历出数组 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in movieList&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;index&#125;&#125;-&#123;&#123;item.name&#125;&#125;-&#123;&#123;item.id&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: <span class="string">&#x27;列表页&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">movieList</span>: [</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;钢铁侠&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;美国队长&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;复仇者联盟&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;雷神&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                ]</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再定义一组数组，并且利用v-for遍历出来</p>
<p>定义生命周期函数<code>onPullDownRefresh()</code>（注：这个是生命周期函数）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生命周期函数监听页面下拉事件</span></span><br><span class="line"><span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面下拉了&#x27;</span>);</span><br><span class="line">    <span class="comment">//利用setTimeout模拟延时操作</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addList</span>() <span class="comment">//执行元素刷新操作</span></span><br><span class="line">        uni.<span class="title function_">stopPullDownRefresh</span>() <span class="comment">//停止下拉刷新的动画</span></span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p> 只要在页面上下拉了就会执行<code>onPullDownRefresh()</code>生命周期函数，然后执行元素刷新操作，然后关掉下拉刷新的动画。</p>
<h3 id="模拟下拉："><a href="#模拟下拉：" class="headerlink" title="模拟下拉："></a>模拟下拉：</h3><p>同时我们还可以通过定义事件来触发下拉，从而执行页面下拉这个生命周期函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">buttonClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;手动刷新&#x27;</span>);</span><br><span class="line">    uni.<span class="title function_">startPullDownRefresh</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义按钮点击事件，然后执行<code>uni.startPullDownRefresh()</code>此时页面就会下拉，就会触发页面下拉这个生命周期函数，从而刷新页面，达到了和真实下拉一样的效果（我们只需要点击按钮就可以了）。</p>
<p>所以，<code>uni.startPullDownRefresh()</code>等价于用户真实下拉页面这个操作。</p>
<p>完整代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 按钮模拟下拉刷新 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;buttonClick&quot;</span>&gt;</span>按钮下拉刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环遍历出数组 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in movieList&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;index&#125;&#125;-&#123;&#123;item.name&#125;&#125;-&#123;&#123;item.id&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: <span class="string">&#x27;列表页&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">movieList</span>: [</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;钢铁侠&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;美国队长&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;复仇者联盟&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;雷神&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                ]</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 生命周期函数监听页面下拉事件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面下拉了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">addList</span>() <span class="comment">//添加元素</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addList</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">movieList</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>:<span class="number">5</span>, <span class="attr">name</span>:<span class="string">&#x27;Agent Of Shiled&#x27;</span> &#125;) <span class="comment">//往数组中添加元素</span></span></span><br><span class="line"><span class="language-javascript">                    uni.<span class="title function_">stopPullDownRefresh</span>() <span class="comment">//停止下拉刷新的动画</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,<span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buttonClick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;手动刷新&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                uni.<span class="title function_">startPullDownRefresh</span>()</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="17、页面上划触底"><a href="#17、页面上划触底" class="headerlink" title="17、页面上划触底"></a>17、页面上划触底</h2><p>同样的，有一个页面的生命周期函数<code>onReachBottom()</code>是会在用户上划到页面底部后调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onReachBottom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面到底了&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">addList</span>() <span class="comment">//添加元素</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>但是不可以模拟手动上划触底。需要注意的是默认页面底部是距离屏幕底部50px，你也可以进行手动更改，在根目录下的pages.json里修改当前页面的style里的<code>&quot;onReachBottomDistance&quot;: 200</code>单位是px，详情参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=pages">pages.json文档</a></p>
<h2 id="18、发送网络请求"><a href="#18、发送网络请求" class="headerlink" title="18、发送网络请求"></a>18、发送网络请求</h2><p>由于很多端都不支持xhr，所以自然的并不是所有端都支持ajax。</p>
<p>关于网络请求，uni-app为了跨端使用封装了<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/request/request?id=request">uni.request API</a>，uni.request是极其类似ajax的：</p>
<p>基本用法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/request&#x27;</span>, <span class="comment">//仅为示例，并非真实接口地址。</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;uni.request&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">header</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;custom-header&#x27;</span>: <span class="string">&#x27;hello&#x27;</span> <span class="comment">//自定义请求头信息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">text</span> = <span class="string">&#x27;request success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但是我觉得自带的uni.request并不是很方便，于是自己在uni-app的插件市场寻找了一个叫<code>luch-request</code>的基于promise封装的很类似axios的网络请求组件，具体使用方式以及安装方式还有配置参数请参看：<a target="_blank" rel="noopener" href="https://www.quanzhan.co/luch-request/guide/3.x/#%E4%BB%8B%E7%BB%8D">luch-request</a></p>
<p>推荐采用npm的方式进行安装：</p>
<ol>
<li><p>生产package.json和node_modules</p>
<p>由于uni-app本身是没有自带package.json和node_modules的，所以我们需要以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>从而就会在项目目录下生成一个package.json和node_modules</p>
</li>
<li><p>利用npm install安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install luch-request</span><br></pre></td></tr></table></figure></li>
</ol>
<p>我的具体封装：</p>
<p>先在根目录建一个utils文件夹：存放request请求相关，主要配置好全局的baseURL和timeout以及request和response拦截器：</p>
<p>request.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入luch-request</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Request</span> <span class="keyword">from</span> <span class="string">&#x27;luch-request&#x27;</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="keyword">new</span> <span class="title class_">Request</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局配置</span></span><br><span class="line">http.<span class="property">config</span>.<span class="property">baseURL</span> = <span class="string">&#x27;http://localhost:8096&#x27;</span></span><br><span class="line">http.<span class="property">config</span>.<span class="property">timeout</span> = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//request拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span>=&gt;</span>&#123;</span><br><span class="line">	config.<span class="property">header</span>[<span class="string">&#x27;X-Client&#x27;</span>] = <span class="string">&#x27;manage-web&#x27;</span></span><br><span class="line">	<span class="comment">// console.log(&#x27;request config&#x27;,config);</span></span><br><span class="line">	<span class="keyword">return</span> config</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;request error&#x27;</span>,error);</span><br><span class="line">	<span class="keyword">throw</span> error</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//response拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">// console.log(&#x27;response&#x27;,response);</span></span><br><span class="line">	<span class="keyword">return</span> response.<span class="property">data</span></span><br><span class="line">&#125;,<span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response error&#x27;</span>,error);</span><br><span class="line">	<span class="keyword">throw</span> error</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> http.<span class="title function_">middware</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再在根目录创建一个api文件夹：存放具体请求相关：</p>
<p>user.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有工程用具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserList</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;user/selectList&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据编号删除车辆</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; id	编号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deleteUser</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;engineer/deleteUser&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: &#123;</span><br><span class="line">            <span class="attr">id</span>: id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先导入刚刚在utils文件夹里创建好的request，然后就传入url、method、params进行请求就可以了。最后在具体页面中使用：</p>
<p>list.vue：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;view&gt;</span><br><span class="line">    &lt;button @click=&quot;buttonClick&quot;&gt;发送请求&lt;/button&gt;</span><br><span class="line">    &lt;view v-for=&quot;item in list&quot;&gt;</span><br><span class="line">        &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123;</span><br><span class="line">        getEngineerList,</span><br><span class="line">        deleteVehicle</span><br><span class="line">    &#125; from &#x27;@/api/engineer.js&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                list: []</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            buttonClick()&#123;</span><br><span class="line">                this.getData1()</span><br><span class="line">                this.getData2()</span><br><span class="line">            &#125;,</span><br><span class="line">            getData1()&#123;</span><br><span class="line">                getEngineerList().then(res=&gt;&#123;</span><br><span class="line">                    console.log(res);</span><br><span class="line">                &#125;).catch(error=&gt;&#123;</span><br><span class="line">                    console.log(error);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            getData2()&#123;</span><br><span class="line">                deleteVehicle(10).then(res=&gt;&#123;</span><br><span class="line">                    console.log(res);</span><br><span class="line">                &#125;).catch(error=&gt;&#123;</span><br><span class="line">                    console.log(error);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>先从api中import他们，然后就可以利用Promise的方法使用他们啦。</p>
<p><strong>Tips：</strong>需要注意的是在跨端开发中，下载和上传请求的method的请求类型是<code>DOWNLOAD</code>和<code>UPLOAD</code>，然后最基本的两个请求类型是<code>GET</code>和<code>POST</code>。所以我认为掌握这最基本的4个请求类型就可以了。具体各端的method支持的情况:</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210413103532057.png"></p>
<p>封装方法很类似vue-element-admin的网络请求，如果你有这个框架的开发经验，那你肯定很快就能上手。<a target="_blank" rel="noopener" href="https://panjiachen.gitee.io/vue-element-admin-site/zh/guide/essentials/server.html">vue-element-admin与服务端交互</a></p>
<h2 id="19、路由和页面跳转"><a href="#19、路由和页面跳转" class="headerlink" title="19、路由和页面跳转"></a>19、路由和页面跳转</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/front-end/uni-app/uni-app/" data-id="clsblyue80013w0k6e1n24fv5" data-title="uni-app学习笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-full-stack/JWT/JWT整合SpringBoot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/full-stack/JWT/JWT%E6%95%B4%E5%90%88SpringBoot/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/full-stack/JWT/JWT%E6%95%B4%E5%90%88SpringBoot/">JWT认证原理，并整合SpringBoot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、JWT是什么？"><a href="#1、JWT是什么？" class="headerlink" title="1、JWT是什么？"></a>1、JWT是什么？</h2><p>JWT是Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（<a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://tools.ietf.org/html/rfc7519">(RFC 7519</a>).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p>
<h2 id="2、JWT的结构"><a href="#2、JWT的结构" class="headerlink" title="2、JWT的结构"></a>2、JWT的结构</h2><p>JWT由三部分组成，结构是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">header.payload.signature</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ</span><br></pre></td></tr></table></figure>

<p>中间由<code>.</code>连接起来</p>
<ol>
<li><p>header（头部）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span>				#签名使用的算法，例如HMAC SHA256或RSA</span><br><span class="line">    <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span>				#令牌的类型，即<span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后在利用base64加密：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span><br></pre></td></tr></table></figure>


</li>
<li><p>payload（有效负载）：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;role&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>通常是跟用户有关的实体，比如用户名，用户编号，用户角色。注意：不要在payload中携带敏感信息，比如用户密码。</p>
<p>然后在利用base64加密：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1aWQiOiIxIiwidXNlcm5hbWUiOiJhZG1pbiIsInJvbGUiOiJhZG1pbiJ9</span><br></pre></td></tr></table></figure>


</li>
<li><p>signature（签名）：</p>
<p>签名信息跟三个部分有关：header(base64)，payload(base64)，secret（密钥）</p>
<p>signature就是将header(base64)和payload(base64)使用<code>.</code>连接后的字符串，然后利用header中声明的加密算法加盐（密钥）secret进行组合加密，最后就成了signature。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java</span></span><br><span class="line"><span class="type">String</span> <span class="variable">encodeHeader</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>().encode(header);</span><br><span class="line"><span class="type">String</span> <span class="variable">encodePayload</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>().encode(payload);</span><br><span class="line"><span class="type">String</span> <span class="variable">encodeHeaderAndPayload</span> <span class="operator">=</span> encodeHeader + <span class="string">&quot;.&quot;</span> + encodePayload;</span><br><span class="line"><span class="type">String</span> <span class="variable">signature</span> <span class="operator">=</span> HMACSHA256(encodeHeaderAndPayload , <span class="string">&quot;secret&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>需要注意的是，secret密钥是保存在服务器的，是用来签发jwt和验证jwt的，同时jwt的签发也在服务端。</p>
<p>签名的目的：最后一部分签名，实际上是防止header和payload被人篡改，虽然，这三样东西在http传输中是暴露的，所有人都知道，但是签名的验证以及签发就只能在服务端实现，即使你修改了header或者payload，但是生成的第三部分的所需要的secret密钥别人是不知道的，所以其他人是无法篡改或者伪造的。</p>
</li>
</ol>
<h2 id="3、利用spring进行编码和解码"><a href="#3、利用spring进行编码和解码" class="headerlink" title="3、利用spring进行编码和解码"></a>3、利用spring进行编码和解码</h2><ol>
<li><p>引入jwt依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--java-jwt--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试生成token</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*   生成header.payload.signature格式的jwt</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">encode</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">instance</span> <span class="operator">=</span> Calendar.getInstance();<span class="comment">// 获取当前时间</span></span><br><span class="line">    instance.add(Calendar.SECOND,<span class="number">600</span>);<span class="comment">// 在当前时间上增加600秒</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *  withHeader声明header</span></span><br><span class="line"><span class="comment">     *  withClaim声明payload（可以声明多个）</span></span><br><span class="line"><span class="comment">     *  sign声明signature（利用算法Algorithm.HMAC256(密钥)）</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWT.create()</span><br><span class="line">            <span class="comment">//.withHeader() //默认是&#123;&quot;typ&quot;:&quot;JWT&quot;,&quot;alg&quot;:&quot;HS256&quot;&#125;</span></span><br><span class="line">            .withClaim(<span class="string">&quot;userId&quot;</span>, <span class="number">11</span>)</span><br><span class="line">            .withClaim(<span class="string">&quot;userName&quot;</span>, <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            <span class="comment">//.withExpiresAt(instance.getTime()) //token过期时间（可选）</span></span><br><span class="line">            .sign(Algorithm.HMAC256(<span class="string">&quot;!213213%^&amp;&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;生成的token-&gt;&quot;</span>+token);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用JWT的实例方法create()然后再添加header、payload、signature参数。就会生成一串JWT：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwidXNlcklkIjoxMX0.4km92AcjGRYvtwJeT8B2fhD8Qjfqq0SPvyH6m3X87cE</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取token中的payload</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*   解jwt</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">decode</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *   1、结合算法生成JWT验证对象</span></span><br><span class="line"><span class="comment">    *   2、利用JWT验证对象验证token的签名是否正确</span></span><br><span class="line"><span class="comment">    *   3、再从验证通过后的decodedJWT对象中获取参数</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="type">JWTVerifier</span> <span class="variable">verifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(<span class="string">&quot;!213213%^&amp;&quot;</span>)).build();</span><br><span class="line">    <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> verifier.verify(<span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyTmFtZSI6ImFkbWluIiwidXNlcklkIjoxMX0.4km92AcjGRYvtwJeT8B2fhD8Qjfqq0SPvyH6m3X87cE&quot;</span>);</span><br><span class="line">    System.out.println(decodedJWT.getHeader()); <span class="comment">// header的base64编码</span></span><br><span class="line">    System.out.println(decodedJWT.getPayload()); <span class="comment">// payload的base64编码</span></span><br><span class="line">    System.out.println(decodedJWT.getSignature()); <span class="comment">// signature的base64编码</span></span><br><span class="line">    System.out.println(decodedJWT.getExpiresAt()); <span class="comment">// 获得jwt的失效时间</span></span><br><span class="line">    System.out.println(decodedJWT.getClaim(<span class="string">&quot;userId&quot;</span>).asInt()); <span class="comment">// payload中的userId的值</span></span><br><span class="line">    System.out.println(decodedJWT.getClaim(<span class="string">&quot;userName&quot;</span>).asString()); <span class="comment">// payload中的userName的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意必须先结合算法验证token中的签名，然后才能获取token中的参数。</p>
</li>
</ol>
<h2 id="4、利用java-jwt验证token时的常见异常"><a href="#4、利用java-jwt验证token时的常见异常" class="headerlink" title="4、利用java-jwt验证token时的常见异常"></a>4、利用java-jwt验证token时的常见异常</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SignatureVerificationException	签名不一致</span><br><span class="line">TokenExpiredException		   令牌时效过期</span><br><span class="line">AlgorithmMismatchException	    算法不匹配</span><br><span class="line">InvalidClaimException		   payload失效</span><br></pre></td></tr></table></figure>

<h2 id="5、SpringBoot-web集成JWT"><a href="#5、SpringBoot-web集成JWT" class="headerlink" title="5、SpringBoot-web集成JWT"></a>5、SpringBoot-web集成JWT</h2><p>因为我们需要从数据库中查询是否存在该用户，然后再给予用户授权信息，所以需要持久化的数据层。</p>
<ol>
<li><p>封装好JWTUtils</p>
<p>负责生成token和验证token就可以了</p>
<p>JWTUtils.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    *   secret密钥</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SECRET</span> <span class="operator">=</span> <span class="string">&quot;!d$!3213#@F3@^G&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  生成JWT对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> payloadMap    有效负载集合</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> token    JWT令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String,String&gt; payloadMap)</span>&#123;</span><br><span class="line">        <span class="comment">//1、创建JWT的builder构造器</span></span><br><span class="line">        JWTCreator.<span class="type">Builder</span> <span class="variable">jwtBuilder</span> <span class="operator">=</span> JWT.create();</span><br><span class="line">        <span class="comment">//2、遍历payloadMap然后利用withClaim添加到JWT中</span></span><br><span class="line">        payloadMap.forEach((key,value)-&gt;&#123;</span><br><span class="line">            <span class="comment">//System.out.println(key+&quot;--&gt;&quot;+value);</span></span><br><span class="line">            jwtBuilder.withClaim(key,value);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">instance</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        instance.add(Calendar.DATE,<span class="number">7</span>); <span class="comment">// 7天token有效期</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> jwtBuilder</span><br><span class="line">                .withExpiresAt(instance.getTime())  <span class="comment">//3、添加JWT失效时间</span></span><br><span class="line">                .sign(Algorithm.HMAC256(SECRET));   <span class="comment">//4、利用算法结合SECRET给JWT签名</span></span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  获得验证签名后的JWT对象：</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token JWT令牌</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> decodedJWT   解密后的JWT对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DecodedJWT <span class="title function_">getTokenInfo</span><span class="params">(String token)</span>&#123;</span><br><span class="line">        <span class="comment">//1、结合算法验证JWT的签名</span></span><br><span class="line">        <span class="type">JWTVerifier</span> <span class="variable">verifier</span> <span class="operator">=</span> JWT.require(Algorithm.HMAC256(SECRET)).build();</span><br><span class="line">        <span class="comment">//2、解密JWT对象</span></span><br><span class="line">        <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> verifier.verify(token);</span><br><span class="line">        <span class="keyword">return</span> decodedJWT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>引入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--java-jwt--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--springboot-web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.38<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--springboot-test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>实体层pojo</p>
<p>User.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>  &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer uid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>mapper对数据库中数据进行增删改查</p>
<p>这是对user表进行增删改查，根据用户名和密码进行查询（用户登录验证用），查询所有用户是登录成功后能够进行的业务</p>
<p>UserMapper.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  根据用户名查询用户（用于登录）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 查询到的用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">selectUserByUsernameAndPassword</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span>String username,</span></span><br><span class="line"><span class="params">                                         <span class="meta">@Param(&quot;password&quot;)</span>String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  查询所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAllUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.wqk.demo.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByUsernameAndPassword&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;cn.wqk.demo.pojo.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            *</span><br><span class="line">        FROM</span><br><span class="line">            user</span><br><span class="line">        WHERE</span><br><span class="line">            username=#&#123;username&#125;</span><br><span class="line">        AND</span><br><span class="line">            password=#&#123;password&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;cn.wqk.demo.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            *</span><br><span class="line">        FROM</span><br><span class="line">            user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>service进一步封装查询出来的数据</p>
<p>登录业务</p>
<p>LoginService.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  检查登录是否成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username  用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password  用户密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  查询成功的用户的完整信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">checkLogin</span><span class="params">(String username,String password)</span> <span class="keyword">throws</span> RuntimeException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LoginServiceImpl.java:</p>
<p>如果用户名和密码查询成功，则直接返回查询到的用户对象，否则抛出异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LoginService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">checkLogin</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> RuntimeException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> userMapper.selectUserByUsernameAndPassword(username,password);</span><br><span class="line">        <span class="keyword">if</span> (userDB!=<span class="literal">null</span>)&#123; <span class="comment">// 用户存在，返回查询到的用户信息</span></span><br><span class="line">            <span class="keyword">return</span> userDB;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;认证失败，请重新登录！&quot;</span>); <span class="comment">//用户不存在，抛出异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserService.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  查询所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">allUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">allUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectAllUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>controller实现接口进行登录和访问</p>
<p>登录的controller:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">login</span><span class="params">(String username,String password)</span>&#123;</span><br><span class="line">    System.out.println(username);</span><br><span class="line">    System.out.println(password);</span><br><span class="line">    <span class="comment">// 初始化返回给前端的携带状态码的map</span></span><br><span class="line">    Map&lt;String, Object&gt; returnMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">// 认证成功</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">userDB</span> <span class="operator">=</span> loginService.checkLogin(username, password);</span><br><span class="line">        <span class="comment">// 认证成功后就把需要的东西生成map集合扔到JWT工具类以生成token</span></span><br><span class="line">        Map&lt;String, String&gt; payloadMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        payloadMap.put(<span class="string">&quot;uid&quot;</span>,userDB.getUid().toString());</span><br><span class="line">        payloadMap.put(<span class="string">&quot;username&quot;</span>,userDB.getUsername());</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWTUtils.createToken(payloadMap); <span class="comment">// 生成token</span></span><br><span class="line">        returnMap.put(<span class="string">&quot;state&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;认证成功&quot;</span>);</span><br><span class="line">        returnMap.put(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123; <span class="comment">// 认证失败</span></span><br><span class="line">        returnMap.put(<span class="string">&quot;state&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/allUser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title function_">allUser</span><span class="params">(String token)</span>&#123;</span><br><span class="line">    System.out.println(token);</span><br><span class="line">    HashMap&lt;String, Object&gt; returnMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    returnMap.put(<span class="string">&quot;state&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123; <span class="comment">//验证token</span></span><br><span class="line">        <span class="type">DecodedJWT</span> <span class="variable">decodedJWT</span> <span class="operator">=</span> JWTUtils.getTokenInfo(token);</span><br><span class="line">        returnMap.put(<span class="string">&quot;state&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;认证成功&quot;</span>);</span><br><span class="line">        List&lt;User&gt; userList = userService.allUser();</span><br><span class="line">        returnMap.put(<span class="string">&quot;data&quot;</span>,userList);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SignatureVerificationException e)&#123; <span class="comment">//签名不一致</span></span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;签名不一致&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (TokenExpiredException e)&#123; <span class="comment">//token过期</span></span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;token过期&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (AlgorithmMismatchException e) &#123; <span class="comment">// 算法不匹配</span></span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;签名算法不匹配&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvalidClaimException e) &#123; <span class="comment">// payload失效</span></span><br><span class="line">        returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;payload已失效&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> returnMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>   逻辑就是从前端里获取传来的token，然后第一步就是验证token，如果验证成功则将查询到的所有用户塞进返回的Map对象里，如果验证不成功，则返回响应的异常。</p>
<p>所以SpringBoot-web集成JWT的完整思路就是：登录生成token，业务验证token。</p>
<p>​		先从前端获取用户名和密码进行登录，如果登录成功则生成token并且塞进用户的response里面，这样用户后面所有的请求都必须携带这个token。用户登录成功想要进行业务的话，就需要先验证token是否有效并且合法，如果合法就能进行相应的业务，否则返回异常。</p>
<h2 id="6、配置Web拦截器来拦截器并且结合JWT来验证"><a href="#6、配置Web拦截器来拦截器并且结合JWT来验证" class="headerlink" title="6、配置Web拦截器来拦截器并且结合JWT来验证"></a>6、配置Web拦截器来拦截器并且结合JWT来验证</h2><p>上述的方法已经能够进行发放token，并且验证token是否合法了，但是有一个问题就是假如每有一个请求我都需要验证的话我就需要写很多重复的代码，所以我就可以交给SpringWeb的拦截器来做。</p>
<p>JWTInterceptor.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JWTInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  拦截器验证token，验证成功放行，否则不放行并且在response里塞入状态和错误信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>); <span class="comment">// 从request请求头中获取token</span></span><br><span class="line">        HashMap&lt;String, Object&gt; returnMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); <span class="comment">//初始化返回给前端的map</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JWTUtils.getTokenInfo(token); <span class="comment">//token验证</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">//token验证通过过滤器放行</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SignatureVerificationException e) &#123; <span class="comment">//签名不一致</span></span><br><span class="line">            returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;签名不一致&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TokenExpiredException e) &#123;  <span class="comment">//token已过期</span></span><br><span class="line">            returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;token已过期&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlgorithmMismatchException e) &#123; <span class="comment">//算法不匹配</span></span><br><span class="line">            returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;算法不匹配&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidClaimException e) &#123; <span class="comment">// payload已失效</span></span><br><span class="line">            returnMap.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;payload已失效&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        returnMap.put(<span class="string">&quot;status&quot;</span>,<span class="literal">false</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(returnMap); <span class="comment">//利用jackson将map转为json</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);  <span class="comment">//设置response响应格式</span></span><br><span class="line">        response.getWriter().println(json); <span class="comment">//将json塞进response里</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从request请求中获取键为token的header，然后进行验证，如果验证通过直接放行，否则返回响应的状态和错误信息。需要注意的是interceptor的返回值是true放行，false不放行，所以我们需要在不放行的response返回信息里面塞进相应的提示信息，所以就需要先将map集合转为json对象，然后写入到response里记得设置response的格式。</p>
<p>写好interceptor拦截器后就需要注册拦截器：</p>
<p>InterceptorConfig.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">JWTInterceptor</span>())   <span class="comment">// 注册JWT拦截器</span></span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/user/**&quot;</span>)                    <span class="comment">// 要拦截的请求</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/login/**&quot;</span>);               <span class="comment">// 不拦截的请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7、关于JWT需要注意的"><a href="#7、关于JWT需要注意的" class="headerlink" title="7、关于JWT需要注意的"></a>7、关于JWT需要注意的</h2><p>由于JWT生成的token的特性，token是存在客户端的，验证和发放是在服务端的，所以，并且在服务端的上验证token的环节只是利用算法和密钥来验证token而已。所以即使服务器重新启动，依旧不影响token的验证，仍然能验证通过。所以，建议，如果在修改了服务器的相关配置后，建议修改密钥，这样就可以使得客户端重新生成一次token，否则很有可能用户可以拿之前的token进行现在的业务。</p>
<p>由于配置了拦截器，如果需要在业务中获取token中的payload的话就直接从request的header中获取就可以了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/full-stack/JWT/JWT%E6%95%B4%E5%90%88SpringBoot/" data-id="clsblyueh0015w0k6ht8vgyg3" data-title="JWT认证原理，并整合SpringBoot" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-front-end/ECharts/echarts整合SpringBoot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/front-end/ECharts/echarts%E6%95%B4%E5%90%88SpringBoot/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/front-end/ECharts/echarts%E6%95%B4%E5%90%88SpringBoot/">ECharts简单上手使用并且整合SpringBoot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是ECharts"><a href="#1、什么是ECharts" class="headerlink" title="1、什么是ECharts"></a>1、什么是ECharts</h2><p>商业级数据图表，它是一个纯JavaScript的图标库，兼容绝大部分的浏览器，底层依赖轻量级的canvas类库ZRender，提供直观，生动，可交互，可高度个性化定制的数据可视化图表。创新的拖拽重计算、数据视图、值域漫游等特性大大增强了用户体验，赋予了用户对数据进行挖掘、整合的能力。简单点来讲就是纯前端的绘制简单的图表。</p>
<p>官网地址：<a target="_blank" rel="noopener" href="https://echarts.apache.org/">https://echarts.apache.org/</a></p>
<h2 id="2、ECharts能画什么图"><a href="#2、ECharts能画什么图" class="headerlink" title="2、ECharts能画什么图"></a>2、ECharts能画什么图</h2><p>折线图（区域图）、柱状图（条状图）、散点图（气泡图）、K线图、饼图（环形图）</p>
<p>雷达图（填充雷达图）、和弦图、力导向布局图、地图、仪表盘、漏斗图、事件河流图等12类图表</p>
<h2 id="3、安装ECharts"><a href="#3、安装ECharts" class="headerlink" title="3、安装ECharts"></a>3、安装ECharts</h2><p>需要先引入ECharts和jQuery的js，或者直接在html里面引入CDN</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入ECharts.js--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/echarts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--引入jQuery.js--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/jquery-3.5.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因为我们需要整合SpringBoot，所以我就使用Thymeleaf模板引擎来渲染，就需要给src前加上th，像这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入ECharts.js--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/echarts.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--引入jQuery.js--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/jquery-3.5.1.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4、简单使用ECharts"><a href="#4、简单使用ECharts" class="headerlink" title="4、简单使用ECharts"></a>4、简单使用ECharts</h2><h3 id="4-1-准备一个div盒子来放图表"><a href="#4-1-准备一个div盒子来放图表" class="headerlink" title="4.1 准备一个div盒子来放图表"></a>4.1 准备一个div盒子来放图表</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--为ECharts准备一个id为main，宽高都为500px的盒子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 500px;height: 500px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-利用Dom操作盒子然后设置图表的参数"><a href="#4-2-利用Dom操作盒子然后设置图表的参数" class="headerlink" title="4.2 利用Dom操作盒子然后设置图表的参数"></a>4.2 利用Dom操作盒子然后设置图表的参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、通过id获取到main并且用echarts初始化</span></span><br><span class="line"><span class="keyword">let</span> myChart=echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>));</span><br><span class="line"><span class="comment">//2、指定图表的配置项和数据</span></span><br><span class="line"><span class="keyword">let</span> option = &#123;</span><br><span class="line">	<span class="comment">//标题</span></span><br><span class="line">	<span class="attr">title</span>: &#123;</span><br><span class="line">		<span class="attr">text</span>: <span class="string">&#x27;ECharts 入门示例&#x27;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//配置信息</span></span><br><span class="line">	<span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">	<span class="attr">legend</span>: &#123;</span><br><span class="line">		<span class="attr">data</span>:[<span class="string">&#x27;销量&#x27;</span>]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">xAxis</span>: &#123;</span><br><span class="line">		<span class="attr">data</span>: [<span class="string">&quot;衬衫&quot;</span>,<span class="string">&quot;羊毛衫&quot;</span>,<span class="string">&quot;雪纺衫&quot;</span>,<span class="string">&quot;裤子&quot;</span>,<span class="string">&quot;高跟鞋&quot;</span>,<span class="string">&quot;袜子&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">series</span>: [&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: [<span class="number">10</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="number">80</span>, <span class="number">50</span>, <span class="number">9</span>]</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//3、使用刚指定的配置项和数据显示图表。</span></span><br><span class="line">myChart.<span class="title function_">setOption</span>(option);</span><br></pre></td></tr></table></figure>

<p>这样就可以在页面初始化的时候看到图表和图表上呈现数据了。</p>
<h2 id="5、ECharts集合SpringBoot和Ajax"><a href="#5、ECharts集合SpringBoot和Ajax" class="headerlink" title="5、ECharts集合SpringBoot和Ajax"></a>5、ECharts集合SpringBoot和Ajax</h2><p>因为大多数时候数据肯定不会是定死的，所以我们肯定需要从后端加载数据</p>
<h3 id="5-1-后端Controller模拟数据"><a href="#5-1-后端Controller模拟数据" class="headerlink" title="5.1 后端Controller模拟数据"></a>5.1 后端Controller模拟数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/data&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Map <span class="title function_">data</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span><span class="type">int</span> id)</span>&#123;</span><br><span class="line">        <span class="comment">//衬衫数量</span></span><br><span class="line">        <span class="type">int</span> shirtNumber=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//羊毛衫数量</span></span><br><span class="line">        <span class="type">int</span> woolSweaterNumber=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//雪纺衫数量</span></span><br><span class="line">        <span class="type">int</span> chiffonShirtNumber=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//裤子数量</span></span><br><span class="line">        <span class="type">int</span> pantsNumber=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//高跟鞋数量</span></span><br><span class="line">        <span class="type">int</span> highHeelsNumber=<span class="number">0</span>;</span><br><span class="line">        <span class="comment">//袜子数量</span></span><br><span class="line">        <span class="type">int</span> sockNumber=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (id==<span class="number">1</span>)&#123;</span><br><span class="line">            shirtNumber=<span class="number">20</span>;</span><br><span class="line">            woolSweaterNumber=<span class="number">30</span>;</span><br><span class="line">            chiffonShirtNumber=<span class="number">8</span>;</span><br><span class="line">            pantsNumber=<span class="number">80</span>;</span><br><span class="line">            highHeelsNumber=<span class="number">9</span>;</span><br><span class="line">            sockNumber=<span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (id==<span class="number">2</span>)&#123;</span><br><span class="line">            shirtNumber=<span class="number">2</span>;</span><br><span class="line">            woolSweaterNumber=<span class="number">3</span>;</span><br><span class="line">            chiffonShirtNumber=<span class="number">8</span>;</span><br><span class="line">            pantsNumber=<span class="number">8</span>;</span><br><span class="line">            highHeelsNumber=<span class="number">9</span>;</span><br><span class="line">            sockNumber=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        HashMap&lt;String, Integer&gt; numberMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        numberMap.put(<span class="string">&quot;shirtNumber&quot;</span>,shirtNumber);</span><br><span class="line">        numberMap.put(<span class="string">&quot;woolSweaterNumber&quot;</span>,woolSweaterNumber);</span><br><span class="line">        numberMap.put(<span class="string">&quot;chiffonShirtNumber&quot;</span>,chiffonShirtNumber);</span><br><span class="line">        numberMap.put(<span class="string">&quot;pantsNumber&quot;</span>,pantsNumber);</span><br><span class="line">        numberMap.put(<span class="string">&quot;highHeelsNumber&quot;</span>,highHeelsNumber);</span><br><span class="line">        numberMap.put(<span class="string">&quot;sockNumber&quot;</span>,sockNumber);</span><br><span class="line">        <span class="keyword">return</span> numberMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发起<code>/test/data</code>这个请求并且携带一个id作为参数，就可以得到key-value的键值对集合来模拟真实的数据。</p>
<h3 id="5-2-前端利用Ajax发起请求获得数据"><a href="#5-2-前端利用Ajax发起请求获得数据" class="headerlink" title="5.2 前端利用Ajax发起请求获得数据"></a>5.2 前端利用Ajax发起请求获得数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、通过id获取到main并且用echarts初始化</span></span><br><span class="line">      <span class="keyword">let</span> myChart=echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>));</span><br><span class="line">      <span class="comment">//开启loading效果</span></span><br><span class="line">      myChart.<span class="title function_">showLoading</span>();</span><br><span class="line">      <span class="comment">//Ajax的post请求</span></span><br><span class="line">      $.<span class="title function_">post</span>(&#123;</span><br><span class="line">          <span class="comment">//向后端发起的请求</span></span><br><span class="line">          <span class="attr">url</span>:<span class="string">&#x27;/test/data&#x27;</span>,</span><br><span class="line">          <span class="comment">//向后端发起的请求并且携带的数据</span></span><br><span class="line">          <span class="attr">data</span>: &#123;</span><br><span class="line">              <span class="attr">id</span>: id</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">//异步开启</span></span><br><span class="line">          <span class="attr">async</span>:<span class="literal">true</span>,</span><br><span class="line">          <span class="comment">//请求成功的回调函数</span></span><br><span class="line">          <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">              myChart.<span class="title function_">hideLoading</span>();<span class="comment">//关闭loading效果</span></span><br><span class="line">              <span class="comment">//打印回调里携带的数据</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">              number.<span class="property">shirtNumber</span>=e.<span class="property">shirtNumber</span>;</span><br><span class="line">              number.<span class="property">woolSweaterNumber</span>=e.<span class="property">woolSweaterNumber</span>;</span><br><span class="line">              number.<span class="property">chiffonShirtNumber</span>=e.<span class="property">chiffonShirtNumber</span>;</span><br><span class="line">              number.<span class="property">pantsNumber</span>=e.<span class="property">pantsNumber</span>;</span><br><span class="line">              number.<span class="property">highHeelsNumber</span>=e.<span class="property">highHeelsNumber</span>;</span><br><span class="line">              number.<span class="property">sockNumber</span>=e.<span class="property">sockNumber</span>;</span><br><span class="line">              <span class="comment">//2、指定图表的配置项和数据</span></span><br><span class="line">              <span class="keyword">let</span> option = &#123;</span><br><span class="line">                  <span class="comment">//标题</span></span><br><span class="line">                  <span class="attr">title</span>: &#123;</span><br><span class="line">                      <span class="attr">text</span>: <span class="string">&#x27;ECharts 入门示例&#x27;</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="comment">//配置信息</span></span><br><span class="line">                  <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">                  <span class="attr">legend</span>: &#123;</span><br><span class="line">                      <span class="attr">data</span>:[<span class="string">&#x27;销量&#x27;</span>]</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">                      <span class="attr">data</span>: [<span class="string">&quot;衬衫&quot;</span>,<span class="string">&quot;羊毛衫&quot;</span>,<span class="string">&quot;雪纺衫&quot;</span>,<span class="string">&quot;裤子&quot;</span>,<span class="string">&quot;高跟鞋&quot;</span>,<span class="string">&quot;袜子&quot;</span>]</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">                  <span class="attr">series</span>: [&#123;</span><br><span class="line">                      <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span><br><span class="line">                      <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                      <span class="attr">data</span>: [number.<span class="property">shirtNumber</span>, number.<span class="property">woolSweaterNumber</span>, number.<span class="property">chiffonShirtNumber</span>, number.<span class="property">pantsNumber</span>, number.<span class="property">highHeelsNumber</span>, number.<span class="property">sockNumber</span>]</span><br><span class="line">                  &#125;]</span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="comment">//3、使用刚指定的配置项和数据显示图表。</span></span><br><span class="line">              myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">//请求失败的回调函数</span></span><br><span class="line">          <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>

<p>所以数据就会在Ajax发起请求并且成功获取到数据的时候赋给图表里的data。因为ECharts自带loading动画的效果，所以在发起请求的时候使用<code>myChart.showLoading()</code>打开开启loading效果，在请求的成功的回调函数里使用<code>myCharts.hideLoading()</code>关闭loading效果。</p>
<h3 id="5-3-汇总"><a href="#5-3-汇总" class="headerlink" title="5.3 汇总"></a>5.3 汇总</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ECharts演示<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入ECharts.js--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/echarts.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入jQuery.js--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/js/jquery-3.5.1.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--为ECharts准备一个id为main，宽高都为500px的盒子--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 500px;height: 500px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//函数：给销量图上设置销量数据（异步加载）</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">setNumber</span>(<span class="params">number,id</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//1、通过id获取到main并且用echarts初始化</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> myChart=echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>));</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//开启loading效果</span></span></span><br><span class="line"><span class="language-javascript">        myChart.<span class="title function_">showLoading</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//Ajax的post请求</span></span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">post</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//向后端发起的请求</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">url</span>:<span class="string">&#x27;/test/data&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//向后端发起的请求并且携带的数据</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">id</span>: id</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//异步开启</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">async</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//请求成功的回调函数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                myChart.<span class="title function_">hideLoading</span>();<span class="comment">//关闭loading效果</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//打印回调里携带的数据</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">                number.<span class="property">shirtNumber</span>=e.<span class="property">shirtNumber</span>;</span></span><br><span class="line"><span class="language-javascript">                number.<span class="property">woolSweaterNumber</span>=e.<span class="property">woolSweaterNumber</span>;</span></span><br><span class="line"><span class="language-javascript">                number.<span class="property">chiffonShirtNumber</span>=e.<span class="property">chiffonShirtNumber</span>;</span></span><br><span class="line"><span class="language-javascript">                number.<span class="property">pantsNumber</span>=e.<span class="property">pantsNumber</span>;</span></span><br><span class="line"><span class="language-javascript">                number.<span class="property">highHeelsNumber</span>=e.<span class="property">highHeelsNumber</span>;</span></span><br><span class="line"><span class="language-javascript">                number.<span class="property">sockNumber</span>=e.<span class="property">sockNumber</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//2、指定图表的配置项和数据</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> option = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//标题</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">text</span>: <span class="string">&#x27;ECharts 入门示例&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">//配置信息</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>:[<span class="string">&#x27;销量&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&quot;衬衫&quot;</span>,<span class="string">&quot;羊毛衫&quot;</span>,<span class="string">&quot;雪纺衫&quot;</span>,<span class="string">&quot;裤子&quot;</span>,<span class="string">&quot;高跟鞋&quot;</span>,<span class="string">&quot;袜子&quot;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [number.<span class="property">shirtNumber</span>, number.<span class="property">woolSweaterNumber</span>, number.<span class="property">chiffonShirtNumber</span>, number.<span class="property">pantsNumber</span>, number.<span class="property">highHeelsNumber</span>, number.<span class="property">sockNumber</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;]</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//3、使用刚指定的配置项和数据显示图表。</span></span></span><br><span class="line"><span class="language-javascript">                myChart.<span class="title function_">setOption</span>(option);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//请求失败的回调函数</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">error</span>:<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//全局加载</span></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//销量对象</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> number=&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//衬衫数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">shirtNumber</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//羊毛衫数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">woolSweaterNumber</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//雪纺衫数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">chiffonShirtNumber</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//裤子数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">pantsNumber</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//高跟鞋数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">highHeelsNumber</span>:<span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//袜子数量</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">sockNumber</span>:<span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> id=<span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(number);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//设置销量图</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">setNumber</span>(number,id);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/front-end/ECharts/echarts%E6%95%B4%E5%90%88SpringBoot/" data-id="clsblyuei0017w0k6hvwd5iou" data-title="ECharts简单上手使用并且整合SpringBoot" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/echarts/" rel="tag">echarts</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-full-stack/WebScoket/前后端使用利用WebSocket进行通信" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/full-stack/WebScoket/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BD%BF%E7%94%A8%E5%88%A9%E7%94%A8WebSocket%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/full-stack/WebScoket/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BD%BF%E7%94%A8%E5%88%A9%E7%94%A8WebSocket%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/">前后端使用利用WebSocket进行通信</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、前后端如何连接"><a href="#1、前后端如何连接" class="headerlink" title="1、前后端如何连接"></a>1、前后端如何连接</h2><p><img src="/2023/07/19/full-stack/WebScoket/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BD%BF%E7%94%A8%E5%88%A9%E7%94%A8WebSocket%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/image-20210602120124374.png"></p>
<p>服务端利用SpringBoot启动<strong>一个</strong>WebSocket服务，同时暴露出该服务的应用路径，客户端则利用该应用路径进行连接。需要注意的是，在服务端只需要启动一个WebSocket服务，而每一个客户端就是一个WebSocket应用。</p>
<p><img src="/2023/07/19/full-stack/WebScoket/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BD%BF%E7%94%A8%E5%88%A9%E7%94%A8WebSocket%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/image-20210602120348676.png"></p>
<p>就有点像：服务端是古老的电话接线员，而客户端就是打电话的人。假如用户A想要给用户B打电话就需要先打电话到接线员那，然后接线员再接通用户B。不过WebSocket可以实现广播和私聊。</p>
<h2 id="2、前端初始化WebSocket对象"><a href="#2、前端初始化WebSocket对象" class="headerlink" title="2、前端初始化WebSocket对象"></a>2、前端初始化WebSocket对象</h2><p>不需要引入第三方依赖包，直接使用js自带的WebSocket对象。</p>
<ol>
<li><p>创建WebSocket对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8000/websocket/&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>ws://</code>和<code>jdbc://</code>、<code>http://</code>一样都是协议名，同样的，Websocket还支持更加安全的<code>wss://</code>，<code>/websocket</code>即该服务的应用路径名</p>
</li>
<li><p>onopen事件监听</p>
<p>与服务端连接成功会触发。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">webSocketOnOpen</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接打开-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>onerror事件监听</p>
<p>与服务端连接异常时触发。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">webSocketOnError</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接异常-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>onclose事件监听</p>
<p>与服务端连接关闭时触发。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">webSocketOnClose</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接关闭-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>onmessage事件监听</p>
<p><strong>接收到来自服务端的消息时触发</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">webSocketOnMessage</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;来自服务端的消息-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ol>
<p>一个完整的WebSocket对象应该具备以上属性，同时需要将以上属性跟WebSocket对象绑定。</p>
<h3 id="使用原生JS初始化WebSocket对象演示"><a href="#使用原生JS初始化WebSocket对象演示" class="headerlink" title="使用原生JS初始化WebSocket对象演示"></a>使用原生JS初始化WebSocket对象演示</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(webSocketUrl)</span><br><span class="line"><span class="comment">//onopen事件监听</span></span><br><span class="line">ws.<span class="title function_">addEventListener</span>(<span class="string">&#x27;open&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接打开-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line"><span class="comment">//onclose事件监听</span></span><br><span class="line">ws.<span class="title function_">addEventListener</span>(<span class="string">&#x27;close&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接关闭-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line"><span class="comment">//onmessage事件监听</span></span><br><span class="line">ws.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;来自服务端的消息-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br><span class="line"><span class="comment">//onerror事件监听</span></span><br><span class="line">ws.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>,<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接异常-&gt;&#x27;</span>,e)</span><br><span class="line">&#125;,<span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>ws对象的addEventListener( )方法，为WebSocket绑定事件监听，从而在各个事件监听中处理事务。</p>
<h3 id="使用Vue初始化WebSocket对象演示"><a href="#使用Vue初始化WebSocket对象演示" class="headerlink" title="使用Vue初始化WebSocket对象演示"></a>使用Vue初始化WebSocket对象演示</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">webSocketObject</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//初始化WebSocket</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">webSocketInit</span>()</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">webSocketInit</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">const</span> webSocketUrl = <span class="string">&#x27;ws://localhost:8000/websocket/&#x27;</span>+<span class="variable language_">this</span>.<span class="property">username</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">webSocketObject</span> = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(webSocketUrl);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">webSocketObject</span>.<span class="property">onopen</span> = <span class="variable language_">this</span>.<span class="property">webSocketOnOpen</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">webSocketObject</span>.<span class="property">onmessage</span> = <span class="variable language_">this</span>.<span class="property">webSocketOnMessage</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">webSocketObject</span>.<span class="property">onerror</span> = <span class="variable language_">this</span>.<span class="property">webSocketOnError</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">webSocketObject</span>.<span class="property">onclose</span> = <span class="variable language_">this</span>.<span class="property">webSocketOnClose</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">webSocketOnOpen</span>(<span class="params">e</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接打开-&gt;&#x27;</span>,e)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">webSocketOnMessage</span>(<span class="params">e</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;来自服务端的消息-&gt;&#x27;</span>,e)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">webSocketOnError</span>(<span class="params">e</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接异常-&gt;&#x27;</span>,e)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">webSocketOnClose</span>(<span class="params">e</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务端连接关闭-&gt;&#x27;</span>,e)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>同样的，利用methods分别定义好OnOpen、OnMessage、OnError、OnClose四个事件监听，然后进行初始化并且绑定就可以了。</p>
<p>这样就完成了WebSocket对象以及事件监听的初始化。</p>
<h2 id="3、后端初始化WebSocket对象"><a href="#3、后端初始化WebSocket对象" class="headerlink" title="3、后端初始化WebSocket对象"></a>3、后端初始化WebSocket对象</h2><p>SpringBoot自带的WebSocket有以下5个注解需要注意：</p>
<ol>
<li><p>@ServerEndpoint</p>
<p>暴露出的ws应用的路径，支持RESTful风格传参，类似<code>/websocket/&#123;username&#125;</code></p>
</li>
<li><p>@OnOpen</p>
<p>与当前客户端连接成功，有入参<code>Session</code>对象（当前连接对象），同时可以利用<code>@PathParam()</code>获取上述应用路径中传递的参数，比如<code>@PathParam(&quot;username&quot;) String username</code>。</p>
</li>
<li><p>@OnClose</p>
<p>与当前客户端连接失败，有入参<code>Session</code>对象（当前连接对象），同时也可以利用<code>@PathParam()</code>获取上述应用路径中传递的参数。</p>
</li>
<li><p>@OnError</p>
<p>与当前客户端连接异常，有入参<code>Session</code>对象（当前连接对象）、<code>Throwable</code>对象（异常对象），同时也可以利用<code>@PathParam()</code>获取上述应用路径中传递的参数。</p>
</li>
<li><p>@OnMessage</p>
<p>当前客户端发送消息，有入参<code>Session</code>对象（当前连接对象）、<code>String message</code>对象（当前客户端传递过来的字符串消息）</p>
</li>
</ol>
<p>利用SpringBoot创建项目，需要引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在application.yaml中定义好该服务的端口号：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br></pre></td></tr></table></figure>

<p>利用自定义配置类开启WebSocket：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.wqk.serverwebsocket.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>定义Websocket主业务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.wqk.serverwebsocket.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;username&#125;&quot;)</span> <span class="comment">//暴露的ws应用的路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端与服务端连接成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onOpen</span></span><br><span class="line"><span class="comment">            与当前客户端连接成功时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端与服务端连接关闭</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Session session,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onClose</span></span><br><span class="line"><span class="comment">            与当前客户端连接关闭时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端与服务端连接异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> error</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable error,Session session,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端向服务端发送消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMsg</span><span class="params">(Session session,String message,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onMessage</span></span><br><span class="line"><span class="comment">            收到来自当前客户端的消息时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4、前后端联动实现简单聊天室"><a href="#4、前后端联动实现简单聊天室" class="headerlink" title="4、前后端联动实现简单聊天室"></a>4、前后端联动实现简单聊天室</h2><p>前端在OnMessage事件监听中接收到来自后端的消息，然后进行处理（展示在页面上）；同样的，后端也是在OnMessage中接收到来自前端的消息，然后进行处理（发送到所有客户端）。</p>
<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><ol>
<li><p>定义一个输入框，再定义一个按钮：接收消息并且发送</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;input</span><br><span class="line">       type=&quot;text&quot;</span><br><span class="line">       v-model=&quot;sendMessage&quot;</span><br><span class="line">       placeholder=&quot;请输入你要发送的消息&quot;&gt;</span><br><span class="line">&lt;button @click=&quot;handleSendButton()&quot;&gt;发送&lt;/button&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">handleSendButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> username = <span class="variable language_">this</span>.<span class="property">username</span></span><br><span class="line">    <span class="keyword">const</span> message = <span class="variable language_">this</span>.<span class="property">sendMessage</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">webSocketObject</span>.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">        message,</span><br><span class="line">        username,</span><br><span class="line">        <span class="attr">time</span>: <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">sendMessage</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>直接利用websocket对象的<code>send()</code>方法发送消息，前后端数据传输利用JSON字符串，所以发送的时候需要将对象转为JSON字符串。</p>
</li>
<li><p>定义一个列表：用于展示聊天信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;消息编号&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;发送者&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;发送时间&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;发送内容&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/thead&gt;</span><br><span class="line">    &lt;tbody&gt;</span><br><span class="line">        &lt;tr v-for=&quot;item in messageList&quot; :key=&quot;item.time&quot;&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; item.id &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; item.username &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; new Date(item.time).toLocaleTimeString() &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; item.message &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当客户端的onMessage接收到消息后就把消息展示到列表中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">webSocketOnMessage</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;来自服务端的消息-&gt;&#x27;</span>,e)</span><br><span class="line">    <span class="keyword">const</span> receiveMessage = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(e.<span class="property">data</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">messageList</span>.<span class="title function_">push</span>(receiveMessage)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>通过console.log(e)不难发现，来自服务端的消息是存储在e.data中的，并且是JSON字符串，所以我们需要将它转为JSON对象。</p>
</li>
</ol>
<p>此时已经完成了前端发送消息并且接收消息且展示消息了。</p>
<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><p>接收消息并且群发消息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnMessage</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMsg</span><span class="params">(Session session,String message,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onMessage</span></span><br><span class="line"><span class="comment">            收到来自当前客户端的消息时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    sendAllMessage(message);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//向所有客户端发送消息（广播）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendAllMessage</span><span class="params">(String message)</span>&#123;</span><br><span class="line">    Set&lt;String&gt; sessionIdSet = onlineClientMap.keySet(); <span class="comment">//获得Map的Key的集合</span></span><br><span class="line">    <span class="keyword">for</span> (String sessionId : sessionIdSet) &#123; <span class="comment">//迭代Key集合</span></span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> onlineClientMap.get(sessionId); <span class="comment">//根据Key得到value</span></span><br><span class="line">        session.getAsyncRemote().sendText(message); <span class="comment">//发送消息给客户端</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">      &lt;thead&gt;</span><br><span class="line">      &lt;tr&gt;</span><br><span class="line">        &lt;th&gt;消息编号&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;发送者&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;发送时间&lt;/th&gt;</span><br><span class="line">        &lt;th&gt;发送内容&lt;/th&gt;</span><br><span class="line">      &lt;/tr&gt;</span><br><span class="line">      &lt;/thead&gt;</span><br><span class="line">      &lt;tbody&gt;</span><br><span class="line">      &lt;tr v-for=&quot;item in messageList&quot; :key=&quot;item.time&quot;&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; item.id &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; item.username &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; new Date(item.time).toLocaleTimeString() &#125;&#125;&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;&#123;&#123; item.message &#125;&#125;&lt;/td&gt;</span><br><span class="line">      &lt;/tr&gt;</span><br><span class="line">      &lt;/tbody&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">    &lt;input</span><br><span class="line">        type=&quot;text&quot;</span><br><span class="line">        v-model=&quot;sendMessage&quot;</span><br><span class="line">        placeholder=&quot;请输入你要发送的消息&quot;&gt;</span><br><span class="line">    &lt;button @click=&quot;handleSendButton()&quot;&gt;发送&lt;/button&gt;</span><br><span class="line">    &lt;button @click=&quot;handleLogoutButton()&quot;&gt;退出&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">  getUsername,</span><br><span class="line">  removeUsername</span><br><span class="line">&#125; from &quot;@/utils/username&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Home&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      webSocketObject: null,</span><br><span class="line">      username: &#x27;&#x27;,</span><br><span class="line">      messageList: [</span><br><span class="line"></span><br><span class="line">      ],</span><br><span class="line">      sendMessage: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    //从localStorage中获得username</span><br><span class="line">    this.username = getUsername()</span><br><span class="line">    //如果username不存在返回到登录页面</span><br><span class="line">    if (!this.username)&#123;</span><br><span class="line">      this.$router.push(&#123;</span><br><span class="line">        name: &#x27;Login&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    //初始化WebSocket</span><br><span class="line">    this.webSocketInit()</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeDestroy() &#123;</span><br><span class="line">    this.webSocketObject.close();//在该组件销毁时关闭该连接以节约资源</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    webSocketInit()&#123;</span><br><span class="line">      const webSocketUrl = &#x27;ws://localhost:8000/websocket/&#x27;+this.username</span><br><span class="line">      this.webSocketObject = new WebSocket(webSocketUrl);</span><br><span class="line">      this.webSocketObject.onopen = this.webSocketOnOpen</span><br><span class="line">      this.webSocketObject.onmessage = this.webSocketOnMessage</span><br><span class="line">      this.webSocketObject.onerror = this.webSocketOnError</span><br><span class="line">      this.webSocketObject.onclose = this.webSocketOnClose</span><br><span class="line">    &#125;,</span><br><span class="line">    webSocketOnOpen(e)&#123;</span><br><span class="line">      console.log(&#x27;与服务端连接打开-&gt;&#x27;,e)</span><br><span class="line">    &#125;,</span><br><span class="line">    webSocketOnMessage(e)&#123;</span><br><span class="line">      console.log(&#x27;来自服务端的消息-&gt;&#x27;,e)</span><br><span class="line">      const receiveMessage = JSON.parse(e.data);</span><br><span class="line">      this.messageList.push(receiveMessage)</span><br><span class="line">    &#125;,</span><br><span class="line">    webSocketOnError(e)&#123;</span><br><span class="line">      console.log(&#x27;与服务端连接异常-&gt;&#x27;,e)</span><br><span class="line">    &#125;,</span><br><span class="line">    webSocketOnClose(e)&#123;</span><br><span class="line">      console.log(&#x27;与服务端连接关闭-&gt;&#x27;,e)</span><br><span class="line">    &#125;,</span><br><span class="line">    handleSendButton() &#123;</span><br><span class="line">      const username = this.username</span><br><span class="line">      const message = this.sendMessage</span><br><span class="line">      this.webSocketObject.send(JSON.stringify(&#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        message,</span><br><span class="line">        username,</span><br><span class="line">        time: new Date().getTime()</span><br><span class="line">      &#125;))</span><br><span class="line">      this.sendMessage = &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleLogoutButton()&#123;</span><br><span class="line">      removeUsername() //清除username然后断开连接</span><br><span class="line">      this.webSocketObject.close();</span><br><span class="line">      this.$router.push(&#123;</span><br><span class="line">        name: &#x27;Login&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips：</strong></p>
<p>我这里采用的是在上一个页面获取到用户的用户名然后存储到LocalStorage中。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.wqk.serverwebsocket.socket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.*;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.PathParam;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;username&#125;&quot;)</span> <span class="comment">//暴露的ws应用的路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocket</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 当前在线客户端数量（线程安全的） */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">onlineClientNumber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 当前在线客户端集合（线程安全的）：以键值对方式存储，key是连接的编号，value是连接的对象 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String ,Session&gt; onlineClientMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端与服务端连接成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onOpen</span></span><br><span class="line"><span class="comment">            与当前客户端连接成功时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        onlineClientNumber.incrementAndGet();<span class="comment">//在线数+1</span></span><br><span class="line">        onlineClientMap.put(session.getId(),session);<span class="comment">//添加当前连接的session</span></span><br><span class="line">        log.info(<span class="string">&quot;时间[&#123;&#125;]：与用户[&#123;&#125;]的连接成功，当前连接编号[&#123;&#125;]，当前连接总数[&#123;&#125;]&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toLocaleString(),</span><br><span class="line">                username,</span><br><span class="line">                session.getId(),</span><br><span class="line">                onlineClientNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端与服务端连接关闭</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Session session,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onClose</span></span><br><span class="line"><span class="comment">            与当前客户端连接关闭时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        onlineClientNumber.decrementAndGet();<span class="comment">//在线数-1</span></span><br><span class="line">        onlineClientMap.remove(session.getId());<span class="comment">//移除当前连接的session</span></span><br><span class="line">        log.info(<span class="string">&quot;时间[&#123;&#125;]：与用户[&#123;&#125;]的连接关闭，当前连接编号[&#123;&#125;]，当前连接总数[&#123;&#125;]&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toLocaleString(),</span><br><span class="line">                username,</span><br><span class="line">                session.getId(),</span><br><span class="line">                onlineClientNumber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端与服务端连接异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> error</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onError</span><span class="params">(Throwable error,Session session,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onError</span></span><br><span class="line"><span class="comment">            与当前客户端连接异常时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        error.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 客户端向服务端发送消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMsg</span><span class="params">(Session session,String message,<span class="meta">@PathParam(&quot;username&quot;)</span> String username)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            do something for onMessage</span></span><br><span class="line"><span class="comment">            收到来自当前客户端的消息时</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        log.info(<span class="string">&quot;时间[&#123;&#125;]：来自连接编号为[&#123;&#125;]的消息：[&#123;&#125;]&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toLocaleString(),</span><br><span class="line">                session.getId(),</span><br><span class="line">                message);</span><br><span class="line">        sendAllMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向所有客户端发送消息（广播）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendAllMessage</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        Set&lt;String&gt; sessionIdSet = onlineClientMap.keySet(); <span class="comment">//获得Map的Key的集合</span></span><br><span class="line">        <span class="keyword">for</span> (String sessionId : sessionIdSet) &#123; <span class="comment">//迭代Key集合</span></span><br><span class="line">            <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> onlineClientMap.get(sessionId); <span class="comment">//根据Key得到value</span></span><br><span class="line">            session.getAsyncRemote().sendText(message); <span class="comment">//发送消息给客户端</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="5、项目大致流程图"><a href="#5、项目大致流程图" class="headerlink" title="5、项目大致流程图"></a>5、项目大致流程图</h2><p><img src="/2023/07/19/full-stack/WebScoket/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BD%BF%E7%94%A8%E5%88%A9%E7%94%A8WebSocket%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/image-20210602173300144.png"></p>
<h2 id="6、总结"><a href="#6、总结" class="headerlink" title="6、总结"></a>6、总结</h2><p>服务端启动一个WebSocket服务，初始化应用路径、连接打开OnOpen、连接关闭OnClose、连接异常OnError、收到消息OnMessage。OnMessage中需要对来自客户端的消息进行对应的处理，比如广播或者私聊给具体某人。</p>
<p>客户端需要利用WebSocket对象（定义好url），然后初始化OnOpen、OnClose、OnError、OnMessage。OnMessage中需要对来自服务端的消息进行处理，如展示到页面上等。同时还可以需用WebSocket对象的send()方法来给服务端发送数据，并且切记在页面关闭时需要将该连接关闭（利用WebSocket对象的close()方法）。</p>
<h2 id="7、项目地址"><a href="#7、项目地址" class="headerlink" title="7、项目地址"></a>7、项目地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/FanGaoXS/websocket-demo">https://github.com/FanGaoXS/websocket-demo</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/full-stack/WebScoket/%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BD%BF%E7%94%A8%E5%88%A9%E7%94%A8WebSocket%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1/" data-id="clsblyuej001aw0k67sjd3m1y" data-title="前后端使用利用WebSocket进行通信" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-network/http/超文本传输协议http" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/network/http/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AEhttp/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/network/http/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AEhttp/">由浅入深了解超文本传输协议</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是超文本传输协议？"><a href="#什么是超文本传输协议？" class="headerlink" title="什么是超文本传输协议？"></a>什么是超文本传输协议？</h2><p><strong>超文本传输协议</strong>（英语：<strong>H</strong>yper<strong>T</strong>ext <strong>T</strong>ransfer <strong>P</strong>rotocol，缩写：<strong>HTTP</strong>）是一种用于分布式、协作式和超媒体信息系统的应用层协议。<strong>HTTP</strong>是万维网的数据通信的基础。</p>
<p>通过HTTP或HTTPS协议请求的资源由统一资源标识符（Uniform Resource Identifiers，URI）来标识。</p>
<h2 id="协议概述"><a href="#协议概述" class="headerlink" title="协议概述"></a>协议概述</h2><p>HTTP是一个客户端（client）和服务端（server）之间请求和应答的标准，通常使用TCP协议。通过使用浏览器、网络爬虫或者其他工具，客户端发起一个HTTP请求到服务器上的指定端口（默认端口为80）。我们称这个客户端为用户代理程序（user agent）。应答的服务器上存储着一些资源，比如HTML文件或者图像。我们称这个应答服务器为源服务器（origin server）。在用户代理或者源服务器中间可能存在多个“中间层”，比如代理服务器、网关或者隧道。</p>
<p>通常，由HTTP客户端（client）发起一个请求，创建一个到服务器（server）指定端口的TCP连接。HTTP服务器则在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态，比如“HTTP&#x2F;1.1 200 OK”，以及返回的内容，如请求的文件、错误信息或者其它信息。</p>
<h2 id="请求方法"><a href="#请求方法" class="headerlink" title="请求方法"></a>请求方法</h2><p>HTTP&#x2F;1.1协议中一共定义了<strong>八种方法</strong>（也叫“动作”）来以不同方式操作指定的资源：</p>
<h3 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h3><p>向指定的资源发出“显示”请求。使用GET方法应该只用在读取资料，而不应当被用于产生“<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE#%E5%89%AF%E4%BD%9C%E7%94%A8">副作用</a>”的操作中。</p>
<h3 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h3><p>向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会<strong>创建</strong>新的资源或<strong>修改</strong>现有资源，或<strong>二者</strong>皆有。每次提交，表单的数据被浏览器用编码到HTTP请求的body里。浏览器发出的POST请求的body主要有两种格式，一种是<strong>application&#x2F;x-www-form-urlencoded</strong>用来传输简单的数据，另外一种是传文件，会采用<strong>multipart&#x2F;form-data</strong>格式。</p>
<h3 id="Put"><a href="#Put" class="headerlink" title="Put"></a>Put</h3><p>向指定资源位置上传其最新内容。一般用作<strong>修改</strong>资源内容</p>
<h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><p>请求服务器<strong>删除</strong>Request-URI所标识的资源。</p>
<h3 id="Head"><a href="#Head" class="headerlink" title="Head"></a>Head</h3><p>与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。</p>
<h3 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h3><p>回显服务器收到的请求，主要用于测试或诊断。</p>
<h3 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h3><p>这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用’*’来代替资源名称，向Web服务器发送OPTIONS请求，可以<strong>测试服务器功能是否正常运作</strong>。</p>
<h3 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h3><p>HTTP&#x2F;1.1协议中预留给能够将连接改为隧道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。</p>
<p>方法名称是<strong>区分大小写</strong>的。<strong>HTTP服务器至少应该实现GET和HEAD方法</strong>，其他方法都是可选的。对于GET和HEAD方法而言，除了进行获取资源信息外，这些请求不应当再有其他意义。也就是说，这些方法应当被认为是“安全的”。 客户端可能会使用其他“非安全”方法，例如POST，PUT及DELETE，应该以特殊的方式（通常是按钮而不是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%B6%85%E9%93%BE%E6%8E%A5">超链接</a>）告知客户可能的后果（例如一个按钮控制的资金交易），或请求的操作可能是不安全的（例如某个文件将被上传或删除）。</p>
<h2 id="HTTP-流"><a href="#HTTP-流" class="headerlink" title="HTTP 流"></a>HTTP 流</h2><p>当客户端想要和服务端进行信息交互时，过程表现为下面几步：</p>
<ol>
<li><p>打开一个TCP连接：TCP连接被用来<strong>发送</strong>一条或者多条请求，以及<strong>接受</strong>响应消息。</p>
</li>
<li><p>发送一个 HTTP 报文：HTTP 报文（在 HTTP&#x2F;2 之前）是语义可读的。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>developer.mozilla.org</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>fr</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取服务端返回的报文消息：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Sat, 09 Oct 2010 14:28:02 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Apache</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Tue, 01 Dec 2009 20:18:22 GMT</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;51142bc1-7449-479b075b2891b&quot;</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>29769</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>... (<span class="keyword">here</span> <span class="keyword">comes</span> <span class="keyword">the</span> 29769 <span class="keyword">bytes</span> <span class="keyword">of</span> <span class="keyword">the</span> <span class="keyword">requested</span> <span class="keyword">web</span> <span class="keyword">page</span>)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭连接或者为后续请求重用连接。</p>
</li>
</ol>
<h2 id="HTTP-报文"><a href="#HTTP-报文" class="headerlink" title="HTTP 报文"></a>HTTP 报文</h2><p>HTTP&#x2F;1.1 以及更早的 HTTP 协议报文都是语义可读的。</p>
<p>有两种 HTTP 报文的类型，请求与响应，每种都有其特定的格式。</p>
<h3 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h3><p><img src="/2023/07/19/network/http/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AEhttp/http_request.png" alt="A basic HTTP request"></p>
<p>请求元素：</p>
<ul>
<li>HTTP的请求方法（<strong>Method</strong>）：经常是由一个动词GET、POST或者名词OPTIONS、HEAD来定义客户端的动作行为。</li>
<li>要获取的资源的路径（<strong>Path</strong>）：通常是上下文中就很明显的元素资源的URL，它没有protocol（<code>http://</code>），domain（<code>developer.mozilla.org</code>）或是TCP的port（80）。</li>
<li>HTTP协议的版本号（<strong>Version of the protocol</strong>）。</li>
<li>为服务端表达其他信息的可选标头（<strong>Headers</strong>）。</li>
<li>对于一些像POST这样的方法，报文的主体（body）就包含了发送的资源，这与响应报文的主体类似。</li>
</ul>
<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><p><img src="/2023/07/19/network/http/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AEhttp/http_response.png"></p>
<p>响应元素：</p>
<ul>
<li>HTTP协议版本号（<strong>Version of the protocol</strong>）。</li>
<li>状态码（<strong>Status code</strong>）：来告知对应请求执行成功或失败，以及失败的原因。</li>
<li>状态信息（<strong>Status message</strong>）：这个信息是非权威的状态码描述信息，可以由服务端自行设定。</li>
<li>HTTP标头（<strong>Headers</strong>）：与请求标头类似。</li>
<li>可选项，比起请求报文，响应报文中更常见地包含获取资源的主体。</li>
</ul>
<h2 id="HTTP-标头（header）"><a href="#HTTP-标头（header）" class="headerlink" title="HTTP 标头（header）"></a>HTTP 标头（header）</h2><h3 id="常见的-request-中的标头"><a href="#常见的-request-中的标头" class="headerlink" title="常见的 request 中的标头"></a>常见的 request 中的标头</h3><h4 id="Accept"><a href="#Accept" class="headerlink" title="Accept"></a>Accept</h4><ul>
<li><code>Accept: text/html</code> 浏览器可以接受服务器回发的类型为<code>text/html</code>。</li>
<li><code>Accecpt: */*</code> 浏览器可以接受所有类型（通常是这个）。</li>
</ul>
<h4 id="Accept-Encoding"><a href="#Accept-Encoding" class="headerlink" title="Accept-Encoding"></a>Accept-Encoding</h4><ul>
<li><code>Accept-Encoding: gzip, deflate </code>浏览器申明自己接收的编码方法，通常指定压缩方法，是否支持压缩，支持什么压缩方法（gzip, deflate）。</li>
</ul>
<h4 id="Accept-Language"><a href="#Accept-Language" class="headerlink" title="Accept-Language"></a>Accept-Language</h4><ul>
<li><code>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</code> 浏览器申明自己接收的语言。（q代表权重，数值越大则代表越优先选择）</li>
</ul>
<h4 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h4><ul>
<li><code>Connection: keep-alive</code> 当一个网页打开完成后，客户端和服务端之间用于传输 HTTP 数据的 TCP 连接不会关闭，如果客户端再次访问这个服务器的网页，会继续使用这一条已经建立的连接。</li>
<li><code>Connection: close</code> 代表一个 Request 完成后，客户端和服务端之间用于传输 HTTP 数据的 TCP 连接关闭，当客户端再次发送 Request，需要重新建立 TCP 连接。</li>
</ul>
<h4 id="Host（发送请求时，该header是必须的）"><a href="#Host（发送请求时，该header是必须的）" class="headerlink" title="Host（发送请求时，该header是必须的）"></a>Host（发送请求时，该header是必须的）</h4><ul>
<li><code>Host: www.example.com</code> 主要用于指定被请求资源的 Internet 主机和端口号，它通常从 HTTP URL中提取出来。</li>
</ul>
<h4 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h4><ul>
<li><code>Referer: &lt;url&gt;</code> 包含了当前请求页面的来源页面的地址，即表示当前页面是通过此来源页面里的链接进入的。</li>
</ul>
<h4 id="User-Agent"><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h4><ul>
<li><code>User-Agent: &lt;product&gt; / &lt;product-version&gt; &lt;comment&gt;</code> 包含了一个特征字符串，用来让网络协议的对端来识别发起请求的用户代理软件的应用类型、操作系统、软件开发商以及版本号。</li>
</ul>
<h4 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h4><ul>
<li><code>Cache-Control: private</code> 默认为private，响应只能够作为私有的缓存，不能在用户间共享</li>
<li><code>Cache-Control: public</code> 响应会被缓存，并且在多用户之间共享。正常情况，如果要求 HTTP 认证，响应就会自动设置为 private。</li>
<li><code>Cache-Control: no-cache</code> 响应不会被缓存，而是实时向服务器请求资源。</li>
<li><code>Cache-Control: max-age=10</code> 设置缓存的最大有效时间，但是这个参数定义的时间大小。单位：秒。</li>
<li><code>Cache-Control: no-store</code> 任何条件下，响应都不会被缓存，并且不会被写入到客户端的磁盘里。</li>
</ul>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>含有先前由服务端通过<code>Set-Cookie</code>投放或者 JavaScript 的<code>Document.cookie</code>设置的，然后存储到客户端的 HTTP cookie。</p>
<h4 id="Range（用于断点续传）"><a href="#Range（用于断点续传）" class="headerlink" title="Range（用于断点续传）"></a>Range（用于断点续传）</h4><ul>
<li><code>Range: bytes=0-5</code> 指定第一个字节的位置和最后一个字节的位置。用户告诉服务器自己想取对象的哪部分。</li>
</ul>
<h3 id="常见的-response-中的标头"><a href="#常见的-response-中的标头" class="headerlink" title="常见的 response 中的标头"></a>常见的 response 中的标头</h3><h4 id="Cache-Control（对应请求的Cache-Control）"><a href="#Cache-Control（对应请求的Cache-Control）" class="headerlink" title="Cache-Control（对应请求的Cache-Control）"></a>Cache-Control（对应请求的Cache-Control）</h4><ul>
<li><code>Cache-Control: private</code> 默认为private，响应只能够作为私有的缓存，不能在用户间共享</li>
<li><code>Cache-Control: public</code> 响应会被缓存，并且在多用户之间共享。正常情况，如果要求 HTTP 认证，响应就会自动设置为 private。</li>
<li><code>Cache-Control: no-cache</code> 响应不会被缓存，而是实时向服务器请求资源。</li>
<li><code>Cache-Control: max-age=10</code> 设置缓存的最大有效时间，但是这个参数定义的时间大小。单位：秒。</li>
<li><code>Cache-Control: no-store</code> 任何条件下，响应都不会被缓存，并且不会被写入到客户端的磁盘里。</li>
</ul>
<h4 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content-Type"></a>Content-Type</h4><ul>
<li><code>Content-Type: text/html;charset=UTF-8</code> 告诉客户端，资源文件的类型，还有字符编码，客户端通过<code>utf-8</code>对资源进行解码，然后对资源进行 html 解析。通常我们会看到有些网站是乱码的，往往就是服务端没有返回正确的编码。</li>
</ul>
<h4 id="Content-Encoding"><a href="#Content-Encoding" class="headerlink" title="Content-Encoding"></a>Content-Encoding</h4><ul>
<li><code>Content-Encoding: gzip</code> 告诉客户端，服务端发送的资源是采用 gzip 编码的，客户端收到该消息后，应该采用 gzip 对资源进行解码。</li>
</ul>
<h4 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h4><ul>
<li><code>Date: Tue, 03 Apr 2018 03:52:28 GMT</code> 这个是服务端发送资源时的服务器时间，GMT是格林尼治所在地的标准时间。</li>
</ul>
<h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><ul>
<li><code>Server: Tengine/1.4.6</code> 这个是服务器和相对应的版本，只是告诉客户端服务器信息。</li>
</ul>
<h4 id="Transfer-Encoding"><a href="#Transfer-Encoding" class="headerlink" title="Transfer-Encoding"></a>Transfer-Encoding</h4><ul>
<li><code>Transfer-Encoding：chunked</code> 告诉客户端，服务端发送的资源是分块发送的。一般分块发送的资源都是服务器动态生成的，在发送时还不知道发送资源的大小，所以采用分块发送，每一块都是独立的，独立的块都能标示自己的长度，最后一块都是<strong>0长度</strong>的，当客户端读到这个0长度的块时，就可以确定资源已经传输完了。</li>
</ul>
<h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4><ul>
<li><code>Expires: Sun, 1 Jan 2000 01:00:00 GMT</code> 这个响应头也跟缓存有关，告诉客户端在这个时间前，可以直接访问缓存副本，但是客户端和服务端的时间不一定会都是相同的，如果时间不同就会导致问题。</li>
</ul>
<h4 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h4><ul>
<li><code>Last-Modified: Dec, 26 Dec 2015 17:30:00 GMT</code> 所请求的对象的最后修改日期。</li>
</ul>
<h4 id="Connection-1"><a href="#Connection-1" class="headerlink" title="Connection"></a>Connection</h4><ul>
<li><code>Connection: keep-alive</code> 回应客户端的<code>Connection: keep-alive</code>，告诉客户端服务器的 TCP 连接也是一个厂链接，客户端可以继续使用这个 TCP 连接发送 HTTP 请求。</li>
</ul>
<h4 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h4><ul>
<li><code>ETag: &quot;737060cd8c284d8af7ad3082f209582d&quot;</code> 就是一个对象（比如URL）的标志值，就一个对象而言，比如一个 html 文件，如果被修改了，其 ETag 也应该会被修改，主要供缓存来识别文件是否被修改。</li>
</ul>
<h4 id="Refresh"><a href="#Refresh" class="headerlink" title="Refresh"></a>Refresh</h4><ul>
<li><code>Refresh: 5; url=http://www.baidu.com</code> 用于重定向，或者当一个新的资源被创建时。默认会在5秒后刷新重定向。</li>
</ul>
<h4 id="Content-Range"><a href="#Content-Range" class="headerlink" title="Content-Range"></a>Content-Range</h4><ul>
<li><code>Content-Range: bytes 200-1000/67589 </code> 显示的是一个数据片段在整个文件中的位置</li>
</ul>
<h2 id="无状态、cookie、session、Token"><a href="#无状态、cookie、session、Token" class="headerlink" title="无状态、cookie、session、Token"></a>无状态、cookie、session、Token</h2><h3 id="什么是无状态"><a href="#什么是无状态" class="headerlink" title="什么是无状态"></a>什么是无状态</h3><p>在同一个连接中，两个执行成功的请求之间是没有关系的。这就会带来一个问题，用户没有办法在同一个网站中进行连续的交互。比如在一个电商网站里，用户想分两次想把某个商品加入到购物车中，这两次添加商品的操作是没有关联的，服务端其实是没办法知道这两次添加商品其实都是同一个用户在同一次添加的。</p>
<p>使用 HTTP Cookie 可以解决这个问题。</p>
<h4 id="无状态的好处"><a href="#无状态的好处" class="headerlink" title="无状态的好处"></a>无状态的好处</h4><p>减少服务端的存储开销：服务端不需要存储请求的状态信息。</p>
<h4 id="无状态的坏处"><a href="#无状态的坏处" class="headerlink" title="无状态的坏处"></a>无状态的坏处</h4><p>服务器没有记忆能力，无法完成一些需要关联性的操作。如同一用户两次往购物车添加商品。</p>
<h3 id="Cookie-1"><a href="#Cookie-1" class="headerlink" title="Cookie"></a>Cookie</h3><p>HTTP Cookie 是服务器发送到用户浏览器并<strong>保存在本地的一小块数据</strong>。浏览器会存储 cookie 并在下次向同一服务器再发起请求时携带并发送到服务器上。通常，它用于告知服务端<strong>两个请求是否来自同一浏览器</strong>——如保持用户登录状态。Cookie使基于无状态的HTTP协议记录稳定的状态信息成为了可能。</p>
<p>服务器使用<code>Set-Cookie</code>向client发送Cookie信息，可能像这样：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>&lt;cookie-name&gt;=&lt;cookie-value&gt;</span><br></pre></td></tr></table></figure>



<p>事例表明服务器告知客户端存储一对cookie：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.0</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>yummy_cookie=choco</span><br><span class="line"><span class="attribute">Set-Cookie</span><span class="punctuation">: </span>tasty_cookie=strawberry</span><br></pre></td></tr></table></figure>



<p>接下来，对该服务器发起的每一次新请求，浏览器都会将之前保存的Cookie信息通过header再发送给服务器：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/sample_page.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.example.org</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>yummy_cookie=choco; tasty_cookie=strawberry</span><br></pre></td></tr></table></figure>



<h4 id="限制访问Cookie"><a href="#限制访问Cookie" class="headerlink" title="限制访问Cookie"></a>限制访问Cookie</h4><p>有两种方法可以确保<code>Cookie</code>被安全发送，并且不会被意外的参与者或脚本访问：<code>Secure</code>属性和<code>HttpOnly</code>属性。</p>
<p><strong>Secure</strong>：有此标记的Cookie只应通过被HTTPS协议加密过的请求发送给服务器。它永远不会使用不安全的HTTP发送（本地主机除外），不安全的站点（在URL中带有<code>http:</code>）无法使用带有<code>Secure</code>属性的cookie。但是，<code>Secure</code>不会阻止对cookie中敏感信息的访问。例如，有权访问客户端硬盘的人可以读取和修改它。</p>
<p><strong>HttpOnly</strong>：JavaScript的<code>Document.cookie</code>API无法访问带有<code>HttpOnly</code>属性的cookie；此类cookie仅作用于服务器。</p>
<h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p>基于cookie实现的，session存储在服务器端，sessionId会被存储到客户端的cookie中。</p>
<ol>
<li>用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建对应的Session。</li>
<li>请求返回时将此Session的唯一标识信息SessionId返回给浏览器</li>
<li>浏览器接收到服务器返回的 SessionID 信息后，会将此信息存入到 Cookie 中，同时 Cookie 记录此 SessionID 属于哪个域名</li>
<li>当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 Cookie 信息，如果存在自动将 Cookie 信息也发送给服务端，服务端会从 Cookie 中获取 SessionID，再根据 SessionID 查找对应的 Session 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 Session 证明用户已经登录可执行后面操作。</li>
</ol>
<h4 id="安全性不同"><a href="#安全性不同" class="headerlink" title="安全性不同"></a>安全性不同</h4><p>Session 比 Cookie 安全，Session 是存储在服务器端的，Cookie 是存储在客户端的。</p>
<h4 id="存值的数据类型不同"><a href="#存值的数据类型不同" class="headerlink" title="存值的数据类型不同"></a>存值的数据类型不同</h4><p>Cookie 只支持存字符串数据，想要设置其他类型的数据，需要将其转换成字符串，Session 可以存任意数据类型。</p>
<h4 id="有效期不同"><a href="#有效期不同" class="headerlink" title="有效期不同"></a>有效期不同</h4><p>Cookie 可设置为长时间保持，比如我们经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭（默认情况下）或者 Session 超时都会失效。</p>
<h4 id="存储大小不同"><a href="#存储大小不同" class="headerlink" title="存储大小不同"></a>存储大小不同</h4><p> 单个 Cookie 保存的数据不能超过 4K，Session 可存储数据远高于 Cookie，但是当访问量过多，会占用过多的服务器资源。</p>
<h3 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h3><p>token的身份验证流程：</p>
<ol>
<li>client使用用户名和密码请求登录</li>
<li>server收到请求，去验证用户名与密码</li>
<li>验证成功后，server会签发一个token并下发给client</li>
<li>client接收到token，会将token存储起来，如：存到cookie或localStorage</li>
<li>client每次向server发送请求资源都携带token</li>
<li>server接收到来自client的token并且验证它。</li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<p>服务端不需要存储token，只需要使用固定的算法解析token。利用解析Token的资源换取存储Token的存储空间。以时间换空间，减轻服务器的压力。</p>
</blockquote>
<h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><h3 id="常见的状态码"><a href="#常见的状态码" class="headerlink" title="常见的状态码"></a>常见的状态码</h3><table>
<thead>
<tr>
<th>状态码</th>
<th>英文名称</th>
<th>中文描述</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td>OK</td>
<td>请求成功</td>
</tr>
<tr>
<td>301</td>
<td>Moved Permanently</td>
<td>资源（网页等）被永久转移到其他URL</td>
</tr>
<tr>
<td>400</td>
<td>Bad Request</td>
<td>客户端请求的语法错误，服务器无法解析</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
<td>请求的资源（网页等）不存在</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
<td>服务器内部错误</td>
</tr>
</tbody></table>
<h3 id="状态码分类"><a href="#状态码分类" class="headerlink" title="状态码分类"></a>状态码分类</h3><table>
<thead>
<tr>
<th>分类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>1xx</td>
<td><strong>信息</strong>，服务器收到请求，需要请求者继续进行操作</td>
</tr>
<tr>
<td>2xx</td>
<td><strong>成功</strong>，操作被成功接受并处理</td>
</tr>
<tr>
<td>3xx</td>
<td><strong>重定向</strong>，需要进一步的操作以完成请求</td>
</tr>
<tr>
<td>4xx</td>
<td><strong>客户端错误</strong>，请求包含语法错误或无法完成请求</td>
</tr>
<tr>
<td>5xx</td>
<td><strong>服务器错误</strong>，服务器在处理请求的过程中发生了错误</td>
</tr>
</tbody></table>
<h2 id="浏览器同源策略"><a href="#浏览器同源策略" class="headerlink" title="浏览器同源策略"></a>浏览器同源策略</h2><h3 id="同源的定义"><a href="#同源的定义" class="headerlink" title="同源的定义"></a>同源的定义</h3><p>如果两个URL的<strong>协议</strong>，<strong>端口</strong>和<strong>主机</strong>都相同的，那么这两个URL同源。</p>
<h2 id="跨域资源共享-CORS"><a href="#跨域资源共享-CORS" class="headerlink" title="跨域资源共享 CORS"></a>跨域资源共享 CORS</h2><p>一种基于HTTP头的机制，该机制通过<strong>允许服务器</strong>标示除了它自己以外的其它源（域、协议或端口），使得浏览器允许这些源访问加载自己的资源。</p>
<p>对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a> 以外的 HTTP 请求，或者搭配某些 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME 类型</a>的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> 请求），浏览器必须首先使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/OPTIONS"><code>OPTIONS</code></a> 方法发起一个<strong>预检请求（preflight request）</strong>，从而获知服务端是否允许该跨源请求。服务器确认允许之后，才发起实际的 HTTP 请求。在预检请求的返回中，服务器端也可以通知客户端，是否需要携带身份凭证（例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies">Cookie</a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication">HTTP 认证</a>相关数据）。</p>
<h3 id="预检请求preflight-request"><a href="#预检请求preflight-request" class="headerlink" title="预检请求preflight request"></a>预检请求preflight request</h3><p>“需预检的请求”要求必须首先使用<code>OPTIONS</code>发起一个预检请求到服务器，以获知服务器是否允许该实际请求。“预检请求”的使用，可以避免跨域请求对服务器的用户数据产生未预期的影响。</p>
<h3 id="附带身份凭证的请求"><a href="#附带身份凭证的请求" class="headerlink" title="附带身份凭证的请求"></a>附带身份凭证的请求</h3><p>在响应附带身份凭证的请求时：</p>
<ul>
<li>服务器<strong>不能</strong>将<code>Access-Control-Allow-Origin</code>的值设为通配符“<code>*</code>”，而应将其设置为特定的域，如：<code>Access-Control-Allow-Origin: https://example.com</code>。</li>
<li>服务器<strong>不能</strong>将<code>Access-Control-Allow-Headers</code>的值设为通配符“<code>*</code>”，而应将其设置为标头（headers）名称的列表，如：<code>Access-Control-Allow-Headers: X-PINGOTHER, Content-Type</code>。</li>
<li>服务器<strong>不能</strong>将<code>Access-Control-Allow-Methods</code>的值设为通配符“<code>*</code>”，而应将其设置为特定请求方法名称的列表，如：<code>Access-Control-Allow-Methods: POST, GET</code>。</li>
</ul>
<h3 id="HTTP-Response-Header-字段"><a href="#HTTP-Response-Header-字段" class="headerlink" title="HTTP Response Header 字段"></a>HTTP Response Header 字段</h3><table>
<thead>
<tr>
<th>header key</th>
<th>header value</th>
<th>describe</th>
</tr>
</thead>
<tbody><tr>
<td>Access-Control-Allow-Origin</td>
<td>&lt;origin&gt; | *</td>
<td>允许浏览器访问的资源列表</td>
</tr>
<tr>
<td>Access-Control-Allow-Headers</td>
<td>&lt;header-name&gt;[, &lt;header-name&gt;]*</td>
<td>允许浏览器访问的header列表</td>
</tr>
<tr>
<td>Access-Control-Allow-Methods</td>
<td>&lt;method&gt;[, &lt;method&gt;]*</td>
<td>指定访问资源时允许使用的请求方法</td>
</tr>
<tr>
<td>Access-Control-Max-Age</td>
<td>&lt;delta-seconds&gt;</td>
<td>指定preflight预检请求能够被缓存多久</td>
</tr>
<tr>
<td>Access-Control-Expose-Headers</td>
<td>&lt;header-name&gt;[, &lt;header-name&gt;]*</td>
<td>允许浏览器访问的<strong>额外</strong>header列表</td>
</tr>
<tr>
<td>Access-Control-Allow-Credentials</td>
<td>true</td>
<td>指定浏览器的<code>credentials</code>是否允许浏览器读取response的内容</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/network/http/%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AEhttp/" data-id="clsblyuek001cw0k68yup2kzw" data-title="由浅入深了解超文本传输协议" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/" rel="tag">http</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArrayList/" rel="tag">ArrayList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC-web/" rel="tag">GRPC-web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaSE/" rel="tag">JavaSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LinkedList/" rel="tag">LinkedList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth2-0/" rel="tag">OAuth2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OIDC/" rel="tag">OIDC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/" rel="tag">SSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringAOP/" rel="tag">SpringAOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/" rel="tag">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/caddy/" rel="tag">caddy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cobra/" rel="tag">cobra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dig/" rel="tag">dig</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dockerfile/" rel="tag">dockerfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/" rel="tag">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flag/" rel="tag">flag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flags/" rel="tag">flags</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/godotenv/" rel="tag">godotenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gorm/" rel="tag">gorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jedis/" rel="tag">jedis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernates/" rel="tag">kubernates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrus/" rel="tag">logrus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/promise/" rel="tag">promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protobuf/" rel="tag">protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stream/" rel="tag">stream</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-cli/" rel="tag">vue-cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-element-admin/" rel="tag">vue-element-admin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-router/" rel="tag">vue-router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag">集合</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ArrayList/" style="font-size: 10px;">ArrayList</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/GRPC/" style="font-size: 12.86px;">GRPC</a> <a href="/tags/GRPC-web/" style="font-size: 10px;">GRPC-web</a> <a href="/tags/Golang/" style="font-size: 18.57px;">Golang</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaSE/" style="font-size: 12.86px;">JavaSE</a> <a href="/tags/LinkedList/" style="font-size: 10px;">LinkedList</a> <a href="/tags/Mybatis/" style="font-size: 11.43px;">Mybatis</a> <a href="/tags/OAuth2-0/" style="font-size: 10px;">OAuth2.0</a> <a href="/tags/OIDC/" style="font-size: 12.86px;">OIDC</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/Spring/" style="font-size: 12.86px;">Spring</a> <a href="/tags/SpringAOP/" style="font-size: 10px;">SpringAOP</a> <a href="/tags/SpringBoot/" style="font-size: 14.29px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/caddy/" style="font-size: 10px;">caddy</a> <a href="/tags/cobra/" style="font-size: 10px;">cobra</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/dig/" style="font-size: 10px;">dig</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/dockerfile/" style="font-size: 10px;">dockerfile</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/flag/" style="font-size: 10px;">flag</a> <a href="/tags/flags/" style="font-size: 10px;">flags</a> <a href="/tags/gin/" style="font-size: 10px;">gin</a> <a href="/tags/godotenv/" style="font-size: 10px;">godotenv</a> <a href="/tags/gorm/" style="font-size: 10px;">gorm</a> <a href="/tags/http/" style="font-size: 11.43px;">http</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/jedis/" style="font-size: 10px;">jedis</a> <a href="/tags/kubernates/" style="font-size: 10px;">kubernates</a> <a href="/tags/logrus/" style="font-size: 10px;">logrus</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/promise/" style="font-size: 10px;">promise</a> <a href="/tags/protobuf/" style="font-size: 10px;">protobuf</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 11.43px;">redis</a> <a href="/tags/stream/" style="font-size: 10px;">stream</a> <a href="/tags/uni-app/" style="font-size: 10px;">uni-app</a> <a href="/tags/vue/" style="font-size: 17.14px;">vue</a> <a href="/tags/vue-cli/" style="font-size: 10px;">vue-cli</a> <a href="/tags/vue-element-admin/" style="font-size: 10px;">vue-element-admin</a> <a href="/tags/vue-router/" style="font-size: 10px;">vue-router</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 11.43px;">多线程</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.43px;">数据库</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 11.43px;">网络安全</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.43px;">设计模式</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 12.86px;">集合</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/02/04/back-end/docker/dockerfile/">docker学习</a>
          </li>
        
          <li>
            <a href="/2023/07/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/">利用Java来手写ArrayList</a>
          </li>
        
          <li>
            <a href="/2023/07/19/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/">利用Java手写LinkedList</a>
          </li>
        
          <li>
            <a href="/2023/07/19/back-end/DevOps/CI_CD/">CI_CD</a>
          </li>
        
          <li>
            <a href="/2023/07/19/design-pattern/SOLID/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84S.O.L.I.D%E5%8E%9F%E5%88%99/">面向对象的S.O.L.I.D原则</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 FanGaoXS<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>