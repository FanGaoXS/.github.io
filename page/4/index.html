<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>FanGaoXS&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="FanGaoXS&#39;s blog">
<meta property="og:url" content="https://fangaoxs.github.io/page/4/index.html">
<meta property="og:site_name" content="FanGaoXS&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="FanGaoXS">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="FanGaoXS's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FanGaoXS&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fangaoxs.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-back-end/Java/MyBatis的常用标签以及标签的使用技巧/MyBatis标签" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/MyBatis%E7%9A%84%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%BB%A5%E5%8F%8A%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/MyBatis%E6%A0%87%E7%AD%BE/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/MyBatis%E7%9A%84%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%BB%A5%E5%8F%8A%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/MyBatis%E6%A0%87%E7%AD%BE/">MyBatis常用标签及标签使用技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="MyBatis常用标签及标签使用技巧"><a href="#MyBatis常用标签及标签使用技巧" class="headerlink" title="MyBatis常用标签及标签使用技巧"></a>MyBatis常用标签及标签使用技巧</h2><p>MyBatis的常用标签有很多，比如</p>
<p><code>&lt;sql id=&quot;&quot;&gt;</code>：预定义可以复用的sql语句</p>
<p><code>&lt;include refid=&quot;&quot;&gt;</code>：根据id引用定义的sql语句</p>
<p><code>&lt;trim&gt;</code>：空白补全，配合<code>&lt;if&gt;</code>标签使用</p>
<p><code>&lt;if test=&quot;&quot;&gt;</code>：条件判断，该语句返回的true，则该标签内的语句就生效</p>
<p><code>&lt;bind name=&quot;&quot; value=&quot;&quot;&gt;</code>：创建一个变量，并且可以绑定到上下文</p>
<h2 id="1、统一的增删改"><a href="#1、统一的增删改" class="headerlink" title="1、统一的增删改"></a>1、统一的增删改</h2><p>通过我暂时的开发经验来说，我认为对一张表增删改操作，起码包括：增加一条记录、删除一条记录、修改一条记录。所以一张表的操作起码包括：增删改。</p>
<p>增加一条是主键id自增，删除一条记录是根据主键id删除，修改一条记录是根据主键id修改，返回值都是Integer类型的成功增删改的记录条数。以User对象为例：</p>
<p>UserMapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 增加成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insertOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">deleteOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 修改成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateOne</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>则对应的UserMapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--update的条件sql（除了自增主键id）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;updateCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; uuid!=null and uuid!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            uuid = #&#123;uuid&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; username!=null and username!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            username = #&#123;username&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; password!=null and password!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            password = #&#123;password&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增一条--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">            user</span><br><span class="line">            (uuid,username,password)</span><br><span class="line">        VALUES</span><br><span class="line">            (#&#123;uuid&#125;,#&#123;username&#125;,#&#123;password&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--删除一条--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        DELETE FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--修改一条（根据id主键）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;updateCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        WHERE</span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于一般修改语句是根据id，所以在<code>&lt;update&gt;</code>标签中，<code>WHERE id = #&#123;id&#125;</code>是写死了的。一般修改的话，是除了id可以修改其余都是可以修改的，所以一般字段会比较多，利用<code>&lt;sql&gt;</code>标签预定义好除了id的字段，并且利用<code>&lt;if&gt;</code>标签包裹起来，同时<strong>特别注意：最后要加上逗号</strong>。然后在<code>&lt;trim&gt;</code>标签中利用<code>&lt;include&gt;</code>标签引用预定义的修改语句的条件。<code>&lt;include&gt;</code>标签就相当于直接把该id的sql语句直接粘贴到这里，这里是为了看起整体排版比较舒服所以才这么做的。</p>
<h2 id="2、统一的查询"><a href="#2、统一的查询" class="headerlink" title="2、统一的查询"></a>2、统一的查询</h2><p>通过我暂时的开发经验来说，我认为对一张表查询操作，起码包括：查询多条记录（可分页可条件）、查询一条记录（可条件），查询该表的总记录数。所以一张表的操作起码包括：三个查询。</p>
<p>查询列表、单个查询、查询该表的总记录数，同样是以User对象为例：</p>
<p>UserMapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有user集合（可分页，可多条件，可单条件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectList</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询一条user记录（可多条件，可单条件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  一条用户对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">selectOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询记录数（可条件查询）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user  用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Long <span class="title function_">count</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分别返回User集合、单个User对象以及记录数。</p>
<p>对应的UserMapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--select的条件sql（全有）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; id!=null and id!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.id = #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; uuid!=null and uuid!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.uuid = #&#123;uuid&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; username!=null and username!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.username = #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; password!=null and password!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.password = #&#123;password&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--分页的条件sql（当前页，每页记录数）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; currentPage!=null and currentPage!=&#x27;&#x27; and pageSize!=null and pageSize!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;offset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pageSize*(currentPage-1)&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;rows&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pageSize&quot;</span>/&gt;</span></span><br><span class="line">            #&#123;offset&#125;,#&#123;rows&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--user表的别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span></span><br><span class="line">        u.id                AS uId,</span><br><span class="line">        u.uuid              AS uUuid,</span><br><span class="line">        u.username          AS uUsername,</span><br><span class="line">        u.password          AS uPassword</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--返回的结果集--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uUuid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uuid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uUsername&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uPassword&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询所有（可分页，可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        FROM</span><br><span class="line">            user u</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        ORDER BY</span><br><span class="line">            u.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;LIMIT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询一条（可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        FROM</span><br><span class="line">            user u</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询记录数（可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            count(u.id)</span><br><span class="line">        FROM</span><br><span class="line">            user u</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>根据三个需求：查询全表、查询单个两个都可以用到条件查询，所以都可以用到同样的sql，所以就可以使用同样的<code>&lt;sql&gt;</code>标签来预定义然后复用。小结一下就是：</p>
<ul>
<li>查询全表：查询字段、可全条件、可分页</li>
<li>查询单个：查询字段、可全条件</li>
<li>查询记录数：可全条件</li>
</ul>
<p>得益于<code>&lt;trim&gt;</code>标签和<code>&lt;if&gt;</code>标签的配合（if标签判断条件是否成立，如果成立则if标签内部语句生效，trim判断内部是否有语句，如果有则trim生效），没有条件传入就查询全表，没有分页传入的时候就不分页，做到了有条件则查条件，无条件则全查，有分页则查分页，无分页则全查。同时定义好结果集映射（column是查出来的列，property是Pojo对象的属性，需要对应好）以及配置好查询字段的别名（AS）。定义结果集和配置查询字段的别名是方便以后扩展。</p>
<p>条件查询的<code>&lt;sql&gt;</code>需要注意的是利用AND连接。</p>
<p>分页的<code>&lt;sql&gt;</code>需要注意的是利用<code>&lt;bind&gt;</code>标签来定义变量，注意变量的换算，一般采用的是传入当前页（currentPage）和每页记录数（pageSize），而数据库中<code>limit</code>语句的参数是<code>limit offset,rows</code>，offset（偏移量，也就是从表中的第几个元素开始，0是首位），rows（记录数，也就是返回多少个），总的来说就是从第几个开始，返回第条记录。然后利用简单的数学换算，将currentPage和pageSize转换为offset和rows。</p>
<p><code>&lt;trim&gt;</code>标签的使用，利用<code>&lt;include&gt;</code>标签引入相应的sql语句后，再用<code>&lt;trim&gt;</code>标签包围，注意好<code>prefix</code>、<code>suffix</code>、<code>prefixOverrides</code>和<code>suffixOverrides</code>。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>SQL语句中各关键字的顺序</p>
</blockquote>
<h2 id="3、统一的增删改查"><a href="#3、统一的增删改查" class="headerlink" title="3、统一的增删改查"></a>3、统一的增删改查</h2><p>最后将增删改和查询总结合并起来就是：</p>
<p>UserMapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 增加成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insertOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">deleteOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 修改成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有user集合（可分页，可多条件，可单条件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectList</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询一条user记录（可多条件，可单条件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  一条用户对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">selectOne</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询记录数（可条件查询）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user  用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Long <span class="title function_">count</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserMapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--select的条件sql（全有）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; id!=null and id!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.id = #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; uuid!=null and uuid!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.uuid = #&#123;uuid&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; username!=null and username!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.username = #&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; password!=null and password!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND u.password = #&#123;password&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--update的条件sql（除了自增主键id）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;updateCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; uuid!=null and uuid!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            uuid = #&#123;uuid&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; username!=null and username!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            username = #&#123;username&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; password!=null and password!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            password = #&#123;password&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--分页的条件sql（当前页，每页记录数）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; currentPage!=null and currentPage!=&#x27;&#x27; and pageSize!=null and pageSize!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;offset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pageSize*(currentPage-1)&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;rows&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pageSize&quot;</span>/&gt;</span></span><br><span class="line">            #&#123;offset&#125;,#&#123;rows&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--user表的别名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span></span><br><span class="line">        u.id                AS uId,</span><br><span class="line">        u.uuid              AS uUuid,</span><br><span class="line">        u.username          AS uUsername,</span><br><span class="line">        u.password          AS uPassword</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--返回的结果集--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;uId&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uUuid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;uuid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uUsername&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;uPassword&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增一条--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">            user</span><br><span class="line">            (uuid,username,password)</span><br><span class="line">        VALUES</span><br><span class="line">            (#&#123;uuid&#125;,#&#123;username&#125;,#&#123;password&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--删除一条--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        DELETE FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--修改一条（根据id主键）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            user</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;updateCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        WHERE</span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询所有（可分页，可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            user u</span><br><span class="line">            JOIN role r on u.roleId = r.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        ORDER BY</span><br><span class="line">            u.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;LIMIT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询一条（可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        FROM</span><br><span class="line">            user u</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询记录数（可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            count(u.id)</span><br><span class="line">        FROM</span><br><span class="line">            user u</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>对一张表的操作最起码就应该包括以上：增加一条记录、删除一条记录、修改一条记录、查询列表（可条件、可分页）、查询一条（可条件）、查询记录数（可条件）。</p>
<h2 id="4、利用IDEA的Code-Templates自动生成"><a href="#4、利用IDEA的Code-Templates自动生成" class="headerlink" title="4、利用IDEA的Code Templates自动生成"></a>4、利用IDEA的Code Templates自动生成</h2><p>总结后观察到，每张表都有这6个操作，并且代码基本上都大致相同，差别只是对象的名字和表中字段不一样，那我每次创建Mapper文件都需要手敲吗？NoNoNo，可以利用IDEA的Code Templates功能，预先定义好Mapper Java和Mapper Xml的大致结构，然后利用传参传入对象名就可以了，这样每次就能自动生成大量代码，然后只需要修改极少部分代码就可以了。</p>
<h3 id="Code-Templates文件的创建："><a href="#Code-Templates文件的创建：" class="headerlink" title="Code Templates文件的创建："></a>Code Templates文件的创建：</h3><p>打开IDEA，左上角依次点击：<code>File</code>-&gt;搜索<code>template</code>-&gt;找到<code>File and Code Templates</code>，在右侧创建新文件，输入文件名，扩展名Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">if</span> ($&#123;PACKAGE_NAME&#125; &amp;&amp; $&#123;PACKAGE_NAME&#125; != <span class="string">&quot;&quot;</span>) <span class="keyword">package</span> $&#123;PACKAGE_NAME&#125;;#end</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line">#parse(<span class="string">&quot;File Header.java&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">$</span>&#123;NAME&#125; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $&#123;pojo&#125; $&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 增加成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">insertOne</span><span class="params">($&#123;Pojo&#125; $&#123;pojo&#125;)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $&#123;pojo&#125; $&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">deleteOne</span><span class="params">($&#123;Pojo&#125; $&#123;pojo&#125;)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改一条记录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $&#123;pojo&#125; $&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 修改成功的记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">updateOne</span><span class="params">($&#123;Pojo&#125; $&#123;pojo&#125;)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有集合（可分页，可多条件，可单条件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $&#123;pojo&#125; $&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> $&#123;pojo&#125;集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;$&#123;Pojo&#125;&gt; selectList($&#123;Pojo&#125; $&#123;pojo&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询一条$&#123;pojo&#125;记录（可多条件，可单条件）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $&#123;pojo&#125; $&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  一条$&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    $&#123;Pojo&#125; selectOne($&#123;Pojo&#125; $&#123;pojo&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询记录数（可条件查询）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> $&#123;pojo&#125;  $&#123;name&#125;对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  记录数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Long <span class="title function_">count</span><span class="params">($&#123;Pojo&#125; $&#123;pojo&#125;)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>$&#123;Pojo&#125;</code>：Pojo对象的类名</p>
<p><code>$&#123;pojo&#125;</code>：Pojo对象的变量名</p>
<p>这样下次在新建Mapper.java文件的时候直接利用该template创建就可以了。</p>
<p>同样的，Mapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;$&#123;PRE&#125;.mapper.$&#123;NAME&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--select的条件sql（全有）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; arg!=null and arg!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            AND arg = #&#123;arg&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--update的条件sql（除了自增主键id）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;updateCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; arg!=null and arg!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            arg = #&#123;arg&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--分页的条件sql（当前页，每页记录数）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; currentPage!=null and currentPage!=&#x27;&#x27; and pageSize!=null and pageSize!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;offset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pageSize*(currentPage-1)&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;rows&quot;</span> <span class="attr">value</span>=<span class="string">&quot;pageSize&quot;</span>/&gt;</span></span><br><span class="line">            #&#123;offset&#125;,#&#123;rows&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--返回的结果集--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;$&#123;Pojo&#125;Map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;&quot;</span> <span class="attr">property</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--新增一条记录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO</span><br><span class="line">            $&#123;TABLE_NAME&#125;</span><br><span class="line">            ()</span><br><span class="line">        VALUES</span><br><span class="line">            ()</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--删除一条记录--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span>&gt;</span></span><br><span class="line">        DELETE FROM</span><br><span class="line">            $&#123;TABLE_NAME&#125;</span><br><span class="line">        WHERE</span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--修改一条记录（根据id主键）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span>&gt;</span></span><br><span class="line">        UPDATE</span><br><span class="line">            $&#123;TABLE_NAME&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;updateCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        WHERE</span><br><span class="line">            id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询所有（可分页，可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;$&#123;Pojo&#125;Map&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            *</span><br><span class="line">        FROM</span><br><span class="line">            $&#123;TABLE_NAME&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        ORDER BY</span><br><span class="line">            id</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;LIMIT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询一条（可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectOne&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultMap</span>=<span class="string">&quot;$&#123;Pojo&#125;Map&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            *</span><br><span class="line">        FROM</span><br><span class="line">            $&#123;TABLE_NAME&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--根据主键id（效率高）查询记录数（可单条件，可多条件）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;$&#123;PRE&#125;.pojo.$&#123;Pojo&#125;&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            count(id)</span><br><span class="line">        FROM</span><br><span class="line">            $&#123;TABLE_NAME&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>$&#123;PRE&#125;</code>：包的前缀</p>
<p><code>$&#123;Pojo&#125;</code>：对象的类名</p>
<p><code>$&#123;TABLE_NAME&#125;</code>：表名</p>
<p>即可以非常快速地生成Mapper.java和Mapper.xml了</p>
<h2 id="5、连接关系表"><a href="#5、连接关系表" class="headerlink" title="5、连接关系表"></a>5、连接关系表</h2><p>因为Mybatis的特性，它可以连表查询。同样的，我们利用上述的方法创建好RoleMapper，如果想要在UserMapper中使用RoleMapper中定义好的sql，那么直接使用<code>&lt;include refid=&quot;包名+id&quot;&gt;</code>，下面是在UserMapper.xml中使用user表和role表连表查询列表举例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询所有（可分页，可单条件，可多条件）--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">parameterType</span>=<span class="string">&quot;com.fangaoxs.userserver.pojo.User&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">       SELECT</span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userAs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span>,</span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;com.xxx.userserver.mapper.RoleMapper.roleAs&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">       FROM</span><br><span class="line">           user u</span><br><span class="line">           JOIN role r on u.roleId = r.id</span><br><span class="line">       <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">       ORDER BY</span><br><span class="line">           u.id</span><br><span class="line">       <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;LIMIT&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;limitCondition&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么，这样就实现了user表和role的联合查询，并且roleMapper.xml中的<code>&lt;sql&gt;</code>也在userMapper.xml中得到了复用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/MyBatis%E7%9A%84%E5%B8%B8%E7%94%A8%E6%A0%87%E7%AD%BE%E4%BB%A5%E5%8F%8A%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/MyBatis%E6%A0%87%E7%AD%BE/" data-id="clsblyuew001yw0k6ac2lcl04" data-title="MyBatis常用标签及标签使用技巧" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/SpringAOP/AOP" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/SpringAOP/AOP/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/SpringAOP/AOP/">一张图搞懂SpringBoot AOP5个通知的交织顺序</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="/2023/07/19/back-end/Java/SpringAOP/AOP/image-20210306002346752.png"></p>
<p>每个通知都分为开始和结束：</p>
<p>环绕通知开始-&gt;（前置通知开始，前置通知结束）-&gt;（切点）-&gt;（正常返回通知开始，正常返回通知结束）或（异常返回通知开始，异常返回通知结束）-&gt;（后置通知开始，后置通知结束）-&gt;环绕通知结束</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/SpringAOP/AOP/" data-id="clsblyuex0021w0k6ehb6cjm8" data-title="一张图搞懂SpringBoot AOP5个通知的交织顺序" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringAOP/" rel="tag">SpringAOP</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/Java多线程/Java多线程进阶简单梳理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6%E7%AE%80%E5%8D%95%E6%A2%B3%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6%E7%AE%80%E5%8D%95%E6%A2%B3%E7%90%86/">Java多线程进阶简单梳理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Java多线程进阶简单梳理"><a href="#Java多线程进阶简单梳理" class="headerlink" title="Java多线程进阶简单梳理"></a>Java多线程进阶简单梳理</h1><h2 id="1、什么是进程？什么是线程"><a href="#1、什么是进程？什么是线程" class="headerlink" title="1、什么是进程？什么是线程?"></a>1、什么是进程？什么是线程?</h2><p>进程就是一个应用程序；线程就是进程中的执行单元。一个进程可以启动多个线程。</p>
<h2 id="2、运行Java应用程序时"><a href="#2、运行Java应用程序时" class="headerlink" title="2、运行Java应用程序时"></a>2、运行Java应用程序时</h2><p>启动JVM就是一个进程。JVM就会启动main（主线程），同时调用垃圾回收线程负责守护，回收垃圾。</p>
<p>所以Java应用程序里至少有两个线程并发，主线程和垃圾回收线程。</p>
<h2 id="3、进程和线程有什么关系？"><a href="#3、进程和线程有什么关系？" class="headerlink" title="3、进程和线程有什么关系？"></a>3、进程和线程有什么关系？</h2><p>进程可以看作大公司，而线程可以看作公司里的员工。</p>
<p>进程与进程之间，内存独立不共享。</p>
<p>线程与线程之间，堆内存和方法区内存共享。栈内存独立。一个线程一个栈，栈内存与栈内存独立。</p>
<p>Java中的多线程机制，目的就是为了提高程序的处理效率。</p>
<p>线程之间宏观上同时进行，微观上依次进行。</p>
<h2 id="4、run-和start-的区别"><a href="#4、run-和start-的区别" class="headerlink" title="4、run( )和start( )的区别"></a>4、run( )和start( )的区别</h2><ul>
<li><p>run( )</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThread01</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主线程线程体</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        <span class="type">Thread_01</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread_01</span>();</span><br><span class="line">        <span class="comment">//调用run()方法只是单纯的调用Thread_01类里的run方法，并没有开辟新的栈内存</span></span><br><span class="line">        t1.run();</span><br><span class="line">        <span class="comment">//run()方法里的代码执行完才会接着执行主线程剩余的代码</span></span><br><span class="line">        <span class="comment">//主线程打印</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Thread_01</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分支线程线程体</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread_01-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果调用分支线程对象的run( )方法，就只是单纯地调用了Thread_01这个类里的run( )方法并没有开辟分支线程的栈空间，Java会严格按照代码行的顺序执行，所以它会执行完run( )方法，再执行主线程里接下来的方法。</p>
<p>JVM内存图：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6%E7%AE%80%E5%8D%95%E6%A2%B3%E7%90%86/image-20200816204633890.png"></p>
<p>当执行到<code>t1.run()</code>的时候主线程里会开辟run方法栈帧执行run方法，等run方法执行完毕后才接着执行主线程里剩余的代码。</p>
<p>总结：所以执行run方法就是单纯的执行线程类里的run方法，并且先让run方法执行完了之后再执行主线程里的接下来的代码。在内存里也并没有开启新的分支线程栈</p>
</li>
<li><p>start( )</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThread01</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主线程线程体</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        <span class="type">Thread_01</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread_01</span>();</span><br><span class="line">        <span class="comment">//调用start()方法就会开启分支线程栈同时立马执行分支线程中的run方法</span></span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="comment">//主线程打印</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;main-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Thread_01</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分支线程线程体</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread_01-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当创建线程对象后调用start()方法的时候就会开辟新的分支线程栈同时才会执行分支线程中的run方法。所以start方法就仅仅相当于开启线程的作用。开启成功后这行代码就结束了，主线程就会接着执行剩下的代码，这个时候分支线程和主线程是并发的。</p>
<p>JVM内存图：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6%E7%AE%80%E5%8D%95%E6%A2%B3%E7%90%86/image-20200816205535961.png"></p>
<p>当t1执行start( )方法的时候，就会立马开辟一个分支线程t1的栈，然后分支线程立马执行run方法，同时start( )方法结束，执行接下的方法，所以此时主线程和分支线程是并发的。</p>
<p>总结：所以执行start方法才是开辟了分支线程的栈，然后立马执行run方法。这才是并发。此时，主线程的main方法和分支线程的run方法是平级的。</p>
</li>
</ul>
<h2 id="5、使用继承Thread还是实现Runnable？"><a href="#5、使用继承Thread还是实现Runnable？" class="headerlink" title="5、使用继承Thread还是实现Runnable？"></a>5、使用继承Thread还是实现Runnable？</h2><p>推荐使用实现Runnable的方法创建线程，因为Java支持单继承实现多接口，如果采用继承Thread的方法的话，那么他就不能再继承另外的方法了，实现Runnable接口则既可以继承另外的类，还可以实现另外的接口。</p>
<h2 id="6、线程的生命周期"><a href="#6、线程的生命周期" class="headerlink" title="6、线程的生命周期"></a>6、线程的生命周期</h2><p>线程一共有5个生命周期：</p>
<ol>
<li>新建状态：线程对象刚刚被创建的时候（刚被new出来）</li>
<li>就绪状态：（线程对象执行start( )方法后线程会进入就绪状态）此时线程又叫做可运行状态，拥有能够抢夺CPU时间片（执行权）的权利，如果抢到了CPU时间片，那么他就会执行run方法，执行run方法就标志着这个线程进入了运行状态。</li>
<li>运行状态：抢夺到了CPU时间片的线程就会执行run方法，执行run方法就标志着这个线程进入了运行状态，当占有的时间片结束之后，就会回到就绪状态继续抢夺时间片。下一次运行的时候就会接着上次的run方法运行。</li>
<li>阻塞状态：当线程运行过程中遇到阻塞事件，比如用户输入或者sleep就会进入阻塞状态，释放掉之前抢夺的时间片回到就绪状态重新开始抢夺。</li>
<li>死亡状态：线程的run方法运行结束线程就会变成死亡状态。</li>
</ol>
<p>状态图：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6%E7%AE%80%E5%8D%95%E6%A2%B3%E7%90%86/image-20200816221704542.png"></p>
<h2 id="7、interrupt-打断线程sleep"><a href="#7、interrupt-打断线程sleep" class="headerlink" title="7、interrupt( )打断线程sleep"></a>7、interrupt( )打断线程sleep</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThread01</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主线程线程体</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread_01</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread_01</span>();</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="comment">//t1线程停止睡眠</span></span><br><span class="line">        t1.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Thread_01</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分支线程线程体</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;---&gt;begin&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;---&gt;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过执行需要醒来的线程的interrupt方法打断线程休眠。其实质是让正在休眠（正在执行sleep方法）的线程抛出异常，从而执行catch而跳出sleep方法。</p>
<h2 id="8、常见线程调度模型"><a href="#8、常见线程调度模型" class="headerlink" title="8、常见线程调度模型"></a>8、常见线程调度模型</h2><ol>
<li><p>抢占式调度模型：（Java采用）</p>
<p>线程优先级（权重）越高，抢到CPU时间片的概率就高一点。</p>
</li>
<li><p>均分式调度模型：</p>
<p>平均分配CPU时间片，每个线程占有的CPU时间片长度一样。平均分配，线程之间都是平等的。</p>
</li>
</ol>
<h2 id="9、什么时候需要考虑线程安全问题？"><a href="#9、什么时候需要考虑线程安全问题？" class="headerlink" title="9、什么时候需要考虑线程安全问题？"></a>9、什么时候需要考虑线程安全问题？</h2><ol>
<li>多线程并发</li>
<li>线程共享某一公共资源</li>
<li>线程同时修改某一公共资源</li>
</ol>
<h2 id="10、怎么解决线程安全问题"><a href="#10、怎么解决线程安全问题" class="headerlink" title="10、怎么解决线程安全问题"></a>10、怎么解决线程安全问题</h2><p>采用<strong>“线程同步机制”</strong>：线程排队执行，不并发，会降低效率。用效率换取安全，安全第一。</p>
<h2 id="11、同步编程模型和异步编程模型"><a href="#11、同步编程模型和异步编程模型" class="headerlink" title="11、同步编程模型和异步编程模型"></a>11、同步编程模型和异步编程模型</h2><ul>
<li>同步（Synchronous）编程模型：线程A和线程B依次排队执行。</li>
<li>异步（Asynchronous）编程模型：线程A和线程B互相执行，互不干扰，并发。</li>
</ul>
<h2 id="12、synchronized同步代码块"><a href="#12、synchronized同步代码块" class="headerlink" title="12、synchronized同步代码块"></a>12、synchronized同步代码块</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(共享的对象)&#123;</span><br><span class="line">    代码块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Java中，任何对象都有一把“锁”，synchronized代码块就是某个线程执行的时候，将这个对象锁占有，然后另外的线程就不能执行了。只有等这个代码块执行完毕，释放对象锁。（这里注意考虑一下栈、堆、方法区中变量）</p>
<h2 id="13、死锁（deadlock）的例子"><a href="#13、死锁（deadlock）的例子" class="headerlink" title="13、死锁（deadlock）的例子"></a>13、死锁（deadlock）的例子</h2><p>线程1：需要资源A和资源B</p>
<p>线程2：需要资源B和资源A</p>
<p>有一种情况线程1拿到了资源A，线程2拿到了资源B，此时线程1在等待资源B的释放，线程2在等待资源A的释放，可是只有等线程1用完了资源A、B后才会释放资源A，线程2用完了B、A后才会释放资源B，所以线程1就永远拿不到资源B，所以它永远释放不了资源A，就导致线程2永远拿不到资源A，也永远释放不了资源B。</p>
<h2 id="14、wait-和sleep-方法的区别"><a href="#14、wait-和sleep-方法的区别" class="headerlink" title="14、wait( )和sleep( )方法的区别"></a>14、wait( )和sleep( )方法的区别</h2><ul>
<li><p>wait( )</p>
<p>wait是Object类的方法，它是作用于对象的，目的是让线程中的某个对象释放掉对象锁，然后进入等待状态，等待notify( )来唤醒这个对象所在的线程。</p>
</li>
<li><p>sleep( )</p>
<p>sleep是Thread类的方法，它是作用于线程的，目的是让线程阻塞，阻塞的时候它并不会释放锁。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6%E7%AE%80%E5%8D%95%E6%A2%B3%E7%90%86/" data-id="clsblyuex0023w0k68mdz768l" data-title="Java多线程进阶简单梳理" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/Java的序列化和反序列化/序列化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/">Java的序列化和反序列化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是序列化和反序列化？"><a href="#什么是序列化和反序列化？" class="headerlink" title="什么是序列化和反序列化？"></a>什么是序列化和反序列化？</h2><ul>
<li><strong>序列化（Serialize）</strong>指将Java对象存储到硬盘文件（流）中的过程，即保存当前Java的状态。</li>
<li><strong>反序列化（Deserialize）</strong>指将序列化的对象转为Java对象。</li>
</ul>
<h2 id="实现对象序列化和反序列化"><a href="#实现对象序列化和反序列化" class="headerlink" title="实现对象序列化和反序列化"></a>实现对象序列化和反序列化</h2><p>需要实现序列化和反序列化的Java对象需要实现<code>Serializable</code>接口（该接口没有任何方法需要实现，是个标志接口，即交由JVM识别的类）</p>
<p>Student.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="序列化Java对象"><a href="#序列化Java对象" class="headerlink" title="序列化Java对象"></a>序列化Java对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSerialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、创建Java对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="comment">//2、创建流来尝试写入文件中</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;student&quot;</span>));</span><br><span class="line">        <span class="comment">//3、将Java对象通过流写入文件</span></span><br><span class="line">        oos.writeObject(student);</span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，student对象就存在与名叫student的文件中了</p>
<h2 id="反序列化Java对象"><a href="#反序列化Java对象" class="headerlink" title="反序列化Java对象"></a>反序列化Java对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDeserialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、输入流</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;student&quot;</span>));</span><br><span class="line">        <span class="comment">//2、从流中读出Java对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;object = &quot;</span> + object);</span><br><span class="line">        <span class="comment">//3、将读出来的Java对象强转为Student对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student)object;</span><br><span class="line">        System.out.println(<span class="string">&quot;student = &quot;</span> + student);</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="序列化多个对象"><a href="#序列化多个对象" class="headerlink" title="序列化多个对象"></a>序列化多个对象</h2><p>可以利用集合来序列化多个对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSerialize2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、创建Java对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test1&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test2&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test3&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        ArrayList&lt;Student&gt; students = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Student&gt;();</span><br><span class="line">        <span class="comment">//2、添加到集合当中</span></span><br><span class="line">        students.add(s1);</span><br><span class="line">        students.add(s2);</span><br><span class="line">        students.add(s3);</span><br><span class="line">        <span class="comment">//3、创建流来尝试写入文件中</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;students&quot;</span>));</span><br><span class="line">        <span class="comment">//4、写入文件中</span></span><br><span class="line">        oos.writeObject(students);</span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，students集合就被写入了名叫students的文件中了</p>
<h2 id="反序列化集合"><a href="#反序列化集合" class="headerlink" title="反序列化集合"></a>反序列化集合</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDeserialize2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、输入流</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;students&quot;</span>));</span><br><span class="line">        <span class="comment">//2、从流中读出Java对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;object = &quot;</span> + object);</span><br><span class="line">        <span class="comment">//3、将Java对象强转为List&lt;Student&gt;</span></span><br><span class="line">        List&lt;Student&gt; students = (List&lt;Student&gt;)object;</span><br><span class="line">        System.out.println(<span class="string">&quot;students = &quot;</span> + students);</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>Tips</strong></p>
<p>因为本身Java的集合都实现了Serializable接口，所以Java的集合本身也支持序列化和反序列化。</p>
</blockquote>
<h2 id="transient关键字"><a href="#transient关键字" class="headerlink" title="transient关键字"></a>transient关键字</h2><p>在实现了Serializable接口的属性上加上<code>transient</code>关键字，则该对象的该属性在被序列化时会被忽略，即不会被序列化</p>
<p>Student.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">int</span> age;		<span class="comment">//该属性不会被序列化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在经过正常的序列化流程后，反序列化读出来的Student对象的age属性会是该属性的基本数据类型的默认值：<img src="/2023/07/19/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/image-20211027220942269.png"></p>
<h2 id="序列化版本号"><a href="#序列化版本号" class="headerlink" title="序列化版本号"></a>序列化版本号</h2><p>自动生成序列化版本号可以标识类的唯一，建议手写序列化版本号。</p>
<blockquote>
<p><strong>Tips</strong></p>
<p>Java比较两个类是否相同：</p>
<ol>
<li>先比较包名、类名</li>
<li>再比较序列化版本号</li>
</ol>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/" data-id="clsblyuey0026w0k6cj439qd1" data-title="Java的序列化和反序列化" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaSE/" rel="tag">JavaSE</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/Spring/Spring" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/Spring/Spring/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/Spring/Spring/">Spring简单剖析</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1、Spring概述"><a href="#1、Spring概述" class="headerlink" title="1、Spring概述"></a>1、Spring概述</h1><h2 id="Spring是什么"><a href="#Spring是什么" class="headerlink" title="Spring是什么"></a>Spring是什么</h2><p>Spring是一个 <strong>开源的</strong> <strong>轻量级的</strong> Java SE或Java EE 开发应用框架，其目的是简化企业级应用程序的开发。</p>
<p>Spring框架提供<strong>日志记录</strong>、<strong>性能统计</strong>、<strong>安全控制</strong>、<strong>异常处理</strong>等面向切面的功能，还提供<strong>数据库事务管理</strong>：本身有一套简单的<strong>JDBC访问实现</strong>，同时还提供与第三方数据访问框架的集成，还提供一套web层的框架SpringMVC。</p>
<p>所以Spring框架是超级粘合平台，不仅自身提供基础功能，还提供与其他技术或其他框架整合的能力，使得Java SE和Java EE开发都很简单。</p>
<blockquote>
<p><strong>牢记</strong>三个特点：</p>
<p>1、基于AOP的日志记录、性能统计、安全控制等功能</p>
<p>2、数据层，提供JDBC访问和集成第三方ORM框架的能力</p>
<p>3、Web层，提供Spring MVC框架和集成第三方Web框架的能力</p>
</blockquote>
<h2 id="Spring能做什么"><a href="#Spring能做什么" class="headerlink" title="Spring能做什么"></a>Spring能做什么</h2><p>Spring框架能带给我们最多的就是<strong>简化开发</strong>：</p>
<ul>
<li>简化依赖关系。Spring会根据配置文件来创建和组装对象间依赖关系，只需要修改配置文件即可。</li>
<li>低耦合地实现日志记录、性能统计、安全控制。Spring面向切面编程能够帮助开发者实现低耦合的日志记录、性能统计、安全控制。</li>
<li>管理数据库事务。Spring能够帮助开发者提供基础的数据库事务管理。</li>
<li>与第三方数据访问层框架无缝集成。能够与Hibernate、JPA等第三方框架无缝集成，同时自己也提供一套JDBC访问模板。</li>
<li>与第三方Web框架无缝集成。能够与Struts、JSF等第三方框架无缝集成，同时自己也提供一套Spring MVC框架，方便web层搭建。</li>
<li>方便整合技术。能够与Java Mail、缓存等技术无缝整合。</li>
</ul>
<h2 id="Spring的相关概念"><a href="#Spring的相关概念" class="headerlink" title="Spring的相关概念"></a>Spring的相关概念</h2><ul>
<li>应用程序（Application）：即完成所需功能或需求的<strong>成品</strong>，如购物网站、OA系统、xx小程序。</li>
<li>框架（Framework）：是能够完成一定功能的<strong>半成品</strong>，如我们可以在框架的基础上进一步开发购物网站，但是框架本身不一定就是最终成品。大多数时候是框架实现一部分功能，自己本身再实现一部分功能，最终形成应用程序。但是框架大多数时候会规定或者约定了开发应用程序的整体架构，提供了基础功能，简化开发人员的后续开发，使得开发人员更加专注于业务逻辑。</li>
<li>非侵入式设计：无需继承框架提供的类，这样的设计就可以看作是非侵入式设计，如果继承了这些框架类，就是侵入式设计。非侵入式设计假如在后续想要更换框架则之前写的代码可以复用；侵入式设计则无法复用。</li>
<li>POJO：即Plain Old Java Objects，简单的Java对象，它可以包含业务逻辑或持久化逻辑，但不担当任何特殊角色且不继承或不实现任何其它Java框架的类或接口。</li>
<li>容器：日常生活中来理解容器就是盛放东西的器具，从程序设计角度看就是装对象的对象，因为存在放入、拿出的“行为”，所以容器还要管理对象的生命周期。</li>
<li>控制反转：即Inversion of Control，缩写为IoC，它还有一个别名叫依赖注入（Dependency Injection），就是由容器控制程序之间的关系，而非传统开发中由程序代码控制。</li>
<li>Bean：一般指容器管理的对象，在Spring中指IoC容器管理的对象。</li>
</ul>
<h2 id="Spring的优点"><a href="#Spring的优点" class="headerlink" title="Spring的优点"></a>Spring的优点</h2><ul>
<li>非常<strong>轻量级的容器</strong>。以集中的、自动化的方式进行应用程序对象创建和装配，负责对象的创建和装配，管理对象的生命周期，能够组合成复杂的应用程序。IoC容器是非侵入式的，不需要依赖任何特定类。且核心JAR包非常小，Spring3.0.5不到1M，而且不需要依赖任何应用服务器，可以部署在任何环境（Java SE或Java EE）。</li>
<li>面向切面编程（AOP）。AOP是Aspect Oriented Programming的缩写。提供从另一个角度来考虑程序结构以完善面向对象编程，即可以通过在编译期间、装载期间或运行期间在不修改源代码的情况下为程序动态添加功能的一种技术。</li>
<li>简单的数据库事务管理。Spring支持简单的可插入的事务管理支持。</li>
<li>JDBC抽象及ORM框架支持。Spring本身提供JDBC访问支持，并且还非常方便集成ORM框架，如Hibernate等，还支持使用Spring事务和Spring提供的异常。</li>
<li>灵活的Web层支持。Spring本身提供一套强大的MVC框架，Spring MVC，同时还方便与其他Web层框架集成，比如Struts等。</li>
<li>简化各种技术并且简化集成。简化并提供对Java Mail、任务调度、JMX、JNDI、EJB、Web Service等的集成。</li>
</ul>
<p>Spring框架为开发者简化应用程序的开发，并且还对JDBC、ORM、Web提供良好的支持，并且还对其他很多技术提供良好的整合，使系统结构更优良，性能更好。</p>
<h2 id="如何学好Spring"><a href="#如何学好Spring" class="headerlink" title="如何学好Spring"></a>如何学好Spring</h2><p>Spring的核心是IoC容器，他的所有技术基本都是基于容器来实现的。所以先要透彻理解IoC容器，如何配置和使用他。</p>
<p>理解完IoC容器后再理解AOP，明确概念-&gt;基本配置-&gt;如何使用-&gt;实现原理。接下来就是简单的Spring事务管理了，其实Spring事务管理是通过AOP实现的，所以需要先理解AOP。</p>
<h1 id="2、Spring-IoC核心流程简述"><a href="#2、Spring-IoC核心流程简述" class="headerlink" title="2、Spring IoC核心流程简述"></a>2、Spring IoC核心流程简述</h1><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><p>初始化的过程主要是读取XML资源，然后解析，最终注册到Bean Factory中：</p>
<p><img src="/2023/07/19/back-end/Java/Spring/Spring/IoC%E5%88%9D%E5%A7%8B%E5%8C%96.png"></p>
<p>完成初始化后，Bean对象就在BeanFactory中等待调用了。</p>
<h2 id="注入依赖"><a href="#注入依赖" class="headerlink" title="注入依赖"></a>注入依赖</h2><p>当初始化完IoC容器后，如果Bean没有设置lazy-init（懒加载）属性的话，那么bean实例的初始化就会在IoC初始化完成后：</p>
<p><img src="/2023/07/19/back-end/Java/Spring/Spring/Bean%E7%9A%84%E6%B3%A8%E5%85%A5.png"></p>
<h1 id="3、Java代理模式的实现"><a href="#3、Java代理模式的实现" class="headerlink" title="3、Java代理模式的实现"></a>3、Java代理模式的实现</h1><p>在聊代理之前需要搞懂为什么需要代理这个东西，它的目的是什么。代理模式是为了在不修改已有代码的前提下，对原来的功能进行增强（做更多处理），比如打印日志，安全控制等。其实不使用代理模式的话也可以实现，但是对代码的入侵性极高，所以使用代理模式几乎可以做到对原有代码没有入侵，并且能够实现想要的功能。</p>
<p>Java代理模式主要有三种：JDK静态代理、JDK动态代理和CGLIB动态代理。其中Spring的AOP的实现中就是利用了JDK动态代理和CGLIB动态代理。</p>
<h2 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h2><p>Java静态代理是代理类和被代理类共同实现同一接口，代理类对被代理类的操作进行增强。</p>
<p>比如：我创建一个学生类，有一个跑方法，我需要代理类对跑进行增强：跑之前操作，跑之后操作。</p>
<p>共同接口StudentInterface.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>普通学生类（被代理类）Student.java：（有name属性）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">StudentInterface</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot; is running &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增强学生类（代理类）StudentProxy.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentProxy</span> <span class="keyword">implements</span> <span class="title class_">StudentInterface</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StudentInterface target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StudentProxy</span><span class="params">(StudentInterface target)</span>&#123;</span><br><span class="line">        <span class="comment">// 在代理类初始化时传入目标类</span></span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; before running &quot;</span>);<span class="comment">//增强</span></span><br><span class="line">        <span class="built_in">this</span>.target.run();<span class="comment">//目标类本身操作</span></span><br><span class="line">        System.out.println(<span class="string">&quot; after running &quot;</span>);<span class="comment">//增强</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试执行Main.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//被代理类对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        <span class="comment">//代理类对象</span></span><br><span class="line">        <span class="type">StudentProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentProxy</span>(student);</span><br><span class="line">        <span class="comment">//代理类执行方法</span></span><br><span class="line">        proxy.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，普通学生类（被代理类）和增强学生类（代理类）都实现了同一接口，并且都实现了<code>run</code>方法，普通类就是很普通的执行了，但是代理类里不仅执行了<code>run</code>方法，还在<code>run</code>方法前后进行了更多的处理（也就是增强）。所以这就是静态代理，在不改变原代码的前提下，使用另一个类对原类进行进一步的增强处理（比如打印日志，安全控制等）。在普通学生类Student的代码中是完全感知不到的，对原代码没有入侵。</p>
<ol>
<li>统一接口</li>
<li>普通类（被代理类）</li>
<li>增强类（代理类）以参数的形式获得目标类，执行普通类中方法再进行增强。</li>
</ol>
<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><p>Java动态代理仍然需要指定一个接口，但是代理类并不需要实现它。主要是利用<strong>Java反射机制</strong>来获取到被代理类执行的方法。</p>
<p>接口StudentInterface.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentInterface</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>被代理类Student.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">StudentInterface</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot; is running&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代理类StudentProxyHandler.java：</p>
<p>和静态代理的类似，都需要获得被代理类对象。不过动态代理需要实现<code>InvocationHandler</code>接口，然后重新<code>invoke()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object subject;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StudentProxyHandler</span><span class="params">(Object subject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">          proxy    代理类对象</span></span><br><span class="line"><span class="comment">          method   被代理类执行的方法</span></span><br><span class="line"><span class="comment">          args     被代理类执行的参数</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;before invoke &quot;</span>+method.getName());</span><br><span class="line">        method.invoke(subject,args);<span class="comment">//执行被代理类的方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;after invoke &quot;</span>+method.getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试执行Main.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 被代理类</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">        <span class="comment">// 代理类</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentProxyHandler</span>(student);</span><br><span class="line"></span><br><span class="line">        <span class="type">StudentInterface</span> <span class="variable">studentInterface</span> <span class="operator">=</span> (StudentInterface) Proxy.newProxyInstance(</span><br><span class="line">                student.getClass().getClassLoader(),</span><br><span class="line">                student.getClass().getInterfaces(),</span><br><span class="line">                handler</span><br><span class="line">        );</span><br><span class="line">        studentInterface.run();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        print:</span></span><br><span class="line"><span class="comment">            before invoke run</span></span><br><span class="line"><span class="comment">            Jack is running</span></span><br><span class="line"><span class="comment">            after invoke run</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到StudentProxyHandler是实现了InvocationHandler，重写了<code>invoke()</code>方法，invoke方法中的第一个参数proxy是代理类，第二个参数method是被代理类执行的方法，第三个参数args是被代理类执行的参数。动态代理原理就是利用Java反射机制来获得被代理类执行的方法，执行的参数，执行的方法的返回值等。</p>
<ol>
<li>接口</li>
<li>被代理类实现接口</li>
<li>代理类实现InvocationHandler接口，重写invoke方法，并利用好proxy、method、args参数。</li>
</ol>
<blockquote>
<p><strong>区别</strong></p>
<p>动态代理相较于静态代理的区别在于动态代理能够利用反射获取到执行方法各个属性，比如方法名、方法参数、方法返回值等。</p>
</blockquote>
<h2 id="CGLIB动态代理"><a href="#CGLIB动态代理" class="headerlink" title="CGLIB动态代理"></a>CGLIB动态代理</h2><p>Cglib是一个强大的、高性能的代码生成包，它广泛被许多AOP框架使用，为他们提供方法的拦截。下，下图是我网上找到的一张Cglib与一些框架和语言的关系：</p>
<p><img src="/2023/07/19/back-end/Java/Spring/Spring/CGLIB%E8%B7%9F%E5%85%B6%E4%BB%96%E6%A1%86%E6%9E%B6%E6%88%96%E8%AF%AD%E8%A8%80%E7%9A%84%E5%85%B3%E7%B3%BB.gif"></p>
<ul>
<li>最底层的是字节码Bytecode，字节码是Java为了保证“一次编译、到处运行”而产生的一种虚拟指令格式，例如iload_0、iconst_1、if_icmpne、dup等</li>
<li>位于字节码之上的是ASM，这是一种直接操作字节码的框架，应用ASM需要对Java字节码、Class结构比较熟悉</li>
<li>位于ASM之上的是CGLIB、Groovy、BeanShell，后两种并不是Java体系中的内容而是脚本语言，它们通过ASM框架生成字节码变相执行Java代码，这说明在JVM中执行程序并不一定非要写Java代码—-只要你能生成Java字节码，JVM并不关心字节码的来源，当然通过Java代码生成的JVM字节码是通过编译器直接生成的，算是最“正统”的JVM字节码</li>
<li>位于CGLIB、Groovy、BeanShell之上的就是Hibernate、Spring AOP这些框架了，这一层大家都比较熟悉</li>
<li>最上层的是Applications，即具体应用，一般都是一个Web项目或者本地跑一个程序</li>
</ul>
<h2 id="三种代理方式的区别"><a href="#三种代理方式的区别" class="headerlink" title="三种代理方式的区别"></a>三种代理方式的区别</h2><table>
<thead>
<tr>
<th>代理方式</th>
<th>实现</th>
<th>优点</th>
<th>缺点</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>JDK静态代理</td>
<td>代理类与委托类实现同一接口，并且在代理类中需要硬编码接口</td>
<td>实现简单，容易理解</td>
<td>代理类需要硬编码接口，在实际应用中可能会导致重复编码，浪费存储空间并且效率很低</td>
<td>好像没啥特点</td>
</tr>
<tr>
<td>JDK动态代理</td>
<td>代理类与委托类实现同一接口，主要是通过代理类实现InvocationHandler并重写invoke方法来进行动态代理的，在invoke方法中将对方法进行增强处理</td>
<td>不需要硬编码接口，代码复用率高</td>
<td>只能够代理实现了接口的委托类</td>
<td>底层使用反射机制进行方法的调用</td>
</tr>
<tr>
<td>CGLIB动态代理</td>
<td>代理类将委托类作为自己的父类并为其中的非final委托方法创建两个方法，一个是与委托方法签名相同的方法，它在方法中会通过super调用委托方法；另一个是代理类独有的方法。在代理方法中，它会判断是否存在实现了MethodInterceptor接口的对象，若存在则将调用intercept方法对委托方法进行代理</td>
<td>可以在运行时对类或者是接口进行增强操作，且委托类无需实现接口</td>
<td>不能对final类以及final方法进行代理</td>
<td>底层将方法全部存入一个数组中，通过数组索引直接进行方法调用</td>
</tr>
</tbody></table>
<h1 id="4、Spring事务概述"><a href="#4、Spring事务概述" class="headerlink" title="4、Spring事务概述"></a>4、Spring事务概述</h1><h2 id="数据库事务概述"><a href="#数据库事务概述" class="headerlink" title="数据库事务概述"></a>数据库事务概述</h2><p><strong>事务：</strong>是一系列操作组成的工作单元。该工作单元内的操作是不可分割的，即要么所有的<strong>操作都做</strong>，要么所有的<strong>操作都不做</strong>。</p>
<p>事务必须满足ACID（原子性、一致性、隔离性、持久性）原则，缺一不可：</p>
<ul>
<li>原子性（Atomicity）：即事务是不可分割的最小单元，事务内的操作要么全做，要么全不做。</li>
<li>一致性（Consistency）：即事务完成前后数据库状态是一致的。</li>
<li>隔离性（Isolation）：并发执行的事务之间是不会相互影响的，一个事务执行的内部不会对其他事务产生影响。（无法避免，所以才会产生事务隔离级别）</li>
<li>持久性（Durability）：事务一旦执行成功，它对数据库的改变是永久的，不会因为断电或者系统故障导致数据不一致或者丢失。</li>
</ul>
<p>实际并发操作可能会出现以下问题：</p>
<ul>
<li>脏读：（A事务读取了B事务还未确定提交的数据，但是B事务回滚了）。A事务读取到了B事务还没提交的数据，最终B事务回滚了，那么A事务就读到了不应该读到的数据。</li>
<li>不可重复读：（读取到了提交的新事务，指更新操作）A事务多次读取数据时不一致，原因是B事务在此期间修改了数据。</li>
<li>幻读：（读取到了提交的新事务，指增删操作）A事务多次读取数据时不一致，原因是B事务在此期间增删了记录。</li>
<li>第一类事务丢失：（回滚丢失）指A事务和B事务同时操作一条数据（A事务比B事务先或同时开始），B事务提交了修改，但是A事务最后回滚了，那么数据最后就会回滚到A事务前，则B事务提交的修改就会丢失。（事务的特性：执行事务前会将数据当前状态“快照”，以便回滚）。</li>
<li>第二类事务丢失：（提交覆盖丢失）指A事务和B事务同时操作一条数据，B事务中途提交了修改，最后提交事务，可是在B事务完成的过程中A事务也进行了修改，最后的结果确实以B事务提交的结果为准，所以A事务的修改就被覆盖了。</li>
</ul>
<p>为了解决以上问题，事务隔离级别由低到高分为Read Uncommited、Read commited、Repeatable read、Serializable。分别是<strong>读未提交、读已提交、可重复读、串行化</strong>。</p>
<ul>
<li>Read Uncommited（读未提交）：A事务能够读到B事务还未提交的数据，可能会<strong>出现脏读</strong>。</li>
<li>Read Commited（读已提交）：A事务只能在B事务提交后才能读，可能会<strong>出现不可重复读</strong>，但是&#x3D;&#x3D;解决了脏读&#x3D;&#x3D;。原因是A事务只能在B事务完成前后才能读，如果B事务发生了修改，那么B事务完成前后的数据肯定不相同，所以数据才会不重复。</li>
<li>Repeatable Read（可重复读）：B事务开启时，A事务不能再修改数据。可能会<strong>出现幻读</strong>，但是&#x3D;&#x3D;解决了不可重复读&#x3D;&#x3D;。原因是B事务开启后，此时A事务即使读到但是无法修改，但是A事务可以读到修改中途的数据。</li>
<li>Serializable（串行化）：所有事务按顺序执行，必须等前一个事务执行完毕后再执行下一个事务，效率较低，但是可以解决以上所有问题。</li>
</ul>
<p>大多数据库默认的隔离级别是Read Commited（读已提交），如Sql Server、Oracle。</p>
<p>MySQL的默认隔离级别是Repeated Read（可重复读）。</p>
<blockquote>
<p>为什么会有事务隔离？</p>
<p>虽然依据事务的隔离性原则来说，事务与事务之间不会相互影响。可是项目实际运行过程中可能会出现很多人一起访问资源的并发情况，所以这个时候必定会出现一些事务与事务之间相互影响的情况，如：脏读、幻读等，针对这些可能出现的情况，就出现了事务的隔离级别，隔离级别越低对两个事务之间就越不干涉，这样效率最高，但是互相影响就越大。</p>
<p>所以需要考虑项目实际运行过程中事务与事务之间能接受的影响程度以及项目运行效率，结合两者来确定隔离级别，以达到效率最大化、事务之间影响最小化。</p>
</blockquote>
<h2 id="事务类型"><a href="#事务类型" class="headerlink" title="事务类型"></a>事务类型</h2><p>Spring支持编程式事务管理和声明式事务管理两种。其中比较推荐使用声明式事务管理的方式。</p>
<h3 id="Spring编程式事务（了解）"><a href="#Spring编程式事务（了解）" class="headerlink" title="Spring编程式事务（了解）"></a>Spring编程式事务（了解）</h3><p>编程式事务管理对代码有侵入性（所以不推荐），使用TransactionTemplate或者使用PlatformTransactionManager，对于编程式事务管理，Spring更推荐使用TransactionTemplate。</p>
<p>需要导入<code>TransactionTemplate</code>然后调用<code>excute()</code>方法，里面包含的就是一整条事务了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TransactionTemplate transactionTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transactionOne</span><span class="params">()</span>&#123;</span><br><span class="line">        transactionTemplate.execute(transactionStatus -&gt; &#123;</span><br><span class="line">            userService.selectAllUser();</span><br><span class="line">            userService.deleteOneUser(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>transactionTemplate.execute()</code>的参数是一个<code>TransactionCallback</code>接口，这个接口只有一个抽象方法<code>doInTransaction()</code>。所以可以使用lambda表达式（当参数是一个接口，并且接口中只有一个抽象方法时，可以使用匿名内部类+lambda表达式）。</p>
<p>其中<code>transactionOne()</code>就是一个事务，<code>transactionTemplate.execute()</code>就是开启事务，并且事务里包含两条操作。（其中一个操作出错了整条事务就会回滚）。</p>
<h3 id="Spring声明式事务（熟悉）"><a href="#Spring声明式事务（熟悉）" class="headerlink" title="Spring声明式事务（熟悉）"></a>Spring声明式事务（熟悉）</h3><p>声明式事务管理器是基于AOP的，所以对代码的入侵性较小，这也是Spring所倡导的非侵入式编程方式。</p>
<p>声明式事务管理器有两种开启方式：</p>
<ol>
<li>在XML文件里配置</li>
<li>以注解的方式配置（<code>@Transactional</code>）</li>
</ol>
<p>这里重点讲解以注解的方式，<code>@Transactional</code>注解可以加在类或者方法上，如果加在类上表示该类下的所有方法都交给事务管理器管理，加在方法上则表示该类交给事务管理器管理。</p>
<p>加在类上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transactionOne</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transactionTwo</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加在方法上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transactionOne</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transactionTwo</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时该注解也可以为事务配置隔离级别、事务传播特性、回滚规则、是否只读、事务超时时间等：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line">    <span class="meta">@AliasFor(&quot;transactionManager&quot;)</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    String <span class="title function_">transactionManager</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String[] label() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Propagation <span class="title function_">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED;</span><br><span class="line"></span><br><span class="line">    Isolation <span class="title function_">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">timeout</span><span class="params">()</span> <span class="keyword">default</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">timeoutString</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Throwable</span>&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Throwable</span>&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到Spring的默认隔离级别是<code>Isolation.DEFAULT</code>，这个值为-1，代表的是数据库的默认隔离级别，也就是说Spring的默认隔离级别是数据库的默认隔离级别。同样的，Spring有以下隔离级别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Isolation</span> &#123;</span><br><span class="line">    DEFAULT(-<span class="number">1</span>),</span><br><span class="line">    READ_UNCOMMITTED(<span class="number">1</span>), <span class="comment">//读未提交</span></span><br><span class="line">    READ_COMMITTED(<span class="number">2</span>),   <span class="comment">//读已提交</span></span><br><span class="line">    REPEATABLE_READ(<span class="number">4</span>),	 <span class="comment">//可重复读</span></span><br><span class="line">    SERIALIZABLE(<span class="number">8</span>);     <span class="comment">//串行化</span></span><br><span class="line">    </span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<h3 id="编程式事务和声明式事务的区别"><a href="#编程式事务和声明式事务的区别" class="headerlink" title="编程式事务和声明式事务的区别"></a>编程式事务和声明式事务的区别</h3><p>编程式事务每次都需要单独实现，如果遇到业务量大且复杂的时候，使用编程式事务则会是一场灾难。而声明式事务属于非侵入式，不会影响业务的逻辑实现，只需要在需要的方法或者类上加上注解，或者使用XML的方式配置。</p>
<p>唯一不足的地方就是声明式事务管理的粒度是<strong>方法级别</strong>，而编程式事务管理是可以到<strong>代码块</strong>的，但是可以通过提取方法的方式完成声明式事务管理的配置。</p>
</blockquote>
<h3 id="Spring事务的传播行为"><a href="#Spring事务的传播行为" class="headerlink" title="Spring事务的传播行为"></a>Spring事务的传播行为</h3><h4 id="外围方法和内部方法"><a href="#外围方法和内部方法" class="headerlink" title="外围方法和内部方法"></a>外围方法和内部方法</h4><p>Spring讲事务传播行为前需要了解两个概念，外围方法和内部方法。如以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service</span>&#123;</span><br><span class="line">    </span><br><span class="line">    Boolean <span class="title function_">insertOne</span><span class="params">()</span>&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Transaction</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transactionOne</span><span class="params">()</span>&#123;</span><br><span class="line">        Service.insertOne();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Transaction类中，<code>transactionOne()</code>对于<code>Service.insertOne()</code>来说，就是外围方法，而<code>Service.insertOne()</code>里面就是内部方法。内部开启事务管理则是在<code>insertOne()</code>加注解，外围开启事务则是在<code>transactionOne()</code>加注解。</p>
<h4 id="Spring中七种事务传播行为"><a href="#Spring中七种事务传播行为" class="headerlink" title="Spring中七种事务传播行为"></a>Spring中七种事务传播行为</h4><p>参考<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000013341344">Spring事务传播行为详解@JerryTse</a></p>
<table>
<thead>
<tr>
<th>事务传播行为类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>PROPAGATION_REQUIRED</td>
<td>如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。这是最常见的选择。</td>
</tr>
<tr>
<td>PROPAGATION_SUPPORTS</td>
<td>支持当前事务，如果当前没有事务，就以非事务方式执行。</td>
</tr>
<tr>
<td>PROPAGATION_MANDATORY</td>
<td>使用当前的事务，如果当前没有事务，就抛出异常。</td>
</tr>
<tr>
<td>PROPAGATION_REQUIRES_NEW</td>
<td>新建事务，如果当前存在事务，把当前事务挂起。</td>
</tr>
<tr>
<td>PROPAGATION_NOT_SUPPORTED</td>
<td>以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</td>
</tr>
<tr>
<td>PROPAGATION_NEVER</td>
<td>以非事务方式执行，如果当前存在事务，则抛出异常。</td>
</tr>
<tr>
<td>PROPAGATION_NESTED</td>
<td>如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行与PROPAGATION_REQUIRED类似的操作。</td>
</tr>
</tbody></table>
<h4 id="PROPAGATION-REQUIRED（Spring默认事务传播行为）"><a href="#PROPAGATION-REQUIRED（Spring默认事务传播行为）" class="headerlink" title="PROPAGATION_REQUIRED（Spring默认事务传播行为）"></a>PROPAGATION_REQUIRED（Spring默认事务传播行为）</h4><p>在<strong>外围方法未开启事务</strong>的情况下<code> PROPAGATION_REQUIRED</code>修饰的内部方法会新开启自己的事务，且开启的事务相互独立，互不干扰。<strong>外围方法没有开启事务，则内部方法分别开启自己的事务，相互独立互不干扰。</strong></p>
<p>在<strong>外围方法开启事务</strong>的情况下<code>PROPAGATION_REQUIRED</code>修饰的内部方法会加入到外围方法的事务中，所有<code>PROPAGATION_REQUIRED</code>修饰的内部方法和外围方法均属于同一事务，只要一个方法回滚，整个事务均回滚。<strong>如果外围方法开启事务，则内部方法也加入进该事务，统一为同一事务。</strong></p>
<h4 id="PROPAGATION-REQUIRES-NEW"><a href="#PROPAGATION-REQUIRES-NEW" class="headerlink" title="PROPAGATION_REQUIRES_NEW"></a>PROPAGATION_REQUIRES_NEW</h4><p>在<strong>外围方法未开启事务</strong>的情况下<code>Propagation.REQUIRES_NEW</code>修饰的内部方法会新开启自己的事务，且开启的事务相互独立，互不干扰。<strong>外围方法没有开启事务，则内部方法分别开启自己的事务，相互独立互不干扰。</strong></p>
<p>在<strong>外围方法开启事务</strong>的情况下<code>Propagation.REQUIRES_NEW</code>修饰的内部方法依然会单独开启独立事务，且与外部方法事务也独立，内部方法之间、内部方法和外部方法事务均相互独立，互不干扰。<strong>外围方法开启事务时，内部方法仍旧会开启独立的事务，与外部事务相互独立，互不干扰。</strong></p>
<h4 id="PROPAGATION-NESTED"><a href="#PROPAGATION-NESTED" class="headerlink" title="PROPAGATION_NESTED"></a>PROPAGATION_NESTED</h4><p>在<strong>外围方法未开启事务</strong>的情况下<code>Propagation.NESTED</code>和<code>Propagation.REQUIRED</code>作用相同，修饰的内部方法都会新开启自己的事务，且开启的事务相互独立，互不干扰。<strong>外围方法没有开启事务，内部方法分别开启自己的事务，相互独立互不干扰。</strong></p>
<p>在<strong>外围方法开启事务</strong>的情况下<code>Propagation.NESTED</code>修饰的内部方法属于外部事务的子事务，外围主事务回滚，子事务一定回滚，而内部子事务可以单独回滚而不影响外围主事务和其他子事务。<strong>外围方法开启事务时，内部方法的事务为外围方法的子事务，外围事务回滚内部事务同时回滚，但是内部事务可以单独捕获，并且外围事务不回滚。</strong></p>
<h1 id="5、SpringMVC概述"><a href="#5、SpringMVC概述" class="headerlink" title="5、SpringMVC概述"></a>5、SpringMVC概述</h1><h2 id="SpringMVC是什么"><a href="#SpringMVC是什么" class="headerlink" title="SpringMVC是什么"></a>SpringMVC是什么</h2><p>Spring Web MVC是一种基于Java的，实现了Web MVC设计模式的请求驱动类型的<strong>轻量级Web框架</strong>。即，使用了MVC架构的模式的思想，简化开发Web开发。</p>
<p>前端控制器是<code>DispatcherServlet</code>。</p>
<p>应用控制器拆分为处理器映射器<code>HandlerMapping</code>进行处理器管理和视图解析器<code>View Resolver</code>进行视图管理。</p>
<p>页面控制器是<code>Controller接口</code>（仅包含<code>ModelAndView handleRequest(request, response)</code>方法）的实现。</p>
<p>提供了非常灵活的数据验证、格式化和数据绑定机制；提供了强大的配置（约定大于配置）编程支持。</p>
<h2 id="Spring-MVC架构"><a href="#Spring-MVC架构" class="headerlink" title="Spring MVC架构"></a>Spring MVC架构</h2><p>Spring Web MVC框架也是一个基于请求驱动的Web框架，并且也是用了前端控制器模式来进行设计，再根据请求映射规则分发给响应的页面控制器进行处理。</p>
<h3 id="Spring-MVC-处理请求的流程"><a href="#Spring-MVC-处理请求的流程" class="headerlink" title="Spring MVC 处理请求的流程"></a>Spring MVC 处理请求的流程</h3><p><img src="/2023/07/19/back-end/Java/Spring/Spring/image-20210804142503656.png"></p>
<p>图片来自：<a target="_blank" rel="noopener" href="https://github.com/h2pl/Java-Tutoria">https://github.com/h2pl/Java-Tutoria</a></p>
<p>具体执行流程如下：</p>
<ol>
<li>用户发起请求——&gt;前端控制器（DispatcherServlet）接收，并根据请求的信息（如URL）来决定哪个页面控制器进行处理然后把该请求委托给它。</li>
<li>页面控制器（Controller）收到请求后对请求进行具体的功能处理（调用业务层Service对象）；处理完毕后返回一个ModelAndView对象给前端控制器。</li>
<li>前端控制器根据返回的视图名View选择对应的页面进行渲染，并把模型数据一并传入视图供视图进行数据渲染。</li>
<li>最后前端控制器将响应返回给用户。</li>
</ol>
<h3 id="Spring-MVC-架构图"><a href="#Spring-MVC-架构图" class="headerlink" title="Spring MVC 架构图"></a>Spring MVC 架构图</h3><p><img src="/2023/07/19/back-end/Java/Spring/Spring/image-20210804145139577.png"></p>
<p>图片来自：<a target="_blank" rel="noopener" href="https://github.com/h2pl/Java-Tutoria">https://github.com/h2pl/Java-Tutoria</a></p>
<h3 id="Spring-MVC-优势"><a href="#Spring-MVC-优势" class="headerlink" title="Spring MVC 优势"></a>Spring MVC 优势</h3><ol>
<li>清晰的角色划分：前端控制器（DispatcherServlet）、处理器映射器（HandlerMapping）、处理器适配器（HandlerAdapter）、视图解析器（ViewResolver）、页面控制器（Controller）、验证器（Validator）等。</li>
<li>分工明确，扩展灵活，很容易扩展。</li>
<li>和其他Spring框架无缝集成，是其他Web框架所不具备的。</li>
<li>可定制性，HandlerMapping、ViewResolver能够很容易定制。</li>
<li>支持RESTful风格。</li>
<li>约定大于配置的契约式编程。</li>
<li>基于注解的零配置支持。</li>
</ol>
<h3 id="DispatcherServlet作用"><a href="#DispatcherServlet作用" class="headerlink" title="DispatcherServlet作用"></a>DispatcherServlet作用</h3><p>DispatcherServlet是前端控制器设计模式的实现，提供Spring Web MVC的集中访问点，负责职责的分派，与Spring IoC容器无缝集成。主要职责如下：</p>
<ol>
<li>文件上传解析，如果请求类型是multipart将通过MultipartResolver进行文件上传解析。</li>
<li>通过HandlerMapping，将请求映射到处理器。</li>
<li>通过ViewResolver解析逻辑视图名到具体视图实现。</li>
</ol>
<p>DispatcherServlet主要负责流程控制。</p>
<p>本文部分内容参考自：<a target="_blank" rel="noopener" href="https://github.com/h2pl/Java-Tutorial/">https://github.com/h2pl/Java-Tutorial/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/Spring/Spring/" data-id="clsblyuez0028w0k61ahu2dxj" data-title="Spring简单剖析" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/Java多线程/Java多线程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/">Java多线程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="创建线程的三种方式"><a href="#创建线程的三种方式" class="headerlink" title="创建线程的三种方式"></a>创建线程的三种方式</h2><ol>
<li>继承Thread类<ul>
<li>继承Thread类</li>
<li>使用Thread类对象的<code>start()</code>启动线程</li>
</ul>
</li>
<li>实现Runnable接口（推荐）<ul>
<li>实现Runnable接口</li>
<li>使用Thread类对象代理线程用<code>start()</code>启动线程</li>
</ul>
</li>
<li>实现Callable接口</li>
</ol>
<h3 id="第一种方式：继承Thread类"><a href="#第一种方式：继承Thread类" class="headerlink" title="第一种方式：继承Thread类"></a>第一种方式：继承Thread类</h3><ol>
<li><p>创建类继承Thread类，重写<code>run()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">//线程体</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;TestThread:&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主入口</p>
<p>创建Thread类对象，再调用<code>start()</code>方法就可以启动线程了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="comment">//主进程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//方式一：继承Thread类</span></span><br><span class="line">        <span class="comment">//新建线程对象，再调用start()方法</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">TestThread</span>().start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="第二种方式：实现Runnable接口"><a href="#第二种方式：实现Runnable接口" class="headerlink" title="第二种方式：实现Runnable接口"></a>第二种方式：实现Runnable接口</h3><ol>
<li><p>创建线程类，实现Runnable接口，重写<code>run()</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>Thread.currentThread().getName()</code>是获得当前线程的线程名，在创建线程对象的时候可以给线程指定线程名</p>
</li>
<li><p>主入口</p>
<p>创建Thread类对象，使用代理模式将实现了Runnable接口的线程丢入Thread类对象里，再调用Thread类对象的<code>start()</code>方法启动线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="comment">//主进程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//方式二：实现Runnable接口</span></span><br><span class="line">        <span class="comment">//新建Thread()代理，参数是线程，再调用start()</span></span><br><span class="line">        <span class="type">TestRunnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestRunnable</span>();</span><br><span class="line">        <span class="comment">//第一个参数是线程，第二个参数是线程名</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(runnable,<span class="string">&quot;RunnableThread&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="第三种方式：实现Callable接口"><a href="#第三种方式：实现Callable接口" class="headerlink" title="第三种方式：实现Callable接口"></a>第三种方式：实现Callable接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Boolean&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">call</span><span class="params">()</span>  &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>();</span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>();</span><br><span class="line">        <span class="type">TestCallable</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TestCallable</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、开启线程池服务</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、将线程提交以供执行</span></span><br><span class="line">        Future&lt;Boolean&gt; s1 = service.submit(t1);</span><br><span class="line">        Future&lt;Boolean&gt; s2 = service.submit(t2);</span><br><span class="line">        Future&lt;Boolean&gt; s3 = service.submit(t3);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3、分别获取线程执行的结果</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">r1</span> <span class="operator">=</span> s1.get();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">r2</span> <span class="operator">=</span> s2.get();</span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">r3</span> <span class="operator">=</span> s3.get();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4、关闭服务（切记）</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>实现Callable接口，并且指定返回值类型</li>
<li>在这个类里重写<code>call()</code>接口，注意区别前两种， 前两种是实现<code>run()</code>方法</li>
<li>先开启线程池服务，用<code>sumbit()</code>方法将线程提交，然后用<code>get()</code>方法得到线程的返回值</li>
<li>最后记得关闭线程池服务</li>
</ol>
<h2 id="了解静态代理模式"><a href="#了解静态代理模式" class="headerlink" title="了解静态代理模式"></a>了解静态代理模式</h2><p>举个例子：假如你要结婚了，你需要找婚庆公司帮忙，那么实际上你和婚庆公司都要结婚，但是婚庆公司做得可能会比你做得要多，比如帮你筹备，帮你计划，帮你拍照等待，但是无论如何你们都是要实现同一个目的——&gt;”结婚”，只是婚庆公司会帮你做而且做得更好，所以婚庆公司就是代理，你就是真正要实现的角色。用户只需要关心自己要实现的功能就好了，婚庆公司（代理）帮你做一些锦上添花的事情，但是具体怎么做，你其实并不用操心。</p>
<ol>
<li><p>共同实现的功能（结婚）</p>
<p>用户和婚庆公司（代理）都需要实现的共同功能——结婚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Marry</span> &#123;</span><br><span class="line">    <span class="comment">//结婚</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">Marry</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>角色实现这个功能（用户实现结婚）</p>
<p>你只需要简单的将你的名字输出就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> <span class="keyword">implements</span> <span class="title class_">Marry</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String peopleName;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">People</span><span class="params">(String peopleName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.peopleName = peopleName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Marry</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(peopleName+<span class="string">&quot;结婚了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>代理需要实现这个功能（代理实现结婚）</p>
<p>婚庆公司不仅帮你实现了结婚，甚至还用了<code>before()</code>和<code>after()</code>方法帮你增强了结婚前和结婚后。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeddingCompany</span> <span class="keyword">implements</span> <span class="title class_">Marry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Marry target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WeddingCompany</span><span class="params">(Marry target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Marry</span><span class="params">()</span> &#123;</span><br><span class="line">        before();</span><br><span class="line">        target.Marry();</span><br><span class="line">        after();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;婚庆公司帮忙结婚前&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;婚庆公司帮忙结婚后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主入口</p>
<p>需要新建people对象，同时将people对象作为WeddingCompany代理的参数，然后执行接口中的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//新建people对象</span></span><br><span class="line">        <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        <span class="comment">//代理帮忙实现接口并且执行方法</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">WeddingCompany</span>(people).Marry();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>总结：</p>
<ol>
<li>定义一个接口，声明方法</li>
<li>目标类实现这个接口，重写里面的方法</li>
<li>代理类也要实现这个接口，在代理的构造方法中，需要另外的共同实现同一接口的对象作为构造函数target，同时在重写的方法里执行目标对象target的方法和代理的增强。</li>
<li>AOP面向切面编程应该就是静态代理的强化，降低耦合。一个代码只需要专注自己的事情，另外需要对这段代码增强就直接使用静态代理就好了。</li>
</ol>
</li>
</ol>
<p>由于开启线程或者创建线程的Thread类里实际上就是实现了Runnable接口，同时创建线程的第二种方式也是实现Runnable接口。所以Thread类就是代理，实现Runnable接口的类就是角色。启动线程就是通过代理模式完成的。</p>
<h2 id="lambda表达式"><a href="#lambda表达式" class="headerlink" title="lambda表达式"></a>lambda表达式</h2><p>在平常情况下，我们想要实现接口，可以用implements实现它，同时还有一种快捷但是不那么已读的方式，就是使用匿名内部类来临时实现接口，比如：</p>
<ul>
<li><p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String name,String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>匿名内部类</p>
<p>我们在创建UserService这个对象的时候，直接在后面跟上{}并且重写里面的方法就可以临时实现这个接口了，但是这个实现类并没有具体的类名，所以这就是匿名内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>() &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String name, String password)</span> &#123;</span><br><span class="line">              System.out.println(<span class="string">&quot;name=&quot;</span>+name);</span><br><span class="line">         	 	System.out.println(<span class="string">&quot;password=&quot;</span>+password);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure>

<p>就有点像Android开发里的按钮监听事件，也是可以用匿名内部类的方式来实现的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setOnClickListener(<span class="keyword">new</span> <span class="title class_">OnClickListener</span>()&#123;  </span><br><span class="line">          <span class="meta">@Override</span>  </span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;  </span><br><span class="line">              <span class="comment">// TODO Auto-generated method stub  </span></span><br><span class="line">              <span class="type">Intent</span> <span class="variable">intet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>(MainActivity.<span class="built_in">this</span>,seekbar.class);  </span><br><span class="line">              startActivity(intet);  </span><br><span class="line">              <span class="comment">//finish();  </span></span><br><span class="line">          &#125;  </span><br><span class="line">            </span><br><span class="line">      &#125;);  </span><br></pre></td></tr></table></figure>
</li>
<li><p>接口只需要实现一个方法</p>
<p>如果接口中只需要实现一个方法的话，那么那么多的匿名内部类的声明代码好像就可以不用写了，因为这个接口本身就只有这一个方法，无论怎样实现都指向这个方法，所有就有了lambda表达式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">userService=(name, password) -&gt; &#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;name=&quot;</span>+name);</span><br><span class="line">          System.out.println(<span class="string">&quot;password=&quot;</span>+password);</span><br><span class="line">      &#125;;</span><br><span class="line">      userService.print(<span class="string">&quot;名字&quot;</span>,<span class="string">&quot;密码&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>可以看到，我们只需要在实现这个接口的时候用<code>(name,password)</code>传递参数，<code>-&gt;&#123;&#125;</code>表明这是一个lambda表达式，中间放实现体就可以了。由于创建线程的方式就是实现Runnable接口里面就只需要重写<code>run()</code>方法，所以我们很多时候就需要用lambda表达式来创建线程。</p>
</li>
</ul>
<h2 id="lambda表达式结合代理模式"><a href="#lambda表达式结合代理模式" class="headerlink" title="lambda表达式结合代理模式"></a>lambda表达式结合代理模式</h2><p>所以综上所述，实际上我们可以利用代理模式并且使用lambda表达式来快速创建线程</p>
<ol>
<li><p>创建Thread静态代理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//静态代理</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用lambda表达式快速创建线程，同时给代理加上<code>start()</code>启动线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//lambda表达式快速创建线程</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> ()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(runnable).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于静态代理需要的参数一定是实现Runnable类对象，所以还可以简化成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLambda</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接在new Thread里写lambda表达式。</p>
</li>
</ol>
<h2 id="线程停止"><a href="#线程停止" class="headerlink" title="线程停止"></a>线程停止</h2><p>Java已经不再建议使用传统的<code>stop()</code>和<code>destory()</code>方法来停止线程，而是建议利用外部标识位来手动停止线程</p>
<ul>
<li><p>线程</p>
<p>标识位flag默认是true，所以while会一直循环，但是如果外部执行了<code>stop()</code>方法的话那么flag就会变成false，while循环就停止了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//置标识位为false</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>&#123;</span><br><span class="line">        flag=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主入口</p>
<p>首先创建线程对象然后启动线程，利用循环来判断，如果循环到了900那么就执行线程里的<code>stop()</code>方法：置线程里的标识位为false从而达到从外部手动停止线程的目的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestStop</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">myThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(myThread).start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i);</span><br><span class="line">            <span class="keyword">if</span> (i==<span class="number">900</span>)&#123;<span class="comment">//如果i循环到了900则执行线程的停止方法</span></span><br><span class="line">                myThread.stop();</span><br><span class="line">                System.out.println(<span class="string">&quot;线程停止&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="线程休眠（sleep）"><a href="#线程休眠（sleep）" class="headerlink" title="线程休眠（sleep）"></a>线程休眠（sleep）</h2><p>线程休眠就是直接调用Thread类的<code>sleep(long millis)</code>方法就好了，参数是毫秒，需要捕获<code>InterruptedException</code>异常，然后线程就会休眠了。</p>
<h2 id="线程礼让（yield）"><a href="#线程礼让（yield）" class="headerlink" title="线程礼让（yield）"></a>线程礼让（yield）</h2><p>线程礼让就是在线程体中调用Thread类的<code>yield()</code>方法，注意“礼让”不代表这个线程一定停止运行，而是有可能让另外个线程运行。</p>
<h2 id="线程强制执行（join）"><a href="#线程强制执行（join）" class="headerlink" title="线程强制执行（join）"></a>线程强制执行（join）</h2><p>线程强制执行就是调用Thread类中<code>join()</code>方法，让线程插队。</p>
<ul>
<li><p>线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">JoinThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主入口</p>
<p>先创建Thread对象，并且给线程名赋为vip，在for循环里主线程也要打印i，同时当i循环到20的时候，调用Thread类对象的<code>join</code>方法强制执行自定义的线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJoin</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//创建线程对象</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">JoinThread</span>(), <span class="string">&quot;vip&quot;</span>);</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//循环数到了20后自定义线程插队</span></span><br><span class="line">            <span class="keyword">if</span> (i==<span class="number">20</span>)&#123;</span><br><span class="line">                thread.join();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//main主线程打印</span></span><br><span class="line">            System.out.println(<span class="string">&quot;main-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>观察结果</p>
<p>通过观察运行结果我们可以指导，在i&lt;20之前，main线程和用户自定义线程并行，但是到了20时，用户自定义线程强制执行后就一直执行用户自定义线程了，直到它执行完毕。最后再是主线程执行完毕。</p>
</li>
</ul>
<h2 id="线程状态（State）"><a href="#线程状态（State）" class="headerlink" title="线程状态（State）"></a>线程状态（State）</h2><p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200710092846896.png"></p>
<h3 id="获取线程状态"><a href="#获取线程状态" class="headerlink" title="获取线程状态"></a>获取线程状态</h3><p>线程的状态对应的有5个：</p>
<table>
<thead>
<tr>
<th>线程状态</th>
<th>Java常量</th>
</tr>
</thead>
<tbody><tr>
<td>new</td>
<td><code>Thread.State.NEW</code></td>
</tr>
<tr>
<td>就绪</td>
<td><code>Thread.State.RUNNABLE</code></td>
</tr>
<tr>
<td>阻塞</td>
<td><code>Thread.State.BLOCKED</code></td>
</tr>
<tr>
<td>等待</td>
<td><code>Thread.State.TIMED_WAITING</code></td>
</tr>
<tr>
<td>死亡</td>
<td><code>Thread.State.TERMINATED</code></td>
</tr>
</tbody></table>
<p>可以利用<code>thread.getState()</code>来获得线程的状态，可以利用这个来循环判断线程是否停止，再执行相应的操作。</p>
<h3 id="线程状态应用"><a href="#线程状态应用" class="headerlink" title="线程状态应用"></a>线程状态应用</h3><ul>
<li><p>创建一个线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StateThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;thread-&gt;&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主方法运行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestState</span> &#123;</span><br><span class="line">    <span class="comment">//声明线程状态对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Thread.State state;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//新建线程对象</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">StateThread</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得线程状态对象</span></span><br><span class="line">        state=thread.getState();</span><br><span class="line">        System.out.println(state);<span class="comment">//NEW</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        thread.start();</span><br><span class="line">        <span class="comment">//获得新的线程状态对象（更新）</span></span><br><span class="line">        state=thread.getState();</span><br><span class="line">        <span class="comment">//判断目前的线程对象是否等于TERMINATED</span></span><br><span class="line">        <span class="keyword">while</span> (state!= Thread.State.TERMINATED)&#123;</span><br><span class="line">            <span class="comment">//获得新的线程状态对象（更新）</span></span><br><span class="line">            state=thread.getState();</span><br><span class="line">            System.out.println(state);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获得新的线程状态对象（更新）</span></span><br><span class="line">        state=thread.getState();</span><br><span class="line">        System.out.println(state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>可以看到，我用<code>new Thread()</code>创建了一个新的线程对象<code>thread</code>，然后通过<code>thread</code>对象的<code>getState()</code>方法得到了目前线程的状态并且赋给了<code>state</code>对象，同时再通过<code>state</code>与<code>Thread.State.TERMINATED</code>进行比对，如果线程状态不为TERMINATED则继续执行循环，这就是一个利用线程状态的例子。</p>
<h2 id="线程优先级（Priority）"><a href="#线程优先级（Priority）" class="headerlink" title="线程优先级（Priority）"></a>线程优先级（Priority）</h2><p>线程优先级就是CPU调度线程的优先级，优先级越高CPU就会优先调度，<strong>但是优先级越高就不代表它一定被先调度</strong>，只是提高权重，被CPU先调度的可能性更高</p>
<p>可以通过<code>Thread</code>线程对象的<code>getPriority()</code>方法获得当前线程的优先级的值（1~10）是整型，同时也可以通过<code>Thread</code>线程对象的<code>setPriority()</code>方法设置优先级，如果没有设置则默认为5，同时<code>Thread</code>类为给线程优先级初始了三个常量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 线程最小值</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MIN_PRIORITY</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 线程正常值</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">NORM_PRIORITY</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 线程最大值</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAX_PRIORITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>感受一下设置线程优先级：</p>
<ul>
<li><p>创建一个线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Priority</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//打印当前线程名以及线程优先级</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+Thread.currentThread().getPriority());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Thread.currentThread()</code>可以获得当前运行的线程对象；</p>
<p><code>Thread.currentThread().getName()</code>可以获得当前运行的线程对象的名字，需要在创建线程对象的时候给线程指定一个线程名（String）；</p>
<p><code>Thread.currentThread().getPriority()</code>可以获得当前运行的线程对象的优先级的值；</p>
</li>
<li><p>主方法里运行线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPriority</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Priority</span> <span class="variable">priority</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Priority</span>();</span><br><span class="line">        <span class="comment">//创建线程1对象，并且设置线程名为t1</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(priority,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        <span class="comment">//创建线程2对象，并且设置线程名为t2</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(priority,<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        <span class="comment">//创建线程2对象，并且设置线程名为t3</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(priority,<span class="string">&quot;t3&quot;</span>);</span><br><span class="line">        <span class="comment">//创建线程4对象，并且设置线程名为t4</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(priority,<span class="string">&quot;t4&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置线程优先级为最大值10</span></span><br><span class="line">        t1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">        <span class="comment">//设置线程优先级为5</span></span><br><span class="line">        t2.setPriority(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//设置线程优先级为最小值1</span></span><br><span class="line">        t3.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        t4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>观察运行结果</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200710154321611.png"></p>
</li>
</ul>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200710154333020.png"></p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200710154345716.png"></p>
<p>通过观察我们得出结论：线程优先级越高不代表它一定会被先运行，但是它被CPU调度的可能性更大。同时没有用<code>setPriority()</code>方法给线程指定初始值的话默认是5。</p>
<h2 id="守护线程（Daemon）"><a href="#守护线程（Daemon）" class="headerlink" title="守护线程（Daemon）"></a>守护线程（Daemon）</h2><p>线程分为<strong>用户线程</strong>和<strong>守护线程</strong></p>
<p>main线程和用户自定义的线程一般都是用户线程</p>
<p>虚拟机必须确保用户线程执行完毕</p>
<p>虚拟机不必等待守护线程执行完毕</p>
<p>守护线程可以用来后台记录操作日志，监控内容，垃圾回收等</p>
<p>用<code>Thread</code>线程对象的<code>setDaemon(true)</code>方法将线程设置为守护线程</p>
<ul>
<li><p>创建用户线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;People Alive &quot;</span>+i+<span class="string">&quot; Day&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;People Dead&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>循环<code>i</code>然后打印<code>人还活着</code>，直到<code>i</code>结束打印<code>人死了</code></p>
</li>
<li><p>创建守护线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">God</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;God Bless You&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>while</code>为真死循环打印<code>上帝保佑你</code></p>
</li>
<li><p>创建主方法入口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">God</span> <span class="variable">god</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">God</span>();</span><br><span class="line">        <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">People</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建God线程对象名叫threadGod</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadGod</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(god);</span><br><span class="line">        <span class="comment">//创建People线程对象名叫threadPeople</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadPeople</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(people);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将threadGod线程设置为守护线程</span></span><br><span class="line">        threadGod.setDaemon(<span class="literal">true</span>);<span class="comment">//true守护线程，false用户线程，线程默认都是false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        threadGod.start();</span><br><span class="line">        threadPeople.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过<code>threadGod</code>的<code>setDaemon()</code>方法将God线程设置为守护线程，People线程则就是默认的用户线程，观察结果我们可以发现，照理说<code>while(true)</code>循环应该永远进行下去，可是当people线程结束之后，god循环也随之结束了，所以我们就可以得出结论：虚拟机不必等待守护线程结束，虚拟机必须保证用户线程结束。就像上帝就像守护线程永远活着，人就像用户线程只会活一段时间。</p>
</li>
</ul>
<h2 id="线程同步（Synchronized）"><a href="#线程同步（Synchronized）" class="headerlink" title="线程同步（Synchronized）"></a>线程同步（Synchronized）</h2><h3 id="线程不安全举例"><a href="#线程不安全举例" class="headerlink" title="线程不安全举例"></a>线程不安全举例</h3><ul>
<li><h4 id="多个人同时买票"><a href="#多个人同时买票" class="headerlink" title="多个人同时买票"></a>多个人同时买票</h4><p>买票线程：</p>
<ol>
<li>其中ticketNumber是所有线程操作的公共资源</li>
<li>定义了一个标识flag使得while循环能够外部停止</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BuyTicket</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">//限定20张票</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> ticketNumber=<span class="number">20</span>;</span><br><span class="line">    <span class="comment">//定义一个标识使得循环能够结束</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+buyTicket());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 买票</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 买的是第几张票</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">buyTicket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ticketNumber&lt;=<span class="number">0</span>)&#123;<span class="comment">//无票</span></span><br><span class="line">            flag=<span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> ticketNumber;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;<span class="comment">//有票</span></span><br><span class="line">            <span class="keyword">return</span> ticketNumber--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主入口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBuyTicket</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BuyTicket</span> <span class="variable">buyTicket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BuyTicket</span>();</span><br><span class="line">        <span class="comment">//创建线程对象并且启动线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket,<span class="string">&quot;你&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket,<span class="string">&quot;我&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket,<span class="string">&quot;黄牛&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712130741722.png"></p>
<p>可以看到”我“和”黄牛“买到了同一张第20票，这是不安全的。</p>
</li>
<li><h4 id="银行取钱"><a href="#银行取钱" class="headerlink" title="银行取钱"></a>银行取钱</h4><p>账户（Account）类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//账户类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span>&#123;</span><br><span class="line">    <span class="comment">//账户余额</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(<span class="type">int</span> balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance=balance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>取钱线程：</p>
<ol>
<li>定义了amount为取的金额</li>
<li>取了钱后accont类对象的balance就减去amount</li>
<li>分别打印出取钱前后的账户金额</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取钱线程</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Withdraw</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">//取出的金额</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> amount;</span><br><span class="line">    <span class="comment">//账户对象</span></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Withdraw</span><span class="params">(<span class="type">int</span> amount,Account account)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.amount=amount;</span><br><span class="line">        <span class="built_in">this</span>.account=account;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (account.balance&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;账户没钱了&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            before();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;取了&quot;</span> + amount);</span><br><span class="line">            account.balance-=amount;</span><br><span class="line">            after();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打印取钱之前的账户余额</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;取前账户余额：&quot;</span>+account.balance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打印取钱之后的账户余额</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;取后账户余额：&quot;</span>+account.balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主入口：</p>
<ol>
<li>给两个线程分别赋线程名为”女“和”男“</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBank</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建账户类对象，余额有500</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="number">500</span>);</span><br><span class="line">        <span class="comment">//创建取钱线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Withdraw</span>(<span class="number">500</span>,account),<span class="string">&quot;女&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Withdraw</span>(<span class="number">100</span>,account),<span class="string">&quot;男&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p>第一次运行：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712132616245.png"></p>
<p>第二次运行：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712132634432.png"></p>
<p>观察运行结果我们可以发现，有时只有女的可以取钱，但是有时男女同时可以取，并且账户余额还变成了负的，他们一共取了100+500&#x3D;600元，这也是不安全的。</p>
</li>
<li><h4 id="List集合"><a href="#List集合" class="headerlink" title="List集合"></a>List集合</h4><ol>
<li>定义了1000个线程（线程体是用lambda表达式定义的）</li>
<li>将1000个线程名添加到List集合里</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt; arrayList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                arrayList.add(Thread.currentThread().getName());</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;集合长度=&quot;</span>+arrayList.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712133334003.png"></p>
<p>观察运行结果我们可以发现，集合长度只有563没有1000，照理说全部线程名加入List集合中的话List的长度应该有1000的，说明线程会覆盖掉其他线程。</p>
</li>
</ul>
<h3 id="synchronized关键字定义同步锁"><a href="#synchronized关键字定义同步锁" class="headerlink" title="synchronized关键字定义同步锁"></a>synchronized关键字定义同步锁</h3><ul>
<li><p>多人买票的同步锁</p>
<p>以刚刚的例子为例，如果没有定义同步锁，线程去操作ticketNumber（买票）是混乱的，是杂乱的，极有可能导致ticketNumber冲突，所以就需要定义一个锁。<code>synchronized</code>同步锁就好像是一个仓库的钥匙，假如有很多人需要去这个仓库拿东西，但是先进去的人就把门锁上了，后面的人就进不来了，里面的人操作完后出来就会把锁释放，然后有人拿到这个锁就可以进去仓库操作了，然后循环，就不会像之前没有定义同步锁一样所有人都能进仓库操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBuyTicket</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BuyTicket</span> <span class="variable">buyTicket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BuyTicket</span>();</span><br><span class="line">        <span class="comment">//创建线程对象并且启动线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket,<span class="string">&quot;你&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket,<span class="string">&quot;我&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(buyTicket,<span class="string">&quot;黄牛&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BuyTicket</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">//限定20张票</span></span><br><span class="line">    <span class="keyword">private</span> Integer ticketNumber=<span class="number">20</span>;</span><br><span class="line">    <span class="comment">//定义一个标识使得循环能够结束</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">            buyTicket();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//买票，并且给buyTicket方法加上同步锁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">buyTicket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ticketNumber&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            flag=<span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+ticketNumber--);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只需要给<code>buyTicket0</code>方法加上同步锁就可以了</p>
<p>运行结果：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712153437454.png"></p>
<p>不会和别人拿票冲突，并且也不会有拿到第0张票的时候</p>
</li>
<li><p>银行取钱同步锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//取钱线程</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Withdraw</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">//取出的金额</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> amount;</span><br><span class="line">    <span class="comment">//账户对象</span></span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line">    <span class="comment">//定义标识</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Withdraw</span><span class="params">(<span class="type">int</span> amount,Account account)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.amount=amount;</span><br><span class="line">        <span class="built_in">this</span>.account=account;</span><br><span class="line">        <span class="built_in">this</span>.flag=<span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">            getMoney();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//取钱</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMoney</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//给account对象加上同步锁</span></span><br><span class="line">        <span class="keyword">synchronized</span> (account)&#123;</span><br><span class="line">            <span class="keyword">if</span> (account.balance&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                flag=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;---------------&quot;</span>);</span><br><span class="line">            before();</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;取了&quot;</span>+amount);</span><br><span class="line">            account.balance-=amount;</span><br><span class="line">            after();</span><br><span class="line">            System.out.println(<span class="string">&quot;---------------&quot;</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打印取钱之前的账户余额</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;取前账户余额：&quot;</span>+account.balance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打印取钱之后的账户余额</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;取后账户余额：&quot;</span>+account.balance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只需要给<code>account</code>对象加上同步锁，然后在同步锁里执行代码块就行了</p>
<p>运行结果：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712153642880.png"></p>
<p>取钱再也不会出现余额变成负数的情况了。因为”男“或者”女“分别取钱的时候另外一个线程是不能对<code>account</code>对象进行操作的，只有等其中一个操作完另外一个线程才能进行操作。 </p>
</li>
<li><p><code>CopyOnWriteArrayList</code>安全的集合</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//用CopyOnWriteArrayList定义安全的集合</span></span><br><span class="line">        CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;String&gt;();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">                list.add(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里用了<code>Thread.sleep()</code>才能打印出集合的大小是因为在主线程里线程跟主线程是一起在运行的，如果不加线程休眠的话就可能会导致自定义线程还没有跑完但是主线程里已经打印出大小了。</p>
</li>
</ul>
<h2 id="Lock锁和Synchronized锁"><a href="#Lock锁和Synchronized锁" class="headerlink" title="Lock锁和Synchronized锁"></a>Lock锁和Synchronized锁</h2><p>lock锁是显式锁，需要显示加锁，显式解锁，而synchronized是隐式锁；</p>
<p>lock只能给代码块加锁，而synchonized能给代码和方法都加上锁；</p>
<p>加了锁能够解决安全和资源冲突问题，但是会降低线程性能，所以不是一定都要加锁。</p>
<p>lock锁的定义方式是先定义一个<code>ReentrantLock</code>对象</p>
<ul>
<li><p>不加锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//新建线程lock对象</span></span><br><span class="line">        <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lock</span>();</span><br><span class="line">        <span class="comment">//新建线程并启动</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(lock,<span class="string">&quot;你&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(lock,<span class="string">&quot;我&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(lock,<span class="string">&quot;他&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> ticketNumber=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">            buyTicket();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyTicket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ticketNumber&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            flag=<span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+ticketNumber--);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712163619370.png"></p>
<p>会出现买到0甚至-1票的情况</p>
</li>
<li><p>加锁</p>
<p>先定义一个私有的<code>ReentrantLock</code>对象取名叫lock，再在需要上锁的代码块前加上<code>lock.lock()</code>方法加锁，再在需要释放锁的地方加上<code>lock.unlock()</code>释放锁，注意需要用<code>try</code>代码块包起来，将<code>lock.lock()</code>放在try里，将<code>lock.unlock()</code>放在finally里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestLock</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//新建线程lock对象</span></span><br><span class="line">        <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lock</span>();</span><br><span class="line">        <span class="comment">//新建线程并启动</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(lock,<span class="string">&quot;你&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(lock,<span class="string">&quot;我&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(lock,<span class="string">&quot;他&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Lock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> ticketNumber=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> ReentrantLock lock=<span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">            buyTicket();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyTicket</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (ticketNumber&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                flag=<span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;-&gt;&quot;</span>+ticketNumber--);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/image-20200712164412113.png"></p>
<p>没有人拿到第0甚至第-1张票，结果是符合我们的预期的。</p>
</li>
</ul>
<h2 id="生产者——消费者问题（线程通信）"><a href="#生产者——消费者问题（线程通信）" class="headerlink" title="生产者——消费者问题（线程通信）"></a>生产者——消费者问题（线程通信）</h2><p>假如说有两个线程一个是生产者（producer）另一个是消费者（customer）。</p>
<p>生产者：没有生产东西前，需要通知消费者等待，生产后通知消费者消费。</p>
<p>消费者：在没有东西消费前，需要通知生产者生产，消费后通知生产者生产。</p>
<p>Java提供了几个方法供线程通信</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>wait()</td>
<td>表示线程会一直等待，直到其他线程通知，跟sleep()不同，wait会释放锁。</td>
</tr>
<tr>
<td>wait(long timeout)</td>
<td>指定等待的毫秒数</td>
</tr>
<tr>
<td>notify()</td>
<td>通知（唤醒）一个等待的线程</td>
</tr>
<tr>
<td>notifyAll()</td>
<td>通知（唤醒）同一个对象上所有调用wait方法的线程，优先级高的线程先被调度</td>
</tr>
</tbody></table>
<p>以上方法均是<code>Object</code>类的方法，但只能在同步块或者同步方法中使用，否则会抛出异常。</p>
<h3 id="解放方式1：管程法"><a href="#解放方式1：管程法" class="headerlink" title="解放方式1：管程法"></a>解放方式1：管程法</h3><p>管程法适用于<code>类似消费者去饭店吃炸鸡，生产者可以在消费者消费的时候生产</code>的问题</p>
<ul>
<li>生产者：生产资源</li>
<li>消费者：消费资源</li>
<li>缓冲区：存放资源</li>
</ul>
<p>生产者将生产的资源放入缓冲区，消费者从缓冲区取走资源。如果缓冲区满了生产者就停止生产（等待）；如果缓冲区为0则消费者停止消费（等待）。</p>
<ol>
<li><p>生产的产品：</p>
<p>存放产品的编号</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生产的产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>&#123;</span><br><span class="line">    <span class="comment">//产品编号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>缓冲区：</p>
<p>看作有大小限制的存放资源的仓库，在缓冲区里定义存入资源和取出资源的方法（<strong>记得加上同步锁</strong>），在这两个方法里先做一个是否满或者是否为空的判断，如果为空或者为满则<code>wait()</code>等待，否则消费或者生产了产品后记得用<code>notify()</code>通知另一个线程消费或者生产。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//缓冲区：存放产品的仓库</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Buffer</span>&#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义数组大小（缓冲区）</span></span><br><span class="line">    Product[] products=<span class="keyword">new</span> <span class="title class_">Product</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="comment">//定义产品的数量</span></span><br><span class="line">    <span class="type">int</span> number=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//生产者生产产品，往仓库中放入产品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(Product product)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (number==products.length)&#123;<span class="comment">//仓库满了</span></span><br><span class="line">            <span class="comment">//生产等待，等待消费者消费</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将生产出来的产品放到数组里</span></span><br><span class="line">        products[number]=product;</span><br><span class="line">        <span class="comment">//数量加一</span></span><br><span class="line">        number++;</span><br><span class="line">        <span class="comment">//通知消费者消费</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;生产了第&quot;</span>+product.getId()+<span class="string">&quot;产品&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//消费者消费产品，从仓库中取出产品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Product <span class="title function_">pull</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (number==<span class="number">0</span>)&#123;<span class="comment">//仓库没有产品</span></span><br><span class="line">            <span class="comment">//消费等待，等待生产者生产</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//数量减一</span></span><br><span class="line">        number--;</span><br><span class="line">        <span class="comment">//将仓库的第number个赋给产品准备返回</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> products[number];</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;消费了第&quot;</span>+product.getId()+<span class="string">&quot;产品&quot;</span>);</span><br><span class="line">        <span class="comment">//通知生产者生产</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        <span class="keyword">return</span> product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>生产者线程</p>
<p>因为在生产者线程里需要对缓冲区进行操作，所以需要提前定义缓冲区，生产产品就是new一个产品对象，并且将编号赋给它，同时丢入缓冲区，以供消费者直接从缓冲区中直接取出产品。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生产者：生产产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">//定义缓冲区对象，因为生产者需要操作缓冲区</span></span><br><span class="line">    <span class="keyword">private</span> Buffer buffer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.buffer = buffer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//i等于0的时候实际上是生产的第1件产品</span></span><br><span class="line">            produce(i+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生产</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="comment">//生产产品</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>(i);</span><br><span class="line">        <span class="comment">//将生产的产品存入缓冲区</span></span><br><span class="line">        buffer.push(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>消费者线程</p>
<p>因为消费者线程里也需要对缓冲区进行操作，所以需要提前定义缓冲区，消费产品就是从缓冲区取一个产品。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消费者：消费商品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">//定义缓冲区对象，因为消费者要操作缓冲区</span></span><br><span class="line">    <span class="keyword">private</span> Buffer buffer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.buffer = buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (consum()&gt;=<span class="number">50</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消费</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">consum</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//从缓冲区从取出产品</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> buffer.pull();</span><br><span class="line">        <span class="keyword">return</span> product.getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>主入口</p>
<p>需要先定义缓冲区，然后将缓冲区丢给生产者消费者线程，然后分别启动两个线程就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPC1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//新建缓冲区</span></span><br><span class="line">        <span class="type">Buffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Buffer</span>();</span><br><span class="line">        <span class="comment">//生产者线程</span></span><br><span class="line">        <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(buffer);</span><br><span class="line">        <span class="comment">//消费者线程</span></span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(buffer);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//启动生产者线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(producer,<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        <span class="comment">//启动消费者线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer,<span class="string">&quot;消费者&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>管程法总结</strong>：</p>
<ol>
<li>定义产品类</li>
<li>定义缓冲区，缓冲区里应该有缓冲区的大小（对象数组），有向缓冲区存入和从缓冲区取出的两个方法。</li>
<li>生产者<strong>向缓冲区存入</strong>的方法里面应该有对产品数量的判断，如果缓冲区的数量满了，线程就应该调用<code>wait()</code>方法进行等待，否则就生产新的产品，产品应该是从该方法的形参中来（其中应该是先将对象赋给数组，然后计数再自加），然后<code>notify()</code>通知消费者。</li>
<li>消费者<strong>从缓冲区取出</strong>的方法里也应该有对产品数量的判断，如果缓冲区的数量为0，则线程就调用<code>wait()</code>方法进行等待，否则消费产品（计数先自减，然后再将产品作为返回值），然后<code>notify()</code>通知生产者。</li>
<li>生产者线程也需要声明缓冲区类对象，因为后续需要对缓冲区进行操作，生产者生产是直接new一个产品，然后将产品存入到缓冲区中</li>
<li>消费者线程也需要声明缓冲区类对象，因为后续需要对缓冲区进行操作，消费者消费实际就是从缓冲区获取一个产品对象。</li>
<li>最后主入口里记得把缓冲区对象分别赋给生产者消费者线程。</li>
</ol>
</li>
</ol>
<h3 id="解决方式2：信号灯法"><a href="#解决方式2：信号灯法" class="headerlink" title="解决方式2：信号灯法"></a>解决方式2：信号灯法</h3><p>信号灯法就是手动设置一个标识位来限制生产者或者消费者对资源的访问。信号灯法适用于<code>类似两个孩子玩同一个玩具，生产者消费者必须操作同一个资源，生产者生产时消费者必须等待</code>的问题</p>
<ul>
<li><p>产品类，需要定义标志位，生产和消费两个方法</p>
<p>设置一个标识位默认为false，因为flag为false，所以消费者<code>wait()</code>等待，否则消费者消费，消费者消费完了之后<code>notify()</code>通知生产者生产，同时标识位取反。</p>
<p>同理，当flag为true的时候，生产者<code>wait()</code>等待，否则生产者生产，生产者生产完了<code>notify()</code>通知消费者消费，标识位取反。</p>
<p>逻辑就是当flag标识位为true的时候，生产者是<code>wait()</code>等待状态，消费者不是<code>wait()</code>状态，消费者正在消费，消费者消费完了之后<code>notify()</code>通知生产者生产，标识位反制。</p>
<p>总的来说就是生产者在操作资源的时候消费者不能操作，消费者操作资源的时候生产者不能操作资源，怎么判断生产者或者消费者有没有操作资源呢？就是靠标识位。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//产品</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Product</span>&#123;</span><br><span class="line">    <span class="comment">//产品名字</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      标识位：</span></span><br><span class="line"><span class="comment">            T：消费者消费，生产者等待</span></span><br><span class="line"><span class="comment">            F：生产者生产，消费者等待</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> flag=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消费</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">consum</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//为F，消费者等待</span></span><br><span class="line">        <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;正在消费&quot;</span>+getName());</span><br><span class="line">        <span class="comment">//通知生产者生产</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        <span class="comment">//改变标志位</span></span><br><span class="line">        flag=!flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生产</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//为T，生产者等待</span></span><br><span class="line">        <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;正在生产&quot;</span>+getName());</span><br><span class="line">        <span class="comment">//通知消费者消费</span></span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">        <span class="comment">//改变标志位</span></span><br><span class="line">        flag=!flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>生产者线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生产者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                product.setName(<span class="string">&quot;产品1&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                product.setName(<span class="string">&quot;产品2&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//生产产品</span></span><br><span class="line">            product.produce();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>消费者线程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.product = product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="comment">//消费产品</span></span><br><span class="line">            product.consum();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>主入口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPC2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        <span class="comment">//启动两个线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Producer</span>(product),<span class="string">&quot;生产者&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(product),<span class="string">&quot;消费者&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>信号灯法总结：</p>
<ol>
<li>定义中间<strong>产品</strong>，需要在产品里定义标识位属性以及生产和消费方法</li>
<li>定义<strong>消费方法</strong>，如果标识位为真则用<code>wait()</code>等待，否则消费然后<code>notify()</code>通知，最后标识位取反</li>
<li>定义<strong>生产方法</strong>，如果标识位为假则用<code>wait()</code>等待，否则生产然后<code>notify()</code>通知，最后标志位取反</li>
<li>在消费者或者生产者线程里只需要用循环生产或者消费就行了。</li>
</ol>
</li>
</ul>
<h3 id="同步锁（Synchronized）总结"><a href="#同步锁（Synchronized）总结" class="headerlink" title="同步锁（Synchronized）总结"></a>同步锁（Synchronized）总结</h3><p>锁就有点像事务，线程拿到锁之后就保存该线程先把这个资源用于自己的操作先做完再把锁释放。</p>
<p>有两种锁，<strong>synchronized</strong>和<strong>lock</strong>锁，第一个可以锁方法和代码块，而第二个只可以锁代码块。</p>
<h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><p>线程池就是可以限定最大同时运行线程的个数</p>
<p>线程池的使用方法：</p>
<ol>
<li>创建线程池服务，并且指定线程池大小</li>
<li>将线程放入线程池服务中</li>
<li>关闭线程池服务</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestPool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//1、创建线程池服务，指定线程池大小，参数是线程池大小</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//2、将线程放入线程池服务中</span></span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread1</span>());</span><br><span class="line">        service.execute(<span class="keyword">new</span> <span class="title class_">MyThread2</span>());</span><br><span class="line">        <span class="comment">//3、关闭线程池服务（切记）</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/" data-id="clsblyuf0002aw0k6cwg97y97" data-title="Java多线程" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/SpringCloud入门/SpringCloud" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/">SpringCloud实际上手</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>首先需要明白SpringCloud就是微服务的思想，将以前的大型项目拆分成很多个模块，模块之间耦合度小甚至没有，每个模块更专注于自己的事情。他们之间利用http进行通信。通过eureka注册中心来将所有的微服务模块连接起来。最简单的可以理解成SpringCloud能够将多个SpringBoot项目很好地协调起来。</p>
<h2 id="1、创建SpringCloud父工程"><a href="#1、创建SpringCloud父工程" class="headerlink" title="1、创建SpringCloud父工程"></a>1、创建SpringCloud父工程</h2><p>利用空Maven项目创建。删除掉src，留下pom.xml用于导入整个项目父工程的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.wqk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span><span class="comment">&lt;!--该父工程的公司组织--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springcloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span><span class="comment">&lt;!--该父工程的项目名--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span><span class="comment">&lt;!--该父工程的版本号--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span><span class="comment">&lt;!--子项目--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>springcloud-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>springcloud-provider-8001<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>springcloud-consumer-80<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>springcloud-eureka-7001<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>springcloud-eureka-7002<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>springcloud-eureka-7003<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--项目打包方式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--依赖版本号集中管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.20<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.22<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">lombok.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--父项目依赖管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--SpringCloud的依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--SpringBoot的依赖--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--MySQL连接驱动--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--SpringBoot-mybatis启动器--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--druid数据源--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--junit单元测试--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;lombok.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是&lt;modules&gt;里该SpringCloud项目的所有子项目，注意项目打包方式采用pom，&lt;properties&gt;属性值，可以用于依赖版本号的集中管理，下面在&lt;dependency&gt;需要引入的version里直接使用${XXX.version}即可使用，注意父项目里面采用的是&lt;dependencyManagement&gt;依赖管理的方式进行导入，而不是直接导入，这里就相当于父类，在子项目里是可以直接继承的。注意两个最主要的依赖springcloud和springboot。&lt;type&gt;是pom，&lt;scope&gt;是import，然后下面就是可能在项目里需要的依赖先预先导入，后面在需要子项目里直接继承就可以了，不用写版本号，这样做是为了保证依赖版本号一致。</p>
<h2 id="2、创建子项目api"><a href="#2、创建子项目api" class="headerlink" title="2、创建子项目api"></a>2、创建子项目api</h2><p>在父工程里创建module，依旧是利用空maven项目创建，取名就叫springcloud-api，注意项目名称，公司组织代码要一致。api里我们只提供pojo实体类，所以就只需要引入lombok依赖，因为我们在父工程里已经指定版本号了，这里就不需要引入版本号了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后创建pojo包<img src="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/image-20200727213618657.png"></p>
<p>在包里创建User类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span><span class="comment">//链式写法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String dbSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>记得额外加上lombok的<code>@Accessors(chain = true)</code>：开启链式写法的注解</p>
<p>至此，api子项目完成！</p>
<h2 id="3、创建子项目provider提供者"><a href="#3、创建子项目provider提供者" class="headerlink" title="3、创建子项目provider提供者"></a>3、创建子项目provider提供者</h2><p>提供者就是生产者，这里是提供Mapper增删改查</p>
<p>创建module，依旧是利用空maven项目创建，取名springcloud-provider-8001（端口号），然后在pom中引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.wqk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span><span class="comment">&lt;!--引入api module--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springcloud-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入父工程里的mysql驱动--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入父工程的mybatis-starter--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入父工程的druid数据源--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入父工程的springboot-web-starter--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里需要切记的是，一定需要引入刚刚创建好的api依赖，因为我们需要用到api项目里的pojo类。因为这个provider里面需要对数据库进行增删改查，所以需要引入mysql驱动，mybatis以及springboot-web-starter的依赖，因为我们在父工程里已经引入初引入版本号了的，所以子项目里就不需要引入版本号了。因为需要增删改查，并且暴露给外部进行访问，所以我们需要mapper、service以及controller<img src="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/image-20200727214424806.png"></p>
<p>UserMapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户集合对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAllUser</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户编号删除用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功删除的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span><span class="type">int</span> userId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以及UserMapper.xml:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.wqk.springcloud.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;userId&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO user</span><br><span class="line">        (username,db_source)</span><br><span class="line">        VALUES</span><br><span class="line">        (#&#123;username&#125;,DATABASE())</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot; username!=null and username!=&#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">                username=#&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        WHERE</span><br><span class="line">            user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;integer&quot;</span>&gt;</span></span><br><span class="line">        DELETE</span><br><span class="line">        FROM</span><br><span class="line">            user</span><br><span class="line">        WHERE</span><br><span class="line">            user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            *</span><br><span class="line">        FROM</span><br><span class="line">            user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;dbSource&quot;</span> <span class="attr">column</span>=<span class="string">&quot;db_source&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时还需要配置application.yaml文件：</p>
<p>配置端口号、配置Mybatis、手动设置该模块暴露给外部的名称以及数据源的配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该模块的端口号</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#mybatis配置</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*Mapper.xml</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">cn.wqk.springcloud.pojo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#该模块的暴露给外部的名字</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springcloud-provider</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数据源</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/cloud?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure>

<p>service层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户集合对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAllUser</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户编号删除用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功删除的行数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> userId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增加用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">selectAllUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectAllUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.deleteUser(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        userMapper.insertUser(user);</span><br><span class="line">        <span class="keyword">return</span> user.getUserId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/allUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">allUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.selectAllUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        userService.insertUser(user);</span><br><span class="line">        <span class="keyword">return</span> user.getUserId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.updateUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/deleteUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="type">int</span> userId)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.deleteUser(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意需要使用RESTFUL风格。</p>
<p>加上SpringBoot的主启动类：</p>
<p>provider_8001.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">provider_8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(provider_8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后去浏览器请求地址测试</p>
<h2 id="4、创建子项目consumer消费者"><a href="#4、创建子项目consumer消费者" class="headerlink" title="4、创建子项目consumer消费者"></a>4、创建子项目consumer消费者</h2><p>依旧是创建空maven项目，module名叫springcloud-consumer-80，引入以下依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入api--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.wqk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springcloud-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入web--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>依旧是需要引入api，和web依赖</p>
<p><img src="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/image-20200727220017469.png"></p>
<p>因为我们需要获得bean：RestTemplate，所以我们需要在Spring容器中用JavaConfig来获得bean</p>
<p>BeanConfig.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="comment">//Spring配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">getRestTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们就可以在需要的地方直接用RestTemplate了</p>
<p>UserController.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/consumer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String URL=<span class="string">&quot;http://localhost:8001&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/allUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">allUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(URL+<span class="string">&quot;/user/allUser&quot;</span>,List.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/addUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(URL+<span class="string">&quot;/user/addUser&quot;</span>,user,Integer.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(URL+<span class="string">&quot;/user/updateUser&quot;</span>,user,Integer.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/deleteUser/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> <span class="type">int</span> userId)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.postForObject(URL+<span class="string">&quot;/user/deleteUser&quot;</span>,userId,Integer.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先注入RestTemplate，然后这个静态常量URL就是提供者的URL，然后利用restTemplate的getForObject或者postForObject方法传递参数，拼接URL，请求的参数（对象），返回值的数据类型，比如<code>(URL+&quot;/user/addUser&quot;,user,Integer.class)</code>中，<code>URL+&quot;/user/addUser&quot;</code>是请求的地址，<code>user</code>是请求的参数对象，<code>Integer.class</code>是返回值的数据类型。</p>
<p>配置application.yaml：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>依旧是创建SpringBoot启动类consumer_80.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">consumer_80</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(consumer_80.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后允许启动类测试以下，记得先启动生产者再启动消费者。</p>
<p>至此，SpringCloud的api、生产者、消费者部署完毕，接下来就是需要部署eureka注册中心</p>
<h1 id="关于Eureka"><a href="#关于Eureka" class="headerlink" title="关于Eureka"></a>关于Eureka</h1><p>关于Eureka我相信百度上的肯定比我讲得好的有太多，比如这篇文章就讲得挺好：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qwe86314/article/details/94552801">https://blog.csdn.net/qwe86314/article/details/94552801</a></p>
<p>所以我就讲讲我的理解：</p>
<p><img src="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/20190703102014756.png"></p>
<p>Eureka是Netflix开发的服务发现框架，本身是一个基于REST的服务，主要用于定位运行在AWS域中的中间层服务，以达到负载均衡和中间层服务故障转移的目的。SpringCloud将它集成在其子项目spring-cloud-netflix中，以实现SpringCloud的服务发现功能。</p>
<p>Eureka包含两个组件：Eureka Server和Eureka Client。</p>
<h2 id="1、创建Eureka-Server"><a href="#1、创建Eureka-Server" class="headerlink" title="1、创建Eureka Server"></a>1、创建Eureka Server</h2><p>创建module，依旧是空Maven项目，名字叫springcloud-eureka-7001，pom中需要引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入eureka服务端--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>引入eureka服务端的依赖，依旧不需要版本号，因为父工程里的Springcloud依赖中有。</p>
<p>需要配置application.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7001</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#配置eureka</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">localhost</span>             <span class="comment">#eureka注册中心服务器的实例名称</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span>     <span class="comment">#是否向eureka注册中心注册增自己（自己本身就是注册中心）</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>           <span class="comment">#true表示自己不是注册中心，false表示自己是注册中心</span></span><br><span class="line">    <span class="attr">service-url:</span>                    <span class="comment">#eureka注册中心服务端地址</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:7001/eureka/</span></span><br></pre></td></tr></table></figure>

<p>需要一个SpringBoot启动类eureka_7001.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaServer</span>         <span class="comment">//运行开启eureka注册中心服务端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">eureka_7001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(eureka_7001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要开启<code>@EnableEurekaServer</code>注解表示这个项目是eureka注册中心的服务端</p>
<p>启动后在浏览器输入<code>localhost:7001</code>测试就能看到eureka页面了，但是并没有Application：</p>
<p><img src="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/image-20200727224044957.png"></p>
<h2 id="2、Eureka-Client客户端"><a href="#2、Eureka-Client客户端" class="headerlink" title="2、Eureka Client客户端"></a>2、Eureka Client客户端</h2><p>直接在刚刚创建的springcloud-provider-8001生产者这个项目中添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--引入eureka的客户端依赖--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span><span class="comment">&lt;!--去掉默认返回xml格式--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>记得排除掉<code>jackson-dataformat-xml</code>这个依赖，不然JSON格式会被自动转为XML格式</p>
<p>然后在application里配置（向eureka注册中心注册）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Eureka配置</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">instance-id:</span> <span class="string">springcloud-provider-8001</span>          <span class="comment">#该模块的描述</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">localhost:7001/eureka/</span>    <span class="comment"># 该模块向eureka服务端注册</span></span><br></pre></td></tr></table></figure>

<p>然后在启动类里加上<code>@EnableEurekaClient</code>注解表明这是一个eureka的客户端</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span>         <span class="comment">//允许开启Eureka客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">provider_8001</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(provider_8001.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先启动eureka注册中心（服务端），再启动eureka客户端，访问<code>localhost:7001</code>就可以看到服务已经注册了</p>
<p><img src="/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/image-20200727225658474.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Java/SpringCloud%E5%85%A5%E9%97%A8/SpringCloud/" data-id="clsblyuf0002bw0k6h2nbel8o" data-title="SpringCloud实际上手" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Redis/Stream 消息队列/stream" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Redis/Stream%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/stream/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Redis/Stream%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/stream/">Redis Stream</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是Stream"><a href="#什么是Stream" class="headerlink" title="什么是Stream"></a>什么是Stream</h2><p>Stream是Redis 5.0版本新增加的数据结构，主要用于消息队列（MQ，Message Queue）。</p>
<p>其实Redis本身有一个<strong>发布订阅（publish&#x2F;subscribe）</strong>来实现消息队列的功能，但是有一个缺点就是<strong>消息无法持久化</strong>，如出现网络断开或者Redis宕机，那么消息则会被丢弃。总结就是<strong>发布订阅</strong>可以分发消息，但是<strong>无法记录历史消息</strong>。</p>
<p>而Stream则提供了<strong>消息的持久化</strong>和<strong>主备复制</strong>的功能，可以让任何客户端访问任何时刻的数据，并且还能记住每一个客户端的访问位置，保证消息不丢失。</p>
<h2 id="Stream的结构"><a href="#Stream的结构" class="headerlink" title="Stream的结构"></a>Stream的结构</h2><p>它有一个消息链表，将所有加入的消息都串起来，每个消息都有唯一的 ID和对应内容：</p>
<p><img src="/2023/07/19/back-end/Redis/Stream%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/stream/image-20220719171212738.png"></p>
<p>每个Stream（MQ）都有唯一的名称，对应Redis中的key，你甚至可以利用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keys *</span><br></pre></td></tr></table></figure>

<p>列出它们。</p>
<ul>
<li><strong>Consumer Group</strong>（消费组）：消费message的组，一个消费组可以有0到n个消费者（Consumer）</li>
<li><strong>last_delivered_id</strong>（游标）：每个消费组都会有个游标，任意一个消费者<strong>读取了消息</strong>都会使得游标向前移动。</li>
<li><strong>pending_ids</strong>（消费者未确认的消息的id）：记录当前已经被客户端读取的消息，但是还没有被<strong>ack</strong>(Acknowledge character：确认字符）的消息的id</li>
</ul>
<h2 id="消息（message）相关命令"><a href="#消息（message）相关命令" class="headerlink" title="消息（message）相关命令"></a>消息（message）相关命令</h2><h3 id="Xadd-添加消息到末尾"><a href="#Xadd-添加消息到末尾" class="headerlink" title="Xadd 添加消息到末尾"></a>Xadd 添加消息到末尾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xadd key ID field value [field value ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>key：队列名称，如果不存在则创建队列</li>
<li>ID：消息id，推荐使用<code>*</code>，表示由redis自动生成，如果自定义请确保递增性。</li>
<li>field value：记录，key-value键值对的方式存储</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xadd test_queue * name xiaoming age 18</span><br><span class="line"><span class="string">&quot;1658053697953-0&quot;</span> <span class="comment"># 返回由redis自动生成的消息ID</span></span><br></pre></td></tr></table></figure>



<h3 id="Xdel-删除消息"><a href="#Xdel-删除消息" class="headerlink" title="Xdel 删除消息"></a>Xdel 删除消息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xdel key ID [ID ...]</span><br></pre></td></tr></table></figure>

<p>根据ID删除一个或者多个消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xdel test_queue 1658053697953-0</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>



<h3 id="Xlen-获取stream包含的消息数量"><a href="#Xlen-获取stream包含的消息数量" class="headerlink" title="Xlen 获取stream包含的消息数量"></a>Xlen 获取stream包含的消息数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xlen key</span><br></pre></td></tr></table></figure>

<p>返回队列的消息个数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xlen test_queue</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; Xadd test_queue * name xiaoming age 18</span><br><span class="line"><span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; Xlen test_queue</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>



<h3 id="Xrange-列出消息列表（不包括已经删除的消息）"><a href="#Xrange-列出消息列表（不包括已经删除的消息）" class="headerlink" title="Xrange 列出消息列表（不包括已经删除的消息）"></a>Xrange 列出消息列表（不包括已经删除的消息）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xrange key start end [COUNT count]</span><br></pre></td></tr></table></figure>

<ul>
<li>start：开始值，<code>-</code>表示最小值</li>
<li>end：结束值，<code>+</code>表示最大值</li>
<li>count：数量，默认是列出所有</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xrange test_queue - +</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">      2) <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">      3) <span class="string">&quot;age&quot;</span></span><br><span class="line">      4) <span class="string">&quot;18&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; Xadd test_queue * name xiaoming2 age 20</span><br><span class="line"><span class="string">&quot;1658054319414-0&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; Xrange test_queue - +</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">      2) <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">      3) <span class="string">&quot;age&quot;</span></span><br><span class="line">      4) <span class="string">&quot;18&quot;</span></span><br><span class="line">2) 1) <span class="string">&quot;1658054319414-0&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">      2) <span class="string">&quot;xiaoming2&quot;</span></span><br><span class="line">      3) <span class="string">&quot;age&quot;</span></span><br><span class="line">      4) <span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="Xrevrange-反向迭代消息列表"><a href="#Xrevrange-反向迭代消息列表" class="headerlink" title="Xrevrange 反向迭代消息列表"></a>Xrevrange 反向迭代消息列表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xrevrange key end start [COUNT count]</span><br></pre></td></tr></table></figure>



<h3 id="Xread-以阻塞或非阻塞的方式读取消息"><a href="#Xread-以阻塞或非阻塞的方式读取消息" class="headerlink" title="Xread 以阻塞或非阻塞的方式读取消息"></a>Xread 以阻塞或非阻塞的方式读取消息</h3><p><strong>不使用消费组</strong>，直接进行消息的读取</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] <span class="built_in">id</span> [<span class="built_in">id</span> ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>milliseconds（可选参数）：阻塞毫秒数，默认是非阻塞模式</li>
<li>id：可以指定确切的消息id，也可以使用<code>0-0</code>表示用首部开始读</li>
</ul>
<blockquote>
<p>Tips</p>
<p><code>STREAMS</code>表示可以同时读取多个队列中的消息</p>
</blockquote>
<h2 id="消费组（Xgroup）常用命令"><a href="#消费组（Xgroup）常用命令" class="headerlink" title="消费组（Xgroup）常用命令"></a>消费组（Xgroup）常用命令</h2><h3 id="Xgroup-create-创建消费组"><a href="#Xgroup-create-创建消费组" class="headerlink" title="Xgroup create 创建消费组"></a>Xgroup create 创建消费组</h3><p>为队列创建一个从<strong>某位置</strong>开始读取的消费组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP [CREATE key groupname id-or-$] [MKSTREAM]</span><br></pre></td></tr></table></figure>

<ul>
<li>key：队列名称</li>
<li>groupname：消费组名</li>
<li>id-or-$：id表示从确切的地方开始消费，$从尾部开始开始消费（即，只接受新消息）</li>
<li>MKSTREAM：创建队列。如果在创建消费组的时候key不存在（队列不存在），则同时会创建队列</li>
</ul>
<blockquote>
<p>Tips</p>
<p>如果队列中的消费组（同一队列中，消费组名不能重复）已经存在，则应该会产生异常。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; XGROUP CREATE test_queue test_group 0-0</span><br><span class="line">OK <span class="comment"># 为test_queue队列创建名为test_group的消费组，从头开始读</span></span><br><span class="line">127.0.0.1:6379&gt; XGROUP CREATE test_queue test_group 0-0</span><br><span class="line">(error) BUSYGROUP Consumer Group name already exists <span class="comment"># 消费组重复，抛出异常</span></span><br></pre></td></tr></table></figure>

<p><code>0-0</code>表示创建消费组时的游标指向<strong>此时</strong>的首部，<strong>切记切记切记</strong></p>
<h3 id="Xgroup-delconsumer-删除组中消费者"><a href="#Xgroup-delconsumer-删除组中消费者" class="headerlink" title="Xgroup delconsumer 删除组中消费者"></a>Xgroup delconsumer 删除组中消费者</h3><p>删除某队列中某消费组的某个消费者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP [DELCONSUMER key groupname consumername]</span><br></pre></td></tr></table></figure>

<ul>
<li>key：队列名称</li>
<li>groupname：消费组名</li>
<li>consumername：消费者名</li>
</ul>
<h3 id="Xgroup-destroy-销毁消费组"><a href="#Xgroup-destroy-销毁消费组" class="headerlink" title="Xgroup destroy 销毁消费组"></a>Xgroup destroy 销毁消费组</h3><p>删除某队列中的某消费组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XGROUP [DESTROY key groupname]</span><br></pre></td></tr></table></figure>

<ul>
<li>key：队列名称</li>
<li>groupname：消费组名</li>
</ul>
<h2 id="消费组读取（Xreadgroup）"><a href="#消费组读取（Xreadgroup）" class="headerlink" title="消费组读取（Xreadgroup）"></a>消费组读取（Xreadgroup）</h2><p>指定消费组中的<strong>消费者（consumer）</strong>读取队列中的消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]</span><br></pre></td></tr></table></figure>

<ul>
<li>group：消费组名</li>
<li>consumer：消费者名</li>
<li>count：读取消息的数量</li>
<li>milliseconds：阻塞毫秒数</li>
<li>key：队列名</li>
<li>ID：消息ID</li>
</ul>
<blockquote>
<p>Tips</p>
<p>消费组read后的消息会立马进入pengding，待消息被ack后，消息会从pending中消失</p>
</blockquote>
<p>使用名为c1的消费组代表消费组test_group消费消息，由于创建消费组时，游标指向首部，所以使用<code>&gt;</code>来表示消费首部的右边一个消息，即首个消息。此时消息进入pending</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; XREADGROUP GROUP test_group c1 count 1 STREAMS test_queue &gt;</span><br><span class="line">1) 1) <span class="string">&quot;test_queue&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">            3) <span class="string">&quot;age&quot;</span></span><br><span class="line">            4) <span class="string">&quot;18&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="待确认消息组（Xpending）"><a href="#待确认消息组（Xpending）" class="headerlink" title="待确认消息组（Xpending）"></a>待确认消息组（Xpending）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xpending key group [[IDLE min-idle-time] start end count [consumer]]</span><br></pre></td></tr></table></figure>

<ul>
<li>min-idle-time：限制时间过滤器</li>
<li>start：从什么地方开始</li>
<li>end：从什么地方结束</li>
<li>count：显示数量</li>
<li>consumer：可选，消费者名</li>
</ul>
<p>可以查看到刚刚c1消费者消费的消息进入了pending</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; xpending test_queue test_group - + 99</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c1&quot;</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 1073303</span><br><span class="line">   4) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>待消息被ack后才会从pending列表中移除</p>
<h2 id="转移消息归属权（Xclaim）"><a href="#转移消息归属权（Xclaim）" class="headerlink" title="转移消息归属权（Xclaim）"></a>转移消息归属权（Xclaim）</h2><p>可以将进入pending的消息转移给其他消费者（副作用：重置消息的空闲时间）如果两个消费者同时认领消息将永远不会成功，只有一个消费者能成功认领。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xclaim key group consumer min-idle-time ID [ID ...] [IDLE ms] [TIME ms-unix-time] [RETRYCOUNT count] [force] [justid] </span><br></pre></td></tr></table></figure>

<ul>
<li>key：队列名称</li>
<li>group：消费组名称</li>
<li>consumer：消费者名称</li>
<li>min-idle-time：最小闲置时间（单位：毫秒），即只会尝试认领超过该闲置时间的消息。如：消息1的闲置时间是1000，消息2的闲置时间是500，min-idle-time设置为700，那么只有消息1会被重新认领，消息2则不会被重新认领。</li>
<li>ID：消息的id</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; xpending test_queue test_group - + 10</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c2&quot;</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 16611</span><br><span class="line">   4) (<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; Xclaim test_queue test_group c3 86400000 1658053868394-0</span><br><span class="line">(empty array)	<span class="comment"># 尝试让c3认领消息，但是消息的闲置时间没有超过8640000</span></span><br><span class="line">127.0.0.1:6379&gt; Xclaim test_queue test_group c3 10000 1658053868394-0</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">      2) <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">      3) <span class="string">&quot;age&quot;</span></span><br><span class="line">      4) <span class="string">&quot;18&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; xpending test_queue test_group - + 99</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c3&quot;</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 70866</span><br><span class="line">   4) (<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<p>可以看到消息已经进入了c3的pending</p>
<h2 id="确认消息（Xack）"><a href="#确认消息（Xack）" class="headerlink" title="确认消息（Xack）"></a>确认消息（Xack）</h2><p>确认某队列某消费组的消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xack key group ID [ID ...]</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; xpending test_queue test_group - + 99</span><br><span class="line">1) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c3&quot;</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 70866</span><br><span class="line">   4) (<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; Xack test_queue test_group 1658053868394-0</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; xpending test_queue test_group - + 99</span><br><span class="line">(empty array)</span><br></pre></td></tr></table></figure>

<p>消息被ack之后，就会从pending中消失</p>
<h2 id="详情（Xinfo）常用命令"><a href="#详情（Xinfo）常用命令" class="headerlink" title="详情（Xinfo）常用命令"></a>详情（Xinfo）常用命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xinfo [CONSUMERS key groupname] [GROUPS key] [STREAM key] [HELP]</span><br></pre></td></tr></table></figure>



<h3 id="stream详情"><a href="#stream详情" class="headerlink" title="stream详情"></a>stream详情</h3><p>根据队列名称查看队列详情</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xinfo STREAM key</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xinfo STREAM test_queue</span><br><span class="line"> 1) <span class="string">&quot;length&quot;</span></span><br><span class="line"> 2) (<span class="built_in">integer</span>) 2</span><br><span class="line"> 3) <span class="string">&quot;radix-tree-keys&quot;</span></span><br><span class="line"> 4) (<span class="built_in">integer</span>) 1</span><br><span class="line"> 5) <span class="string">&quot;radix-tree-nodes&quot;</span></span><br><span class="line"> 6) (<span class="built_in">integer</span>) 2</span><br><span class="line"> 7) <span class="string">&quot;last-generated-id&quot;</span></span><br><span class="line"> 8) <span class="string">&quot;1658054319414-0&quot;</span></span><br><span class="line"> 9) <span class="string">&quot;groups&quot;</span></span><br><span class="line">10) (<span class="built_in">integer</span>) 1</span><br><span class="line">11) <span class="string">&quot;first-entry&quot;</span></span><br><span class="line">12) 1) <span class="string">&quot;1658053868394-0&quot;</span></span><br><span class="line">    2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">       2) <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">       3) <span class="string">&quot;age&quot;</span></span><br><span class="line">       4) <span class="string">&quot;18&quot;</span></span><br><span class="line">13) <span class="string">&quot;last-entry&quot;</span></span><br><span class="line">14) 1) <span class="string">&quot;1658054319414-0&quot;</span></span><br><span class="line">    2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">       2) <span class="string">&quot;xiaoming2&quot;</span></span><br><span class="line">       3) <span class="string">&quot;age&quot;</span></span><br><span class="line">       4) <span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>“length”：消息的长度（个数）</li>
<li>“groups”：队列中消费组的个数</li>
<li>“first-entry”：首消息</li>
<li>“last-entry”：尾消息</li>
</ul>
<h3 id="groups详情"><a href="#groups详情" class="headerlink" title="groups详情"></a>groups详情</h3><p>查看队列中的所有消费组</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xinfo GROUPS key</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xinfo GROUPS test_queue</span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;test_group&quot;</span></span><br><span class="line">   3) <span class="string">&quot;consumers&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 3</span><br><span class="line">   5) <span class="string">&quot;pending&quot;</span></span><br><span class="line">   6) (<span class="built_in">integer</span>) 0</span><br><span class="line">   7) <span class="string">&quot;last-delivered-id&quot;</span></span><br><span class="line">   8) <span class="string">&quot;1658053868394-0&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="CONSUMERS详情"><a href="#CONSUMERS详情" class="headerlink" title="CONSUMERS详情"></a>CONSUMERS详情</h3><p>查看队列中某消费组中的所有消费者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xinfo CONSUMERS key groupname</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; Xinfo CONSUMERS test_queue test_group</span><br><span class="line">1) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c1&quot;</span></span><br><span class="line">   3) <span class="string">&quot;pending&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 0</span><br><span class="line">   5) <span class="string">&quot;idle&quot;</span></span><br><span class="line">   6) (<span class="built_in">integer</span>) 164374831</span><br><span class="line">2) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c2&quot;</span></span><br><span class="line">   3) <span class="string">&quot;pending&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 0</span><br><span class="line">   5) <span class="string">&quot;idle&quot;</span></span><br><span class="line">   6) (<span class="built_in">integer</span>) 1759377</span><br><span class="line">3) 1) <span class="string">&quot;name&quot;</span></span><br><span class="line">   2) <span class="string">&quot;c3&quot;</span></span><br><span class="line">   3) <span class="string">&quot;pending&quot;</span></span><br><span class="line">   4) (<span class="built_in">integer</span>) 0</span><br><span class="line">   5) <span class="string">&quot;idle&quot;</span></span><br><span class="line">   6) (<span class="built_in">integer</span>) 1508038</span><br></pre></td></tr></table></figure>



<blockquote>
<p>Tips</p>
<p><code>idle</code>是闲置时间，单位是毫秒。</p>
</blockquote>
<p><strong>参考链接</strong></p>
<p>本笔记大量内容参考自<a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-stream.html">https://www.runoob.com/redis/redis-stream.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Redis/Stream%20%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/stream/" data-id="clsblyuf1002dw0k621nye3xr" data-title="Redis Stream" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stream/" rel="tag">stream</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/gRPC/grpc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/gRPC/grpc/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/gRPC/grpc/">初识gRPC</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、认识RPC"><a href="#1、认识RPC" class="headerlink" title="1、认识RPC"></a>1、认识RPC</h2><p><strong>RPC</strong>（Remote Procedure Call，远程过程调用）是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络细节的应用程序通信协议。RPC协议构建于TCP或UDP，或者是HTTP。允许开发者直接调用另一台服务器上的程序，而开发者无需另外的为这个调用过程编写网络通信相关代码，使得开发网络分布式程序在内的应用程序更加容易。</p>
<p>RPC采用客户端&#x2F;服务器端的工作模式，请求服务即客户端，服务提供者即是服务器端。当执行一个远程过程调用时，客户端程序首先先发送一个带有参数的调用信息到服务端，然后等待服务端响应。在服务端，服务进程保持睡眠状态直到客户端的调用信息到达。当一个调用信息到达时，服务端获得进程参数，计算出结果，并向客户端发送应答信息。然后等待下一个调用。</p>
<p><img src="/2023/07/19/back-end/go/gRPC/grpc/image-20211222112403969.png"></p>
<blockquote>
<p>并非狭义的客户端和服务器端，只要发送带有请求的调用信息就是客户端，而能够处理来自客户端的请求信息的就是服务器端。</p>
</blockquote>
<p>rpc不是框架，是一种思想。</p>
<p>通常在一次RPC调用会有三个特点：</p>
<ul>
<li>约定好调用的语义（接口语法）</li>
<li>约定好网络传输的内容的格式</li>
<li>网络传输</li>
</ul>
<p>RESTful就是目前比较常用的实现了RPC的架构风格，RESTful依靠HTTP&#x2F;1.1和JSON来进行传输。</p>
<h2 id="2、认识gRPC"><a href="#2、认识gRPC" class="headerlink" title="2、认识gRPC"></a>2、认识gRPC</h2><p>gRPC是一个开源的、高性能的RPC框架。最初由google开发，现在是CNCF的一部分。其网络数据传输默认采用的是Google的Protobuf，并且使用HTTP&#x2F;2。</p>
<h2 id="3、gRPC工作流程"><a href="#3、gRPC工作流程" class="headerlink" title="3、gRPC工作流程"></a>3、gRPC工作流程</h2><p>gRPC要求client存放一个stub（存根：提供与服务器相同的方法和功能），stub由gRPC框架自动生成。有了stub后，开发人员只需要关心具体的业务逻辑，而不需要关心网络通信相关实现原理。</p>
<p><img src="/2023/07/19/back-end/go/gRPC/grpc/image-20211222140307192.png"></p>
<blockquote>
<p>client的stub是由protoc生成的，可以利用插件快速将proto文件生成gRPC需要的stub</p>
</blockquote>
<h2 id="4、gRPC的四种类型"><a href="#4、gRPC的四种类型" class="headerlink" title="4、gRPC的四种类型"></a>4、gRPC的四种类型</h2><ul>
<li><p>unary（一元）</p>
<p>客户端发送1个单一请求，服务端回复1个单一响应，和普通的HTTP API类似。</p>
</li>
<li><p>client streaming（客户端流）</p>
<p>客户端发送多个消息流，并且期望服务端回复1个单一响应。</p>
</li>
<li><p>server streaming（服务端流）</p>
<p>客户端仅发送1个单一请求，服务端回复多个消息流。</p>
</li>
<li><p>bidirectional streaming（双向流）</p>
<p>客户端和服务端平行地发送和接受多条消息，并以任意顺序，非常灵活且无阻塞。</p>
</li>
</ul>
<h2 id="5、gRPC和REST的区别"><a href="#5、gRPC和REST的区别" class="headerlink" title="5、gRPC和REST的区别"></a>5、gRPC和REST的区别</h2><p><img src="/2023/07/19/back-end/go/gRPC/grpc/image-20211222142304070.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/gRPC/grpc/" data-id="clsblyuf2002fw0k6guf94d9v" data-title="初识gRPC" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/gRPC/grpc整合go" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/">gRPC在go语言当中的应用，第一个gRPC应用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前序"><a href="#前序" class="headerlink" title="前序"></a>前序</h2><p>请确保在进行后续的步骤时，确保电脑中有protobuf</p>
<p>MacOS可以利用<code>brew install protobuf</code>安装</p>
<h2 id="1、创建新的go项目"><a href="#1、创建新的go项目" class="headerlink" title="1、创建新的go项目"></a>1、创建新的go项目</h2><p>项目名称：<code>gitee.com/qingke.wu/hello-grpc/pb</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init gitee.com/qingke.wu/hello-grpc/pb</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── Makefile						<span class="comment">#常用的make命令，如go run，go test</span></span><br><span class="line">├── client							<span class="comment">#客户端</span></span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">├── pb									<span class="comment">#经protoc编译后的文件</span></span><br><span class="line">├── proto								<span class="comment">#proto源文件</span></span><br><span class="line">├── server							<span class="comment">#服务端</span></span><br><span class="line">└── service							<span class="comment">#对pb中的实现的业务逻辑</span></span><br></pre></td></tr></table></figure>

<h2 id="2、安装依赖"><a href="#2、安装依赖" class="headerlink" title="2、安装依赖"></a>2、安装依赖</h2><p>安装gRPC需要的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get - u google.golang.org/grpc</span><br></pre></td></tr></table></figure>



<h2 id="3、安装插件"><a href="#3、安装插件" class="headerlink" title="3、安装插件"></a>3、安装插件</h2><p>安装定制给go和gRPC的插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/golang/protobuf/protoc-gen-go@latest</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest</span><br></pre></td></tr></table></figure>

<h2 id="4、编写proto文件并且编译"><a href="#4、编写proto文件并且编译" class="headerlink" title="4、编写proto文件并且编译"></a>4、编写proto文件并且编译</h2><p>hello.proto：</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;      <span class="comment">//语法版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;.;hello&quot;</span>;    <span class="comment">//生成的go文件的包名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloResponse</span> &#123;</span><br><span class="line">  <span class="type">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个 rpc 服务通过参数和返回类型来指定可以远程调用的方法</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">Hello</span> &#123;</span><br><span class="line">  <span class="comment">// rpc 定义可远程调用服务</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> HelloWorld (HelloRequest) <span class="keyword">returns</span> (HelloResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用protoc生成可用于go和grpc的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=proto proto/*.proto --go_out=plugins=grpc:./pb</span><br></pre></td></tr></table></figure>

<p>可以将它写进Makefile中</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">gen:</span></span><br><span class="line">	protoc --proto_path=proto proto/*.proto --go_out=plugins=grpc:./pb</span><br></pre></td></tr></table></figure>



<h2 id="5、服务端对pb中的文件进行实现"><a href="#5、服务端对pb中的文件进行实现" class="headerlink" title="5、服务端对pb中的文件进行实现"></a>5、服务端对pb中的文件进行实现</h2><p>这是位于hello.pb.go文件中的HelloServer接口，我们需要自己实现它。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloServer is the server API for Hello service.</span></span><br><span class="line"><span class="keyword">type</span> HelloServer <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// rpc 定义可远程调用服务</span></span><br><span class="line">	HelloWorld(context.Context, *HelloRequest) (*HelloResponse, <span class="type">error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以编写在service包下新建<code>hello_service.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	pb <span class="string">&quot;gitee.com/qingke.wu/hello-grpc/pb&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloServer hello.proto中service hello的实现（即实现hello service）</span></span><br><span class="line"><span class="keyword">type</span> HelloServer <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewHelloServer</span><span class="params">()</span></span> *HelloServer &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;HelloServer&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloWorld 实现hello.proto中的中的service hello中定义的HelloWorld方法（必须同名）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *HelloServer)</span></span> HelloWorld(context context.Context, request *pb.HelloRequest) (*pb.HelloResponse, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 通过getter来获取到request中的name</span></span><br><span class="line">	log.Printf(<span class="string">&quot;Received hello.name: %v&quot;</span>, request.GetName())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对request作对应的处理</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过response返回给调用者</span></span><br><span class="line">	<span class="keyword">return</span> &amp;pb.HelloResponse&#123;Message: <span class="string">&quot;Hello!&quot;</span> + request.GetName()&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6、服务端"><a href="#6、服务端" class="headerlink" title="6、服务端"></a>6、服务端</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	pb <span class="string">&quot;gitee.com/qingke.wu/hello-grpc/pb&quot;</span></span><br><span class="line">	<span class="string">&quot;gitee.com/qingke.wu/hello-grpc/service&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// grpc服务</span></span><br><span class="line">	grpcServer := grpc.NewServer()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 利用hello.pb.go中的RegisterHelloServer()将service注册到grpc</span></span><br><span class="line">	pb.RegisterHelloServer(grpcServer, service.NewHelloServer())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 启用net利用tcp来连接并且进行监听</span></span><br><span class="line">	listen, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;:9001&quot;</span>) <span class="comment">// 指定端口号</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;failed to listen: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开启服务</span></span><br><span class="line">	err = grpcServer.Serve(listen)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;failed to serve: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7、客户端"><a href="#7、客户端" class="headerlink" title="7、客户端"></a>7、客户端</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	pb <span class="string">&quot;gitee.com/qingke.wu/hello-grpc/pb&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 指定端口号连接到grpc服务</span></span><br><span class="line">	<span class="comment">// WithInsecure()不指定安全选项</span></span><br><span class="line">	conn, err := grpc.Dial(<span class="string">&quot;localhost:9001&quot;</span>, grpc.WithInsecure())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;did not connect: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 延迟关闭连接</span></span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 利用hello.pb.go文件中的NewHelloClient()来获得client</span></span><br><span class="line">	client := pb.NewHelloClient(conn)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置上下文超时时间</span></span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建request1</span></span><br><span class="line">	request1 := &amp;pb.HelloRequest&#123;&#125;</span><br><span class="line">	request1.Name = <span class="string">&quot;World!&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 利用request发起请求，并且得到response响应</span></span><br><span class="line">	<span class="comment">// client不需要关心HelloWorld在服务端上的具体实现</span></span><br><span class="line">	<span class="comment">// 只需要关心request和response即可</span></span><br><span class="line">	response, err := client.HelloWorld(ctx, request1)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;could not succ: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// 读取response</span></span><br><span class="line">	log.Printf(<span class="string">&quot;Receive from server: %s&quot;</span>, response.Message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动服务端再启动客户端</p>
<p>服务端接受来自客户端的请求：<img src="/2023/07/19/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/image-20211222174543835.png"></p>
<p>客户端收到来自服务端的响应：<img src="/2023/07/19/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/image-20211222174607153.png"></p>
<p><strong>OK！</strong>至此，一个简单的基于go的gRPC实现的演示项目已经完成！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>client和server通过共同协定好的proto约定来进行通信。</p>
<p>其中server需要对proto生成的proto.go对象的service进行实现，然后再将grpcServer与XxxPbServer进行注册。</p>
<p>其中client只需要关心proto.go对象的service中的rpc调用的request和response即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/" data-id="clsblyuf3002iw0k636lr7nkb" data-title="gRPC在go语言当中的应用，第一个gRPC应用" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArrayList/" rel="tag">ArrayList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC-web/" rel="tag">GRPC-web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaSE/" rel="tag">JavaSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LinkedList/" rel="tag">LinkedList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth2-0/" rel="tag">OAuth2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OIDC/" rel="tag">OIDC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/" rel="tag">SSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringAOP/" rel="tag">SpringAOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/" rel="tag">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/caddy/" rel="tag">caddy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cobra/" rel="tag">cobra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dig/" rel="tag">dig</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dockerfile/" rel="tag">dockerfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/" rel="tag">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flag/" rel="tag">flag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flags/" rel="tag">flags</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/godotenv/" rel="tag">godotenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gorm/" rel="tag">gorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jedis/" rel="tag">jedis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernates/" rel="tag">kubernates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrus/" rel="tag">logrus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/promise/" rel="tag">promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protobuf/" rel="tag">protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stream/" rel="tag">stream</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-cli/" rel="tag">vue-cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-element-admin/" rel="tag">vue-element-admin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-router/" rel="tag">vue-router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag">集合</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ArrayList/" style="font-size: 10px;">ArrayList</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/GRPC/" style="font-size: 12.86px;">GRPC</a> <a href="/tags/GRPC-web/" style="font-size: 10px;">GRPC-web</a> <a href="/tags/Golang/" style="font-size: 18.57px;">Golang</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaSE/" style="font-size: 12.86px;">JavaSE</a> <a href="/tags/LinkedList/" style="font-size: 10px;">LinkedList</a> <a href="/tags/Mybatis/" style="font-size: 11.43px;">Mybatis</a> <a href="/tags/OAuth2-0/" style="font-size: 10px;">OAuth2.0</a> <a href="/tags/OIDC/" style="font-size: 12.86px;">OIDC</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/Spring/" style="font-size: 12.86px;">Spring</a> <a href="/tags/SpringAOP/" style="font-size: 10px;">SpringAOP</a> <a href="/tags/SpringBoot/" style="font-size: 14.29px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/caddy/" style="font-size: 10px;">caddy</a> <a href="/tags/cobra/" style="font-size: 10px;">cobra</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/dig/" style="font-size: 10px;">dig</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/dockerfile/" style="font-size: 10px;">dockerfile</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/flag/" style="font-size: 10px;">flag</a> <a href="/tags/flags/" style="font-size: 10px;">flags</a> <a href="/tags/gin/" style="font-size: 10px;">gin</a> <a href="/tags/godotenv/" style="font-size: 10px;">godotenv</a> <a href="/tags/gorm/" style="font-size: 10px;">gorm</a> <a href="/tags/http/" style="font-size: 11.43px;">http</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/jedis/" style="font-size: 10px;">jedis</a> <a href="/tags/kubernates/" style="font-size: 10px;">kubernates</a> <a href="/tags/logrus/" style="font-size: 10px;">logrus</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/promise/" style="font-size: 10px;">promise</a> <a href="/tags/protobuf/" style="font-size: 10px;">protobuf</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 11.43px;">redis</a> <a href="/tags/stream/" style="font-size: 10px;">stream</a> <a href="/tags/uni-app/" style="font-size: 10px;">uni-app</a> <a href="/tags/vue/" style="font-size: 17.14px;">vue</a> <a href="/tags/vue-cli/" style="font-size: 10px;">vue-cli</a> <a href="/tags/vue-element-admin/" style="font-size: 10px;">vue-element-admin</a> <a href="/tags/vue-router/" style="font-size: 10px;">vue-router</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 11.43px;">多线程</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.43px;">数据库</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 11.43px;">网络安全</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.43px;">设计模式</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 12.86px;">集合</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/02/04/back-end/docker/dockerfile/">docker学习</a>
          </li>
        
          <li>
            <a href="/2023/07/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/">利用Java来手写ArrayList</a>
          </li>
        
          <li>
            <a href="/2023/07/19/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/">利用Java手写LinkedList</a>
          </li>
        
          <li>
            <a href="/2023/07/19/back-end/DevOps/CI_CD/">CI_CD</a>
          </li>
        
          <li>
            <a href="/2023/07/19/design-pattern/SOLID/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84S.O.L.I.D%E5%8E%9F%E5%88%99/">面向对象的S.O.L.I.D原则</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 FanGaoXS<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>