<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>FanGaoXS&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="FanGaoXS&#39;s blog">
<meta property="og:url" content="https://fangaoxs.github.io/page/4/index.html">
<meta property="og:site_name" content="FanGaoXS&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="FanGaoXS">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="FanGaoXS's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FanGaoXS&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fangaoxs.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-back-end/go/grpc-web" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/23/back-end/go/grpc-web/" class="article-date">
  <time class="dt-published" datetime="2021-12-23T07:30:39.000Z" itemprop="datePublished">2021-12-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/23/back-end/go/grpc-web/">第一个gRPC-web项目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是gRPC-web？"><a href="#1、什么是gRPC-web？" class="headerlink" title="1、什么是gRPC-web？"></a>1、什么是gRPC-web？</h2><p>简单来说，gRPC-web就是gRPC的JavaScript版本的client实现</p>
<h2 id="2、gRPC-web工作流程"><a href="#2、gRPC-web工作流程" class="headerlink" title="2、gRPC-web工作流程"></a>2、gRPC-web工作流程</h2><p>由于浏览器的特性，gRPC-web其实没办法直接向gRPC-server发送HTTP&#x2F;2请求的，只有通过envoy代理，将来自gRPC-web的HTTP&#x2F;1的请求转换为gRPC-server能够接收的HTTP&#x2F;2请求</p>
<p><img src="/2021/12/23/back-end/go/grpc-web/image-20211223101933454.png"></p>
<h2 id="3、安装gRPC-web相关依赖"><a href="#3、安装gRPC-web相关依赖" class="headerlink" title="3、安装gRPC-web相关依赖"></a>3、安装gRPC-web相关依赖</h2><p>在使用下列命令前确保开发环境已经安装<code>node</code></p>
<p>全局安装<code>protoc-gen-grpc-web</code>插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i protoc-gen-grpc-web -g			<span class="comment">#全局安装</span></span><br></pre></td></tr></table></figure>

<p>在web项目中安装（确保项目使用<code>npm init -y</code>初始化）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i protobufjs</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i grpc-web</span><br></pre></td></tr></table></figure>



<h2 id="4、编写proto文件"><a href="#4、编写proto文件" class="headerlink" title="4、编写proto文件"></a>4、编写proto文件</h2><p>编写proto文件，并且通过插件将proto文件编译为js文件</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;      <span class="comment">//语法版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> pb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;./;pb&quot;</span>;    <span class="comment">//生成的go文件的包名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloResponse</span> &#123;</span><br><span class="line">  <span class="type">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个 rpc 服务通过参数和返回类型来指定可以远程调用的方法</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">Hello</span> &#123;</span><br><span class="line">  <span class="comment">// rpc 定义可远程调用服务</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> HelloWorld (HelloRequest) <span class="keyword">returns</span> (HelloResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用插件将proto文件编译为js文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=proto proto/*proto \</span><br><span class="line">    --js_out=import_style=commonjs:./pb \</span><br><span class="line">    --grpc-web_out=import_style=commonjs,mode=grpcwebtext:./pb</span><br></pre></td></tr></table></figure>

<p>语义：</p>
<p><code>--proto_path</code>指proto文件所在的目录</p>
<p><code>--js_out=import_style=commonjs:./pb</code>指利用commonjs将编译后的js文件存放在<code>./pb</code>目录中</p>
<p><code>--grpc-web_out=import_style=commonjs,mode=grpcwebtext:./pb</code>指利用commonjs将编译后的grpc-web的js文件存放在<code>./pb</code>目录，并且模式是grpcwebtext</p>
<p>同样的，也可以添加到Makefile中</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">gen:</span></span><br><span class="line">	protoc --proto_path=proto proto/*proto \</span><br><span class="line">    --js_out=import_style=commonjs:./pb \</span><br><span class="line">    --grpc-web_out=import_style=commonjs,mode=grpcwebtext:./pb</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm pb/*.js</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h2 id="5、启用客户端"><a href="#5、启用客户端" class="headerlink" title="5、启用客户端"></a>5、启用客户端</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从pb中拿到request和response</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">HelloRequest</span>,<span class="title class_">HelloResponse</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./pb/hello_pb.js&#x27;</span></span><br><span class="line"><span class="comment">// 从grpc_web_pb中拿到client</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">HelloClient</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./pb/hello_grpc_web_pb.js&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得client</span></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title class_">HelloClient</span>(<span class="string">&#x27;http://localhost:9001&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建request</span></span><br><span class="line"><span class="keyword">let</span> request = <span class="keyword">new</span> <span class="title class_">HelloRequest</span>();</span><br><span class="line">request.<span class="title function_">setName</span>(<span class="string">&#x27;World!&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 利用request发起请求，得到response响应</span></span><br><span class="line"><span class="comment">// 其中response包含在一个回调函数当中</span></span><br><span class="line">client.<span class="title function_">helloWorld</span>(request, &#123;&#125;, <span class="function">(<span class="params">err,response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;  <span class="comment">//获得response失败</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response err &#x27;</span>,err)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 获得response成功</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;receive from server: &#x27;</span>,response)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现，和gRPC-client的go的实现的步骤是差不多的，1、从生成的文件中获得client，然后利用client执行service中的方法，最后获得response。</p>
<h2 id="5、已知缺点"><a href="#5、已知缺点" class="headerlink" title="5、已知缺点"></a>5、已知缺点</h2><p>只支持server往client发送消息流，其余方式的信息流不支持</p>
<h2 id="6、envoy代理"><a href="#6、envoy代理" class="headerlink" title="6、envoy代理"></a>6、envoy代理</h2><p>envoy是一个代理服务，类似于Nginx。</p>
<p>gRPC-web目前支持HTTP&#x2F;1.0和HTTP&#x2F;1.1，但是gRPC请求要求的协议是HTTP2，所以gRPC-web发送过来的请求无法直接被gRPC-server（服务端）接受，所以需要使用envoy做一次代理转换，将来自gRPC-web的请求HTTP&#x2F;1请求转换为gRPC-server能使用的HTTP&#x2F;2请求。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/12/23/back-end/go/grpc-web/" data-id="clto66l4q000rsck66b55hyjc" data-title="第一个gRPC-web项目" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/protobuf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/22/back-end/go/protobuf/" class="article-date">
  <time class="dt-published" datetime="2021-12-22T07:30:39.000Z" itemprop="datePublished">2021-12-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/22/back-end/go/protobuf/">初识protobuf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是protobuf？"><a href="#1、什么是protobuf？" class="headerlink" title="1、什么是protobuf？"></a>1、什么是protobuf？</h2><blockquote>
<p>protocol buffers 是一种语言无关、平台无关、可扩展的<strong>序列化</strong>结构数据的方法，它可用于（数据）通信协议、数据存储等。</p>
<p>Protocol Buffers 是一种灵活，高效，自动化机制的结构数据序列化方法－可类比 XML，但是比 XML 更小（3 ~ 10倍）、更快（20 ~ 100倍）、更为简单。</p>
<p>你可以定义数据的结构，然后使用特殊生成的源代码轻松的在各种数据流中使用各种语言进行编写和读取结构数据。你甚至可以更新数据结构，而不破坏由旧数据结构编译的已部署程序。 ——<a target="_blank" rel="noopener" href="https://developers.google.com/protocol-buffers/">https://developers.google.com/protocol-buffers/</a></p>
</blockquote>
<p>简而言之，protobuf是一种<strong>序列化</strong>结构数据的方法，类似于XML、JSON，是一种数据传输格式，它的存储方式是二进制，所以有体量更小，解析速度更快的特点。</p>
<p>proto不能像JSON和XML一样开箱即用，需要利用工具（protoc）来编译成常用语言的所能够使用的文件（如果.java，.go等）。</p>
<p>protobuf更像是一个API合同，能够供服务端（Server）和客户端（Client）同时“阅读”的一种API约定、协议。其实它就是协议的一个缓冲文件，缓冲更好地凸显了它的名字中的<strong>buf</strong>（即buffers）</p>
<h2 id="2、为什么要使用protobuf？"><a href="#2、为什么要使用protobuf？" class="headerlink" title="2、为什么要使用protobuf？"></a>2、为什么要使用protobuf？</h2><ol>
<li>易读且容易理解</li>
<li>不同语言可以互相操作，因为可以利用工具生成不同语言的代码文件</li>
<li>体积小（存储方式是二进制）</li>
<li>更快的传输效率（存储方式是二进制）</li>
<li>相较于JSON和XML有更高效的序列化能力</li>
<li>非常安全（客户端和服务端之间强类型的API合同）</li>
</ol>
<h2 id="3、支持序列化"><a href="#3、支持序列化" class="headerlink" title="3、支持序列化"></a>3、支持序列化</h2><p>序列化的定义：序列化 (Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。序列化使其他代码可以查看或修改，那些不序列化便无法访问的对象实例数据。</p>
<p>可以把proto文件理解为上述所描述的<strong>存储区</strong>，可以从proto文件中反序列化出对象的状态，并且创建该对象。</p>
<p>proto相较于普通的序列化强大的一点是，它可以由开发人员按照一定的规范编写文件，并且可以利用protoc反序列化成其他任意语言能够解释的对象。</p>
<blockquote>
<p>如果有接触过Java的序列化就能更好理解，Java的序列化会将此时的Java对象的状态序列化到文件当中，但是该文件是不可读的，然后可以利用Java的反序列化将当时的Java对象的状态重建。</p>
</blockquote>
<h2 id="4、proto2和proto3"><a href="#4、proto2和proto3" class="headerlink" title="4、proto2和proto3"></a>4、proto2和proto3</h2><p>protobuf有两个大版本，proto2和proto3，目前比较新的都是使用proto3，proto3相较于proto2增加了更多语言的支持。</p>
<h2 id="5、protobuf包含什么？"><a href="#5、protobuf包含什么？" class="headerlink" title="5、protobuf包含什么？"></a>5、protobuf包含什么？</h2><ul>
<li>业务的描述（service）</li>
<li>有效负载消息实体（message）</li>
</ul>
<h2 id="6、第一次使用protobuf"><a href="#6、第一次使用protobuf" class="headerlink" title="6、第一次使用protobuf"></a>6、第一次使用protobuf</h2><h3 id="1、创建新的项目"><a href="#1、创建新的项目" class="headerlink" title="1、创建新的项目"></a>1、创建新的项目</h3><p>其中包含两个目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── go.mod</span><br><span class="line">├── pb				<span class="comment">#proto编译后的文件</span></span><br><span class="line">├── proto			<span class="comment">#proto原始文件</span></span><br></pre></td></tr></table></figure>



<h3 id="2、创建test-proto文件"><a href="#2、创建test-proto文件" class="headerlink" title="2、创建test.proto文件"></a>2、创建test.proto文件</h3><p>确保IDE已经安装了proto相关的插件。</p>
<p>在proto目录下创建</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;.;pb&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> query = <span class="number">1</span>;</span><br><span class="line">  <span class="type">int32</span> page_number = <span class="number">2</span>;</span><br><span class="line">  <span class="type">int32</span> result_per_page = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、利用protoc来编译"><a href="#3、利用protoc来编译" class="headerlink" title="3、利用protoc来编译"></a>3、利用protoc来编译</h3><p>确保go是1.1版本以上并且能够正常使用go mod</p>
<p>安装能够将proto文件编译成go能够使用的文件的插件<code>protoc-gen-go</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install google.golang.org/protobuf/cmd/protoc-gen-go@latest</span><br></pre></td></tr></table></figure>

<p>执行<code>protoc</code>编译命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=proto proto/*.proto --go_out=pb</span><br></pre></td></tr></table></figure>

<p>可以看到pb目录下已经有了经protoc编译后的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── go.mod</span><br><span class="line">├── pb</span><br><span class="line">│   └── test.pb.go</span><br><span class="line">├── proto</span><br><span class="line">│   └── test.proto</span><br></pre></td></tr></table></figure>

<h3 id="4、使用-go文件中的go对象"><a href="#4、使用-go文件中的go对象" class="headerlink" title="4、使用.go文件中的go对象"></a>4、使用.go文件中的go对象</h3><p><strong>OK！</strong>现在已经完成了一次proto文件的编写、以及编译，接下来就可以直接使用.go文件中的go语言能够使用的对象了。</p>
<p>接下来更需要关心的是proto文件的具体编写。</p>
<h2 id="7、编写proto文件"><a href="#7、编写proto文件" class="headerlink" title="7、编写proto文件"></a>7、编写proto文件</h2><p><code>syntax = &quot;proto3&quot;;</code>指定该proto文件的语法是proto3（必须）</p>
<p><code>option go_package = &quot;.;pb&quot;;</code>指定该proto输出到当前目录下的pb文件夹</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">xxx</span> &#123;</span><br><span class="line">  <span class="comment">// 字段规则：required -&gt; 字段只能也必须出现 1 次</span></span><br><span class="line">  <span class="comment">// 字段规则：optional -&gt; 字段可出现 0 次或1次</span></span><br><span class="line">  <span class="comment">// 字段规则：repeated -&gt; 字段可出现任意多次（包括 0）</span></span><br><span class="line">  <span class="comment">// 类型：int32、int64、sint32、sint64、string、32-bit ....</span></span><br><span class="line">  <span class="comment">// 字段编号：0 ~ 536870911（除去 19000 到 19999 之间的数字）</span></span><br><span class="line">  字段规则 类型 名称 = 字段编号;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义消息实体</p>
<h2 id="8、总结"><a href="#8、总结" class="headerlink" title="8、总结"></a>8、总结</h2><ol>
<li>XML、JSON、Protobuf都具有数据传输的能力</li>
<li>XML、JSON注重数据<strong>结构化</strong>，Protobuf注重数据<strong>序列化</strong></li>
<li>Protobuf使用场景更明确，XML、JSON使用场景更丰富且多元（更普遍）。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/12/22/back-end/go/protobuf/" data-id="clto66l4t000tsck63oxo93qx" data-title="初识protobuf" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/gRPC/grpc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/22/back-end/go/gRPC/grpc/" class="article-date">
  <time class="dt-published" datetime="2021-12-22T07:30:39.000Z" itemprop="datePublished">2021-12-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/22/back-end/go/gRPC/grpc/">初识gRPC</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、认识RPC"><a href="#1、认识RPC" class="headerlink" title="1、认识RPC"></a>1、认识RPC</h2><p><strong>RPC</strong>（Remote Procedure Call，远程过程调用）是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络细节的应用程序通信协议。RPC协议构建于TCP或UDP，或者是HTTP。允许开发者直接调用另一台服务器上的程序，而开发者无需另外的为这个调用过程编写网络通信相关代码，使得开发网络分布式程序在内的应用程序更加容易。</p>
<p>RPC采用客户端&#x2F;服务器端的工作模式，请求服务即客户端，服务提供者即是服务器端。当执行一个远程过程调用时，客户端程序首先先发送一个带有参数的调用信息到服务端，然后等待服务端响应。在服务端，服务进程保持睡眠状态直到客户端的调用信息到达。当一个调用信息到达时，服务端获得进程参数，计算出结果，并向客户端发送应答信息。然后等待下一个调用。</p>
<p><img src="/2021/12/22/back-end/go/gRPC/grpc/image-20211222112403969.png"></p>
<blockquote>
<p>并非狭义的客户端和服务器端，只要发送带有请求的调用信息就是客户端，而能够处理来自客户端的请求信息的就是服务器端。</p>
</blockquote>
<p>rpc不是框架，是一种思想。</p>
<p>通常在一次RPC调用会有三个特点：</p>
<ul>
<li>约定好调用的语义（接口语法）</li>
<li>约定好网络传输的内容的格式</li>
<li>网络传输</li>
</ul>
<p>RESTful就是目前比较常用的实现了RPC的架构风格，RESTful依靠HTTP&#x2F;1.1和JSON来进行传输。</p>
<h2 id="2、认识gRPC"><a href="#2、认识gRPC" class="headerlink" title="2、认识gRPC"></a>2、认识gRPC</h2><p>gRPC是一个开源的、高性能的RPC框架。最初由google开发，现在是CNCF的一部分。其网络数据传输默认采用的是Google的Protobuf，并且使用HTTP&#x2F;2。</p>
<h2 id="3、gRPC工作流程"><a href="#3、gRPC工作流程" class="headerlink" title="3、gRPC工作流程"></a>3、gRPC工作流程</h2><p>gRPC要求client存放一个stub（存根：提供与服务器相同的方法和功能），stub由gRPC框架自动生成。有了stub后，开发人员只需要关心具体的业务逻辑，而不需要关心网络通信相关实现原理。</p>
<p><img src="/2021/12/22/back-end/go/gRPC/grpc/image-20211222140307192.png"></p>
<blockquote>
<p>client的stub是由protoc生成的，可以利用插件快速将proto文件生成gRPC需要的stub</p>
</blockquote>
<h2 id="4、gRPC的四种类型"><a href="#4、gRPC的四种类型" class="headerlink" title="4、gRPC的四种类型"></a>4、gRPC的四种类型</h2><ul>
<li><p>unary（一元）</p>
<p>客户端发送1个单一请求，服务端回复1个单一响应，和普通的HTTP API类似。</p>
</li>
<li><p>client streaming（客户端流）</p>
<p>客户端发送多个消息流，并且期望服务端回复1个单一响应。</p>
</li>
<li><p>server streaming（服务端流）</p>
<p>客户端仅发送1个单一请求，服务端回复多个消息流。</p>
</li>
<li><p>bidirectional streaming（双向流）</p>
<p>客户端和服务端平行地发送和接受多条消息，并以任意顺序，非常灵活且无阻塞。</p>
</li>
</ul>
<h2 id="5、gRPC和REST的区别"><a href="#5、gRPC和REST的区别" class="headerlink" title="5、gRPC和REST的区别"></a>5、gRPC和REST的区别</h2><p><img src="/2021/12/22/back-end/go/gRPC/grpc/image-20211222142304070.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/12/22/back-end/go/gRPC/grpc/" data-id="clto66l5m002isck67l0gguux" data-title="初识gRPC" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/gRPC/grpc整合go" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/22/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/" class="article-date">
  <time class="dt-published" datetime="2021-12-22T07:30:39.000Z" itemprop="datePublished">2021-12-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/22/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/">gRPC在go语言当中的应用，第一个gRPC应用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="前序"><a href="#前序" class="headerlink" title="前序"></a>前序</h2><p>请确保在进行后续的步骤时，确保电脑中有protobuf</p>
<p>MacOS可以利用<code>brew install protobuf</code>安装</p>
<h2 id="1、创建新的go项目"><a href="#1、创建新的go项目" class="headerlink" title="1、创建新的go项目"></a>1、创建新的go项目</h2><p>项目名称：<code>gitee.com/qingke.wu/hello-grpc/pb</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init gitee.com/qingke.wu/hello-grpc/pb</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── Makefile						<span class="comment">#常用的make命令，如go run，go test</span></span><br><span class="line">├── client							<span class="comment">#客户端</span></span><br><span class="line">├── go.mod</span><br><span class="line">├── go.sum</span><br><span class="line">├── pb									<span class="comment">#经protoc编译后的文件</span></span><br><span class="line">├── proto								<span class="comment">#proto源文件</span></span><br><span class="line">├── server							<span class="comment">#服务端</span></span><br><span class="line">└── service							<span class="comment">#对pb中的实现的业务逻辑</span></span><br></pre></td></tr></table></figure>

<h2 id="2、安装依赖"><a href="#2、安装依赖" class="headerlink" title="2、安装依赖"></a>2、安装依赖</h2><p>安装gRPC需要的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get - u google.golang.org/grpc</span><br></pre></td></tr></table></figure>



<h2 id="3、安装插件"><a href="#3、安装插件" class="headerlink" title="3、安装插件"></a>3、安装插件</h2><p>安装定制给go和gRPC的插件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/golang/protobuf/protoc-gen-go@latest</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest</span><br></pre></td></tr></table></figure>

<h2 id="4、编写proto文件并且编译"><a href="#4、编写proto文件并且编译" class="headerlink" title="4、编写proto文件并且编译"></a>4、编写proto文件并且编译</h2><p>hello.proto：</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;      <span class="comment">//语法版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> go_package = <span class="string">&quot;.;hello&quot;</span>;    <span class="comment">//生成的go文件的包名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">HelloResponse</span> &#123;</span><br><span class="line">  <span class="type">string</span> message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一个 rpc 服务通过参数和返回类型来指定可以远程调用的方法</span></span><br><span class="line"><span class="keyword">service </span><span class="title class_">Hello</span> &#123;</span><br><span class="line">  <span class="comment">// rpc 定义可远程调用服务</span></span><br><span class="line">  <span class="function"><span class="keyword">rpc</span> HelloWorld (HelloRequest) <span class="keyword">returns</span> (HelloResponse) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用protoc生成可用于go和grpc的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc --proto_path=proto proto/*.proto --go_out=plugins=grpc:./pb</span><br></pre></td></tr></table></figure>

<p>可以将它写进Makefile中</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">gen:</span></span><br><span class="line">	protoc --proto_path=proto proto/*.proto --go_out=plugins=grpc:./pb</span><br></pre></td></tr></table></figure>



<h2 id="5、服务端对pb中的文件进行实现"><a href="#5、服务端对pb中的文件进行实现" class="headerlink" title="5、服务端对pb中的文件进行实现"></a>5、服务端对pb中的文件进行实现</h2><p>这是位于hello.pb.go文件中的HelloServer接口，我们需要自己实现它。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// HelloServer is the server API for Hello service.</span></span><br><span class="line"><span class="keyword">type</span> HelloServer <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// rpc 定义可远程调用服务</span></span><br><span class="line">	HelloWorld(context.Context, *HelloRequest) (*HelloResponse, <span class="type">error</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以编写在service包下新建<code>hello_service.go</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	pb <span class="string">&quot;gitee.com/qingke.wu/hello-grpc/pb&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloServer hello.proto中service hello的实现（即实现hello service）</span></span><br><span class="line"><span class="keyword">type</span> HelloServer <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewHelloServer</span><span class="params">()</span></span> *HelloServer &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;HelloServer&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HelloWorld 实现hello.proto中的中的service hello中定义的HelloWorld方法（必须同名）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *HelloServer)</span></span> HelloWorld(context context.Context, request *pb.HelloRequest) (*pb.HelloResponse, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// 通过getter来获取到request中的name</span></span><br><span class="line">	log.Printf(<span class="string">&quot;Received hello.name: %v&quot;</span>, request.GetName())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 对request作对应的处理</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过response返回给调用者</span></span><br><span class="line">	<span class="keyword">return</span> &amp;pb.HelloResponse&#123;Message: <span class="string">&quot;Hello!&quot;</span> + request.GetName()&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6、服务端"><a href="#6、服务端" class="headerlink" title="6、服务端"></a>6、服务端</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	pb <span class="string">&quot;gitee.com/qingke.wu/hello-grpc/pb&quot;</span></span><br><span class="line">	<span class="string">&quot;gitee.com/qingke.wu/hello-grpc/service&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// grpc服务</span></span><br><span class="line">	grpcServer := grpc.NewServer()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 利用hello.pb.go中的RegisterHelloServer()将service注册到grpc</span></span><br><span class="line">	pb.RegisterHelloServer(grpcServer, service.NewHelloServer())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 启用net利用tcp来连接并且进行监听</span></span><br><span class="line">	listen, err := net.Listen(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;:9001&quot;</span>) <span class="comment">// 指定端口号</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;failed to listen: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开启服务</span></span><br><span class="line">	err = grpcServer.Serve(listen)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;failed to serve: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7、客户端"><a href="#7、客户端" class="headerlink" title="7、客户端"></a>7、客户端</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	pb <span class="string">&quot;gitee.com/qingke.wu/hello-grpc/pb&quot;</span></span><br><span class="line">	<span class="string">&quot;google.golang.org/grpc&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 指定端口号连接到grpc服务</span></span><br><span class="line">	<span class="comment">// WithInsecure()不指定安全选项</span></span><br><span class="line">	conn, err := grpc.Dial(<span class="string">&quot;localhost:9001&quot;</span>, grpc.WithInsecure())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;did not connect: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 延迟关闭连接</span></span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 利用hello.pb.go文件中的NewHelloClient()来获得client</span></span><br><span class="line">	client := pb.NewHelloClient(conn)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置上下文超时时间</span></span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), time.Second)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建request1</span></span><br><span class="line">	request1 := &amp;pb.HelloRequest&#123;&#125;</span><br><span class="line">	request1.Name = <span class="string">&quot;World!&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 利用request发起请求，并且得到response响应</span></span><br><span class="line">	<span class="comment">// client不需要关心HelloWorld在服务端上的具体实现</span></span><br><span class="line">	<span class="comment">// 只需要关心request和response即可</span></span><br><span class="line">	response, err := client.HelloWorld(ctx, request1)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;could not succ: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// 读取response</span></span><br><span class="line">	log.Printf(<span class="string">&quot;Receive from server: %s&quot;</span>, response.Message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动服务端再启动客户端</p>
<p>服务端接受来自客户端的请求：<img src="/2021/12/22/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/image-20211222174543835.png"></p>
<p>客户端收到来自服务端的响应：<img src="/2021/12/22/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/image-20211222174607153.png"></p>
<p><strong>OK！</strong>至此，一个简单的基于go的gRPC实现的演示项目已经完成！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>client和server通过共同协定好的proto约定来进行通信。</p>
<p>其中server需要对proto生成的proto.go对象的service进行实现，然后再将grpcServer与XxxPbServer进行注册。</p>
<p>其中client只需要关心proto.go对象的service中的rpc调用的request和response即可。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/12/22/back-end/go/gRPC/grpc%E6%95%B4%E5%90%88go/" data-id="clto66l5n002ksck64cnz3omq" data-title="gRPC在go语言当中的应用，第一个gRPC应用" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/docker/docker学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/" class="article-date">
  <time class="dt-published" datetime="2021-12-17T07:30:39.000Z" itemprop="datePublished">2021-12-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/">docker学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、安装docker"><a href="#1、安装docker" class="headerlink" title="1、安装docker"></a>1、安装docker</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/macos-docker-install.html">https://www.runoob.com/docker/macos-docker-install.html</a></p>
<p>选择匹配自己操作系统的版本进行安装，如果比较慢的话可以使用阿里的开源镜像站下载：</p>
<p><a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/docker-toolbox/">http://mirrors.aliyun.com/docker-toolbox/</a></p>
<h2 id="2、配置docker镜像源加速"><a href="#2、配置docker镜像源加速" class="headerlink" title="2、配置docker镜像源加速"></a>2、配置docker镜像源加速</h2><p>由于docker下载镜像默认是从dockerhub上下载，会比较慢，所以建议配置国内的镜像源，具体配置方法参看：</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-mirror-acceleration.html">https://www.runoob.com/docker/docker-mirror-acceleration.html</a></p>
<h2 id="3、docker的基本概念"><a href="#3、docker的基本概念" class="headerlink" title="3、docker的基本概念"></a>3、docker的基本概念</h2><p>Docker 包括三个基本概念:</p>
<ul>
<li><strong>镜像（Image）</strong>：Docker 镜像（Image），就相当于是一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。</li>
<li><strong>容器（Container）</strong>：镜像（Image）和容器（Container）的关系，就像是面向对象程序设计中的类和实例一样，镜像是静态的定义，容器是镜像运行时的实体。容器可以被创建、启动、停止、删除、暂停等。</li>
<li><strong>仓库（Repository）</strong>：仓库可看成一个代码控制中心，用来保存镜像。</li>
</ul>
<h2 id="4、docker容器（container）"><a href="#4、docker容器（container）" class="headerlink" title="4、docker容器（container）"></a>4、docker容器（container）</h2><h3 id="运行容器（run）"><a href="#运行容器（run）" class="headerlink" title="运行容器（run）"></a>运行容器（run）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run</span><br></pre></td></tr></table></figure>

<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><ul>
<li>-t：在新容器内指定一个伪终端或终端。</li>
<li>-i：允许你对容器内的标准输入 (STDIN) 进行交互。</li>
<li>-d：以后台模式启动容器</li>
<li>-p：容器内部端口绑定到<strong>指定</strong>的主机端口。</li>
<li>-P：容器内部端口<strong>随机</strong>映射到主机的高端口。</li>
<li>–name：命名容器</li>
</ul>
<h3 id="列出容器（ps）"><a href="#列出容器（ps）" class="headerlink" title="列出容器（ps）"></a>列出容器（ps）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p>（默认）查看<strong>正在运行</strong>的容器</p>
<p><img src="/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/image-20211216154455337.png"></p>
<p><strong>CONTAINER ID:</strong> 容器 ID。</p>
<p><strong>IMAGE:</strong> 使用的镜像。</p>
<p><strong>COMMAND:</strong> 启动容器时运行的命令。</p>
<p><strong>CREATED:</strong> 容器的创建时间。</p>
<p><strong>STATUS:</strong> 容器状态。</p>
<p>状态有7种：</p>
<ul>
<li>created（已创建）</li>
<li>restarting（重启中）</li>
<li>running 或 Up（运行中）</li>
<li>removing（迁移中）</li>
<li>paused（暂停）</li>
<li>exited（停止）</li>
<li>dead（死亡）</li>
</ul>
<p><strong>PORTS:</strong> 容器的端口信息和使用的连接类型（tcp\udp）。</p>
<p><strong>NAMES:</strong> 自动分配的容器名称。</p>
<h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><ul>
<li>-a：查看<strong>所有</strong>容器</li>
<li>-l：查询最后一次创建的容器</li>
</ul>
<h3 id="查看容器内的标准输出（logs）"><a href="#查看容器内的标准输出（logs）" class="headerlink" title="查看容器内的标准输出（logs）"></a>查看容器内的标准输出（logs）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h4 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h4><ul>
<li>-f：像<code>tail -f</code>一样来进行标准输出（追加输出正在变化的文件）</li>
</ul>
<h3 id="停止容器（stop）"><a href="#停止容器（stop）" class="headerlink" title="停止容器（stop）"></a>停止容器（stop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h3 id="重启容器（restart）"><a href="#重启容器（restart）" class="headerlink" title="重启容器（restart）"></a>重启容器（restart）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h3 id="启动停止的容器（start）"><a href="#启动停止的容器（start）" class="headerlink" title="启动停止的容器（start）"></a>启动停止的容器（start）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h3 id="进入后台运行的容器（exec）"><a href="#进入后台运行的容器（exec）" class="headerlink" title="进入后台运行的容器（exec）"></a>进入后台运行的容器（exec）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<p>根据容器编号或者容器名称来进入一个后台运行的容器</p>
<p>如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% docker <span class="built_in">exec</span> -it 5262dfdbd369 /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="导出容器为镜像（export）"><a href="#导出容器为镜像（export）" class="headerlink" title="导出容器为镜像（export）"></a>导出容器为镜像（export）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">export</span> &lt;CONTAINER ID&gt; &gt; &lt;filename&gt;</span><br></pre></td></tr></table></figure>

<p>将本地的某个容器导出为<strong>镜像</strong></p>
<p>如：到当前位置下的docker目录中，名称为ubuntu.tar</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">% docker <span class="built_in">export</span> 5262dfdbd369 &gt; ./docker/ubuntu.tar</span><br></pre></td></tr></table></figure>

<h3 id="导入镜像（import）"><a href="#导入镜像（import）" class="headerlink" title="导入镜像（import）"></a>导入镜像（import）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import</span><br></pre></td></tr></table></figure>

<p>将远程或者本地的某个容器导入为<strong>镜像</strong></p>
<p>如：将当前位置下的docker目录中的ubuntu.tar导为镜像test&#x2F;ubuntu:v1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./docker/ubuntu.tar | docker import - <span class="built_in">test</span>/ubuntu:v1</span><br></pre></td></tr></table></figure>

<p>如：从远程导入某个容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker import http://example.com/exampleimage.tgz example/imagerepo</span><br></pre></td></tr></table></figure>

<h3 id="删除容器（rm）"><a href="#删除容器（rm）" class="headerlink" title="删除容器（rm）"></a>删除容器（rm）</h3><p>（容器必须是停止状态）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<p>如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f 5262dfdbd369</span><br></pre></td></tr></table></figure>

<h3 id="查看容器映射的端口号（port）"><a href="#查看容器映射的端口号（port）" class="headerlink" title="查看容器映射的端口号（port）"></a>查看容器映射的端口号（port）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker port &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h3 id="查看容器内部运行的进程（top）"><a href="#查看容器内部运行的进程（top）" class="headerlink" title="查看容器内部运行的进程（top）"></a>查看容器内部运行的进程（top）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h3 id="查看容器的配置以及状态信息（inspect）"><a href="#查看容器的配置以及状态信息（inspect）" class="headerlink" title="查看容器的配置以及状态信息（inspect）"></a>查看容器的配置以及状态信息（inspect）</h3><p>会返回一个JSON格式的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect &lt;CONTAINER ID&gt; | &lt;NAMES&gt;</span><br></pre></td></tr></table></figure>

<h2 id="5、docker镜像（image）"><a href="#5、docker镜像（image）" class="headerlink" title="5、docker镜像（image）"></a>5、docker镜像（image）</h2><h3 id="列出镜像（images）"><a href="#列出镜像（images）" class="headerlink" title="列出镜像（images）"></a>列出镜像（images）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p>列出本机上的所有镜像</p>
<p><img src="/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/image-20211216165241664.png"></p>
<ul>
<li><strong>REPOSITORY：</strong>表示镜像的仓库源</li>
<li><strong>TAG：</strong>镜像的标签（代表该镜像的不同版本）</li>
<li><strong>IMAGE ID：</strong>镜像ID</li>
<li><strong>CREATED：</strong>镜像创建时间</li>
<li><strong>SIZE：</strong>镜像大小</li>
</ul>
<p>如：<code>ubuntu:15.10</code>即指定ubuntu的15.10版本。</p>
<p>如：<code>training/webapp</code>不指定版本，则是会默认使用latest（最近）的版本。</p>
<h3 id="拉取镜像（pull）"><a href="#拉取镜像（pull）" class="headerlink" title="拉取镜像（pull）"></a>拉取镜像（pull）</h3><p>会从dockerhub中拉取镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull</span><br></pre></td></tr></table></figure>

<p>如：下载mysql的镜像</p>
<p><img src="/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/image-20211216171635678.png"></p>
<h3 id="查看镜像（search）"><a href="#查看镜像（search）" class="headerlink" title="查看镜像（search）"></a>查看镜像（search）</h3><p>可以从dockerhub来搜索镜像，或者使用search来根据关键字搜索镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search</span><br></pre></td></tr></table></figure>

<p>如：搜索关键字<code>httpd</code></p>
<p><img src="/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/image-20211216171941131.png"></p>
<p><strong>NAME:</strong> 镜像仓库源的名称</p>
<p><strong>DESCRIPTION:</strong> 镜像的描述</p>
<p><strong>OFFICIAL:</strong> 是否 docker 官方发布</p>
<p><strong>stars:</strong> 类似 Github 里面的 star，表示点赞、喜欢的意思。</p>
<p><strong>AUTOMATED:</strong> 自动构建。</p>
<h3 id="删除镜像（rmi）"><a href="#删除镜像（rmi）" class="headerlink" title="删除镜像（rmi）"></a>删除镜像（rmi）</h3><p>（需要先移除使用到该镜像的容器）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &lt;REPOSITORY&gt; | &lt;IMAGE ID&gt;</span><br></pre></td></tr></table></figure>

<h3 id="利用commit创建镜像（commit）"><a href="#利用commit创建镜像（commit）" class="headerlink" title="利用commit创建镜像（commit）"></a>利用commit创建镜像（commit）</h3><h4 id="参数-3"><a href="#参数-3" class="headerlink" title="参数"></a>参数</h4><ul>
<li><strong>-m:</strong> 提交的描述信息</li>
<li><strong>-a:</strong> 指定镜像作者</li>
<li><strong>0824479d7fcd：</strong>容器 ID</li>
<li><strong>test&#x2F;ubuntu:v1:</strong> 指定要创建的目标镜像名</li>
</ul>
<p>在对旧的镜像进行修改后可以提交为新的镜像</p>
<ol>
<li><p>运行镜像为容器</p>
<p><code>% docker run -it ubuntu:15.10 /bin/bash</code></p>
</li>
<li><p>在容器中升级</p>
<p><code>apt-get update</code></p>
</li>
<li><p>退出容器</p>
<p><code>exit</code></p>
</li>
<li><p>将修改后的容器提交为新的镜像</p>
<p><code>% docker commit -m=&quot;ubuntu update&quot; -a=&quot;test&quot; 0824479d7fcd test/ubuntu:v1 </code></p>
</li>
</ol>
<h3 id="利用dockerfile创建镜像（build）"><a href="#利用dockerfile创建镜像（build）" class="headerlink" title="利用dockerfile创建镜像（build）"></a>利用dockerfile创建镜像（build）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build &lt;dockerfilename&gt;</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><strong>-t</strong> ：指定要创建的目标镜像名</li>
<li><strong><dockerfilename></strong> ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li>
</ul>
<p>如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t wqk/centos:6.7 ./dockerfile_test</span><br></pre></td></tr></table></figure>

<p>利用当前目录下的dockerfile_test dockerfile文件创建一个wqk&#x2F;centos:6.7镜像</p>
<h3 id="设置镜像标签（tag）"><a href="#设置镜像标签（tag）" class="headerlink" title="设置镜像标签（tag）"></a>设置镜像标签（tag）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag CONTAINER_ID AUTH_NAME/REPOSITORY_NAME:TAG</span><br></pre></td></tr></table></figure>

<p>如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag 860c279d2fec runoob/centos:dev</span><br></pre></td></tr></table></figure>

<p>docker tag 镜像ID，这里是 860c279d2fec ,用户名称、镜像源名(repository name)和新的标签名(tag)。</p>
<h2 id="6、docker-compose"><a href="#6、docker-compose" class="headerlink" title="6、docker-compose"></a>6、docker-compose</h2><p>Compose 是用于定义和运行<strong>多容器</strong> Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。</p>
<p>Compose 使用的三个步骤：</p>
<ol>
<li>使用 Dockerfile 定义应用程序的环境。</li>
<li>使用 docker-compose.yml 定义构成应用程序的服务，这样它们可以在隔离环境中一起运行。</li>
<li>最后，执行 docker-compose up 命令来启动并运行整个应用程序。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/12/17/back-end/docker/docker%E5%AD%A6%E4%B9%A0/" data-id="clto66l4k000jsck6e9mf8hjr" data-title="docker学习" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/gin" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/02/back-end/go/gin/" class="article-date">
  <time class="dt-published" datetime="2021-11-02T07:30:39.000Z" itemprop="datePublished">2021-11-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/02/back-end/go/gin/">Gin框架的学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="什么是Gin？"><a href="#什么是Gin？" class="headerlink" title="什么是Gin？"></a>什么是Gin？</h1><p>Gin 是一个用 Go (Golang) 编写的 web 框架。 它是一个类似于 <a target="_blank" rel="noopener" href="https://github.com/go-martini/martini">martini</a> 但拥有更好性能的 API 框架, 由于 <a target="_blank" rel="noopener" href="https://github.com/julienschmidt/httprouter">httprouter</a>，速度提高了近 40 倍。 如果你是性能和高效的追求者, 你会爱上 Gin。</p>
<p><a target="_blank" rel="noopener" href="https://gin-gonic.com/zh-cn/docs/introduction/">中文官方文档地址</a></p>
<h1 id="安装Gin"><a href="#安装Gin" class="headerlink" title="安装Gin"></a>安装Gin</h1><p>使用Go Modules安装Gin</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure>



<h1 id="第一个Gin应用"><a href="#第一个Gin应用" class="headerlink" title="第一个Gin应用"></a>第一个Gin应用</h1><p>创建main.go，注意目录结构，同时需要确保go.mod中已经引入gin</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">│  go.mod</span><br><span class="line">│  go.sum</span><br><span class="line">│  main.go</span><br></pre></td></tr></table></figure>

<p>main.go：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	<span class="comment">//默认的路由引擎</span></span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//检查连接</span></span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">			<span class="string">&quot;message&quot;</span>:<span class="string">&quot;gin-demo server is running by gin&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//启动Web服务</span></span><br><span class="line">	r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>利用<code>gin.Default()</code>创建默认的路由引擎<code>r</code></li>
<li><code>r.GET()</code>即是处理HTTP请求中的GET方法</li>
<li><code>r.Run()</code>加上端口号即是启动web服务</li>
</ol>
<h1 id="处理HTTP请求"><a href="#处理HTTP请求" class="headerlink" title="处理HTTP请求"></a>处理HTTP请求</h1><p>处理HTTP请求的GET方法是使用r.GET( )，第一个参数是处理的URI地址，第二个参数是具体的处理函数，上述是匿名函数的写法，你也可以写成具名函数，如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">	<span class="comment">//默认的路由引擎</span></span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	<span class="comment">//检查连接</span></span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>,index)</span><br><span class="line">    </span><br><span class="line">	<span class="comment">//启动Web服务</span></span><br><span class="line">	r.Run(<span class="string">&quot;:9090&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>:<span class="string">&quot;gin-demo server is running by gin&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同理，处理POST方法即是<code>r.POST() </code>，PUT方法是<code>r.PUT()</code>等。如果想要同时匹配全部的HTTP请求的方法，可以使用<code>r.Any()</code></p>
<h1 id="返回JSON"><a href="#返回JSON" class="headerlink" title="返回JSON"></a>返回JSON</h1><p>可以利用<code>c.JSON(code int, obj interface&#123;&#125;)</code>来返回JSON数据</p>
<p>gin内置的gin.H数据类型实际上就是Map[string]interface{}数据类型，以key-value的形式返回JSON数据</p>
<p>gin.H：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> H <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">   c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>:<span class="string">&quot;gin-demo server is running by gin&quot;</span>,</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>返回的数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gin-demo server is running by gin&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>同理返回JSON对象则是</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="type">string</span> <span class="string">`json:&quot;name,omitempty&quot; form:&quot;name&quot;`</span></span><br><span class="line">	Age     <span class="type">int</span>    <span class="string">`json:&quot;age,omitempty&quot; form:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="comment">//返回JSON对象</span></span><br><span class="line">    r.GET(<span class="string">&quot;/student&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        student := &amp;Student&#123;</span><br><span class="line">            Name:    <span class="string">&quot;student&quot;</span>,</span><br><span class="line">            Age:     <span class="number">20</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回JSON类型的对象</span></span><br><span class="line">        c.JSON(http.StatusOK,student)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回的数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;student&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>需要以JSON数据格式返回的属性的首字母需要大写（因为本质实际上就是通过反射来判断该结构体对象的字段是否能够导出），同时需要加上tag：`json:”name”`使得具体返回的字段名有tag决定，如果没有指定则是返回属性名，即Name</p>
</blockquote>
<h1 id="获取query参数（Query）"><a href="#获取query参数（Query）" class="headerlink" title="获取query参数（Query）"></a>获取query参数（Query）</h1><p>可以利用<code>c.Query(key)</code>、<code>c.GetQuery(key)</code>、<code>c.DefaultQuery(key,defaultValue)</code>来获取query中的参数</p>
<p>如：path</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9090/query?id=1&amp;name=test&amp;age=18</span><br></pre></td></tr></table></figure>

<p>则可以分别用过上述三种方式来获取参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/query&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//1、直接获取query</span></span><br><span class="line">    id := c.Query(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="comment">//2、获取query（返回value和ok）</span></span><br><span class="line">    name, _ := c.GetQuery(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    <span class="comment">//3、获取并且设置可能的默认值</span></span><br><span class="line">    age := c.DefaultQuery(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: age,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="获取form表单参数（PostForm）"><a href="#获取form表单参数（PostForm）" class="headerlink" title="获取form表单参数（PostForm）"></a>获取form表单参数（PostForm）</h1><p>可以利用<code>c.PostForm(key)</code>、<code>c.GetPostForm(key)</code>、<code>c.DefaultPostForm(key,defaultValue)</code>来获取form（POST）表单提交的参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/form&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//1、直接获取form中的value</span></span><br><span class="line">    id := c.PostForm(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="comment">//2、获取form中value（返回value和ok）</span></span><br><span class="line">    name, _ := c.GetPostForm(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    <span class="comment">//3、返回form中的value并且设置可能的默认值</span></span><br><span class="line">    age := c.DefaultPostForm(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;10&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: name,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: age,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="获取path路径参数URI（Param）"><a href="#获取path路径参数URI（Param）" class="headerlink" title="获取path路径参数URI（Param）"></a>获取path路径参数URI（Param）</h1><p>可以利用<code>c.Param(key)</code>来获取path中的参数（URI）</p>
<p>如：path</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:9090/path/10/18</span><br></pre></td></tr></table></figure>

<p>则</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//path中使用`/:param`的方式来定义路径参数</span></span><br><span class="line">r.GET(<span class="string">&quot;/path/:id/:age&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//获取路径参数</span></span><br><span class="line">    id := c.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">    <span class="comment">//params := c.Params	//可以使用c.Params来获取所有路径参数</span></span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: id,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="参数绑定至结构体（ShouldBind）"><a href="#参数绑定至结构体（ShouldBind）" class="headerlink" title="参数绑定至结构体（ShouldBind）"></a>参数绑定至结构体（ShouldBind）</h1><p>在大多数时候，返回的参数很多的情况下，如果使用Query或者PostForm去一一获取可能会比较慢，我们可以预先定义好结构体，然后在直接使用参数绑定<code>ShouldBind()</code>来使得参数能够自动匹配到结构体对象上。在这之前，我们需要先定义结构体</p>
<h2 id="定义结构体"><a href="#定义结构体" class="headerlink" title="定义结构体"></a>定义结构体</h2><p>切记：需要在结构体上加上form的tag</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">   Name    <span class="type">string</span> <span class="string">`json:&quot;name,omitempty&quot; form:&quot;name&quot;`</span></span><br><span class="line">   Age     <span class="type">int</span>    <span class="string">`json:&quot;age,omitempty&quot; form:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="绑定GET的query"><a href="#绑定GET的query" class="headerlink" title="绑定GET的query"></a>绑定GET的query</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/bindGet&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//新建空对象</span></span><br><span class="line">    <span class="keyword">var</span> s Student</span><br><span class="line">    <span class="comment">//传入对象的地址</span></span><br><span class="line">    err := c.ShouldBind(&amp;s)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">//参数绑定失败</span></span><br><span class="line">        c.JSON(http.StatusBadRequest,gin.H&#123;</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;student = %v&quot;</span>,s)</span><br><span class="line">    c.JSON(http.StatusOK,s)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="绑定POST的form"><a href="#绑定POST的form" class="headerlink" title="绑定POST的form"></a>绑定POST的form</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/bindForm&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s Student</span><br><span class="line">    err := c.ShouldBind(&amp;s)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">//参数绑定失败</span></span><br><span class="line">        c.JSON(http.StatusBadRequest,gin.H&#123;</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;student = %v&quot;</span>,s)</span><br><span class="line">    c.JSON(http.StatusOK,s)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="绑定JSON对象"><a href="#绑定JSON对象" class="headerlink" title="绑定JSON对象"></a>绑定JSON对象</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/bindJson&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s Student</span><br><span class="line">    err := c.ShouldBind(&amp;s)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">//参数绑定失败</span></span><br><span class="line">        c.JSON(http.StatusBadRequest,gin.H&#123;</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;student = %v&quot;</span>,s)</span><br><span class="line">    c.JSON(http.StatusOK,s)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>Tips</strong></p>
<p>基本上来自GET请求的query和POST请求的form对象以及json对象都能自动绑定到结构体对象上，不过需要注意的是需要传入<strong>对象的指针</strong></p>
</blockquote>
<h1 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h1><p>文件上传需要注意两个步骤</p>
<ol>
<li>从POST请求（form表单）中读取文件（需要处理错误）</li>
<li>尝试将读取到的文件保存的服务端本地（需要处理错误）</li>
</ol>
<h2 id="单个文件上传"><a href="#单个文件上传" class="headerlink" title="单个文件上传"></a>单个文件上传</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/upload&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//1、从请求中读取文件</span></span><br><span class="line">    file, err := c.FormFile(<span class="string">&quot;file&quot;</span>) <span class="comment">//根据文件的标识来获取文件（form表单的name属性）</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">//文件读取错误</span></span><br><span class="line">        c.JSON(http.StatusBadRequest,gin.H&#123;</span><br><span class="line">            <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//文件读取成功</span></span><br><span class="line">        <span class="comment">//2、到读取到的文件保存到本地（服务端）</span></span><br><span class="line">        filename := file.Filename	<span class="comment">//上传的文件的文件名</span></span><br><span class="line">        dst := path.Join(<span class="string">&quot;./&quot;</span>, filename)	<span class="comment">//将文件保存到的目标路径（`.\`，即当前目录下）</span></span><br><span class="line">        err := c.SaveUploadedFile(file, dst)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="comment">//文件保存到本地失败</span></span><br><span class="line">            c.JSON(http.StatusBadRequest,gin.H&#123;</span><br><span class="line">                <span class="string">&quot;error&quot;</span>: err.Error(),</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//文件保存到本地成功</span></span><br><span class="line">            c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: filename+<span class="string">&quot; 上传成功&quot;</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="多个文件上传"><a href="#多个文件上传" class="headerlink" title="多个文件上传"></a>多个文件上传</h2><p>多个文件上传只不过就是需要获取到文件列表，然后迭代文件列表并依次存储到本地服务器</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">r.POST(<span class="string">&quot;/uploadList&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//拿到form表单对象</span></span><br><span class="line">    form, _ := c.MultipartForm()</span><br><span class="line">    <span class="comment">//根据form表单对象Map获取到file文件列表（根据form的name属性来获取）</span></span><br><span class="line">    fileList := form.File[<span class="string">&quot;file&quot;</span>]</span><br><span class="line">    <span class="comment">//循环文件列表</span></span><br><span class="line">    <span class="keyword">for</span> _, file := <span class="keyword">range</span> fileList &#123;</span><br><span class="line">        <span class="comment">//得到文件名</span></span><br><span class="line">        filename := file.Filename</span><br><span class="line">        dst := path.Join(<span class="string">&quot;./&quot;</span>,filename)</span><br><span class="line">        c.SaveUploadedFile(file,dst)	<span class="comment">//存储到服务端本地</span></span><br><span class="line">    &#125;</span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;上传成功&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>无论是单文件上传还是多文件上传，都是先根据form表单的name属性来获取到文件或者文件列表，如果是文件列表则迭代文件列表，再将单个文件通过<code>SaveUploadedFile(file,dst)</code>来存储到本地</p>
</blockquote>
<h1 id="请求重定向，请求转发"><a href="#请求重定向，请求转发" class="headerlink" title="请求重定向，请求转发"></a>请求重定向，请求转发</h1><h2 id="HTTP重定向"><a href="#HTTP重定向" class="headerlink" title="HTTP重定向"></a>HTTP重定向</h2><p>将该HTTP请求（GET、POST均可）重定向到某个具体的location</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/redirectGet&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//注意第二个参数location需要加上协议名称（也就是http://）</span></span><br><span class="line">    <span class="comment">//跳转到baidu</span></span><br><span class="line">   c.Redirect(http.StatusMovedPermanently,<span class="string">&quot;http://www.baidu.com/&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="请求转发（路由重定向）"><a href="#请求转发（路由重定向）" class="headerlink" title="请求转发（路由重定向）"></a>请求转发（路由重定向）</h2><p>将该HTTP请求交由本服务的其他路由来处理，即请求转发</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/redirectLocal&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">//路由重定向到本机的`/`请求，交由它处理</span></span><br><span class="line">    c.Request.URL.Path = <span class="string">&quot;/&quot;</span></span><br><span class="line">    r.HandleContext(c)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h1 id="路由、路由组、路由组嵌套"><a href="#路由、路由组、路由组嵌套" class="headerlink" title="路由、路由组、路由组嵌套"></a>路由、路由组、路由组嵌套</h1><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>在Gin中，像如下这样的处理HTTP请求的叫做一个<strong>路由</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;gin-router server is running by gin&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>r.GET()</code>、<code>r.POST()</code>、<code>r.Any()</code>等</p>
<h2 id="路由组"><a href="#路由组" class="headerlink" title="路由组"></a>路由组</h2><p>前缀相同的HTTP请求可以组合成路由组，更加直观</p>
<p>非路由组形式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/user/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">r.GET(<span class="string">&quot;/user/about&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">r.GET(<span class="string">&quot;/user/detail&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>等价于</strong></p>
<p>路由组形式（<code>r.Group()</code>）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">userGroup := r.Group(<span class="string">&quot;/user&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//省略路由组，等价于访问/user/index</span></span><br><span class="line">    userGroup.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">    userGroup.GET(<span class="string">&quot;/about&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">    userGroup.GET(<span class="string">&quot;/detail&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="路由组嵌套"><a href="#路由组嵌套" class="headerlink" title="路由组嵌套"></a>路由组嵌套</h2><p>同时路由组还支持嵌套</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 匹配/v1/api</span></span><br><span class="line">    v1.GET(<span class="string">&quot;/api&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">    v2 := v1.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//匹配/v1/v2/api</span></span><br><span class="line">        v2.GET(<span class="string">&quot;/api&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Gin中间件"><a href="#Gin中间件" class="headerlink" title="Gin中间件"></a>Gin中间件</h1><p> Gin框架允许开发者在处理请求过程中，加入开发者自己的钩子（Hook）函数。这个钩子函数就叫中间件，中间件适合处理一些<strong>公共的业务逻辑</strong>，如登录认证、权限校验、数据分页、记录日志、耗时统计等。</p>
<h2 id="定义中间件（两种方式）"><a href="#定义中间件（两种方式）" class="headerlink" title="定义中间件（两种方式）"></a>定义中间件（两种方式）</h2><p>Gin的中间件必须是一个<code>gin.HandlerFunc</code>类型</p>
<p>如m1中间件（定义方式一）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义中间件方式一（不可以传递额外参数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;m1 start&quot;</span>)</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;m1 end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>m2中间件（定义方式二）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义中间件方式二（可以传递额外参数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;m2 start&quot;</span>)</span><br><span class="line">		<span class="comment">// do something</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;m2 end&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>根据中间件的定义方式一我们不难发现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">		<span class="string">&quot;message&quot;</span>: <span class="string">&quot;gin-middle server is running by gin&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在处理GET请求中的匿名函数其实也是一个比较特殊的gin.HandlerFunc，即最后一个中间件</p>
</blockquote>
<h2 id="路由使用中间件"><a href="#路由使用中间件" class="headerlink" title="路由使用中间件"></a>路由使用中间件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET(relativePath <span class="type">string</span>, handlers ...HandlerFunc)</span><br><span class="line"><span class="comment">// GET方法的第二个形参是多个HandlerFunc</span></span><br></pre></td></tr></table></figure>

<p>所以我们可以给GET方法加上多个gin.HandlerFunc来使用中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, m1, m2(), <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;index start&quot;</span>)</span><br><span class="line">    c.JSON(http.StatusOK,gin.H&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;gin-middle server is running by gin&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    fmt.Println(<span class="string">&quot;index end&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>中间件执行顺序：</p>
<p><img src="/2021/11/02/back-end/go/gin/image-20211101001619382.png"></p>
<p>m1中间件执行完毕-&gt;m2中间件执行完毕-&gt;匿名函数执行完毕</p>
<h2 id="全局注册中间件"><a href="#全局注册中间件" class="headerlink" title="全局注册中间件"></a>全局注册中间件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注册全局中间件</span></span><br><span class="line">r.Use(m1)	<span class="comment">//给全局路由注册m1中间件</span></span><br></pre></td></tr></table></figure>



<h2 id="路由组注册中间件（两种方式）"><a href="#路由组注册中间件（两种方式）" class="headerlink" title="路由组注册中间件（两种方式）"></a>路由组注册中间件（两种方式）</h2><p>1、<code>r.Group()</code>注册中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//user路由组（并且使用m2中间件）</span></span><br><span class="line">userGroup := r.Group(<span class="string">&quot;/user&quot;</span>,m2())</span><br><span class="line">&#123;</span><br><span class="line">    userGroup.GET(<span class="string">&quot;/v1&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 start&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 end&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    userGroup.GET(<span class="string">&quot;/v2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 start&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 end&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、<code>Use()</code>注册中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//user路由组</span></span><br><span class="line">userGroup := r.Group(<span class="string">&quot;/user&quot;</span>)</span><br><span class="line">userGroup.Use(m2())	<span class="comment">//user路由组注册m2中间件</span></span><br><span class="line">&#123;</span><br><span class="line">    userGroup.GET(<span class="string">&quot;/v1&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 start&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 end&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    userGroup.GET(<span class="string">&quot;/v2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 start&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;/user/v1 end&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="c-Next"><a href="#c-Next" class="headerlink" title="c.Next( )"></a>c.Next( )</h2><p>可以在中间件中使用<code>Next()</code>来&#x3D;&#x3D;立即&#x3D;&#x3D;调用下一中间件，如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义中间件方式一（不可以传递额外参数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;m1 start&quot;</span>)</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">	c.Next()</span><br><span class="line">	fmt.Println(<span class="string">&quot;m1 end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义中间件方式二（可以传递额外参数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;m2 start&quot;</span>)</span><br><span class="line">		<span class="comment">// do something</span></span><br><span class="line">		c.Next()</span><br><span class="line">		fmt.Println(<span class="string">&quot;m2 end&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;/ start&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;/ end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	r.GET(<span class="string">&quot;/&quot;</span>,m1,m2(),index)</span><br><span class="line">	r.Run(<span class="string">&quot;:9092&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2021/11/02/back-end/go/gin/image-20211101010341834.png"></p>
<p><img src="/2021/11/02/back-end/go/gin/image-20211101010809794.png"></p>
<p>可以观察到，中间件A执行<code>c.Next()</code>会立马执行下一中间件B，待中间件B执行完毕后再接着执行中间件A剩余的代码（类似栈调用）</p>
<p><strong>应用场景</strong>：时常做 一些判断，然后&#x3D;&#x3D;中途&#x3D;&#x3D;放行到下一中间件</p>
<blockquote>
<p><strong>Tips</strong></p>
<p>如果不在代码中间加<code>c.Next()</code>照样会进入到下一中间件，只是会将当前中间件<strong>执行完毕后</strong>再执行下一中间件。</p>
</blockquote>
<h2 id="c-Abort"><a href="#c-Abort" class="headerlink" title="c.Abort( )"></a>c.Abort( )</h2><p>可以在中间件中使用<code>c.Abort()</code>来阻断进入下一中间件</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义中间件方式一（不可以传递额外参数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 start&quot;</span>)</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义中间件方式二（可以传递额外参数）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;m2 start&quot;</span>)</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        c.Abort()	<span class="comment">//阻止进入下一中间件</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;m2 end&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;/ start&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;/ end&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    r.GET(<span class="string">&quot;/&quot;</span>,m1,m2(),index)</span><br><span class="line">    r.Run(<span class="string">&quot;:9092&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2021/11/02/back-end/go/gin/image-20211101011640419.png"></p>
<p>并没有执行index函数，而是被阻断了，并且执行完了m2中间件</p>
<blockquote>
<p><strong>配合return</strong></p>
<p>直接中断处理</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;m2 start&quot;</span>)</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        c.Abort()</span><br><span class="line">        <span class="keyword">return</span>	<span class="comment">//直接中断整个过程</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;m2 end&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2021/11/02/back-end/go/gin/image-20211101011826004.png"></p>
<p>如果在<code>c.Abort()</code>后直接加上return，可以发现m2中间件也没有接着执行，而是被中断。</p>
<p>加不加return的区别就是return会立马阻断当前中间件，不会接着执行当前中间件的逻辑，不加return则是阻断下一中间件，当前中间件仍会接着执行</p>
</blockquote>
<p><strong>应用场景</strong>：可以做一些拦截操作，比如用户认证不通过，然后直接进行拦截</p>
<h2 id="中间件执行顺序"><a href="#中间件执行顺序" class="headerlink" title="中间件执行顺序"></a>中间件执行顺序</h2><p>中间件一定会按照顺序依次进入下一中间件，只是<code>Next()</code>或者<code>Abort()</code>会<strong>提前</strong>进入下一中间件或者<strong>阻断</strong>进入下一中间件</p>
<h2 id="中间件上下文参数传递"><a href="#中间件上下文参数传递" class="headerlink" title="中间件上下文参数传递"></a>中间件上下文参数传递</h2><p>可以在当前中间件利用<code>c.Set()</code>存值，然后在接下来的中间件利用<code>c.Get()</code>取值。</p>
<h3 id="Set存值"><a href="#Set存值" class="headerlink" title="Set存值"></a>Set存值</h3><p>Set(key,value)，value是<code>interface&#123;&#125;</code>类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m1</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 start&quot;</span>)</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    c.Set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;test&quot;</span>)</span><br><span class="line">    c.Next()</span><br><span class="line">    fmt.Println(<span class="string">&quot;m1 end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Get取值（推荐）"><a href="#Get取值（推荐）" class="headerlink" title="Get取值（推荐）"></a>Get取值（推荐）</h3><p>利用Get(key)取值，第一个返回值是value，第二个返回值是是否存在(bool)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">m2</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;m2 start&quot;</span>)</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        name, _ := c.Get(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">        fmt.Println(<span class="string">&quot;name =&quot;</span>,name)</span><br><span class="line">        c.Abort()</span><br><span class="line">        <span class="comment">//return	//直接中断整个过程</span></span><br><span class="line">        fmt.Println(<span class="string">&quot;m2 end&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>如果value不存在，则value &#x3D; nil</p>
</blockquote>
<h3 id="MustGet取值"><a href="#MustGet取值" class="headerlink" title="MustGet取值"></a>MustGet取值</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;/ start&quot;</span>)</span><br><span class="line">    name := c.MustGet(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;name =&quot;</span>,name)</span><br><span class="line">    fmt.Println(<span class="string">&quot;/ end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>如果value不存在，则会抛出panic错误</p>
</blockquote>
<h2 id="Gin路由默认的中间件"><a href="#Gin路由默认的中间件" class="headerlink" title="Gin路由默认的中间件"></a>Gin路由默认的中间件</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">()</span></span> *Engine &#123;</span><br><span class="line">    debugPrintWARNINGDefault()</span><br><span class="line">    engine := New()</span><br><span class="line">    engine.Use(Logger(), Recovery())</span><br><span class="line">    <span class="keyword">return</span> engine</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据<code>gin.Default()</code>源码可以看到，gin默认为我们添加了Logger和Recovery中间件。如果不想使用默认的中间件，则可以利用<code>gin.New()</code>创建初始没有任何中间件的路由引擎。</p>
<p>其中：</p>
<ul>
<li>Logger中间件会将日志写入gin.DefaultWriter，即使配置了GIN_MODE&#x3D;release</li>
<li>Recovery中间件会recover任何panic。并且会返回500响应码</li>
</ul>
<h2 id="在中间件中使用goroutine"><a href="#在中间件中使用goroutine" class="headerlink" title="在中间件中使用goroutine"></a>在中间件中使用goroutine</h2><p>在中间件中使用c的话，只能使用原始的<code>(c *gin.Context)</code>，只能使用<code>c.copy()</code></p>
<h2 id="手写中间件来计算响应耗时"><a href="#手写中间件来计算响应耗时" class="headerlink" title="手写中间件来计算响应耗时"></a>手写中间件来计算响应耗时</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//中间件：计算响应耗时</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">takeTime</span><span class="params">(c *gin.Context)</span></span>  &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;takeTime start&quot;</span>)</span><br><span class="line">    start := time.Now()			<span class="comment">//开始时间</span></span><br><span class="line">    c.Next()	<span class="comment">//进入下一中间件</span></span><br><span class="line">    since := time.Since(start)	<span class="comment">//从start开始过了多长时间（即花费了多少时间）</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;since = %v\n&quot;</span>,since)</span><br><span class="line">    fmt.Println(<span class="string">&quot;takeTime end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/11/02/back-end/go/gin/" data-id="clto66l4n000nsck6e97he8cb" data-title="Gin框架的学习" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/Java的序列化和反序列化/序列化" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/28/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/" class="article-date">
  <time class="dt-published" datetime="2021-10-28T07:30:39.000Z" itemprop="datePublished">2021-10-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/28/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/">Java的序列化和反序列化</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是序列化和反序列化？"><a href="#什么是序列化和反序列化？" class="headerlink" title="什么是序列化和反序列化？"></a>什么是序列化和反序列化？</h2><ul>
<li><strong>序列化（Serialize）</strong>指将Java对象存储到硬盘文件（流）中的过程，即保存当前Java的状态。</li>
<li><strong>反序列化（Deserialize）</strong>指将序列化的对象转为Java对象。</li>
</ul>
<h2 id="实现对象序列化和反序列化"><a href="#实现对象序列化和反序列化" class="headerlink" title="实现对象序列化和反序列化"></a>实现对象序列化和反序列化</h2><p>需要实现序列化和反序列化的Java对象需要实现<code>Serializable</code>接口（该接口没有任何方法需要实现，是个标志接口，即交由JVM识别的类）</p>
<p>Student.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="序列化Java对象"><a href="#序列化Java对象" class="headerlink" title="序列化Java对象"></a>序列化Java对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSerialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、创建Java对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="comment">//2、创建流来尝试写入文件中</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;student&quot;</span>));</span><br><span class="line">        <span class="comment">//3、将Java对象通过流写入文件</span></span><br><span class="line">        oos.writeObject(student);</span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此，student对象就存在与名叫student的文件中了</p>
<h2 id="反序列化Java对象"><a href="#反序列化Java对象" class="headerlink" title="反序列化Java对象"></a>反序列化Java对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDeserialize</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、输入流</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;student&quot;</span>));</span><br><span class="line">        <span class="comment">//2、从流中读出Java对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;object = &quot;</span> + object);</span><br><span class="line">        <span class="comment">//3、将读出来的Java对象强转为Student对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student)object;</span><br><span class="line">        System.out.println(<span class="string">&quot;student = &quot;</span> + student);</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="序列化多个对象"><a href="#序列化多个对象" class="headerlink" title="序列化多个对象"></a>序列化多个对象</h2><p>可以利用集合来序列化多个对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestSerialize2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、创建Java对象</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test1&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test2&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;test3&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        ArrayList&lt;Student&gt; students = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Student&gt;();</span><br><span class="line">        <span class="comment">//2、添加到集合当中</span></span><br><span class="line">        students.add(s1);</span><br><span class="line">        students.add(s2);</span><br><span class="line">        students.add(s3);</span><br><span class="line">        <span class="comment">//3、创建流来尝试写入文件中</span></span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;students&quot;</span>));</span><br><span class="line">        <span class="comment">//4、写入文件中</span></span><br><span class="line">        oos.writeObject(students);</span><br><span class="line">        oos.flush();</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，students集合就被写入了名叫students的文件中了</p>
<h2 id="反序列化集合"><a href="#反序列化集合" class="headerlink" title="反序列化集合"></a>反序列化集合</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDeserialize2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1、输入流</span></span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;students&quot;</span>));</span><br><span class="line">        <span class="comment">//2、从流中读出Java对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;object = &quot;</span> + object);</span><br><span class="line">        <span class="comment">//3、将Java对象强转为List&lt;Student&gt;</span></span><br><span class="line">        List&lt;Student&gt; students = (List&lt;Student&gt;)object;</span><br><span class="line">        System.out.println(<span class="string">&quot;students = &quot;</span> + students);</span><br><span class="line">        <span class="comment">//关闭流</span></span><br><span class="line">        ois.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>Tips</strong></p>
<p>因为本身Java的集合都实现了Serializable接口，所以Java的集合本身也支持序列化和反序列化。</p>
</blockquote>
<h2 id="transient关键字"><a href="#transient关键字" class="headerlink" title="transient关键字"></a>transient关键字</h2><p>在实现了Serializable接口的属性上加上<code>transient</code>关键字，则该对象的该属性在被序列化时会被忽略，即不会被序列化</p>
<p>Student.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="type">int</span> age;		<span class="comment">//该属性不会被序列化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在经过正常的序列化流程后，反序列化读出来的Student对象的age属性会是该属性的基本数据类型的默认值：<img src="/2021/10/28/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/image-20211027220942269.png"></p>
<h2 id="序列化版本号"><a href="#序列化版本号" class="headerlink" title="序列化版本号"></a>序列化版本号</h2><p>自动生成序列化版本号可以标识类的唯一，建议手写序列化版本号。</p>
<blockquote>
<p><strong>Tips</strong></p>
<p>Java比较两个类是否相同：</p>
<ol>
<li>先比较包名、类名</li>
<li>再比较序列化版本号</li>
</ol>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/10/28/back-end/Java/Java%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/%E5%BA%8F%E5%88%97%E5%8C%96/" data-id="clto66l5e0020sck67tmc4doe" data-title="Java的序列化和反序列化" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Redis/redis入门/redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/08/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/" class="article-date">
  <time class="dt-published" datetime="2021-10-08T07:30:39.000Z" itemprop="datePublished">2021-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/08/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/">Redis原理和Jedis</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Redis是什么？"><a href="#Redis是什么？" class="headerlink" title="Redis是什么？"></a>Redis是什么？</h2><p>Redis 是完全开源的，遵守 BSD 协议，是一个高性能的 <strong>key-value 数据库</strong>。（B&#x2F;S架构）</p>
<p>Redis 与其他 key - value 缓存产品有以下三个特点：</p>
<ul>
<li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>
</ul>
<h2 id="Redis的优势"><a href="#Redis的优势" class="headerlink" title="Redis的优势"></a>Redis的优势</h2><ul>
<li><strong>性能极高</strong> – Redis能读的速度是110000次&#x2F;s,写的速度是81000次&#x2F;s 。</li>
<li><strong>丰富的数据类型</strong> – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>
<li><strong>原子</strong> – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>
<li>丰富的特性 – Redis还支持 publish&#x2F;subscribe, 通知, key 过期等等特性。</li>
</ul>
<h2 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h2><h3 id="Windows环境下安装"><a href="#Windows环境下安装" class="headerlink" title="Windows环境下安装"></a>Windows环境下安装</h3><ol>
<li><p>下载压缩包</p>
<p>github：<a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></p>
</li>
<li><p>解压缩</p>
</li>
<li><p>配置环境变量</p>
<p>添加REDIS_HOME系统变量：<img src="/2021/10/08/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/image-20210915225059349.png"></p>
<p>再配置环境变量path（即在path中添加）：<img src="/2021/10/08/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/image-20210915225208358.png"></p>
</li>
<li><p>试运行</p>
<p>尝试在任何地方使用cmd运行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure>

<p>如果出现如下内容则证明redis安装成功并且环境变量配置成功：<img src="/2021/10/08/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/image-20210915225404024.png"></p>
</li>
</ol>
<h3 id="linux环境下安装"><a href="#linux环境下安装" class="headerlink" title="linux环境下安装"></a>linux环境下安装</h3><blockquote>
<p>Redis默认端口号：6379</p>
</blockquote>
<h2 id="Redis服务端"><a href="#Redis服务端" class="headerlink" title="Redis服务端"></a>Redis服务端</h2><h3 id="服务端启动Redis服务"><a href="#服务端启动Redis服务" class="headerlink" title="服务端启动Redis服务"></a>服务端启动Redis服务</h3><ol>
<li><p>前台启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure>


</li>
<li><p>后台启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server &amp;</span><br></pre></td></tr></table></figure>


</li>
<li><p>指定配置文件启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server &lt;config_name&gt; [&amp;] (是否后台启动)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="服务端停止Redis服务"><a href="#服务端停止Redis服务" class="headerlink" title="服务端停止Redis服务"></a>服务端停止Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure>



<h2 id="Redis客户端"><a href="#Redis客户端" class="headerlink" title="Redis客户端"></a>Redis客户端</h2><p>Redis分为客户端和服务端。客户端用于连接Redis服务，并且向Redis服务端发送命令。</p>
<h3 id="启动cli客户端"><a href="#启动cli客户端" class="headerlink" title="启动cli客户端"></a>启动cli客户端</h3><p>使用以下命令即可启动redis的客户端程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli   		<span class="comment">#默认连接127.0.0.1:6379的redis服务</span></span><br><span class="line">	[-p port]		<span class="comment">#指定端口号</span></span><br><span class="line">	[-h hostname]	<span class="comment">#指定主机地址</span></span><br></pre></td></tr></table></figure>



<h3 id="退出cli客户端"><a href="#退出cli客户端" class="headerlink" title="退出cli客户端"></a>退出cli客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span> [quit]</span><br></pre></td></tr></table></figure>



<h2 id="Redis基本知识"><a href="#Redis基本知识" class="headerlink" title="Redis基本知识"></a>Redis基本知识</h2><h3 id="服务端测试Redis性能"><a href="#服务端测试Redis性能" class="headerlink" title="服务端测试Redis性能"></a>服务端测试Redis性能</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark</span><br></pre></td></tr></table></figure>

<h3 id="客户端查看Redis服务是否正常运行"><a href="#客户端查看Redis服务是否正常运行" class="headerlink" title="客户端查看Redis服务是否正常运行"></a>客户端查看Redis服务是否正常运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;ping</span><br><span class="line">PONG	<span class="comment">#返回PONG说明Redis服务正常运行</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端查看Redis服务的统计信息"><a href="#客户端查看Redis服务的统计信息" class="headerlink" title="客户端查看Redis服务的统计信息"></a>客户端查看Redis服务的统计信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;info	<span class="comment">#返回redis服务的所有相关信息</span></span><br><span class="line">	[section]			<span class="comment">#查看具体某一指定端的信息</span></span><br></pre></td></tr></table></figure>

<h3 id="Redis数据库实例"><a href="#Redis数据库实例" class="headerlink" title="Redis数据库实例"></a>Redis数据库实例</h3><p>Redis的数据库实例只能由Redis服务来创建和维护，开发人员不能修改和自行创建数据库实例。默认情况下，Redis会自动创建16个数据库实例，并且这些数据库实例由编号来区别，由0—15来使用。Redis的数据库实例本身占用的存储空间很少。Redis客户端默认连接的是编号为0的数据库实例。</p>
<h4 id="客户端切换数据库实例"><a href="#客户端切换数据库实例" class="headerlink" title="客户端切换数据库实例"></a>客户端切换数据库实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;<span class="keyword">select</span> [index]	<span class="comment">#根据编号切换数据库实例</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端查看数据库实例记录数（key的数量）"><a href="#客户端查看数据库实例记录数（key的数量）" class="headerlink" title="客户端查看数据库实例记录数（key的数量）"></a>客户端查看数据库实例记录数（key的数量）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 2					<span class="comment">#返回key的数量		</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端查看当前数据库实例所有key"><a href="#客户端查看当前数据库实例所有key" class="headerlink" title="客户端查看当前数据库实例所有key"></a>客户端查看当前数据库实例所有key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;keys [pattern] [*] <span class="comment"># * 所有</span></span><br><span class="line">1) <span class="string">&quot;key:__rand_int__&quot;</span>	</span><br><span class="line">2) <span class="string">&quot;k1&quot;</span>						<span class="comment">#返回有哪些key</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端清空当前数据库实例"><a href="#客户端清空当前数据库实例" class="headerlink" title="客户端清空当前数据库实例"></a>客户端清空当前数据库实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;flushdb</span><br></pre></td></tr></table></figure>

<h4 id="客户端清空所有数据库实例"><a href="#客户端清空所有数据库实例" class="headerlink" title="客户端清空所有数据库实例"></a>客户端清空所有数据库实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;flushall</span><br></pre></td></tr></table></figure>

<h4 id="客户端查看当前Redis服务的配置信息"><a href="#客户端查看当前Redis服务的配置信息" class="headerlink" title="客户端查看当前Redis服务的配置信息"></a>客户端查看当前Redis服务的配置信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;config get [param] [*]</span><br></pre></td></tr></table></figure>

<h2 id="Redis的五种数据结构"><a href="#Redis的五种数据结构" class="headerlink" title="Redis的五种数据结构"></a>Redis的五种数据结构</h2><p>Redis支持五种数据类型：string（字符串），list（列表），hash（哈希），set（集合）及zset(sorted set：有序集合)。</p>
<h3 id="string（字符串）"><a href="#string（字符串）" class="headerlink" title="string（字符串）"></a>string（字符串）</h3><p>string是redis最基本的类型，一个key对应一个value，是<strong>二进制安全</strong>的。可以包含任何数据，比如jpg图片或者序列化的对象。</p>
<p>最大能存储<strong>512MB</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">set</span> key value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SET runoob <span class="string">&quot;菜鸟教程&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; GET runoob</span><br><span class="line"><span class="string">&quot;菜鸟教程&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="list（列表）"><a href="#list（列表）" class="headerlink" title="list（列表）"></a>list（列表）</h3><p>简单的字符串列表，按照<strong>插入顺序</strong>排序，可以添加元素到头部或者尾部</p>
<p>列表最多可存储 2^32^ - 1 元素 (4294967295, 每个列表可存储40多亿)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; lpush key member</span><br><span class="line">cli&gt; lrange key start end <span class="comment">#从start到end遍历key列表</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lpush runoob redis</span><br><span class="line">127.0.0.1:6379&gt; lpush runoob mongodb</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange runoob 0 10</span><br><span class="line">1) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">2) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="set（集合）"><a href="#set（集合）" class="headerlink" title="set（集合）"></a>set（集合）</h3><p>字符串的<strong>无序</strong>集合（基于哈希表实现，故不能插入重复的value）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sadd key member	<span class="comment">#成功返回1，失败返回0（如重复）</span></span><br><span class="line">cli&gt; smembers key		<span class="comment">#遍历key集合</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; sadd runoob redis</span><br><span class="line">127.0.0.1:6379&gt; sadd runoob mongodb</span><br><span class="line">127.0.0.1:6379&gt; smembers runoob	</span><br><span class="line">1) <span class="string">&quot;redis&quot;</span></span><br><span class="line">2) <span class="string">&quot;mongodb&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="hash（哈希）"><a href="#hash（哈希）" class="headerlink" title="hash（哈希）"></a>hash（哈希）</h3><p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象。</p>
<p>每个 hash 可以存储 2^32^ -1 键值对（40多亿）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#存入key对象，其中属性field1的值为value1，属性filed2的值为value2</span></span><br><span class="line">cli&gt; HMSET key field1 value1 field2 value2</span><br><span class="line"><span class="comment">#获取key对象中属性为filed的值value</span></span><br><span class="line">cli&gt; HGET key filed</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; HMSET runoob field1 <span class="string">&quot;Hello&quot;</span> field2 <span class="string">&quot;World&quot;</span></span><br><span class="line"><span class="string">&quot;OK&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HGET runoob field1</span><br><span class="line"><span class="string">&quot;Hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HGET runoob field2</span><br><span class="line"><span class="string">&quot;World&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="zset（有序集合）"><a href="#zset（有序集合）" class="headerlink" title="zset（有序集合）"></a>zset（有序集合）</h3><p>Redis zset 和 set 一样也是string类型元素的集合,且<strong>不允许重复</strong>的成员。</p>
<p>不同的是每个元素都会<strong>关联</strong>一个double类型的分数（score）。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p>zset的成员是唯一的,但分数(score)却可以重复。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zadd key score member</span><br><span class="line">cli&gt; zrangebyscore key start end <span class="comment">#根据具体分数（score必须在start和end范围内）排序</span></span><br><span class="line">cli&gt; zrange key start end		 <span class="comment">#排序（根据分数）</span></span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 redis</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 mongodb</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 rabbitmq</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 rabbitmq</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZRANGEBYSCORE runoob 0 1000</span><br><span class="line">1) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">2) <span class="string">&quot;rabbitmq&quot;</span></span><br><span class="line">3) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="Redis命令的基本语法"><a href="#Redis命令的基本语法" class="headerlink" title="Redis命令的基本语法"></a>Redis命令的基本语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; COMMAND KEY_NAME</span><br></pre></td></tr></table></figure>

<p><strong>COMMAND</strong>是命令，<strong>KEY_NAME</strong>是键</p>
<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; DEL runoobkey</span><br></pre></td></tr></table></figure>

<p><strong>DEL</strong>是删除命令，<strong>runoobkey</strong>是一个键，该命令的目的是删除runoobkey</p>
<h2 id="Redis关于key的命令"><a href="#Redis关于key的命令" class="headerlink" title="Redis关于key的命令"></a><span id="redis-key">Redis关于key的命令</span></h2><h3 id="查询key的命令（keys）"><a href="#查询key的命令（keys）" class="headerlink" title="查询key的命令（keys）"></a>查询key的命令（keys）</h3><p>基本语法格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; keys [pattern]		<span class="comment">#pattern是匹配规则</span></span><br><span class="line">		[*]			<span class="comment">#匹配0个或者多个字符</span></span><br><span class="line">		[?]			<span class="comment">#只匹配1个字符</span></span><br><span class="line">		[[]]		<span class="comment">#只匹配[]中的1个字符</span></span><br><span class="line">		[a*]		<span class="comment">#以&#x27;a&#x27;字符开始的key</span></span><br><span class="line">		[a*b]		<span class="comment">#以&#x27;a&#x27;开始，&#x27;b&#x27;结尾的key</span></span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *				<span class="comment">#查看所有key</span></span><br><span class="line">1) <span class="string">&quot;ageZset&quot;</span></span><br><span class="line">2) <span class="string">&quot;name&quot;</span></span><br><span class="line">3) <span class="string">&quot;osList&quot;</span></span><br><span class="line">4) <span class="string">&quot;citySet&quot;</span></span><br><span class="line">5) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">6) <span class="string">&quot;k1&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys k*				<span class="comment">#查看以&#x27;k&#x27;字符开头的key</span></span><br><span class="line">1) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys a*t			<span class="comment">#查看以&#x27;a&#x27;开头，t结尾的key</span></span><br><span class="line">1) <span class="string">&quot;ageZset&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys n?me			<span class="comment">#查看第1个字符为n，第34字符为me的key</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys n[abc]me 		<span class="comment">#查看第1个字符为n，第2个字符为[abc]其中一个，第34字符为me的key</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="判断key是否存在（exists）"><a href="#判断key是否存在（exists）" class="headerlink" title="判断key是否存在（exists）"></a>判断key是否存在（exists）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; exists key	[key key key...]		<span class="comment">#判断key是否存在</span></span><br><span class="line"><span class="comment">#存在返回1（或存在的数量），否则返回0</span></span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; exists name osList ageZset citySet</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; exists name osList ageZset citySet <span class="built_in">test</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>



<h3 id="移动key到指定的数据库实例（move）"><a href="#移动key到指定的数据库实例（move）" class="headerlink" title="移动key到指定的数据库实例（move）"></a>移动key到指定的数据库实例（move）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; move key index					  	<span class="comment">#移动key到index数据库实例</span></span><br></pre></td></tr></table></figure>



<h3 id="查看key剩余生存时间（ttl）"><a href="#查看key剩余生存时间（ttl）" class="headerlink" title="查看key剩余生存时间（ttl）"></a>查看key剩余生存时间（ttl）</h3><p>单位是秒。（TTL：time to live）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; ttl key							<span class="comment">#查看key的剩余生存时间</span></span><br><span class="line"><span class="comment">#返回-1，永不过期（默认）</span></span><br><span class="line"><span class="comment">#返回-2，key不存在</span></span><br></pre></td></tr></table></figure>



<h3 id="设置定key的生存时间（expire）"><a href="#设置定key的生存时间（expire）" class="headerlink" title="设置定key的生存时间（expire）"></a>设置定key的生存时间（expire）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; expire key seconds					<span class="comment">#给key设置生存时间seconds秒（超出即被删除）</span></span><br></pre></td></tr></table></figure>



<h3 id="查看key的数据类型（type）"><a href="#查看key的数据类型（type）" class="headerlink" title="查看key的数据类型（type）"></a>查看key的数据类型（type）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">type</span> key								<span class="comment">#查看key的数据类型</span></span><br></pre></td></tr></table></figure>



<h3 id="重命名key（rename）"><a href="#重命名key（rename）" class="headerlink" title="重命名key（rename）"></a>重命名key（rename）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; rename key newkey</span><br></pre></td></tr></table></figure>



<h3 id="删除key（del）"><a href="#删除key（del）" class="headerlink" title="删除key（del）"></a>删除key（del）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; del key [key key key...]</span><br><span class="line">	<span class="comment">#返回成功删除key的条数</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>增</li>
<li>删<ul>
<li>del：删除key</li>
</ul>
</li>
<li>改<ul>
<li>move：移动key</li>
<li>expire：设置key的生存时间</li>
<li>rename：重命名</li>
</ul>
</li>
<li>查<ul>
<li>keys：查询key</li>
<li>exists：判断key是否存在</li>
<li>ttl：查询key的剩余生存时间</li>
<li>type：查看key的数据类型</li>
</ul>
</li>
</ul>
<h2 id="Redis操作string类型"><a href="#Redis操作string类型" class="headerlink" title="Redis操作string类型"></a><span id="redis-string">Redis操作string类型</span></h2><p>单key——单value</p>
<h3 id="存string类型数据（set）"><a href="#存string类型数据（set）" class="headerlink" title="存string类型数据（set）"></a>存string类型数据（set）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">set</span> key value</span><br><span class="line">		<span class="comment">#如果key已经存在，会发生覆盖</span></span><br></pre></td></tr></table></figure>

<h3 id="取string类型数据（get）"><a href="#取string类型数据（get）" class="headerlink" title="取string类型数据（get）"></a>取string类型数据（get）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; get key</span><br></pre></td></tr></table></figure>

<h3 id="追加字符串（append）"><a href="#追加字符串（append）" class="headerlink" title="追加字符串（append）"></a>追加字符串（append）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; append key value		<span class="comment">#往key中追加字符串value</span></span><br><span class="line">		<span class="comment">#返回值是追加后字符串长度</span></span><br><span class="line">		<span class="comment">#如果key不存在，相当于set</span></span><br></pre></td></tr></table></figure>

<h3 id="获取字符串长度（strlen）"><a href="#获取字符串长度（strlen）" class="headerlink" title="获取字符串长度（strlen）"></a>获取字符串长度（strlen）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; strlen key				<span class="comment">#返回key的字符串长度</span></span><br></pre></td></tr></table></figure>

<h3 id="将字符串数值进行加1运算（incr）"><a href="#将字符串数值进行加1运算（incr）" class="headerlink" title="将字符串数值进行加1运算（incr）"></a>将字符串数值进行加1运算（incr）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; incr key				<span class="comment">#key的value+1并且返回</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips：</p>
<ul>
<li>如果key不存在，则先创建该key-value，value初始化为0然后+1</li>
<li>key的value必须是数值，否则报错</li>
</ul>
</blockquote>
<h3 id="将字符串数值进行减1运算（decr）"><a href="#将字符串数值进行减1运算（decr）" class="headerlink" title="将字符串数值进行减1运算（decr）"></a>将字符串数值进行减1运算（decr）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;decr key</span><br></pre></td></tr></table></figure>

<p>与<strong>incr</strong>同理</p>
<h3 id="将字符串数值进行加offset（指定数值）运算（incrby）"><a href="#将字符串数值进行加offset（指定数值）运算（incrby）" class="headerlink" title="将字符串数值进行加offset（指定数值）运算（incrby）"></a>将字符串数值进行加offset（指定数值）运算（incrby）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;incrby key offset			<span class="comment">#key的vaule+offset并且返回</span></span><br></pre></td></tr></table></figure>

<h3 id="将字符串数值进行减offset（指定数值）运算（decrby）"><a href="#将字符串数值进行减offset（指定数值）运算（decrby）" class="headerlink" title="将字符串数值进行减offset（指定数值）运算（decrby）"></a>将字符串数值进行减offset（指定数值）运算（decrby）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;decrby key offset			<span class="comment">#key的vaule-offset并且返回</span></span><br></pre></td></tr></table></figure>

<h3 id="获取字符串中字符串（getrange）"><a href="#获取字符串中字符串（getrange）" class="headerlink" title="获取字符串中字符串（getrange）"></a>获取字符串中字符串（getrange）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;getrange key startIndex endIndex</span><br><span class="line">				<span class="comment">#截取key中value从startIndex到endIndex		</span></span><br></pre></td></tr></table></figure>

<h3 id="设置字符串中字符串（setrange）"><a href="#设置字符串中字符串（setrange）" class="headerlink" title="设置字符串中字符串（setrange）"></a>设置字符串中字符串（setrange）</h3><p>会改变数据库中的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;setrange key startIndex value</span><br><span class="line">				<span class="comment">#用value覆盖从下标为startIndex开始的字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="设置字符串的同时设置生命周期（setex）"><a href="#设置字符串的同时设置生命周期（setex）" class="headerlink" title="设置字符串的同时设置生命周期（setex）"></a>设置字符串的同时设置生命周期（setex）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;setex key seconds value</span><br><span class="line">				<span class="comment">#给key-value设置seconds秒后过期</span></span><br><span class="line">cli&gt; setex k1 30 v1</span><br><span class="line">OK</span><br><span class="line">cli&gt; ttl k1</span><br><span class="line">(<span class="built_in">integer</span>) 27</span><br></pre></td></tr></table></figure>

<h3 id="设置字符串数据当key不存在才设置，key存在则不设置（setnx）"><a href="#设置字符串数据当key不存在才设置，key存在则不设置（setnx）" class="headerlink" title="设置字符串数据当key不存在才设置，key存在则不设置（setnx）"></a>设置字符串数据当key不存在才设置，key存在则不设置（setnx）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;setnx key value</span><br></pre></td></tr></table></figure>

<h3 id="批量设置字符串数据（mset）"><a href="#批量设置字符串数据（mset）" class="headerlink" title="批量设置字符串数据（mset）"></a>批量设置字符串数据（mset）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;mset key1 value1 key2 value2 key3 value3 ...</span><br></pre></td></tr></table></figure>

<h3 id="批量获取字符串数据（mget）"><a href="#批量获取字符串数据（mget）" class="headerlink" title="批量获取字符串数据（mget）"></a>批量获取字符串数据（mget）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;mget key1 key2 key3 ...</span><br></pre></td></tr></table></figure>

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>Redis操作string类型</p>
<ul>
<li>增<ul>
<li>set：最基本的存储string类型数据的方式（如果存在则会覆盖）</li>
<li>setex：存储数据的同时设置生命周期</li>
<li>setnx：如果存在则不存储</li>
<li>mset：批量存储</li>
</ul>
</li>
<li>删</li>
<li>改<ul>
<li>set：修改string类型的数据（如果存在则会覆盖，也就是修改）</li>
<li>append：在原有的基础上追加数据</li>
<li>incr：数值字符串增加</li>
<li>decr：数值字符串减少</li>
<li>setrange：修改字符串中指定下标的数据</li>
</ul>
</li>
<li>查<ul>
<li>get：获得数据</li>
<li>mget：批量获得数据</li>
<li>getrange：获得字符串中子串</li>
<li>strlen：字符串长度</li>
</ul>
</li>
</ul>
<h2 id="Redis操作list类型"><a href="#Redis操作list类型" class="headerlink" title="Redis操作list类型"></a><span id="redis-list">Redis操作list类型</span></h2><p>单key——多有序value。顺序跟插入元素的顺序有关</p>
<h3 id="从左侧起存list类型数据（lpush）"><a href="#从左侧起存list类型数据（lpush）" class="headerlink" title="从左侧起存list类型数据（lpush）"></a>从左侧起存list类型数据（lpush）</h3><p>依次往左侧（头部）添加元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;lpush key value [value value...]</span><br><span class="line"></span><br><span class="line">cli&gt; lpush list1 1 2 3 4</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br><span class="line">cli&gt; lrange list1 0 4</span><br><span class="line">1) <span class="string">&quot;4&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;2&quot;</span></span><br><span class="line">4) <span class="string">&quot;1&quot;</span>	</span><br><span class="line">			<span class="comment">#可以看到lpush的顺序后插入的元素在列表中越靠前</span></span><br></pre></td></tr></table></figure>

<h3 id="从右侧起存list类型数据（rpush）"><a href="#从右侧起存list类型数据（rpush）" class="headerlink" title="从右侧起存list类型数据（rpush）"></a>从右侧起存list类型数据（rpush）</h3><p>依次从右侧（尾部）添加元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;rpush key value [value value...]</span><br></pre></td></tr></table></figure>



<h3 id="获取指定列表中指定下标区间的元素（lrange）"><a href="#获取指定列表中指定下标区间的元素（lrange）" class="headerlink" title="获取指定列表中指定下标区间的元素（lrange）"></a>获取指定列表中指定下标区间的元素（lrange）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;lrange key startIndex endIndex</span><br><span class="line">					<span class="comment">#获取key列表中startIndex到endIndex的元素</span></span><br><span class="line">					</span><br><span class="line">cli&gt; lrange list1 0 4</span><br><span class="line">1) <span class="string">&quot;4&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;2&quot;</span></span><br><span class="line">4) <span class="string">&quot;1&quot;</span>		</span><br><span class="line"></span><br><span class="line">cli&gt; lrange list1 0 -1 	<span class="comment">#获取从头到尾的全部元素，-1表示倒数第一个，即尾部</span></span><br><span class="line">1) <span class="string">&quot;4&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;2&quot;</span></span><br><span class="line">4) <span class="string">&quot;1&quot;</span>		</span><br></pre></td></tr></table></figure>



<h3 id="从指定列表中移除并返回表头（左侧）元素（lpop）"><a href="#从指定列表中移除并返回表头（左侧）元素（lpop）" class="headerlink" title="从指定列表中移除并返回表头（左侧）元素（lpop）"></a>从指定列表中移除并返回表头（左侧）元素（lpop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; lpop key</span><br></pre></td></tr></table></figure>



<h3 id="从指定列表中移除并返回表尾（右侧）元素（rpop）"><a href="#从指定列表中移除并返回表尾（右侧）元素（rpop）" class="headerlink" title="从指定列表中移除并返回表尾（右侧）元素（rpop）"></a>从指定列表中移除并返回表尾（右侧）元素（rpop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; rpop key</span><br></pre></td></tr></table></figure>



<h3 id="获取列表中指定下标的元素（lindex）"><a href="#获取列表中指定下标的元素（lindex）" class="headerlink" title="获取列表中指定下标的元素（lindex）"></a>获取列表中指定下标的元素（lindex）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; lindex key index</span><br></pre></td></tr></table></figure>



<h3 id="获取指定列表的长度（元素个数）（llen）"><a href="#获取指定列表的长度（元素个数）（llen）" class="headerlink" title="获取指定列表的长度（元素个数）（llen）"></a>获取指定列表的长度（元素个数）（llen）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; llen key</span><br></pre></td></tr></table></figure>



<h3 id="移除指定列表中数据（lrem）"><a href="#移除指定列表中数据（lrem）" class="headerlink" title="移除指定列表中数据（lrem）"></a>移除指定列表中数据（lrem）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;lrem key count value</span><br><span class="line">			<span class="comment">#移除key列表count个中值为value的元素</span></span><br><span class="line">			<span class="comment"># count &gt; 0 从左侧起移除</span></span><br><span class="line">			<span class="comment"># count &lt; 0 从右侧起移除</span></span><br><span class="line">			<span class="comment"># count = 0 移除所有</span></span><br></pre></td></tr></table></figure>

<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>Redis操作list类型</p>
<ul>
<li>增<ul>
<li>lpush：从左边添加元素</li>
<li>rpush：从右边添加元素</li>
</ul>
</li>
<li>删<ul>
<li>lpop：从左边弹出元素</li>
<li>rpop：从右边弹出元素</li>
<li>lrem：移除指定元素</li>
</ul>
</li>
<li>改</li>
<li>查<ul>
<li>lrange：遍历</li>
<li>lindex：指定下标的元素</li>
<li>llen：长度</li>
</ul>
</li>
</ul>
<h2 id="Redis操作set类型"><a href="#Redis操作set类型" class="headerlink" title="Redis操作set类型"></a><span id="redis-set">Redis操作set类型</span></h2><p>单key——多无序且不可重复value</p>
<h3 id="将一个或多个元素添加到指定集合中（sadd）"><a href="#将一个或多个元素添加到指定集合中（sadd）" class="headerlink" title="将一个或多个元素添加到指定集合中（sadd）"></a>将一个或多个元素添加到指定集合中（sadd）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sadd key value [value value ...]	<span class="comment">#若元素重复，则忽略</span></span><br><span class="line"></span><br><span class="line">cli&gt; sadd set1 a b c a</span><br><span class="line">(<span class="built_in">integer</span>) 3			<span class="comment">#成功添加元素的个数</span></span><br><span class="line">					<span class="comment">#只添加成功三个</span></span><br></pre></td></tr></table></figure>

<h3 id="获取指定集合中的元素（smembers）"><a href="#获取指定集合中的元素（smembers）" class="headerlink" title="获取指定集合中的元素（smembers）"></a>获取指定集合中的元素（smembers）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; smembers key</span><br><span class="line"></span><br><span class="line">cli&gt; smembers set1</span><br><span class="line">1) <span class="string">&quot;c&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="判断元素在集合中是否存在（sismember）"><a href="#判断元素在集合中是否存在（sismember）" class="headerlink" title="判断元素在集合中是否存在（sismember）"></a>判断元素在集合中是否存在（sismember）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sismember key member</span><br><span class="line"></span><br><span class="line">(<span class="built_in">integer</span>) 1			<span class="comment">#返回1则存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 0			<span class="comment">#返回0则不存在</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的长度（scard）"><a href="#获取集合的长度（scard）" class="headerlink" title="获取集合的长度（scard）"></a>获取集合的长度（scard）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; scard key</span><br></pre></td></tr></table></figure>

<h3 id="移除集合中1个或者多个元素（srem）"><a href="#移除集合中1个或者多个元素（srem）" class="headerlink" title="移除集合中1个或者多个元素（srem）"></a>移除集合中1个或者多个元素（srem）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; srem key member [member ...]</span><br><span class="line">						<span class="comment">#返回成功移除的元素的个数</span></span><br></pre></td></tr></table></figure>

<h3 id="随机获取集合中的一个或多个元素（srandmember）"><a href="#随机获取集合中的一个或多个元素（srandmember）" class="headerlink" title="随机获取集合中的一个或多个元素（srandmember）"></a>随机获取集合中的一个或多个元素（srandmember）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; srandmember key [count]	</span><br><span class="line">						<span class="comment">#count&gt;0 随机获取的元素不会重复</span></span><br><span class="line">						<span class="comment">#count&lt;0 随机获取的元素可能重复</span></span><br></pre></td></tr></table></figure>

<h3 id="随机移除集合中的一个或多个元素（spop）"><a href="#随机移除集合中的一个或多个元素（spop）" class="headerlink" title="随机移除集合中的一个或多个元素（spop）"></a>随机移除集合中的一个或多个元素（spop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; spop key [count]</span><br></pre></td></tr></table></figure>

<h3 id="将集合中的元素移动到另一集合（smove）"><a href="#将集合中的元素移动到另一集合（smove）" class="headerlink" title="将集合中的元素移动到另一集合（smove）"></a>将集合中的元素移动到另一集合（smove）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; smove <span class="built_in">source</span> dest member	<span class="comment">#将source集合中的member移动到dest集合</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的差集（sdiff）"><a href="#获取集合的差集（sdiff）" class="headerlink" title="获取集合的差集（sdiff）"></a>获取集合的差集（sdiff）</h3><p>即一个集合中有，但是其他集合中没有的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sdiff key1 key2 [key3 ...]</span><br><span class="line">					<span class="comment">#即key1集合中有，其他集合中没有的元素</span></span><br><span class="line">					</span><br><span class="line">cli&gt; smembers set1</span><br><span class="line">1) <span class="string">&quot;f&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;e&quot;</span></span><br><span class="line">4) <span class="string">&quot;g&quot;</span></span><br><span class="line">5) <span class="string">&quot;a&quot;</span></span><br><span class="line">6) <span class="string">&quot;b&quot;</span></span><br><span class="line">cli&gt; smembers set2</span><br><span class="line">1) <span class="string">&quot;d&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;g&quot;</span></span><br><span class="line">4) <span class="string">&quot;f&quot;</span></span><br><span class="line">5) <span class="string">&quot;e&quot;</span></span><br><span class="line">6) <span class="string">&quot;i&quot;</span></span><br><span class="line">7) <span class="string">&quot;b&quot;</span></span><br><span class="line">8) <span class="string">&quot;a&quot;</span></span><br><span class="line">9) <span class="string">&quot;h&quot;</span></span><br><span class="line">cli&gt; sdiff set2 set1		<span class="comment">#set2中有hid，但是set1中没有</span></span><br><span class="line">1) <span class="string">&quot;i&quot;</span></span><br><span class="line">2) <span class="string">&quot;d&quot;</span></span><br><span class="line">3) <span class="string">&quot;h&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的交集（sinter）"><a href="#获取集合的交集（sinter）" class="headerlink" title="获取集合的交集（sinter）"></a>获取集合的交集（sinter）</h3><p>即指定集合中都有的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sinter key key [key key...]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; smembers set1</span><br><span class="line">1) <span class="string">&quot;f&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;e&quot;</span></span><br><span class="line">4) <span class="string">&quot;g&quot;</span></span><br><span class="line">5) <span class="string">&quot;a&quot;</span></span><br><span class="line">6) <span class="string">&quot;b&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers set2</span><br><span class="line">1) <span class="string">&quot;d&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;g&quot;</span></span><br><span class="line">4) <span class="string">&quot;f&quot;</span></span><br><span class="line">5) <span class="string">&quot;e&quot;</span></span><br><span class="line">6) <span class="string">&quot;i&quot;</span></span><br><span class="line">7) <span class="string">&quot;b&quot;</span></span><br><span class="line">8) <span class="string">&quot;a&quot;</span></span><br><span class="line">9) <span class="string">&quot;h&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinter set1 set2</span><br><span class="line">1) <span class="string">&quot;f&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;e&quot;</span></span><br><span class="line">4) <span class="string">&quot;g&quot;</span></span><br><span class="line">5) <span class="string">&quot;a&quot;</span></span><br><span class="line">6) <span class="string">&quot;b&quot;</span></span><br><span class="line">						<span class="comment">#set1和set2中都有abcefg</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的并集（sunion）"><a href="#获取集合的并集（sunion）" class="headerlink" title="获取集合的并集（sunion）"></a>获取集合的并集（sunion）</h3><p>即指定集合中的所有元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sunion key key [key key...]</span><br></pre></td></tr></table></figure>

<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>Redis操作set类型</p>
<ul>
<li>增<ul>
<li>sadd：新增元素到集合中</li>
</ul>
</li>
<li>删<ul>
<li>srem：移除元素</li>
<li>spop：弹出元素</li>
<li>smove：移动过元素到另一集合</li>
</ul>
</li>
<li>改<ul>
<li>sadd：新增元素到集合中，如果value已经存在则会覆盖</li>
</ul>
</li>
<li>查<ul>
<li>smembers：遍历集合元素</li>
<li>sismember：判断元素是否存在</li>
<li>scard：集合长度</li>
<li>srandmember：随机获取集合元素</li>
<li>sdiff：差集</li>
<li>sinter：交集</li>
<li>sunion：并集</li>
</ul>
</li>
</ul>
<h2 id="Redis操作hash类型"><a href="#Redis操作hash类型" class="headerlink" title="Redis操作hash类型"></a><span id="redis-hash">Redis操作hash类型</span></h2><p>单key——field-value </p>
<p>​					field-value </p>
<p>​					field-value</p>
<p>​					适合存储对象</p>
<h3 id="将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）"><a href="#将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）" class="headerlink" title="将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）"></a>将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）</h3><p>如果key中的filed之前是<strong>存在</strong>的，则会强制覆盖（使用hsetnx不会强制覆盖）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hset key field1 value1 [field2 value2 ...]</span><br><span class="line"></span><br><span class="line">cli&gt; hset student1 name wqk age 20</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h3 id="获取指定hash表中指定field值（hget）"><a href="#获取指定hash表中指定field值（hget）" class="headerlink" title="获取指定hash表中指定field值（hget）"></a>获取指定hash表中指定field值（hget）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hget key field			<span class="comment">#获取key哈希表中field的值</span></span><br><span class="line"></span><br><span class="line">cli&gt; hget student1 name</span><br><span class="line"><span class="string">&quot;wqk&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="批量获取指定hash表中field的值（hmget）"><a href="#批量获取指定hash表中field的值（hmget）" class="headerlink" title="批量获取指定hash表中field的值（hmget）"></a>批量获取指定hash表中field的值（hmget）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hmget key field1 [field2 field3 ...]</span><br><span class="line"></span><br><span class="line">cli&gt; hmget student1 name age</span><br><span class="line">1) <span class="string">&quot;wqk&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取hash表中所有的field和value（hgetall）"><a href="#获取hash表中所有的field和value（hgetall）" class="headerlink" title="获取hash表中所有的field和value（hgetall）"></a>获取hash表中所有的field和value（hgetall）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hgetall key</span><br><span class="line"></span><br><span class="line">cli&gt; hgetall student1</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;wqk&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br><span class="line">4) <span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="移除hash表中指定一个或者多个field（hdel）"><a href="#移除hash表中指定一个或者多个field（hdel）" class="headerlink" title="移除hash表中指定一个或者多个field（hdel）"></a>移除hash表中指定一个或者多个field（hdel）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hdel key field1 [field2 field3 ...]</span><br></pre></td></tr></table></figure>

<h3 id="统计hash表中field数量（hlen）"><a href="#统计hash表中field数量（hlen）" class="headerlink" title="统计hash表中field数量（hlen）"></a>统计hash表中field数量（hlen）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hlen key</span><br></pre></td></tr></table></figure>

<h3 id="判断hash表中是否存在某field（hexists）"><a href="#判断hash表中是否存在某field（hexists）" class="headerlink" title="判断hash表中是否存在某field（hexists）"></a>判断hash表中是否存在某field（hexists）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hexists key field</span><br><span class="line">				<span class="comment">#返回0表示不存在，1表示存在</span></span><br></pre></td></tr></table></figure>

<h3 id="获取hash表中所有的field列表（hkeys）"><a href="#获取hash表中所有的field列表（hkeys）" class="headerlink" title="获取hash表中所有的field列表（hkeys）"></a>获取hash表中所有的field列表（hkeys）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hkeys key</span><br><span class="line"></span><br><span class="line">cli&gt; hkeys student2</span><br><span class="line">1) <span class="string">&quot;id&quot;</span></span><br><span class="line">2) <span class="string">&quot;name&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取hash表中所有的value（hvals）"><a href="#获取hash表中所有的value（hvals）" class="headerlink" title="获取hash表中所有的value（hvals）"></a>获取hash表中所有的value（hvals）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hvals key</span><br><span class="line"></span><br><span class="line">cli&gt; hvals student2</span><br><span class="line">1) <span class="string">&quot;10001&quot;</span></span><br><span class="line">2) <span class="string">&quot;test&quot;</span></span><br><span class="line">3) <span class="string">&quot;18&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="对hash表中指定field的value进行整数加法运算（hincrby）"><a href="#对hash表中指定field的value进行整数加法运算（hincrby）" class="headerlink" title="对hash表中指定field的value进行整数加法运算（hincrby）"></a>对hash表中指定field的value进行整数加法运算（hincrby）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hincrby key field incrment</span><br><span class="line">	<span class="comment">#对key哈希表中的field属性的值进行加incrment值运算</span></span><br><span class="line">				</span><br><span class="line">cli&gt; hget student2 age</span><br><span class="line"><span class="string">&quot;18&quot;</span></span><br><span class="line"></span><br><span class="line">cli&gt; hincrby student2 age 2 </span><br><span class="line">(<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>



<h3 id="对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）"><a href="#对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）" class="headerlink" title="对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）"></a>对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hincrbyfloat key field incrment</span><br><span class="line"></span><br><span class="line">cli&gt; hset student2 score 85</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">cli&gt; hincrbyfloat student2 score 1.5</span><br><span class="line"><span class="string">&quot;86.5&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）"><a href="#将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）" class="headerlink" title="将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）"></a>将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）</h3><p>如果key的field已经存在则放弃设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hsetnx key filed1 value1 [field2 value2]</span><br></pre></td></tr></table></figure>

<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><p>Redis操作hash类型</p>
<ul>
<li>增<ul>
<li>hset：存入hash类型数据</li>
<li>hsetnx：存入数据，如果存在则不存入</li>
</ul>
</li>
<li>删<ul>
<li>hdel：删除hash表中field及其value</li>
</ul>
</li>
<li>改<ul>
<li>hset：存入hash类型数据，如果field存在则会覆盖</li>
<li>hincrby：value是数值，则会增加</li>
</ul>
</li>
<li>查<ul>
<li>hget：获取hash表中指定field的value</li>
<li>hmget：批量获取hash表中指定field的value</li>
<li>hgetall：获取hash表中所有field及其value</li>
<li>hlen：获取hash表中field的数量</li>
<li>hexists：判断hash表中该field是否存在</li>
<li>hkeys：获取hash表中所有field</li>
<li>hvals：获取hash表中所有value</li>
</ul>
</li>
</ul>
<h2 id="Redis操作zset类型"><a href="#Redis操作zset类型" class="headerlink" title="Redis操作zset类型"></a><span id="redis-zset">Redis操作zset类型</span></h2><p>有序集合。顺序跟score有关</p>
<h3 id="将一个或多个member及其score值加入有序集合（zadd）"><a href="#将一个或多个member及其score值加入有序集合（zadd）" class="headerlink" title="将一个或多个member及其score值加入有序集合（zadd）"></a>将一个或多个member及其score值加入有序集合（zadd）</h3><p>score必须是数值。如果member<strong>已经存在</strong>，则会覆盖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zadd key score member [score member]</span><br><span class="line"></span><br><span class="line">cli&gt; zadd zset1 95 wqk 90 lk 98 zp</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定下标区间的元素（zrange）"><a href="#获取有序集合中指定下标区间的元素（zrange）" class="headerlink" title="获取有序集合中指定下标区间的元素（zrange）"></a>获取有序集合中指定下标区间的元素（zrange）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrange key startIndex endIndex [withscores] <span class="comment">#获取key集合startIndex到endIndex区间的元素（是否显示分数）</span></span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）"><a href="#获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）" class="headerlink" title="获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）"></a>获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrangebyscore key min max [withscores] <span class="comment">#获取key集合min到max分数区间的元素（是否显示分数）</span></span><br></pre></td></tr></table></figure>

<h3 id="删除有序集合中一个或者多个元素（zrem）"><a href="#删除有序集合中一个或者多个元素（zrem）" class="headerlink" title="删除有序集合中一个或者多个元素（zrem）"></a>删除有序集合中一个或者多个元素（zrem）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrem key member [member]</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中元素个数（zcard）"><a href="#获取有序集合中元素个数（zcard）" class="headerlink" title="获取有序集合中元素个数（zcard）"></a>获取有序集合中元素个数（zcard）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zcard key</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中分数在指定区间的元素个数（zcount）"><a href="#获取有序集合中分数在指定区间的元素个数（zcount）" class="headerlink" title="获取有序集合中分数在指定区间的元素个数（zcount）"></a>获取有序集合中分数在指定区间的元素个数（zcount）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zcount key min max		<span class="comment">#获取key有序集合中min到max区间的元素个数</span></span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定元素的排名（升序）（zrank）"><a href="#获取有序集合中指定元素的排名（升序）（zrank）" class="headerlink" title="获取有序集合中指定元素的排名（升序）（zrank）"></a>获取有序集合中指定元素的排名（升序）（zrank）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrank key member</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定元素的排名（降序）（zrevrank）"><a href="#获取有序集合中指定元素的排名（降序）（zrevrank）" class="headerlink" title="获取有序集合中指定元素的排名（降序）（zrevrank）"></a>获取有序集合中指定元素的排名（降序）（zrevrank）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrevrank key member</span><br></pre></td></tr></table></figure>



<h3 id="获取有序集合指定元素的分数（zscore）"><a href="#获取有序集合指定元素的分数（zscore）" class="headerlink" title="获取有序集合指定元素的分数（zscore）"></a>获取有序集合指定元素的分数（zscore）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zscore key member</span><br></pre></td></tr></table></figure>

<h3 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h3><p>Redis操作zset类型</p>
<ul>
<li>增<ul>
<li>zadd：往集合中存入元素</li>
</ul>
</li>
<li>删<ul>
<li>zrem：移除集合中的元素</li>
</ul>
</li>
<li>改</li>
<li>查<ul>
<li>zrange：遍历集合元素</li>
<li>zrangebyscore：根据score遍历集合元素</li>
<li>zcard：集合元素个数</li>
<li>zcount：指定分数区间元素个数</li>
<li>zrank：元素的排名（正序）</li>
<li>zrevrank：元素的排名（倒序）</li>
<li>zscore：元素的分数</li>
</ul>
</li>
</ul>
<h2 id="Redis配置文件"><a href="#Redis配置文件" class="headerlink" title="Redis配置文件"></a>Redis配置文件</h2><p>Redis根目录下有个默认的配置文件：<code>.\redis.conf</code>，里面有一些redis默认的配置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; redis-server [config_name]	<span class="comment">#默认使用默认的配置的文件</span></span><br></pre></td></tr></table></figure>

<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><ul>
<li><p>port</p>
<p>指定redis服务所使用的端口号，<strong>默认6379</strong></p>
</li>
<li><p>bind</p>
<p>指定客户端连接redis服务时，所能使用的主机地址，<strong>默认是redis服务所在主机名</strong>，一般情况下都需要指定主机名</p>
</li>
<li><p>tcp-keeplive</p>
<p>TCP连接保活策略，单位是秒。指的是Redis服务端会在指定秒内向连接他的客户端发送一次ACK请求，以确保连接有效。<strong>默认是60秒</strong></p>
</li>
</ul>
<p>如果以上配置在配置文件中生效，则在客户端中连接需使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h <span class="built_in">bind</span> -p 6380</span><br></pre></td></tr></table></figure>

<h3 id="常规配置"><a href="#常规配置" class="headerlink" title="常规配置"></a>常规配置</h3><ul>
<li><p>loglevel</p>
<p>配置日志级别，分为四个级别：debug、verbose、notice、warning。<strong>默认是notice</strong></p>
</li>
<li><p>logfile</p>
<p>日志文件持久化存储的地方。<strong>默认不会持久化，只会输出到终端</strong></p>
</li>
<li><p>databases</p>
<p>配置Redis服务默认创建的数据库实例个数。<strong>默认是16个</strong>。</p>
</li>
</ul>
<h3 id="安全配置"><a href="#安全配置" class="headerlink" title="安全配置"></a>安全配置</h3><ul>
<li><p>requirepass</p>
<p>配置Redis客户端访问Redis服务时的密码，需要<code>protected-mode = yes</code>时生效</p>
</li>
</ul>
<p>如配置了requirepass，则在客户端连接中需使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [-h hostname] [-p port] [-a <span class="built_in">pwd</span>]</span><br></pre></td></tr></table></figure>

<h2 id="Redis数据持久化"><a href="#Redis数据持久化" class="headerlink" title="Redis数据持久化"></a>Redis数据持久化</h2><p>Redis提供持久化策略，可以在适当的时机采用适当的手段把内存中的数据持久化的磁盘。</p>
<h3 id="RDB策略（Redis默认启用的持久化策略）"><a href="#RDB策略（Redis默认启用的持久化策略）" class="headerlink" title="RDB策略（Redis默认启用的持久化策略）"></a>RDB策略（Redis默认启用的持久化策略）</h3><p>RDB（Redis DataBase）策略是指，在<strong>指定时间间隔</strong>内，Redis服务执行<strong>指定次数</strong>的写操作，会自动触发一次持久化操作。如需修改可以在redis的配置文件中修改RDB相关的配置（<code>dbfilename</code>持久化数据的文件名，默认是dump.rdb，<code>dir</code>持久化数据的目录，默认是<code>./</code>，即根目录）。</p>
<h3 id="AOF策略"><a href="#AOF策略" class="headerlink" title="AOF策略"></a>AOF策略</h3><p>记录每一次Redis服务的<strong>完整写操作</strong>进入日志，每次Redis服务启动时，都会重新执行一遍完整的操作日志以便恢复数据。效率不高，默认不开启AOF（<code>appendonly</code>配置是否开启AOF策略，<code>appendfilename</code>配置操作日志文件）。</p>
<h2 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h2><p>数据库事务：一组对数据库的操作一起执行，保证操作的原子性，要么同时成功，要么同时失败。</p>
<p>Redis事务：允许一组Redis命令放在一起，将命令序列化，然后按队列执行，保证部分原子性。</p>
<h3 id="multi"><a href="#multi" class="headerlink" title="multi"></a>multi</h3><p>标记一个Redis事务的开始（与exec成对存在）。</p>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><p>标记一个Redis事务的结束（与multi成对存在），即立即开始执行上述事务。</p>
<p>一个完整的Redis事务的输入格式应该是如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi				<span class="comment">#标识事务开始了</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> k1 v1			<span class="comment">#操作1</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> k2 v2			<span class="comment">#操作2</span></span><br><span class="line">cli&gt; <span class="built_in">exec</span>				<span class="comment">#标识事务结束了（即立即开始执行）</span></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi</span><br><span class="line">OK		<span class="comment">#事务开启</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> str1 value1</span><br><span class="line">QUEUED	<span class="comment">#操作1加入队列</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> str2 value2</span><br><span class="line">QUEUED	<span class="comment">#操作2加入队列</span></span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK	<span class="comment">#操作1执行结果</span></span><br><span class="line">2) OK	<span class="comment">#操作2执行结果</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips：</strong></p>
<p>Redis事务不是脚本命令。而是在cli执行<code>multi</code>后接着<strong>一行一行输入</strong>操作的命令（操作会插入队列），最后执行<code>exec</code>才会按队列执行上述操作。为保证事务的<strong>部分</strong>原子性，Redis事务遵循以下两则规则：</p>
<ol>
<li><p>输入事务操作过程中如果发生错误，则事务输入失败，即事务无法被创建。即<code>multi</code>和<code>exec</code>中间操作语句有错误则事务无法被创建。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi		</span><br><span class="line">cli&gt; <span class="built_in">set</span> k1 v1	</span><br><span class="line">cli&gt; seta k2 v2		<span class="comment">#操作2：命令错误</span></span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">                  </span><br><span class="line">					<span class="comment">#该事务无法被创建：操作的命令错误</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>如果上述规则没有发生错误，则在最后执行操作队列时，即使其中一项操作执行异常仍会继续执行其余操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi</span><br><span class="line">cli&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">cli&gt; incr k1		</span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">					<span class="comment">#事务会被创建，即使incr的执行结果异常</span></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h3 id="discard"><a href="#discard" class="headerlink" title="discard"></a>discard</h3><p>清除已经存在于操作队列中的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi</span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">set</span> k5 v5</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; <span class="built_in">set</span> k6 v6</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; discard					<span class="comment">#清空上述操作队列</span></span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">(error) ERR EXEC without MULTI			<span class="comment">#exec执行失败的原因是操作命令的队列被清空</span></span><br></pre></td></tr></table></figure>

<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>在事务开启前（<code>multi</code>）监控某一个键，在事务执行的过程中监控的键的值发生变化，则此次事务放弃执行；否则正常执行。</p>
<p>用以下事务来模拟一个场景：钱包A余额50，钱包B余额50，钱包B向钱包A转账50，那么最后钱包B余额0，钱包A余额100。并发情况下假如多个钱包需要向钱包B转账，那么就会发生错误。所以需要监控该次事务执行前的version是否还是该version。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">set</span> balanceA 50</span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">set</span> balanceB 50</span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">set</span> verison 1</span><br><span class="line">OK</span><br><span class="line">cli&gt; watch version			<span class="comment">#监控version的值</span></span><br><span class="line">OK</span><br><span class="line">cli&gt; multi</span><br><span class="line">OK</span><br><span class="line">cli&gt; incrby balanceA 50</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; decrby balanceB 50</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; incr version</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 100</span><br><span class="line">2) (<span class="built_in">integer</span>) 0</span><br><span class="line">3) (<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>watch就是类似于乐观锁，A事务执行前查询一个键（该键会在其他事务进行该事务后发生改变，即标识此次事务执行成功），如果该键在A事务执行过程中发生了改变（说明其他事务对数据进行了操作），即A事务应该不执行，如果该键没有发生改变，则A事务正常执行。</p>
</blockquote>
<h3 id="unwatch"><a href="#unwatch" class="headerlink" title="unwatch"></a>unwatch</h3><p>放弃监控的所有键。</p>
<h2 id="Redis消息的发布与订阅（了解）"><a href="#Redis消息的发布与订阅（了解）" class="headerlink" title="Redis消息的发布与订阅（了解）"></a>Redis消息的发布与订阅（了解）</h2><p>Redis<strong>客户端</strong>订阅频道，订阅了同一频道的客户端可以发送或者收到来自同一频道的消息。（消息中间件）</p>
<h4 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h4><p>订阅频道（以便接收消息）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; subscribe channel [channel ...]			<span class="comment">#可以订阅多个频道</span></span><br></pre></td></tr></table></figure>

<p>client1：</p>
<p>订阅了ch1频道</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; subscribe ch1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;ch1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>client2：</p>
<p>订阅了ch1频道</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; subscribe ch1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;ch1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>此时client1和client2都订阅了ch1频道，如果有客户端往ch1频道发送消息，那么client1和client2都会收到</p>
<h3 id="psubscribe"><a href="#psubscribe" class="headerlink" title="psubscribe"></a>psubscribe</h3><p>订阅频道（支持通配符）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; psubscribe pattern [pattern ...]</span><br><span class="line"></span><br><span class="line">cli&gt; psubscribe news*			<span class="comment">#订阅以news开头的频道</span></span><br></pre></td></tr></table></figure>

<h3 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h3><p>往频道上发布消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; publish channel message			<span class="comment">#往channel频道发送message消息</span></span><br></pre></td></tr></table></figure>

<p>client3向ch1频道发送消息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; publish ch1 Hello,Redis!</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<p>此时client1和client2就会收到来自client3的消息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;ch1&quot;</span></span><br><span class="line">3) <span class="string">&quot;Hello,Redis!&quot;</span>            </span><br></pre></td></tr></table></figure>

<h2 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h2><h3 id="搭建一主二从的Redis集群并启动"><a href="#搭建一主二从的Redis集群并启动" class="headerlink" title="搭建一主二从的Redis集群并启动"></a>搭建一主二从的Redis集群并启动</h3><p>实际开发中应分别在三台不同的服务器上部署三个Redis服务，这里为了方便演示选择在同一台服务器启动三个配置文件不同的Redis服务来模拟，三个Redis服务端口号分别是6379、6380、6381，三份配置文件名命名为：<code>redis_6379.conf</code>、<code>redis_6380.conf</code>、<code>redis_6381.conf</code>。</p>
<p>redis_6379.conf：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port</span> <span class="string">6379						#修改端口号</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;redis_6379.log&quot;		#修改生成的日志文件名</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">redis_6379.rdb		#修改持久化的文件名</span></span><br></pre></td></tr></table></figure>

<p>同理，redis_6380.conf和redis_6381.conf也需要修改以上配置</p>
<blockquote>
<p><strong>Tips</strong></p>
<p>需要修改日志和持久化文件的文件名，不然可能会造成数据冲突。</p>
</blockquote>
<p>接下来使用<code>redis-server &lt;config_name&gt;</code>分别启动三个Redis服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis_6379.conf</span><br><span class="line">redis-server redis_6380.conf</span><br><span class="line">redis-server redis_6381.conf</span><br></pre></td></tr></table></figure>

<h3 id="使用cli分别连接三台Redis服务"><a href="#使用cli分别连接三台Redis服务" class="headerlink" title="使用cli分别连接三台Redis服务"></a>使用cli分别连接三台Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379</span><br><span class="line">redis-cli -p 6380</span><br><span class="line">redis-cli -p 6381</span><br></pre></td></tr></table></figure>

<h3 id="查看Redis服务的主从信息"><a href="#查看Redis服务的主从信息" class="headerlink" title="查看Redis服务的主从信息"></a>查看Redis服务的主从信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; info replication</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master								<span class="comment">#角色：主机</span></span><br><span class="line">connected_slaves:0						<span class="comment">#已连接的从机数量：0</span></span><br><span class="line">master_replid:91792be1189896bfa47e7a99aae23b8702c8c93b</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>

<p>初始化的Redis服务的角色都是主机，即<code>role:master</code>。</p>
<h3 id="设置从机从属于主机（slaveof）"><a href="#设置从机从属于主机（slaveof）" class="headerlink" title="设置从机从属于主机（slaveof）"></a>设置从机从属于主机（slaveof）</h3><p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; slaveof host port     <span class="comment">#设置当前连接的服务从属于host:port的redis服务</span></span><br></pre></td></tr></table></figure>



<p>在已连接从机服务的客户端上执行：<code>slaveof 127.0.0.1 6379</code>，即</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave						<span class="comment">#角色：从机</span></span><br><span class="line">master_host:127.0.0.1			<span class="comment">#主机host地址</span></span><br><span class="line">master_port:6379				<span class="comment">#主机port端口号</span></span><br><span class="line">master_link_status:up			<span class="comment">#与主机连接状态：up（已连接）</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="全量复制"><a href="#全量复制" class="headerlink" title="全量复制"></a>全量复制</h3><p>一旦主从关系确定，主库会将所有数据立马同步到从库。</p>
<h3 id="增量复制"><a href="#增量复制" class="headerlink" title="增量复制"></a>增量复制</h3><p>在主库上写的数据，会同步到从库。</p>
<h3 id="读写分离，主写从读"><a href="#读写分离，主写从读" class="headerlink" title="读写分离，主写从读"></a>读写分离，主写从读</h3><p>主机既能读也能写（尽量写），从机只能读不能写。</p>
<h3 id="主机宕机，从机原地待命"><a href="#主机宕机，从机原地待命" class="headerlink" title="主机宕机，从机原地待命"></a>主机宕机，从机原地待命</h3><p>主机宕机后，<strong>从机仍然可以读数据</strong>，可以从<code>info replication</code>中看到与主机的连接状态变为<code>down</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave									<span class="comment">#角色仍是从机</span></span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:down						<span class="comment">#与主机的连接状态变为down（未连接）</span></span><br></pre></td></tr></table></figure>

<h3 id="主机恢复，恢复原样"><a href="#主机恢复，恢复原样" class="headerlink" title="主机恢复，恢复原样"></a>主机恢复，恢复原样</h3><p>主机恢复后，<strong>恢复到原样</strong>，从机与主机继续建立连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up						<span class="comment">#与主机的连接状态变为up（已连接）</span></span><br></pre></td></tr></table></figure>

<h3 id="从机宕机"><a href="#从机宕机" class="headerlink" title="从机宕机"></a>从机宕机</h3><p>从机宕机后，主机少一台从机，其余从机不受影响</p>
<h3 id="从机恢复"><a href="#从机恢复" class="headerlink" title="从机恢复"></a>从机恢复</h3><p>从机恢复后，会初始化到最初的状态（即变为<code>role:master</code>），需要重新设置从属主机，然后主机的数据会全量复制到从机上。</p>
<h3 id="主机宕机，从机上位"><a href="#主机宕机，从机上位" class="headerlink" title="主机宕机，从机上位"></a>主机宕机，从机上位</h3><p>主机宕机后，如果主机灾害程度无法短时间恢复则可以使用从机进行上位（即取代主机）。</p>
<ol>
<li><p>选择一个从机取消其原本的从属关系，成为新的主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slaveof no one			<span class="comment">#取消从属关系（成为主机）</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication		<span class="comment">#查看复制关系</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master								<span class="comment">#角色：主机（新的主机）</span></span><br><span class="line">connected_slaves:0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>此时6380从机成为了新的主机，并且<strong>仍保留原有的数据</strong></p>
</li>
<li><p>其余从机重新从属于新的主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6380	<span class="comment">#6381从机从属于6380</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6380</span><br><span class="line">master_link_status:up</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<p>主机可读可写，从机只能读，不能写。</p>
</blockquote>
<h2 id="Redis哨兵模式"><a href="#Redis哨兵模式" class="headerlink" title="Redis哨兵模式"></a>Redis哨兵模式</h2><p>Redis的哨兵模式会在某一Redis服务发生故障（如宕机）时，自动执行从机上位（按照一定规则），并且主机恢复后会从属于新的主机。流程如下：</p>
<ol>
<li><p>配置哨兵的配置文件</p>
<p>redis_sentinel.conf：（配置文件名称自定义）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#该哨兵的名称是sentinel-redis。作用是monitor（监控）主机127.0.0.1的6379（端口）上的Redis服务</span><br><span class="line">sentinel monitor sentinel-redis 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>


</li>
<li><p>启动哨兵</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt; redis-server redis_sentinel.conf --sentinel</span><br></pre></td></tr></table></figure>

<p>出现以下内容则启动成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt;redis-server.exe redis_sentinel.conf --sentinel</span><br><span class="line">[16228] 07 Oct 21:58:19.446 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">[16228] 07 Oct 21:58:19.446 <span class="comment"># Redis version=5.0.10, bits=64, commit=1c047b68, modified=0, pid=16228, just started</span></span><br><span class="line">[16228] 07 Oct 21:58:19.446 <span class="comment"># Configuration loaded</span></span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis 5.0.10 (1c047b68/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._</span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 16228</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line">          `-._        _.-<span class="string">&#x27;</span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span></span><br><span class="line"></span><br><span class="line">[16228] 07 Oct 21:58:19.452 <span class="comment"># Sentinel ID is 192b87ae0be76565fefed74ead2f28454a49f746</span></span><br><span class="line">[16228] 07 Oct 21:58:19.452 <span class="comment"># +monitor master sentinel-redis 127.0.0.1 6379 quorum 1</span></span><br><span class="line">[16228] 07 Oct 21:58:19.456 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ sentinel-redis 127.0.0.1 6379</span><br><span class="line">[16228] 07 Oct 21:58:19.457 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ sentinel-redis 127.0.0.1 6379</span><br></pre></td></tr></table></figure>


</li>
<li><p>监控的主机宕机，从机会在短时间后上位（变为新的主机，其余从机从属于该新主机）</p>
<p>（此时6379宕机）</p>
<p>6381成为新的主机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=22068,lag=0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>6380从属于6381：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6381</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br></pre></td></tr></table></figure>


</li>
<li><p>旧主机恢复，变为新主机的从机</p>
<p>（此时6379恢复）</p>
<p>6379从属于6381：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6381</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<p>哨兵并不会在主机宕机的一瞬间就将从机上位，而是在一定间隔时间内扫描，扫描到主机宕机了再让从机上位，旧主机恢复时，哨兵将其变为新主机的从机时同理（并不会立马执行，而是在一定时间间隔内）。</p>
</blockquote>
<h3 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h3><ol>
<li><p>查看Redis服务的主从关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; info replication</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置Redis服务之间的从属关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; slaveof host port			<span class="comment">#执行命令的当前主机从属于host:port上的Redis服务</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>开启哨兵模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt; redis-sentinel &lt;sentinel_config&gt;	<span class="comment">#以sentinel_config配置文件执行哨兵</span></span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<ul>
<li>主从复制原则：先全量复制，再增量复制</li>
<li>哨兵三大任务：监控、提醒、自动故障迁移</li>
</ul>
</blockquote>
<h2 id="Jedis的使用"><a href="#Jedis的使用" class="headerlink" title="Jedis的使用"></a>Jedis的使用</h2><p>Jedis是在Java上使用Redis的客户端，封装了一些命令和操作。类似jdbc，同时Spring官方还提供<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-redis">Spring Data Redis</a></p>
<h3 id="引入Jedis依赖"><a href="#引入Jedis依赖" class="headerlink" title="引入Jedis依赖"></a>引入Jedis依赖</h3><p>采用Maven项目进行演示，需要引入Jedis依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置主机和端口号"><a href="#配置主机和端口号" class="headerlink" title="配置主机和端口号"></a>配置主机和端口号</h3><p>创建Jedis的连接</p>
<p>JedisConnection.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisConnection</span> &#123;</span><br><span class="line">    <span class="comment">//host</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_HOST</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="comment">//port</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REDIS_PORT</span> <span class="operator">=</span> <span class="number">6379</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title function_">getJedis</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(REDIS_HOST,REDIS_PORT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作key"><a href="#操作key" class="headerlink" title="操作key"></a>操作key</h3><p>具体命令参考<a href="#redis-key">Redis操作key</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisKeys</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获得Jedis对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//是否能连接上redis服务</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ping</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">        <span class="comment">//查询keys</span></span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//k1是否存在</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">existsK1</span> <span class="operator">=</span> jedis.exists(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        <span class="comment">//k1的生存时间</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">ttlK1</span> <span class="operator">=</span> jedis.ttl(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        <span class="comment">//k1的类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">typeK1</span> <span class="operator">=</span> jedis.type(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作string"><a href="#操作string" class="headerlink" title="操作string"></a>操作string</h3><p>具体命令参考<a href="#redis-string">Redis操作string类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisString</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获得Jedis对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//存储string数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">setResult</span> <span class="operator">=</span> jedis.set(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//批量存储string数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msetResult</span> <span class="operator">=</span> jedis.mset(<span class="string">&quot;k4&quot;</span>, <span class="string">&quot;v4&quot;</span>, <span class="string">&quot;k5&quot;</span>, <span class="string">&quot;v5&quot;</span>);</span><br><span class="line">        <span class="comment">//获得k3的value</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">getK3</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;k3&quot;</span>);</span><br><span class="line">        <span class="comment">//存储k10并且自加</span></span><br><span class="line">        jedis.set(<span class="string">&quot;k10&quot;</span>,<span class="string">&quot;5&quot;</span>);</span><br><span class="line">        jedis.incr(<span class="string">&quot;k10&quot;</span>);</span><br><span class="line">        <span class="comment">//存储k11并且自加50</span></span><br><span class="line">        jedis.set(<span class="string">&quot;k11&quot;</span>,<span class="string">&quot;100&quot;</span>);</span><br><span class="line">        jedis.incrBy(<span class="string">&quot;k11&quot;</span>, <span class="number">50</span>);</span><br><span class="line">        <span class="comment">//获得k3的字符串长度</span></span><br><span class="line">        jedis.strlen(<span class="string">&quot;k3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作list"><a href="#操作list" class="headerlink" title="操作list"></a>操作list</h3><p>具体命令参考<a href="#redis-list">Redis操作list类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从左边添加元素</span></span><br><span class="line">        jedis.lpush(<span class="string">&quot;list1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//移除左边的元素</span></span><br><span class="line">        jedis.lpop(<span class="string">&quot;list1&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历list1</span></span><br><span class="line">        List&lt;String&gt; list1 = jedis.lrange(<span class="string">&quot;list1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        list1.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//返回list1长度</span></span><br><span class="line">        jedis.llen(<span class="string">&quot;list1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从右边添加元素</span></span><br><span class="line">        jedis.rpush(<span class="string">&quot;list2&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//从右边移除元素</span></span><br><span class="line">        jedis.rpop(<span class="string">&quot;list2&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历list2</span></span><br><span class="line">        List&lt;String&gt; list2 = jedis.lrange(<span class="string">&quot;list2&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        list2.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//返回list2长度</span></span><br><span class="line">        jedis.llen(<span class="string">&quot;list2&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="操作set"><a href="#操作set" class="headerlink" title="操作set"></a>操作set</h3><p>具体命令参考<a href="#redis-set">Redis操作set类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisSet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加元素</span></span><br><span class="line">        jedis.sadd(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//判断元素是否存在</span></span><br><span class="line">        jedis.sismember(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        <span class="comment">//（随机）弹出元素</span></span><br><span class="line">        jedis.spop(<span class="string">&quot;set1&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//移除v1,v2元素</span></span><br><span class="line">        jedis.srem(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历set1</span></span><br><span class="line">        Set&lt;String&gt; smembers = jedis.smembers(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line">        smembers.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//set1长度</span></span><br><span class="line">        jedis.scard(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="操作hash"><a href="#操作hash" class="headerlink" title="操作hash"></a>操作hash</h3><p>具体命令参考<a href="#redis-hash">Redis操作hash类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisHash</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存入对象student1</span></span><br><span class="line">        jedis.hset(<span class="string">&quot;student1&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wqk&quot;</span>);</span><br><span class="line">        HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;18&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;score&quot;</span>,<span class="string">&quot;98&quot;</span>);</span><br><span class="line">        <span class="comment">//批量存入student1</span></span><br><span class="line">        jedis.hmset(<span class="string">&quot;student1&quot;</span>,map);</span><br><span class="line">        <span class="comment">//获取student1对象的name值</span></span><br><span class="line">        jedis.hget(<span class="string">&quot;student1&quot;</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">//批量获取student1对象的name、age、score</span></span><br><span class="line">        jedis.hmget(<span class="string">&quot;student1&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;score&quot;</span>);</span><br><span class="line">        <span class="comment">//获取student1对象的所有field-value</span></span><br><span class="line">        jedis.hgetAll(<span class="string">&quot;student1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="操作zset"><a href="#操作zset" class="headerlink" title="操作zset"></a>操作zset</h3><p>具体命令参考<a href="#redis-zset">Redis操作zset类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisZset</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向zset1添加v1，v2，v3</span></span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset1&quot;</span>,<span class="number">500</span>,<span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset1&quot;</span>,<span class="number">1000</span>,<span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset1&quot;</span>,<span class="number">100</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按照下标遍历zset1</span></span><br><span class="line">        Set&lt;String&gt; zset1 = jedis.zrange(<span class="string">&quot;zset1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        zset1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按照分数遍历zset1</span></span><br><span class="line">        Set&lt;String&gt; zset11 = jedis.zrangeByScore(<span class="string">&quot;zset1&quot;</span>, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">        zset11.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//zset1长度</span></span><br><span class="line">        jedis.zcard(<span class="string">&quot;zset1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis事务-1"><a href="#Redis事务-1" class="headerlink" title="Redis事务"></a>Redis事务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTransaction</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取Redis的事务对象</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">transaction</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        <span class="comment">// start</span></span><br><span class="line">        transaction.set(<span class="string">&quot;k6&quot;</span>,<span class="string">&quot;v6&quot;</span>);</span><br><span class="line">        transaction.set(<span class="string">&quot;k7&quot;</span>,<span class="string">&quot;v7&quot;</span>);</span><br><span class="line">        <span class="comment">// end</span></span><br><span class="line">        transaction.exec(); <span class="comment">//执行事务</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Redis客户端可视化"><a href="#Redis客户端可视化" class="headerlink" title="Redis客户端可视化"></a>Redis客户端可视化</h2><p>一个开源的Redis客户端可视化工具<a target="_blank" rel="noopener" href="https://github.com/uglide/RedisDesktopManager/releases/download/0.8.8/redis-desktop-manager-0.8.8.384.exe">Redis-Desktop-Manager</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/10/08/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/" data-id="clto66l5o002nsck63fnfegcw" data-title="Redis原理和Jedis" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-data-structure/手写LinkedList/LinkedList整合Java" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/" class="article-date">
  <time class="dt-published" datetime="2021-08-30T07:30:39.000Z" itemprop="datePublished">2021-08-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/">利用Java手写LinkedList</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>和ArrayList不同的是，LinkedList是采用链表实现的，链表的特点就是每个节点存储的是value和下个节点的地址，所以不存在类似ArrayList的扩容问题，添加节点只需要一个新的节点对象然后链表末尾指向它就可以了。参考Java官方的LinkedList实现：<code>java.util.LinkedList</code>。不过Java官方使用双向链表实现。</p>
<blockquote>
<p><strong>链表和节点</strong></p>
<p>链表有n多个链表节点组成，每个节点存储的都是元素+下个节点的内存地址。如何得到节点中存储的元素实际上是通过从链表的头一个节点开始迭代，然后得到当前节点。</p>
</blockquote>
<h2 id="私有属性"><a href="#私有属性" class="headerlink" title="私有属性"></a>私有属性</h2><p>动态数组大小<code>size</code>，以及用于存放该动态数组的头节点<code>first</code></p>
<blockquote>
<p><strong>注意</strong>：为什么要有头节点？</p>
<p>是因为链表元素的获取是利用迭代来不断得到next元素的，也就是说你迭代到了中间某一元素后，你就没有办法回溯了，你这个链表就暂时停留在这里了（因为该元素前的所以链表的内存地址已丢失），所以就需要保存一个头节点的内存地址，以确保每次都能够从头开始依次访问链表中的元素</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; first;</span><br><span class="line">    </span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<h2 id="节点类"><a href="#节点类" class="headerlink" title="节点类"></a>节点类</h2><p>通过静态内部类的方式来声明链表中的节点Node类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; first;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态内部类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt;&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 该节点存储的元素</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> E element;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 该节点所指向的下一个节点</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E element, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.element = element;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<p>Node类主要包含节点存储的具体元素、下个节点的内存地址，以及节点的构造方法（指定元素，以及指定下一个节点）。</p>
<h2 id="通过下标获得具体node节点"><a href="#通过下标获得具体node节点" class="headerlink" title="通过下标获得具体node节点"></a>通过下标获得具体node节点</h2><p>链表与数组不同的是，它是利用迭代来定位到具体某个节点的，再很多add、remove的场景中我们可能会经常需要定位到某个具体的节点（因为需要获取该节点前后的节点）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 获取具体某一下标的节点</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> index      下标</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>           该下标的node节点</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">       Node&lt;E&gt; node = first;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">           node = node.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> node;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到上述方法就是通过for循环的方式，node.next不断迭代获得node节点，最后获取到位于index位置的node元素。</p>
<h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><p>LinkedList不同于ArrayList，因为它不需要初始化数组容量，所以它没有构造函数。</p>
<h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2><p>和ArrayList类似，LinkedList具有以下基本方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组是否为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组是否为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">isEmpty</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  1 2 3   4 5 6 7 8</span></span><br><span class="line"><span class="comment">     * 向指定位置添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  a b c 1 d e f g h</span></span><br><span class="line"><span class="comment">     * 移除指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空动态数组中的元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index      位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断数组是否包含该元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           true包含，false不包含</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">contains</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该元素第一次出现的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="size"><a href="#size" class="headerlink" title="size()"></a>size()</h3><p>返回动态数组的大小</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> size; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty()"></a>isEmpty()</h3><p>返回该动态数组是否为空，即判断size是否为0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h3><p>打印该链表，依旧是从头节点开始迭代然后打印</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">StringBuilder</span> <span class="variable">string</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">       string.append(<span class="string">&quot;LinkedList&#123;&quot;</span>);</span><br><span class="line">       string.append(<span class="string">&quot;size=&quot;</span> + size + <span class="string">&quot;, elements=[&quot;</span>);</span><br><span class="line">       Node&lt;E&gt; node = first;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">           string.append(node.element);</span><br><span class="line">           node = node.next;</span><br><span class="line">           <span class="keyword">if</span> (i!=size-<span class="number">1</span>)&#123;</span><br><span class="line">               string.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       string.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">       string.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> string.toString();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="indexOf-和contains"><a href="#indexOf-和contains" class="headerlink" title="indexOf()和contains()"></a>indexOf()和contains()</h3><p>indexOf(E element)就是返回该元素所在的位置下标，如果不存在则返回-1。同样地，利用从first开始迭代node，如果节点的元素等于传入的元素则直接返回该下标。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span> &#123;</span><br><span class="line">    Node&lt;E&gt; node = first;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (node.element).equals(element) ) <span class="keyword">return</span> i;</span><br><span class="line">        node = node.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>contains(E element)就是判断链表是否包含该元素，如果包含则返回true。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(E element)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> indexOf(element) &gt;= <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h3><p>通过节点下标获得该节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> node(index).element;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><p>修改某位置节点的元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">       node(index).element = element;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="add"><a href="#add" class="headerlink" title="add()"></a>add()</h3><p>链表添加元素。链表添加元素的原理大致是：</p>
<ol>
<li>获取该下标位置的前一个节点（目的是拿到该下标位置的地址）</li>
<li>创建一个新的Node节点，将当前位置的地址赋值给该Node节点，同时插入的元素也赋值给该节点</li>
<li>前一个节点next指向新创建的Node节点。</li>
<li>这样原先的前一个节点的next指向新创建的节点，新创建的节点指向原本该下标的节点，这样就完成了插入。最后size++</li>
</ol>
<p>步骤图：</p>
<ol>
<li><p>原链表</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210827171700166.png"></p>
</li>
<li><p>执行插入</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210827172218050.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>)&#123;</span><br><span class="line">            first = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, first);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;E&gt; pNode = node(index - <span class="number">1</span>);             <span class="comment">//当前index的前一个节点</span></span><br><span class="line">            pNode.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, pNode.next);      <span class="comment">//当前节点的下一个节点赋给待添加的节点</span></span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>需要特别注意的就是，如果向第一个位置进行插入，那么利用上述的<code>node(int index)</code>方法是没有办法获取到头节点的前一个节点的（因为不存在）。所以如果是往index为0的位置插入需要额外写方法。逻辑就是直接将first指向新创建的node节点就可以了，同时将原有的first指向存入新创建的node节点。</p>
<h3 id="remove"><a href="#remove" class="headerlink" title="remove()"></a>remove()</h3><p>链表移除元素。原理同样是改变元素指向：</p>
<ol>
<li>获取到移除元素的前一个节点，命名为pNode</li>
<li>将要移除元素的next赋值给pNode.next</li>
<li>这样pNode直接指向要移除元素的下一个元素。最后size–</li>
</ol>
<p>步骤图：</p>
<ol>
<li><p>原链表</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210827181900189.png"></p>
</li>
<li><p>执行删除</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210827181930981.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">       Node&lt;E&gt; indexNode = <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">           indexNode = first;</span><br><span class="line">           first = first.next;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           Node&lt;E&gt; pNode = node(index - <span class="number">1</span>);</span><br><span class="line">           indexNode = pNode.next;</span><br><span class="line">           pNode.next = indexNode.next;</span><br><span class="line">       &#125;</span><br><span class="line">       size--;</span><br><span class="line">       <span class="keyword">return</span> indexNode;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>pNode直接指向当前node.next后，当前node没有被指向了，那么它就会被Java的垃圾回收机制给自动清理掉。同样需要注意的是，如果需要删除第一个元素，你同样也是没办法获取到first的。所以也是需要额外处理，直接将当前的first指向first.next，那么原来first指向的节点也会被Java垃圾回收机制给清理掉。</p>
<h3 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h3><p>清空数组的所有元素，直接置size为0，并且first指向null就可以了，因为first指向null，所以first以及first后面所指向的所有节点都会被销毁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">       size = <span class="number">0</span>;</span><br><span class="line">       first = <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="下标越界"><a href="#下标越界" class="headerlink" title="下标越界"></a>下标越界</h2><p>和ArrayList同样的，在执行add或者remove前都需要检查一下传入的index是否在范围内。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>add()和remove()、get()、set()的index范围有所区别。添加元素允许往动态数组的最后一个位置添加元素，所以index是可以访问到size的，但是删除、查询和修改都是在元素已经在动态数组中存在的基础上，所以index是不可以访问到size的，切记！！！</p>
</blockquote>
<h3 id="checkIndex"><a href="#checkIndex" class="headerlink" title="checkIndex()"></a>checkIndex()</h3><p>检查非添加时的下标index，不能小于0或者不能大于等于size（0&lt;index&lt;size）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkIndex</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;<span class="number">0</span>||index&gt;=size) indexOutOfBoundsException(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="checkIndexAdd"><a href="#checkIndexAdd" class="headerlink" title="checkIndexAdd()"></a>checkIndexAdd()</h3><p>检查添加时下标index，不能小于0或者不能大于size（0&lt;index$\leqslant$size）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkIndexAdd</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;<span class="number">0</span>||index&gt;size) indexOutOfBoundsException(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="indexOutOfBoundsException"><a href="#indexOutOfBoundsException" class="headerlink" title="indexOutOfBoundsException()"></a>indexOutOfBoundsException()</h3><p>下标越界时抛出的自定义异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexOutOfBoundsException</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index=&quot;</span>+index+<span class="string">&quot;, size=&quot;</span>+size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="List接口"><a href="#List接口" class="headerlink" title="List接口"></a>List接口</h2><p>在很多时候一种思想可以用不同的解决办法来实现，比如动态数组就可以利用底层分别是数组和链表的ArrayList和LinkedList来实现，他们需要实现的方法是一样的，但是方法内部的实现是不一样的，所以就可以为他们共同指定一个<strong>“标准”</strong>，这个标准就是<strong>接口</strong>。接口里只定义需要实现的方法（返回值类型、传入的参数、方法名），接口不需要关心方法如何具体实现，只需要指定方法就可以了，这样不同的解决方法就可以有不同的具体实现，虽然是实现同一个方法。就类似公司领导给两个人下达了同一任务，只告诉了这个任务需要什么，并且要得到什么，但是他不关心具体实现过程，由员工来按照要求进行实现。不同员工实现该任务肯定各有优劣，领导就会根据他想要的目的来选用哪个具体的解决方案。</p>
<p>那么List接口应该有如下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">List</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组是否为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组是否为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  1 2 3   4 5 6 7 8</span></span><br><span class="line"><span class="comment">     * 向指定位置添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  a b c 1 d e f g h</span></span><br><span class="line"><span class="comment">     * 移除指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">remove</span><span class="params">(E element)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空动态数组中的元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index      位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index,E element)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断数组是否包含该元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           true包含，false不包含</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(E element)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该元素第一次出现的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AbstractList抽象类"><a href="#AbstractList抽象类" class="headerlink" title="AbstractList抽象类"></a>AbstractList抽象类</h2><p>如果说接口是严格的标准，那么抽象类就是宽松一点的标准，抽象类里可以实现接口，甚至可以预先实现部分方法。通常抽象类实现接口后可以将可能会用到的重复代码或者方法或者属性抽离到抽象类中。</p>
<p>比如ArrayList和LinkedList都需要用到获取动态数组大小和判断动态数组是否为空，那么就可以将这两个方法抽离出来，以及判断index下标是否越界也是可以抽离的。那么AbstractList抽象类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractList</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">List</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * list大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123; <span class="keyword">return</span> size; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123; <span class="keyword">return</span> size == <span class="number">0</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * index超出范围后的报错信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexOutOfBoundsException</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index=&quot;</span>+index+<span class="string">&quot;, size=&quot;</span>+size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查删改查元素的index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">checkIndex</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index&lt;<span class="number">0</span> || index&gt;=size) indexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查增元素的index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">checkIndexForAdd</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index&lt;<span class="number">0</span> || index&gt;size) indexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要特别注意方法和属性的访问范围限制，protected是当前类和子类都能访问，private是只能当前类访问。</p>
<p>所以List接口、AbstractList抽象类、ArrayList和LinkedList类的继承关系如下：</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210830121133007.png"></p>
<h2 id="内存或时间消耗"><a href="#内存或时间消耗" class="headerlink" title="内存或时间消耗"></a>内存或时间消耗</h2><p>ArrayList底层就是数组，数组的存储空间是一串连续的内存地址，是比较省空间的。在add或者remove中间的元素需要不断移动后面的元素，存储空间存储的内存地址不断被重新赋值。往数组末尾添加或者删除元素的时直接加在数组尾或者移除数组尾元素，是不需要移动任何元素的。扩容的时候需要请求内存并且重新循环给数组赋值。如果数组没有被元素填满的话，可能存在浪费。</p>
<p>LinkedList底层是链表，每个节点存储的是元素和下一个节点的内存地址，内存地址是散乱的，在add或者remove的时候只需要改变节点存储的下一个节点的指向就可以了，比较方便，并且不需要扩容，即加一个元素就直接加一个元素，移除一个元素就移除一个元素。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; first;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态内部类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt;&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 该节点存储的元素</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> E element;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 该节点所指向的下一个节点</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E element, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.element = element;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取具体某一下标的节点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index      下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           该下标的node节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        Node&lt;E&gt; node = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            node = node.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span> &#123;</span><br><span class="line">        add(size,element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        checkIndexForAdd(index);</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>)&#123;</span><br><span class="line">            first = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, first);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;E&gt; pNode = node(index - <span class="number">1</span>);             <span class="comment">//当前index的前一个节点</span></span><br><span class="line">            pNode.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, pNode.next);      <span class="comment">//当前节点的下一个节点赋给待添加的节点</span></span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        checkIndex(index);</span><br><span class="line">        Node&lt;E&gt; indexNode = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            indexNode = first;</span><br><span class="line">            first = first.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;E&gt; pNode = node(index - <span class="number">1</span>);</span><br><span class="line">            indexNode = pNode.next;</span><br><span class="line">            pNode.next = indexNode.next;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> indexNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(E element)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> remove(indexOf(element));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        first = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        checkIndex(index);</span><br><span class="line">        node(index).element = element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        checkIndex(index);</span><br><span class="line">        <span class="keyword">return</span> node(index).element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(E element)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> indexOf(element) &gt;= <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span> &#123;</span><br><span class="line">        Node&lt;E&gt; node = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( (node.element).equals(element) ) <span class="keyword">return</span> i;</span><br><span class="line">            node = node.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">string</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        string.append(<span class="string">&quot;LinkedList&#123;&quot;</span>);</span><br><span class="line">        string.append(<span class="string">&quot;size=&quot;</span> + size + <span class="string">&quot;, elements=[&quot;</span>);</span><br><span class="line">        Node&lt;E&gt; node = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            string.append(node.element);</span><br><span class="line">            node = node.next;</span><br><span class="line">            <span class="keyword">if</span> (i!=size-<span class="number">1</span>)&#123;</span><br><span class="line">                string.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        string.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        string.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> string.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="虚拟头节点"><a href="#虚拟头节点" class="headerlink" title="虚拟头节点"></a>虚拟头节点</h2><p>在add以及remove的时候，常常需要判断index是否为0，其实这个时候可以引入虚拟头节点的方式来保证每个节点的前一个节点都是存在的。</p>
<p>即在构造方法中，创建LinkedList对象时候就创建一个虚拟头节点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">LinkedList2</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//虚拟头节点</span></span><br><span class="line">       first = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;E&gt;(<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>同样的，使用index来查找链表中节点的时候，如果index为-1，则返回这个头节点，其余时候正常返回：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">       Node&lt;E&gt; node = first.next;</span><br><span class="line">       <span class="keyword">if</span> (index == -<span class="number">1</span>) <span class="keyword">return</span> first;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">           node = node.next;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> node;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>那么在add或者remove的时候就可以直接获取前一个节点就可以了，即使是index为0的时候，因为index为0时，它的前结点是index为-1的虚拟头节点：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">       checkIndex(index);</span><br><span class="line">       Node&lt;E&gt; preNode = node(index - <span class="number">1</span>);</span><br><span class="line">       preNode.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element,preNode.next);</span><br><span class="line">       size++;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">       checkIndex(index);</span><br><span class="line">       Node&lt;E&gt; preNode = node(index - <span class="number">1</span>);</span><br><span class="line">       Node&lt;E&gt; indexNode = preNode.next;</span><br><span class="line">       preNode.next = indexNode.next;</span><br><span class="line">       size--;</span><br><span class="line">       <span class="keyword">return</span> indexNode;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h2><p>双向链表会在单向链表的基础上增加尾节点的概念，以及节点Node上会多一个前一个节点的内存地址。目的就是为了增加从尾节点开始迭代访问节点的效率。</p>
<blockquote>
<p><strong>与单向链表的差别</strong></p>
<p>单向链表每次访问index位置的元素都是从first开始访问，但是如果链表存储的元素过多，需要访问比较靠后的元素花费的时间就比较长，此时引入双向链表的概念（即last开始访问）。将链表中元素根据size分为前半部分和后半部分，如果index靠近前半部分就从first开始迭代，反之则从last开始迭代。同时node节点中需要使用prev来引用前一个节点的地址。所以其实双向链表是对称的。</p>
</blockquote>
<p>它的结构如图：<img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916160017658.png"></p>
<p>first指向首节点，last指向尾节点</p>
<p>那么它的私有属性以及内部类则就是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//首节点</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; first;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//尾节点</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; last;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//节点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt;&#123;</span><br><span class="line">        <span class="keyword">private</span> E element;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;E&gt; prev;</span><br><span class="line">        <span class="keyword">private</span> Node&lt;E&gt; next;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E element, Node&lt;E&gt; prev, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.element = element;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>则它根据index获取对应位置的节点的方法就是：</p>
<p>index与一半size进行比较，如果index位于前半部分则从first开始迭代，反正则从last开始迭代。（提高了时间效率，不再像单向链表一样每次都从前往后迭代访问）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 双向链表可以根据index距离头节点更近或者尾节点更近来选择从那边开始迭代</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          node节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">private</span> Node&lt;E&gt; <span class="title function_">node</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">halfSize</span> <span class="operator">=</span> size &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;=halfSize) &#123;<span class="comment">//如果要访问的下标在前一半链表</span></span><br><span class="line">        Node&lt;E&gt; node = first;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            node = node.next;   <span class="comment">//依次往后迭代</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//如果要访问的下标在后一半链表</span></span><br><span class="line">        Node&lt;E&gt; node = last;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size-<span class="number">1</span>; i &gt; index ; i--) &#123;</span><br><span class="line">            node = node.prev;   <span class="comment">//依次往前迭代</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add-1"><a href="#add-1" class="headerlink" title="add"></a>add</h3><p>与单向链表会有一些差别，因为涉及到prev引用。</p>
<h4 id="普遍情况（size-1并且不是往首或尾添加）"><a href="#普遍情况（size-1并且不是往首或尾添加）" class="headerlink" title="普遍情况（size &gt; 1并且不是往首或尾添加）"></a>普遍情况（size &gt; 1并且不是往首或尾添加）</h4><ol>
<li><p>获取到当前index位置的节点（命名nextNode）以及它的前一个位置的节点（命名prevNode）</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916162609681.png"></p>
</li>
<li><p>创建一个Node对象，它的prev指向prevNode，它的next指向nextNode</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916162816569.png"></p>
</li>
<li><p>prevNode的next指向新创建的Node对象，nextNode的prev指向新创建的Node对象，完成add操作</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916162903772.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;E&gt; nextNode = node(index);<span class="comment">//index位置的节点</span></span><br><span class="line">Node&lt;E&gt; prevNode = nextNode.prev;<span class="comment">//index位置的前节点</span></span><br><span class="line">Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, prevNode, nextNode);<span class="comment">//新加入的节点</span></span><br><span class="line">prevNode.next = node;</span><br><span class="line">nextNode.prev = node;</span><br></pre></td></tr></table></figure>



<h4 id="空链表的情况（size-0）"><a href="#空链表的情况（size-0）" class="headerlink" title="空链表的情况（size &#x3D; 0）"></a>空链表的情况（size &#x3D; 0）</h4><p>直接创建一个节点，该节点的prev和next都为null，然后链表的first和last都指向该节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">first = node;</span><br><span class="line">last = node;</span><br></pre></td></tr></table></figure>



<h4 id="向首位置插入（index-0-且-size-0）"><a href="#向首位置插入（index-0-且-size-0）" class="headerlink" title="向首位置插入（index &#x3D; 0 且 size &gt; 0）"></a>向首位置插入（index &#x3D; 0 且 size &gt; 0）</h4><p>（如果size为0往首位置插入实际上就是往空链表插入所以和上面的情况没差别则不讨论）</p>
<ol>
<li><p>首先获取到插入前的首节点，即first（命名为oldFirst）</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916163630499.png"></p>
</li>
<li><p>创建新的节点node，它的next指向oldFirst，prev指向null</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916163736932.png"></p>
</li>
<li><p>first指向新的节点node，之前的oldFirst的prev指向新的节点，完成add操作</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916164001023.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;E&gt; oldFirst = first;	<span class="comment">//获取first节点</span></span><br><span class="line">Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, <span class="literal">null</span>, oldFirst);</span><br><span class="line">first = node;</span><br><span class="line">oldFirst.prev = node;</span><br></pre></td></tr></table></figure>



<h4 id="向尾位置插入（index-size且size-0）"><a href="#向尾位置插入（index-size且size-0）" class="headerlink" title="向尾位置插入（index &#x3D; size且size&gt;0）"></a>向尾位置插入（index &#x3D; size且size&gt;0）</h4><p>和向首位置插入基本类似，对称的。</p>
<ol>
<li><p>获取原本的尾节点oldLast</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916164456330.png"></p>
</li>
<li><p>创建新的节点node，它的prev指向oldLast，next指向null</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916164540759.png"></p>
</li>
<li><p>链表的last指向新创建node节点，oldLast的next也指向新创建的node节点，完成add操作</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916164631987.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;E&gt; oldLast = last; <span class="comment">//原本的最后一个元素</span></span><br><span class="line">Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, oldLast, <span class="literal">null</span>);</span><br><span class="line">last = node;</span><br><span class="line">oldLast.next = node;</span><br></pre></td></tr></table></figure>

<h4 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">    checkIndexForAdd(index);</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;    <span class="comment">//链表中还没有任何元素（即即将添加的是第一个元素）</span></span><br><span class="line">        Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        first = node;</span><br><span class="line">        last = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;    <span class="comment">//链表中已经存在至少一个元素</span></span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;   <span class="comment">//往第一个位置添加元素</span></span><br><span class="line">            Node&lt;E&gt; oldFirst = first;</span><br><span class="line">            Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, <span class="literal">null</span>, oldFirst);</span><br><span class="line">            first = node;</span><br><span class="line">            oldFirst.prev = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == size)&#123;  <span class="comment">//往最后一个位置添加元素</span></span><br><span class="line">            Node&lt;E&gt; oldLast = last; <span class="comment">//原本的最后一个元素</span></span><br><span class="line">            Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, oldLast, <span class="literal">null</span>);</span><br><span class="line">            last = node;</span><br><span class="line">            oldLast.next = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">//往中间添加元素</span></span><br><span class="line">            Node&lt;E&gt; nextNode = node(index);<span class="comment">//index位置的节点</span></span><br><span class="line">            Node&lt;E&gt; prevNode = nextNode.prev;<span class="comment">//index位置的前节点</span></span><br><span class="line">            Node&lt;E&gt; node = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(element, prevNode, nextNode);<span class="comment">//新加入的节点</span></span><br><span class="line">            prevNode.next = node;</span><br><span class="line">            nextNode.prev = node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="remove-1"><a href="#remove-1" class="headerlink" title="remove"></a>remove</h3><p>remove移除节点考虑的和add差不太多，主要也是考虑没有节点时候的删除以及删除首或者尾节点</p>
<h4 id="普遍情况（size-1-且不是从首或尾移除）"><a href="#普遍情况（size-1-且不是从首或尾移除）" class="headerlink" title="普遍情况（size &gt; 1 且不是从首或尾移除）"></a>普遍情况（size &gt; 1 且不是从首或尾移除）</h4><ol>
<li><p>获取到当前index位置节点（indexNode）的前一个节点（prevNode）以及它的后一个节点（nextNode）</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916165410816.png"></p>
</li>
<li><p>prevNode的next指向nextNode，nextNode的prev指向prevNode（此时indexNode没有被引用，根据Java垃圾回收机制就会被清空），remove操作完成</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916165457243.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;E&gt; indexNode = node(index);    <span class="comment">//当前index的节点</span></span><br><span class="line">Node&lt;E&gt; prevNode = indexNode.prev;  <span class="comment">//当前index的前一节点</span></span><br><span class="line">Node&lt;E&gt; nextNode = indexNode.next;  <span class="comment">//当前index的后一节点</span></span><br><span class="line">prevNode.next = nextNode;</span><br><span class="line">nextNode.prev = prevNode;</span><br></pre></td></tr></table></figure>

<h4 id="链表中只有一个元素（size-1）"><a href="#链表中只有一个元素（size-1）" class="headerlink" title="链表中只有一个元素（size &#x3D; 1）"></a>链表中只有一个元素（size &#x3D; 1）</h4><p>直接first和last都指向null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">first = <span class="literal">null</span>;</span><br><span class="line">last = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<h4 id="移除首节点（size-1-且-index-0）"><a href="#移除首节点（size-1-且-index-0）" class="headerlink" title="移除首节点（size &gt; 1 且 index &#x3D; 0）"></a>移除首节点（size &gt; 1 且 index &#x3D; 0）</h4><ol>
<li><p>获取到首节点first，以及首节点的下一个节点first.next</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916170144977.png"></p>
</li>
<li><p>first.next的prev指向null，然后链表的first指向first.next（此时之前的first节点没有被指向了，就会被垃圾回收掉），此时remove操作完成</p>
<p><img src="/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/image-20210916170429403.png"></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">first.next.prev = <span class="literal">null</span>;</span><br><span class="line">first = first.next;</span><br></pre></td></tr></table></figure>



<h4 id="移除尾节点（size-1-且-index-size-1-）"><a href="#移除尾节点（size-1-且-index-size-1-）" class="headerlink" title="移除尾节点（size &gt; 1 且 index &#x3D; size -1 ）"></a>移除尾节点（size &gt; 1 且 index &#x3D; size -1 ）</h4><p>移除尾节点和移除首节点类似，只是first换为last，并且prev换位next</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">last.prev.next = <span class="literal">null</span>;</span><br><span class="line">last = last.prev;</span><br></pre></td></tr></table></figure>

<h4 id="合并-1"><a href="#合并-1" class="headerlink" title="合并"></a>合并</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">       checkIndex(index);</span><br><span class="line">       Node&lt;E&gt; indexNode = <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">if</span> (size == <span class="number">1</span>) &#123;    <span class="comment">//只有一个元素的时候</span></span><br><span class="line">           indexNode = first;</span><br><span class="line">           first = <span class="literal">null</span>;</span><br><span class="line">           last = <span class="literal">null</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;    <span class="comment">//至少两个元素</span></span><br><span class="line">           <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;  <span class="comment">//移除第一个元素</span></span><br><span class="line">               indexNode = first;</span><br><span class="line">               first.next.prev = <span class="literal">null</span>;</span><br><span class="line">               first = first.next;</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == size -<span class="number">1</span>) &#123;  <span class="comment">//移除最后一个元素</span></span><br><span class="line">               indexNode = last;</span><br><span class="line">               last.prev.next = <span class="literal">null</span>;</span><br><span class="line">               last = last.prev;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               indexNode = node(index);            <span class="comment">//当前index的节点</span></span><br><span class="line">               Node&lt;E&gt; prevNode = indexNode.prev;  <span class="comment">//当前index的前一节点</span></span><br><span class="line">               Node&lt;E&gt; nextNode = indexNode.next;  <span class="comment">//当前index的后一节点</span></span><br><span class="line">               prevNode.next = nextNode;</span><br><span class="line">               nextNode.prev = prevNode;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       size--;</span><br><span class="line">       <span class="keyword">return</span> indexNode.element;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="clear-1"><a href="#clear-1" class="headerlink" title="clear"></a>clear</h3><p>即first和last都指向null，并且size &#x3D; 0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">    first = <span class="literal">null</span>;</span><br><span class="line">    last = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="lastIndexOf"><a href="#lastIndexOf" class="headerlink" title="lastIndexOf"></a>lastIndexOf</h3><p>增加了可以从链表尾部开始查找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lastIndexOf</span><span class="params">(E element)</span> &#123;</span><br><span class="line">    Node&lt;E&gt; node = last;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (node.element).equals(element) ) <span class="keyword">return</span> i;</span><br><span class="line">        node = node.prev;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单向链表和双向链表的区别"><a href="#单向链表和双向链表的区别" class="headerlink" title="单向链表和双向链表的区别"></a>单向链表和双向链表的区别</h2><p>双向链表引入了尾节点，可以从尾节点开始迭代访问节点元素，在一定程度上增加了效率，并且通过index与size&#x2F;2进行比较，决定是从哪边开始访问。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/08/30/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/" data-id="clto66l4y0011sck6d0sub98w" data-title="利用Java手写LinkedList" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-data-structure/手写ArrayList/ArrayList整合Java" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/" class="article-date">
  <time class="dt-published" datetime="2021-08-19T07:30:39.000Z" itemprop="datePublished">2021-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/">利用Java来手写ArrayList</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>几乎所有的语言都会有数组，Java也不例外。数组有个特点就是在初始化的时候必须确定长度，即使容量到达了也无法自动扩容，无法满足需求，所以我们可以利用动态数组（ArrayList）来实现可以自动扩容的数组。参考Java官方的ArrayList实现：<code>java.util.ArrayList</code>。ArrayList的底层还是数组，相当于数组的强化版，能够进行自动扩容并且进行数据的增删改查。</p>
<blockquote>
<p><strong>注意：</strong></p>
<p>以下利用<strong>动态数组</strong>来表示<code>ArrayList</code>，利用<strong>数组</strong>来表示<code>Object[]</code></p>
</blockquote>
<h2 id="私有属性"><a href="#私有属性" class="headerlink" title="私有属性"></a>私有属性</h2><p>最起码需要表示动态数组的大小<code>size</code>，存放数据的基本数组<code>elements[]</code>，所以应该有以下属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> E[] elements;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里使用到了泛型，是为了方便顺序存储相似的数据（类型相同的数据）</p>
<h2 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h2><p>无参构造方法：创建一个默认容量的数组；</p>
<p>有参构造方法：创建一个指定容量的数组。</p>
<p>既然涉及到默认，那我们可以指定一个常量为默认容量，可以按照自己的需求来，随便多少都可以。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动态数组默认容量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 无参构造，创建默认大小的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 有参构造，根据容量创建数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> capacity      自定义容量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> capacity)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：</strong></p>
<p>容量（capacity）是指该动态数组能够容纳多少个元素，而不代表它里面已经存了多少个元素，通常情况数组的长度<code>elements.length</code>和他相等。</p>
<p>大小（size）是指该动态数组已经有多少个元素。</p>
</blockquote>
<h3 id="无参构造"><a href="#无参构造" class="headerlink" title="无参构造"></a>无参构造</h3><p>创建默认容量的Object数组，再强制类型转换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span>&#123;</span><br><span class="line">    elements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[DEFAULT_CAPACITY];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="有参构造"><a href="#有参构造" class="headerlink" title="有参构造"></a>有参构造</h3><p>创建指定容量的数组，需要控制一下传入的容量大小，不允许为负数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> capacity)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (capacity&lt;=<span class="number">0</span>) capacity = DEFAULT_CAPACITY; <span class="comment">//如果传入容量不为自然数，则强制为默认容量</span></span><br><span class="line">    elements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2><p>仿造<code>java.util.ArrayList</code>，得出以下基本方法包含基本的添加删除查询元素等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组是否为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组是否为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">isEmpty</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  1 2 3   4 5 6 7 8</span></span><br><span class="line"><span class="comment">     * 向指定位置添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  a b c 1 d e f g h</span></span><br><span class="line"><span class="comment">     * 移除指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空动态数组中的元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index      位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断数组是否包含该元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           true包含，false不包含</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">contains</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该元素第一次出现的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="size"><a href="#size" class="headerlink" title="size()"></a>size()</h3><p>返回动态数组的大小</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty()"></a>isEmpty()</h3><p>返回动态数组是否为空，判断size是否为0</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">isEmpty</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h3><p>打印动态数组，这个按照自己的需求来就可以了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">string</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    string.append(<span class="string">&quot;ArrayList&#123;&quot;</span>);</span><br><span class="line">    string.append(<span class="string">&quot;size=&quot;</span> + size + <span class="string">&quot;, elements=[&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        string.append(elements[i]);</span><br><span class="line">        <span class="keyword">if</span> (i != size -<span class="number">1</span>) &#123; <span class="comment">//最后一个元素末尾不添加逗号</span></span><br><span class="line">            string.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    string.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    string.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> string.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="indexOf-和contains"><a href="#indexOf-和contains" class="headerlink" title="indexOf()和contains()"></a>indexOf()和contains()</h3><p>indexOf()返回的元素第一次出现的下标（循环数组，如果有该元素则返回下标，下标为-1则表示没有该元素）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (elements[i].equals(element)) <span class="keyword">return</span> i; <span class="comment">//如果element存在返回下标</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>contains()判断是否存在该元素，利用indexOf()来判断，如果存在下标则说明存在该元素，不存在下标则不存在该元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Boolean <span class="title function_">contains</span><span class="params">(E element)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> indexOf(element) &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h3><p>返回指定下标的数组元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> elements[index];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><p>向指定下标塞入元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;</span><br><span class="line">    elements[index] = element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="add"><a href="#add" class="headerlink" title="add()"></a>add()</h3><p>添加元素，向动态数组末尾添加元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span>&#123;</span><br><span class="line">    elements[size] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重载方法add(int index, E element)向指定位置添加元素，原来的元素会依次向后挪动。元素挪动的目的是为了空出index下标的元素，所以index下标及其后面的元素都需要<strong>依次往后挪动</strong>。挪动的顺序应是</p>
<p><img src="/2021/08/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/image-20210818184937456.png"></p>
<p>注意第一是先挪动最后一个，如果你从index才是挪动后面的会被覆盖。依次挪动然后index下标处元素就会被空出来，然后塞入要插入的元素即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size; i &gt; index ; i--) &#123; <span class="comment">//元素依次往后挪动</span></span><br><span class="line">        elements[i] = elements[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    elements[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同理，其实add(E element)就是往动态数组末尾添加元素，所以可以直接调用重载方法，指定下标为末尾（size）就可以了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span>&#123;</span><br><span class="line">    add(size,element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="remove"><a href="#remove" class="headerlink" title="remove()"></a>remove()</h3><p>移除指定位置的元素，移除指定位置的元素之后，指定位置的元素会被删除，然后指定位置后面的元素会<strong>依次往前挪动</strong>。</p>
<p><img src="/2021/08/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/image-20210818185906721.png"></p>
<p>注意，实际上不用硬性删除指定的元素，在Java的特性中，只要某一内存地址没有再被指向那么它就会被垃圾回收掉（视为删除），所以直接用后面的元素直接覆盖掉指定下标的元素，原来的元素的地址就没有被指向了，所以就会被删除，最后再将末尾的一个元素置为null即可。但是需要注意的是删除是先挪动前面再挪动后面，如果从后往前挪会被覆盖掉。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="type">E</span> <span class="variable">element</span> <span class="operator">=</span> elements[index];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt; size-<span class="number">1</span> ; i++) &#123; <span class="comment">//元素依次往前挪</span></span><br><span class="line">        elements[i] = elements[i+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    elements[size-<span class="number">1</span>] = <span class="literal">null</span>; <span class="comment">//将数组的最后一个元素置为null</span></span><br><span class="line">    size--;</span><br><span class="line">    <span class="keyword">return</span> element;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h3><p>清空动态数组，直接将所有位置置为null即可，那么之前的元素的地址就不没有被指向了，就会被删除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        elements[i] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="下标越界"><a href="#下标越界" class="headerlink" title="下标越界"></a>下标越界</h2><p>在上述方法传入index的时候，可能会出现index越界的情况，比如为负数或者超出上限，所以需要控制index的有效范围，并且在每次传入进行检查就可以了，错误就抛出异常。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>add()和remove()、get()、set()的index范围有所区别。添加元素允许往动态数组的最后一个位置添加元素，所以index是可以访问到size的，但是删除、查询和修改都是在元素已经在动态数组中存在的基础上，所以index是不可以访问到size的，切记！！！</p>
</blockquote>
<h3 id="checkIndex"><a href="#checkIndex" class="headerlink" title="checkIndex()"></a>checkIndex()</h3><p>检查非添加时的下标index，不能小于0或者不能大于等于size（0&lt;index&lt;size）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkIndex</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;<span class="number">0</span>||index&gt;=size) indexOutOfBoundsException(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="checkIndexAdd"><a href="#checkIndexAdd" class="headerlink" title="checkIndexAdd()"></a>checkIndexAdd()</h3><p>检查添加时下标index，不能小于0或者不能大于size（0&lt;index$\leqslant$​size）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkIndexAdd</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index&lt;<span class="number">0</span>||index&gt;size) indexOutOfBoundsException(index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="indexOutOfBoundsException"><a href="#indexOutOfBoundsException" class="headerlink" title="indexOutOfBoundsException()"></a>indexOutOfBoundsException()</h3><p>下标越界时抛出的自定义异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexOutOfBoundsException</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index=&quot;</span>+index+<span class="string">&quot;, size=&quot;</span>+size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态扩容"><a href="#动态扩容" class="headerlink" title="动态扩容"></a>动态扩容</h2><p>动态数组相较于传统数组的优势就是能够动态扩容，但其实底层仍然是利用数组扩容，实质就是利用新的容量的数组来装填原来的数据，这当中会涉及到很多底层的内存消耗以及资源最优化的问题，这里不讲解，主要讲解如何实现。</p>
<p>扩容也只可能会在添加元素的时候发生，并且是添加元素时的动态数组的size也就是元素个数刚好达到容量这个时候就该扩容了：</p>
<ol>
<li>判断动态数组元素个数已经达到数组容量，说明已经满了需要扩容了</li>
<li>新的数组容量为当前数组容量的1.5倍</li>
<li>以新的数组容量大小创建数组</li>
<li>旧数组依次向新的数组赋值</li>
<li>旧数组的指针指向新数组</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;</span><br><span class="line">    <span class="comment">//检查index</span></span><br><span class="line">    checkIndexAdd(index);</span><br><span class="line">    <span class="comment">//容量扩容</span></span><br><span class="line">    <span class="keyword">if</span> (size == elements.length)&#123; <span class="comment">//如果动态数组得大小已经达到数组容量（已满）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">nowCapacity</span> <span class="operator">=</span> elements.length;                  <span class="comment">//当前动态数组容量就是数组长度</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> nowCapacity + (nowCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">//扩容至当前容量得1.5倍</span></span><br><span class="line">        E[] newElements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[newCapacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123; <span class="comment">//旧数组依次向新数组中赋值</span></span><br><span class="line">            newElements[i] = elements[i];</span><br><span class="line">        &#125;</span><br><span class="line">        elements = newElements;     <span class="comment">//elements对象指向newElements</span></span><br><span class="line">        System.out.println(nowCapacity + <span class="string">&quot;扩容至&quot;</span> + newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size; i &gt; index ; i--) &#123; <span class="comment">//元素依次往后挪动</span></span><br><span class="line">        elements[i] = elements[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    elements[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们将数组扩容单独提出来（提高可维护性和可读性）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == elements.length)&#123; <span class="comment">//如果动态数组得大小已经达到数组容量（已满）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">nowCapacity</span> <span class="operator">=</span> elements.length;                  <span class="comment">//当前动态数组容量就是数组长度</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> nowCapacity + (nowCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">//扩容至当前容量得1.5倍</span></span><br><span class="line">        E[] newElements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[newCapacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123; <span class="comment">//旧数组依次向新数组中赋值</span></span><br><span class="line">            newElements[i] = elements[i];</span><br><span class="line">        &#125;</span><br><span class="line">        elements = newElements;     <span class="comment">//elements对象指向newElements</span></span><br><span class="line">        System.out.println(nowCapacity + <span class="string">&quot;扩容至&quot;</span> + newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//至此，动态数组扩容完毕</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>综合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == elements.length)&#123; <span class="comment">//如果动态数组得大小已经达到数组容量（已满）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">nowCapacity</span> <span class="operator">=</span> elements.length;                  <span class="comment">//当前动态数组容量就是数组长度</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> nowCapacity + (nowCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">//扩容至当前容量得1.5倍</span></span><br><span class="line">        E[] newElements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[newCapacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123; <span class="comment">//旧数组依次向新数组中赋值</span></span><br><span class="line">            newElements[i] = elements[i];</span><br><span class="line">        &#125;</span><br><span class="line">        elements = newElements;     <span class="comment">//elements对象指向newElements</span></span><br><span class="line">        System.out.println(nowCapacity + <span class="string">&quot;扩容至&quot;</span> + newCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;</span><br><span class="line">    checkIndexAdd(index);</span><br><span class="line">    ensureCapacity();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size; i &gt; index ; i--) &#123; <span class="comment">//元素依次往后挪动</span></span><br><span class="line">        elements[i] = elements[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    elements[index] = element;</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="缩容"><a href="#缩容" class="headerlink" title="缩容"></a>缩容</h2><p>在很多时候可能动态数组中没有使用的位置占比较多时，就可以使用缩容来节省空间。比如动态数组容量由于不断add然后扩容到了1000个，但是这个时候只用了100个来装元素，剩下的900个都没用装元素，这个时候其实是浪费的。所以可以考虑采用缩容的方式来节省空间。</p>
<p>remove</p>
<p>如果当前数组大小（元素个数）比当前容量的一半还要小并且当前容量大于默认容量时开始缩容：创建一个新的数组（大小为原容量的一半），然后旧数组依次赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">       checkIndex(index);</span><br><span class="line">       <span class="comment">//缩容开始</span></span><br><span class="line">       <span class="type">int</span> <span class="variable">nowCapacity</span> <span class="operator">=</span> elements.length;  <span class="comment">//当前容量</span></span><br><span class="line">       <span class="keyword">if</span> ( size &lt;= nowCapacity&gt;&gt;<span class="number">1</span> &amp;&amp; nowCapacity&gt;DEFAULT_CAPACITY)&#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> nowCapacity&gt;&gt;<span class="number">1</span>; <span class="comment">//即nowCapacity/2</span></span><br><span class="line">           E[] newElements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[newCapacity];</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">               newElements[i] = elements[i];</span><br><span class="line">           &#125;</span><br><span class="line">           elements = newElements;</span><br><span class="line">           System.out.println(nowCapacity + <span class="string">&quot;缩容至&quot;</span> + newCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//缩容结束</span></span><br><span class="line">       <span class="type">E</span> <span class="variable">element</span> <span class="operator">=</span> elements[index];</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt; size-<span class="number">1</span> ; i++) &#123; <span class="comment">//元素依次往前挪</span></span><br><span class="line">           elements[i] = elements[i+<span class="number">1</span>];</span><br><span class="line">       &#125;</span><br><span class="line">       elements[size-<span class="number">1</span>] = <span class="literal">null</span>; <span class="comment">//将数组的最后一个元素置为null</span></span><br><span class="line">       size--;</span><br><span class="line">       <span class="keyword">return</span> element;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>即trim()：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 缩容（在动态数组中未使用的部分过大时缩容）</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">trim</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">nowCapacity</span> <span class="operator">=</span> elements.length;  <span class="comment">//当前容量</span></span><br><span class="line">       <span class="comment">//如果当前数组元素个数比当前容量的一半还要小，并且容量是大于默认容量的则开始缩容</span></span><br><span class="line">       <span class="keyword">if</span> ( size &lt;= nowCapacity&gt;&gt;<span class="number">1</span> &amp;&amp; nowCapacity&gt;DEFAULT_CAPACITY)&#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> nowCapacity&gt;&gt;<span class="number">1</span>; <span class="comment">//即nowCapacity/2</span></span><br><span class="line">           E[] newElements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[newCapacity];</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">               newElements[i] = elements[i];</span><br><span class="line">           &#125;</span><br><span class="line">           elements = newElements;</span><br><span class="line">           System.out.println(nowCapacity + <span class="string">&quot;缩容至&quot;</span> + newCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>remove()：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">       checkIndex(index);</span><br><span class="line">       trim();         <span class="comment">//缩容</span></span><br><span class="line">       <span class="type">E</span> <span class="variable">element</span> <span class="operator">=</span> elements[index];</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt; size-<span class="number">1</span> ; i++) &#123; <span class="comment">//元素依次往前挪</span></span><br><span class="line">           elements[i] = elements[i+<span class="number">1</span>];</span><br><span class="line">       &#125;</span><br><span class="line">       elements[size-<span class="number">1</span>] = <span class="literal">null</span>; <span class="comment">//将数组的最后一个元素置为null</span></span><br><span class="line">       size--;</span><br><span class="line">       <span class="keyword">return</span> element;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在解决了动态数组的大小、元素存放的数组等属性和一些基本的添加、删除、修改和查询方法后，以及对<strong>下标越界</strong>的处理和<strong>最核心的动态扩容</strong>部分解决后，一个最基本的动态数组ArrayList就大致完成了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> E[] elements;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组默认容量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_CAPACITY</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 无参构造，创建默认大小的数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">()</span>&#123;</span><br><span class="line">        elements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[DEFAULT_CAPACITY];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 有参构造，根据容量创建数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> capacity      自定义容量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArrayList</span><span class="params">(<span class="type">int</span> capacity)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (capacity&lt;=<span class="number">0</span>) capacity = DEFAULT_CAPACITY; <span class="comment">//如果传入容量不为自然数，则强制为默认容量</span></span><br><span class="line">        elements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[capacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 动态数组是否为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      动态数组是否为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">isEmpty</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下班超出范围的报错信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">indexOutOfBoundsException</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IndexOutOfBoundsException</span>(<span class="string">&quot;index=&quot;</span>+index+<span class="string">&quot;, size=&quot;</span>+size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查添加元素时候的index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkIndexForAdd</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index&lt;<span class="number">0</span>||index&gt;size) indexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查删改查时的index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">checkIndex</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (index&lt;<span class="number">0</span>||index&gt;=size) indexOutOfBoundsException(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 确保容量（如果动态数组元素大小达到当前动态数组的容量满了则扩容）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ensureCapacity</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size == elements.length)&#123; <span class="comment">//如果动态数组得大小已经达到数组容量（已满）</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">nowCapacity</span> <span class="operator">=</span> elements.length;                  <span class="comment">//当前动态数组容量就是数组长度</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> nowCapacity + (nowCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">//扩容至当前容量得1.5倍</span></span><br><span class="line">            E[] newElements = (E[]) <span class="keyword">new</span> <span class="title class_">Object</span>[newCapacity];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123; <span class="comment">//旧数组依次向新数组中赋值</span></span><br><span class="line">                newElements[i] = elements[i];</span><br><span class="line">            &#125;</span><br><span class="line">            elements = newElements;     <span class="comment">//elements对象指向newElements</span></span><br><span class="line">            System.out.println(nowCapacity + <span class="string">&quot;扩容至&quot;</span> + newCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E element)</span>&#123;</span><br><span class="line">        add(size,element);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  1 2 3   4 5 6 7 8</span></span><br><span class="line"><span class="comment">     * 向指定位置添加元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (element == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;不允许添加null&quot;</span>);</span><br><span class="line">        checkIndexForAdd(index);</span><br><span class="line">        ensureCapacity();                     <span class="comment">//确保数组容量（如果容量满了则扩容）</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size; i &gt; index ; i--) &#123; <span class="comment">//元素依次往后挪动</span></span><br><span class="line">            elements[i] = elements[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        elements[index] = element;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  0 1 2 3 4 5 6 7 8 9</span></span><br><span class="line"><span class="comment">     *  a b c 1 d e f g h</span></span><br><span class="line"><span class="comment">     * 移除指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        checkIndex(index);</span><br><span class="line">        trim();</span><br><span class="line">        <span class="type">E</span> <span class="variable">element</span> <span class="operator">=</span> elements[index];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt; size-<span class="number">1</span> ; i++) &#123; <span class="comment">//元素依次往前挪</span></span><br><span class="line">            elements[i] = elements[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        elements[size-<span class="number">1</span>] = <span class="literal">null</span>; <span class="comment">//将数组的最后一个元素置为null</span></span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除指定元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element   元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">remove</span><span class="params">(E element)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> remove(indexOf(element));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空动态数组中的元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            elements[i] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index      位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> index,E element)</span>&#123;</span><br><span class="line">        checkIndex(index);</span><br><span class="line">        elements[index] = element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得指定位置的元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index     位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>          元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span>&#123;</span><br><span class="line">        checkIndex(index);</span><br><span class="line">        <span class="keyword">return</span> elements[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断数组是否包含该元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           true包含，false不包含</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">contains</span><span class="params">(E element)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> indexOf(element) &gt;= <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该元素第一次出现的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> element    元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(E element)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (elements[i].equals(element)) <span class="keyword">return</span> i; <span class="comment">//如果element存在返回下标</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">string</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        string.append(<span class="string">&quot;ArrayList&#123;&quot;</span>);</span><br><span class="line">        string.append(<span class="string">&quot;size=&quot;</span> + size + <span class="string">&quot;, elements=[&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            string.append(elements[i]);</span><br><span class="line">            <span class="keyword">if</span> (i != size -<span class="number">1</span>) &#123; <span class="comment">//最后一个元素末尾不添加逗号</span></span><br><span class="line">                string.append(<span class="string">&quot;, &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        string.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        string.append(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> string.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2021/08/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/" data-id="clto66l4x000zsck65x943072" data-title="利用Java来手写ArrayList" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; 上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OIDC/" rel="tag">OIDC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/" rel="tag">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernates/" rel="tag">kubernates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/GRPC/" style="font-size: 13.33px;">GRPC</a> <a href="/tags/Golang/" style="font-size: 18.33px;">Golang</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/OIDC/" style="font-size: 13.33px;">OIDC</a> <a href="/tags/Spring/" style="font-size: 13.33px;">Spring</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 11.67px;">docker</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/http/" style="font-size: 11.67px;">http</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/kubernates/" style="font-size: 10px;">kubernates</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 11.67px;">redis</a> <a href="/tags/uni-app/" style="font-size: 10px;">uni-app</a> <a href="/tags/vue/" style="font-size: 16.67px;">vue</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.67px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 11.67px;">数据结构</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 11.67px;">网络安全</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.67px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/12/back-end/go/Goroutine%E8%B0%83%E5%BA%A6%E5%99%A8GMP/">Goroutine调度器GMP</a>
          </li>
        
          <li>
            <a href="/2024/01/31/back-end/docker/dockerfile/">dockerfile</a>
          </li>
        
          <li>
            <a href="/2023/11/07/network/caddy/http%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">利用Caddy实现http反向代理</a>
          </li>
        
          <li>
            <a href="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/">结合OIDC和Cookie实现SSO</a>
          </li>
        
          <li>
            <a href="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/">Java集合</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 FanGaoXS<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>