<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>FanGaoXS&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="FanGaoXS&#39;s blog">
<meta property="og:url" content="https://fangaoxs.github.io/page/5/index.html">
<meta property="og:site_name" content="FanGaoXS&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="FanGaoXS">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="FanGaoXS's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FanGaoXS&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fangaoxs.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-back-end/go/golang库/cobra" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/golang%E5%BA%93/cobra/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/golang%E5%BA%93/cobra/">cobra命令行程序库</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>cobra</code>是一个命令行程序库，可以用来编写命令行程序。同时，它还提供了一个脚手架，用于生成基于cobra的应用程序。知名的开源项目：<code>Kubernates</code>、<code>Hugo</code>、<code>etcd</code>等。</p>
<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>安装第三方库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/spf13/cobra/cobra</span><br></pre></td></tr></table></figure>

<p>依据darjun的指引，我们尝试实现一个简单的命令行程序git，当然并不是真正的git，而是模拟其命令行，最后其实还是通过调用<code>os/exec</code>库调用外部程序去执行真正的git命令，返回其结果。</p>
<p>目录结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">quick_start</span><br><span class="line">  ├── cmd</span><br><span class="line">  │   ├── helper.go</span><br><span class="line">  │   ├── root.go</span><br><span class="line">  │   └── version.go</span><br><span class="line">  └── main.go</span><br></pre></td></tr></table></figure>



<p>root.go</p>
<p><strong>根命令git</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rootCmd = &amp;cobra.Command&#123;</span><br><span class="line">	Use:   <span class="string">&quot;git&quot;</span>,</span><br><span class="line">	Short: <span class="string">&quot;Git is a distributed version control system.&quot;</span>,</span><br><span class="line">	Long: <span class="string">`Git is a free and open source distributed version control system</span></span><br><span class="line"><span class="string">designed to handle everything from small to very large projects </span></span><br><span class="line"><span class="string">with speed and efficiency.`</span>,</span><br><span class="line">	Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">		Error(cmd, args, errors.New(<span class="string">&quot;unimplemented command&quot;</span>))</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Execute</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 执行root及其子命令</span></span><br><span class="line">	<span class="keyword">if</span> err := rootCmd.Execute(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;execute root command failed&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>version.go</p>
<p><strong>子命令git version</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">&quot;github.com/spf13/cobra&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> versionCmd = &amp;cobra.Command&#123;</span><br><span class="line">	Use:   <span class="string">&quot;version&quot;</span>,</span><br><span class="line">	Short: <span class="string">&quot;version subcommand show git version info.&quot;</span>,</span><br><span class="line">	Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 使用exec库直接执行 git version 命令</span></span><br><span class="line">		command := exec.Command(<span class="string">&quot;git&quot;</span>, <span class="string">&quot;version&quot;</span>)</span><br><span class="line">		output, err := command.CombinedOutput()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			Error(cmd, args, err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		fmt.Print(<span class="type">string</span>(output)) <span class="comment">// 打印执行的结果</span></span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 将version命令添加为root命令的子命令</span></span><br><span class="line">	rootCmd.AddCommand(versionCmd)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;lib_cobra/quick_start/cmd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   cmd.Execute() <span class="comment">// 执行root命令</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>terminal</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ go build -o diygit main.go <span class="comment"># 为了避免和真正的git冲突，我们将其命名为diygit</span></span><br><span class="line">&gt; $ diygit -h</span><br><span class="line">Git is a free and open <span class="built_in">source</span> distributed version control system</span><br><span class="line">designed to handle everything from small to very large projects </span><br><span class="line">with speed and efficiency.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  git [flags]</span><br><span class="line">  git [<span class="built_in">command</span>]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  completion  Generate the autocompletion script <span class="keyword">for</span> the specified shell</span><br><span class="line">  <span class="built_in">help</span>        Help about any <span class="built_in">command</span></span><br><span class="line">  version     version subcommand show git version info.</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --<span class="built_in">help</span>   <span class="built_in">help</span> <span class="keyword">for</span> git</span><br><span class="line"></span><br><span class="line">Use <span class="string">&quot;git [command] --help&quot;</span> <span class="keyword">for</span> more information about a <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">&gt; $ diygit version -h</span><br><span class="line">version subcommand show git version info.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  git version [flags]</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">  -h, --<span class="built_in">help</span>   <span class="built_in">help</span> <span class="keyword">for</span> version</span><br><span class="line"></span><br><span class="line">&gt; $ diygit version</span><br><span class="line">git version 2.26.2</span><br></pre></td></tr></table></figure>

<p>此时的经过go build后的<code>diygit</code>即是<code>git</code>命令</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>使用cobra构建命令行工具时，程序的目录结构推荐使用以下结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">app_name</span><br><span class="line">  ├── cmd</span><br><span class="line">  │   ├── root.go</span><br><span class="line">  │   ├── cmd1.go</span><br><span class="line">  │   ├── cmd2.go</span><br><span class="line">  │   └── cmd3.go</span><br><span class="line">  └── main.go</span><br></pre></td></tr></table></figure>

<p>cmd下的每个文件实现一个命令，外层的main.go的作用仅仅是初始化root命令。</p>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><p>cobra提供非常丰富的功能：</p>
<ul>
<li>支持子命令，如<code>app server</code>，<code>app fetch</code></li>
<li>支持长短选项，如<code>-v</code>，<code>--verbose</code></li>
<li>子命令嵌套</li>
<li>全局、本地层级选项</li>
<li>使用脚手架自动生成程序和命令</li>
</ul>
<p>三个基本概念：</p>
<ul>
<li>命令（Command）：需要执行的操作</li>
<li>参数（Args）：命令的参数，即操作的对象</li>
<li>选项（Flag）：命令选项可以调整命令的行为</li>
</ul>
<p>如示例<code>git branch -D dev</code>，<code>branch</code>是子命令，<code>-D</code>是该子命令的选项，<code>dev</code>是该子命令的参数</p>
<p>如示例<code>curl -X example.com</code>，<code>curl</code>是命令，<code>-X</code>是该命令的选项，<code>example.com</code>是该参数</p>
<h3 id="命令（Command）"><a href="#命令（Command）" class="headerlink" title="命令（Command）"></a>命令（Command）</h3><p>每个命令基本上只需要对<code>cobra.Command</code>的<code>Use</code>、<code>Short</code>、<code>Long</code>、<code>Run</code>四个属性进行赋值差不多就可以了。</p>
<ul>
<li>Use：命令的使用信息。Tips：在这里可以解释如何使用该命令，但是只有该属性的第一个词会被录入到<strong>help</strong>即帮助信息中</li>
<li>Short：命令的短描述，可以通过<code>--help</code>查看</li>
<li>Long：命令的长描述，可以通过<code>--help &lt;command&gt; </code>查看</li>
<li>Run：该命令的具体执行逻辑，类型是<code>func(cmd *cobra.Command, args []string)</code>，其中cmd是该命令本身的一些属性，args是该命令的选项列表。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;cobra.Command&#123;</span><br><span class="line">   Use:   <span class="string">&quot;&quot;</span>,</span><br><span class="line">   Short: <span class="string">&quot;&quot;</span>,	</span><br><span class="line">   Long:  <span class="string">&quot;&quot;</span>,</span><br><span class="line">   Run:   <span class="literal">nil</span>,	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很多时候，还可以使用<code>Args</code>属性，类型是<code>func(cmd *cobra.Command, args []string) error</code>，它可以帮助你提前校验<code>args</code>是否符合规范，如果不符合，请返回err</p>
<h3 id="选项（Flag）"><a href="#选项（Flag）" class="headerlink" title="选项（Flag）"></a>选项（Flag）</h3><p>cobra的选项分为两种，一种是<strong>永久选项</strong>，该选项可以被定义它的命令及其子命令使用。另一种是<strong>本地选项</strong>，只能在定义它的命令中使用。cobra使用pflag来解析命令后选项，pflag的使用基本和flag相同。</p>
<ul>
<li><p>定义好存储选项的变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	Sex  <span class="type">bool</span></span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>


</li>
<li><p>设置永久选项</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registerCmd.PersistentFlags().BoolVarP(&amp;Sex, <span class="string">&quot;sex&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;sex of user&quot;</span>)</span><br></pre></td></tr></table></figure>


</li>
<li><p>设置本地选项</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">registerCmd.Flags().StringVar(&amp;Name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;name of user&quot;</span>)</span><br><span class="line">registerCmd.Flags().IntVarP(&amp;Age, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="number">0</span>, <span class="string">&quot;age of user&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><code>TypeVar</code>和<code>TypeVarP</code>的区别在于，后者支持短选项。</p>
</li>
</ul>
<p>使用<code>id</code>和<code>uuid</code>联合来移除用户的简单操作：如果id或者uuid存在则使用id或者uuid来移除用户，如果同时存在，则联合来移除。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	Id   <span class="type">string</span></span><br><span class="line">	Uuid <span class="type">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> removeCmd = &amp;cobra.Command&#123;</span><br><span class="line">	Use:   <span class="string">&quot;remove&quot;</span>,</span><br><span class="line">	Short: <span class="string">&quot;remove user&quot;</span>,</span><br><span class="line">	Long:  <span class="string">&quot;remove user with given information&quot;</span>,</span><br><span class="line">	Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">		removeUser(Id, Uuid)</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">removeUser</span><span class="params">(id <span class="type">string</span>, uuid <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// do remove</span></span><br><span class="line">	<span class="keyword">if</span> id != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;remove user with id: %s\n&quot;</span>, id)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> uuid != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;remove user with uuid: %s\n&quot;</span>, uuid)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> id != <span class="string">&quot;&quot;</span> &amp;&amp; uuid != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;remove user with id: %s and uuid: %s\n&quot;</span>, id, uuid)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	removeCmd.Flags().StringVar(&amp;Id, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;id of user&quot;</span>)</span><br><span class="line">	removeCmd.Flags().StringVar(&amp;Uuid, <span class="string">&quot;uuid&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;uuid of user&quot;</span>)</span><br><span class="line">	rootCmd.AddCommand(removeCmd)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://darjun.github.io/2020/01/17/godailylib/cobra/">每日一库之cobra</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/golang%E5%BA%93/cobra/" data-id="clsblyuf3002kw0k602t8cpup" data-title="cobra命令行程序库" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cobra/" rel="tag">cobra</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/golang库/dig" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/golang%E5%BA%93/dig/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/golang%E5%BA%93/dig/">Go的依赖注入库dig</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是dig？"><a href="#什么是dig？" class="headerlink" title="什么是dig？"></a>什么是dig？</h2><p><a target="_blank" rel="noopener" href="https://github.com/uber-go/dig">dig</a>是uber的开源的实现了依赖注入的一个库。如果你熟悉Java的话，我相信你对大名鼎鼎的Spring以及SpringIoC一定会有所了解，SpringIoC就是Java的依赖注入的实现。而dig则是golang的依赖注入的实现，不过dig很小巧且简洁，只不过易用性相较于SpringIoC会差一点。</p>
<h2 id="第一个dig应用"><a href="#第一个dig应用" class="headerlink" title="第一个dig应用"></a>第一个dig应用</h2><ol>
<li>从配置文件中读取配置信息</li>
<li>利用读取到的配置信息初始化简单的App对象</li>
<li>最后对User对象进行打印</li>
</ol>
<h3 id="安装库"><a href="#安装库" class="headerlink" title="安装库"></a>安装库</h3><p>由于需要读取配置文件，所以我们需要用到<a target="_blank" rel="noopener" href="https://github.com/joho/godotenv">godotenv</a>库，如果你不会使用它，没关系，它很简单。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get go.uber.org/dig</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">go get github.com/joho/godotenv</span></span><br></pre></td></tr></table></figure>



<h3 id="具体实现逻辑"><a href="#具体实现逻辑" class="headerlink" title="具体实现逻辑"></a>具体实现逻辑</h3><p>.env文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app_name = test-demo</span><br><span class="line">app_creator = FanGaoXS</span><br><span class="line">app_version = 0.0.1</span><br></pre></td></tr></table></figure>

<p>从<code>.env</code>中读取配置信息：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> EnvOption <span class="keyword">struct</span> &#123;</span><br><span class="line">	AppName    <span class="type">string</span></span><br><span class="line">	AppCreator <span class="type">string</span></span><br><span class="line">	AppVersion <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitEnv</span><span class="params">()</span></span> (*EnvOption, <span class="type">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 从根目录下的.env文件中读取配置文件（以key-value的形式）</span></span><br><span class="line">  <span class="comment">// 返回key-value的map</span></span><br><span class="line">	envMap, err := godotenv.Read(<span class="string">&quot;.env&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;EnvOption&#123;</span><br><span class="line">		AppName:    envMap[<span class="string">&quot;app_name&quot;</span>],</span><br><span class="line">		AppCreator: envMap[<span class="string">&quot;app_creator&quot;</span>],</span><br><span class="line">		AppVersion: envMap[<span class="string">&quot;app_version&quot;</span>],</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该func的不需要其他依赖，并且返回值是EnvOption实例。</p>
<p>构建App对象：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> App <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="type">string</span></span><br><span class="line">	Version <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitApp</span><span class="params">(opt *EnvOption)</span></span> *App &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;App&#123;</span><br><span class="line">		Name:    opt.AppName,</span><br><span class="line">		Version: opt.AppVersion,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该func需要EnvOption实例，返回App实例。</p>
<p>最后对App对象进行打印：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printApp</span><span class="params">(app *App)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;app = %#v\n&quot;</span>, app)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该func需要App实例，没有返回。</p>
<h3 id="自动依赖注入"><a href="#自动依赖注入" class="headerlink" title="自动依赖注入"></a>自动依赖注入</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1, 创建容器</span></span><br><span class="line">	container := dig.New()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2, 将对象的构造函数provide</span></span><br><span class="line">	container.Provide(InitEnv)</span><br><span class="line">	container.Provide(InitApp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3, 将函数需要的依赖从容器中注入</span></span><br><span class="line">	container.Invoke(printApp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h3><p>我们可以简单来理一下这个依赖关系：</p>
<p>printApp依赖于InitApp，InitApp依赖于InitEnv</p>
<p>传统依赖关系</p>
<p><img src="/2023/07/19/back-end/go/golang%E5%BA%93/dig/image-20220519181851161.png"></p>
<p>使用依赖注入容器思想的依赖关系</p>
<p><img src="/2023/07/19/back-end/go/golang%E5%BA%93/dig/image-20220519181915991.png"></p>
<p>可以看到，传统的依赖关系是依赖于具体某个函数或者及其返回值。但是使用依赖注入思想的依赖关系，则是将依赖放入容器当中，然后需要某个依赖直接从容器中取用。这样不仅可以解决对象可能会复用的问题，还可以解决复杂的依赖链问题。（注意，此处所指的<code>依赖注入思想</code>不局限于<code>dig</code>库，适用于所有实现了<code>依赖注入思想</code>的库）。</p>
<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jessevdk/go-flags&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/joho/godotenv&quot;</span></span><br><span class="line">	<span class="string">&quot;go.uber.org/dig&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> EnvOption <span class="keyword">struct</span> &#123;</span><br><span class="line">	AppName    <span class="type">string</span></span><br><span class="line">	AppCreator <span class="type">string</span></span><br><span class="line">	AppVersion <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitEnv</span><span class="params">()</span></span> (*EnvOption, <span class="type">error</span>) &#123;</span><br><span class="line">	envMap, err := godotenv.Read(<span class="string">&quot;.env&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;EnvOption&#123;</span><br><span class="line">		AppName:    envMap[<span class="string">&quot;app_name&quot;</span>],</span><br><span class="line">		AppCreator: envMap[<span class="string">&quot;app_creator&quot;</span>],</span><br><span class="line">		AppVersion: envMap[<span class="string">&quot;app_version&quot;</span>],</span><br><span class="line">	&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> App <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="type">string</span></span><br><span class="line">	Version <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitApp</span><span class="params">(opt *EnvOption)</span></span> *App &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;App&#123;</span><br><span class="line">		Name:    opt.AppName,</span><br><span class="line">		Version: opt.AppVersion,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printApp</span><span class="params">(app *App)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;app = %#v\n&quot;</span>, app)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1, 创建容器</span></span><br><span class="line">	container := dig.New()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2, 将对象的构造函数provide</span></span><br><span class="line">	container.Provide(InitEnv)</span><br><span class="line">	container.Provide(InitApp)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3, 将函数需要的依赖从容器中注入</span></span><br><span class="line">	container.Invoke(printApp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips</p>
<p>需要特别注意的是，即使是provide简单的对象，也不能直接provide对象的地址，而是利用使用函数返回对象，然后provide该函数。</p>
<p>e.g:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误示范：</span></span><br><span class="line">u = NewUser()</span><br><span class="line">container.Provide(u) &lt;=&gt; container.Provider(NewUser()) :</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 正确示范：</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUser</span><span class="params">()</span></span> *User&#123;<span class="keyword">return</span> NewUser()&#125;</span><br><span class="line">container.Provide(initUser)</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="参数对象"><a href="#参数对象" class="headerlink" title="参数对象"></a>参数对象</h2><p>有的时候，如果某个func需要多个依赖，像这样：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">container.Provide(<span class="function"><span class="keyword">func</span> <span class="params">(arg1 *Arg1, arg2 *Arg2, arg3 *Arg3, ....)</span></span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我们可以利用<code>dig.In</code>将它们合并起来：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Args &#123;</span><br><span class="line">  dig.In</span><br><span class="line"></span><br><span class="line">  Arg1 *Arg1</span><br><span class="line">  Arg2 *Arg2</span><br><span class="line">  Arg3 *Arg3</span><br><span class="line">  Arg4 *Arg4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">container.Provide(<span class="function"><span class="keyword">func</span> <span class="params">(args Args)</span></span> *Object &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><ol>
<li>依旧是从.env中读User对象和Shoe对象的配置信息，构建Option实例并且返回</li>
<li>分别利用Option初始化User和Shoe对象</li>
<li>打印User和Shoe对象</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> UserEnv <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ShoeEnv <span class="keyword">struct</span> &#123;</span><br><span class="line">	Brand <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Option <span class="keyword">struct</span> &#123;</span><br><span class="line">	User *UserEnv</span><br><span class="line">	Shoe *ShoeEnv</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitEnv</span><span class="params">()</span></span> *Option &#123;</span><br><span class="line">	envMap, err := godotenv.Read(<span class="string">&quot;.env&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;read env err&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	age, _ := strconv.Atoi(envMap[<span class="string">&quot;user_age&quot;</span>])</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> &amp;Option&#123;</span><br><span class="line">		User: &amp;UserEnv&#123;</span><br><span class="line">			Name: envMap[<span class="string">&quot;user_name&quot;</span>],</span><br><span class="line">			Age:  age,</span><br><span class="line">		&#125;,</span><br><span class="line">		Shoe: &amp;ShoeEnv&#123;</span><br><span class="line">			Brand: envMap[<span class="string">&quot;shoe_brand&quot;</span>],</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUser</span><span class="params">(opt *env.Option)</span></span> *model.User &#123;</span><br><span class="line">	<span class="keyword">return</span> model.NewUser(opt.User.Name, opt.User.Age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initShoe</span><span class="params">(opt *env.Option)</span></span> *model.Shoe &#123;</span><br><span class="line">	<span class="keyword">return</span> model.NewShoe(opt.Shoe.Brand)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Args 在invoke的时候，方便直接使用Args结构体对象的属性来进行调用</span></span><br><span class="line"><span class="comment">// 如arg.User来使用容器中的user实例</span></span><br><span class="line"><span class="keyword">type</span> Args <span class="keyword">struct</span> &#123;</span><br><span class="line">	dig.In</span><br><span class="line"></span><br><span class="line">	User *model.User</span><br><span class="line">	Shoe *model.Shoe</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用dig.In</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">print</span><span class="params">(args Args)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;user = %#v\n&quot;</span>, args.User)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;shoe = %#v\n&quot;</span>, args.Shoe)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	container := dig.New()</span><br><span class="line"></span><br><span class="line">	container.Provide(env.InitEnv)</span><br><span class="line">	container.Provide(initUser)</span><br><span class="line">	container.Provide(initShoe)</span><br><span class="line"></span><br><span class="line">	container.Invoke(<span class="built_in">print</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到，最后打印的时候，直接使用了args实例里的User对象和Shoe对象。</p>
<p>等价于：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Args <span class="keyword">struct</span> &#123;</span><br><span class="line">	User *model.User</span><br><span class="line">	Shoe *model.Shoe</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用dig.In</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">print</span><span class="params">(user *model.User,shoe *model.Shoe)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;user = %#v\n&quot;</span>, user)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;shoe = %#v\n&quot;</span>, shoe)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="结果对象"><a href="#结果对象" class="headerlink" title="结果对象"></a>结果对象</h2><p>类似的，如果一个函数返回多个结果，像这样：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">container.Provide(<span class="function"><span class="keyword">func</span> <span class="params">()</span></span> (result1, result2, result4, result4, <span class="type">error</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>可以使用<code>dig.Out</code>将它们合并起来：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Results <span class="keyword">struct</span> &#123;</span><br><span class="line">  dig.Out</span><br><span class="line"></span><br><span class="line">  Result1 *Result1</span><br><span class="line">  Result2 *Result2</span><br><span class="line">  Result3 *Result3</span><br><span class="line">  Result4 *Result4</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">container.Provide(<span class="function"><span class="keyword">func</span> <span class="params">()</span></span> (Results, <span class="type">error</span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>将上一个节的思想稍作修改：</p>
<ol>
<li>从<code>.env</code>文件中读取user和shoe的配置信息，并且构建option实例</li>
<li>利用option构建user和shoe</li>
<li>打印user和shoe</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Result <span class="keyword">struct</span> &#123;</span><br><span class="line">	dig.Out</span><br><span class="line"></span><br><span class="line">	User *model.User</span><br><span class="line">	Shoe *model.Shoe</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用dig.out的时候，返回值直接返回包含dig.out的结构体实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUserAndShoe</span><span class="params">(opt *env.Option)</span></span> Result &#123;</span><br><span class="line">	<span class="keyword">return</span> Result&#123;</span><br><span class="line">		User: &amp;model.User&#123;</span><br><span class="line">			Name: opt.User.Name,</span><br><span class="line">			Age:  opt.User.Age,</span><br><span class="line">		&#125;,</span><br><span class="line">		Shoe: &amp;model.Shoe&#123;</span><br><span class="line">			Brand: opt.Shoe.Brand,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用dig.out：直接使用具体的对象实例，而不是Result实例的属性：</span></span><br><span class="line"><span class="comment">// 如直接使用User实例，而不是Result.User实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printInfo</span><span class="params">(user *model.User, shoe *model.Shoe)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;user = %#v\n&quot;</span>, user)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;shoe = %#v\n&quot;</span>, shoe)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	container := dig.New()</span><br><span class="line"></span><br><span class="line">	container.Provide(env.InitEnv)</span><br><span class="line">	container.Provide(initUserAndShoe)</span><br><span class="line"></span><br><span class="line">	err := container.Invoke(printInfo)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到在初始化User和Shoe对象时，将user和shoe实例合并返回了。但是在使用的时候，则是分别使用User和Shoe对象。</p>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><p>有的时候我们可能需要同一结构体的不同实例，如使用不同的user实例，我们可以利用<code>dig.Name</code>来分别将它们命名，然后再使用指定的实例就可以了。</p>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造函数不能返回结构体对象，应当返回函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUser</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>)</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> *model.User &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> *model.User &#123;</span><br><span class="line">		<span class="keyword">return</span> &amp;model.User&#123;Name: name, Age: age&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UsersInArg <span class="keyword">struct</span> &#123;</span><br><span class="line">	dig.In</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 指定名称来使用</span></span><br><span class="line">	U1 *model.User <span class="string">`name:&quot;u1&quot;`</span></span><br><span class="line">	U2 *model.User <span class="string">`name:&quot;u2&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintUsers</span><span class="params">(arg UsersInArg)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;user1 = %#v\n&quot;</span>, arg.U1)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;user2 = %#v\n&quot;</span>, arg.U2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	container := dig.New()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将同一结构体的不同对象放入容器当中，需要命名，并且再取用的时候需要利用dig.in并且指定名称来使用</span></span><br><span class="line">	container.Provide(initUser(<span class="string">&quot;t1&quot;</span>, <span class="number">18</span>), dig.Name(<span class="string">&quot;u1&quot;</span>))</span><br><span class="line">	container.Provide(initUser(<span class="string">&quot;t2&quot;</span>, <span class="number">20</span>), dig.Name(<span class="string">&quot;u2&quot;</span>))</span><br><span class="line"></span><br><span class="line">	container.Invoke(PrintUsers)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>provide的时候将两个不同的user实例放入了容器，并且为它们命了名，这样在使用的时候就可以结合<code>dig.In</code>和tag：<code>name:&quot;xx&quot;</code>来使用。</p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>和上述情况类似的，如果将同一结构体的多个不同对象放入容器中，但是并不需要指定某个名称来使用，就可以利用<code>dig.Group</code>将它们分组。</p>
<h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUser</span><span class="params">(name <span class="type">string</span>, age <span class="type">int</span>)</span></span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> *model.User &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> *model.User &#123;</span><br><span class="line">		<span class="keyword">return</span> &amp;model.User&#123;Name: name, Age: age&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Args <span class="keyword">struct</span> &#123;</span><br><span class="line">	dig.In</span><br><span class="line"></span><br><span class="line">	Users []*model.User <span class="string">`group:&quot;user&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printInfo</span><span class="params">(args Args)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i, u := <span class="keyword">range</span> args.Users &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;user[%d] = %#v\n&quot;</span>, i, u)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	container := dig.New()</span><br><span class="line"></span><br><span class="line">	container.Provide(initUser(<span class="string">&quot;u1&quot;</span>, <span class="number">18</span>), dig.Group(<span class="string">&quot;user&quot;</span>))</span><br><span class="line">	container.Provide(initUser(<span class="string">&quot;u2&quot;</span>, <span class="number">18</span>), dig.Group(<span class="string">&quot;user&quot;</span>))</span><br><span class="line"></span><br><span class="line">	container.Invoke(printInfo)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>provide的时候将多个user实例放入了容器，并且使用<code>dig.Group</code>将它们分了组，最后使用<code>dig.In</code>和tag：<code>group:&quot;user&quot;</code>来访问该实例列表。由于是将实例分组，所以<strong>并不保证访问实例的顺序</strong>。</p>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><p>在使用<code>invoke</code>的时候常常会返回一些错误</p>
<ul>
<li>无法找到依赖，或依赖创建失败；</li>
<li><code>Invoke</code>执行的函数返回<code>error</code>，该错误也会被传给调用者。</li>
</ul>
<p>这两种情况，我们都可以判断<code>Invoke</code>的返回值来查找原因。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>dig GitHub：<a target="_blank" rel="noopener" href="https://github.com/uber-go/dig">https://github.com/uber-go/dig</a></li>
<li>darjun每日一库：<a target="_blank" rel="noopener" href="https://darjun.github.io/2020/02/22/godailylib/dig/">https://darjun.github.io/2020/02/22/godailylib/dig/</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/golang%E5%BA%93/dig/" data-id="clsblyuf4002mw0k6dype1d3r" data-title="Go的依赖注入库dig" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dig/" rel="tag">dig</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Redis/redis入门/redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/">Redis原理和Jedis</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Redis是什么？"><a href="#Redis是什么？" class="headerlink" title="Redis是什么？"></a>Redis是什么？</h2><p>Redis 是完全开源的，遵守 BSD 协议，是一个高性能的 <strong>key-value 数据库</strong>。（B&#x2F;S架构）</p>
<p>Redis 与其他 key - value 缓存产品有以下三个特点：</p>
<ul>
<li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>
</ul>
<h2 id="Redis的优势"><a href="#Redis的优势" class="headerlink" title="Redis的优势"></a>Redis的优势</h2><ul>
<li><strong>性能极高</strong> – Redis能读的速度是110000次&#x2F;s,写的速度是81000次&#x2F;s 。</li>
<li><strong>丰富的数据类型</strong> – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li>
<li><strong>原子</strong> – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。</li>
<li>丰富的特性 – Redis还支持 publish&#x2F;subscribe, 通知, key 过期等等特性。</li>
</ul>
<h2 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h2><h3 id="Windows环境下安装"><a href="#Windows环境下安装" class="headerlink" title="Windows环境下安装"></a>Windows环境下安装</h3><ol>
<li><p>下载压缩包</p>
<p>github：<a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></p>
</li>
<li><p>解压缩</p>
</li>
<li><p>配置环境变量</p>
<p>添加REDIS_HOME系统变量：<img src="/2023/07/19/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/image-20210915225059349.png"></p>
<p>再配置环境变量path（即在path中添加）：<img src="/2023/07/19/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/image-20210915225208358.png"></p>
</li>
<li><p>试运行</p>
<p>尝试在任何地方使用cmd运行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure>

<p>如果出现如下内容则证明redis安装成功并且环境变量配置成功：<img src="/2023/07/19/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/image-20210915225404024.png"></p>
</li>
</ol>
<h3 id="linux环境下安装"><a href="#linux环境下安装" class="headerlink" title="linux环境下安装"></a>linux环境下安装</h3><blockquote>
<p>Redis默认端口号：6379</p>
</blockquote>
<h2 id="Redis服务端"><a href="#Redis服务端" class="headerlink" title="Redis服务端"></a>Redis服务端</h2><h3 id="服务端启动Redis服务"><a href="#服务端启动Redis服务" class="headerlink" title="服务端启动Redis服务"></a>服务端启动Redis服务</h3><ol>
<li><p>前台启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server</span><br></pre></td></tr></table></figure>


</li>
<li><p>后台启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server &amp;</span><br></pre></td></tr></table></figure>


</li>
<li><p>指定配置文件启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server &lt;config_name&gt; [&amp;] (是否后台启动)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="服务端停止Redis服务"><a href="#服务端停止Redis服务" class="headerlink" title="服务端停止Redis服务"></a>服务端停止Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure>



<h2 id="Redis客户端"><a href="#Redis客户端" class="headerlink" title="Redis客户端"></a>Redis客户端</h2><p>Redis分为客户端和服务端。客户端用于连接Redis服务，并且向Redis服务端发送命令。</p>
<h3 id="启动cli客户端"><a href="#启动cli客户端" class="headerlink" title="启动cli客户端"></a>启动cli客户端</h3><p>使用以下命令即可启动redis的客户端程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli   		<span class="comment">#默认连接127.0.0.1:6379的redis服务</span></span><br><span class="line">	[-p port]		<span class="comment">#指定端口号</span></span><br><span class="line">	[-h hostname]	<span class="comment">#指定主机地址</span></span><br></pre></td></tr></table></figure>



<h3 id="退出cli客户端"><a href="#退出cli客户端" class="headerlink" title="退出cli客户端"></a>退出cli客户端</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span> [quit]</span><br></pre></td></tr></table></figure>



<h2 id="Redis基本知识"><a href="#Redis基本知识" class="headerlink" title="Redis基本知识"></a>Redis基本知识</h2><h3 id="服务端测试Redis性能"><a href="#服务端测试Redis性能" class="headerlink" title="服务端测试Redis性能"></a>服务端测试Redis性能</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark</span><br></pre></td></tr></table></figure>

<h3 id="客户端查看Redis服务是否正常运行"><a href="#客户端查看Redis服务是否正常运行" class="headerlink" title="客户端查看Redis服务是否正常运行"></a>客户端查看Redis服务是否正常运行</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;ping</span><br><span class="line">PONG	<span class="comment">#返回PONG说明Redis服务正常运行</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端查看Redis服务的统计信息"><a href="#客户端查看Redis服务的统计信息" class="headerlink" title="客户端查看Redis服务的统计信息"></a>客户端查看Redis服务的统计信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;info	<span class="comment">#返回redis服务的所有相关信息</span></span><br><span class="line">	[section]			<span class="comment">#查看具体某一指定端的信息</span></span><br></pre></td></tr></table></figure>

<h3 id="Redis数据库实例"><a href="#Redis数据库实例" class="headerlink" title="Redis数据库实例"></a>Redis数据库实例</h3><p>Redis的数据库实例只能由Redis服务来创建和维护，开发人员不能修改和自行创建数据库实例。默认情况下，Redis会自动创建16个数据库实例，并且这些数据库实例由编号来区别，由0—15来使用。Redis的数据库实例本身占用的存储空间很少。Redis客户端默认连接的是编号为0的数据库实例。</p>
<h4 id="客户端切换数据库实例"><a href="#客户端切换数据库实例" class="headerlink" title="客户端切换数据库实例"></a>客户端切换数据库实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;<span class="keyword">select</span> [index]	<span class="comment">#根据编号切换数据库实例</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端查看数据库实例记录数（key的数量）"><a href="#客户端查看数据库实例记录数（key的数量）" class="headerlink" title="客户端查看数据库实例记录数（key的数量）"></a>客户端查看数据库实例记录数（key的数量）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;dbsize</span><br><span class="line">(<span class="built_in">integer</span>) 2					<span class="comment">#返回key的数量		</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端查看当前数据库实例所有key"><a href="#客户端查看当前数据库实例所有key" class="headerlink" title="客户端查看当前数据库实例所有key"></a>客户端查看当前数据库实例所有key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;keys [pattern] [*] <span class="comment"># * 所有</span></span><br><span class="line">1) <span class="string">&quot;key:__rand_int__&quot;</span>	</span><br><span class="line">2) <span class="string">&quot;k1&quot;</span>						<span class="comment">#返回有哪些key</span></span><br></pre></td></tr></table></figure>

<h4 id="客户端清空当前数据库实例"><a href="#客户端清空当前数据库实例" class="headerlink" title="客户端清空当前数据库实例"></a>客户端清空当前数据库实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;flushdb</span><br></pre></td></tr></table></figure>

<h4 id="客户端清空所有数据库实例"><a href="#客户端清空所有数据库实例" class="headerlink" title="客户端清空所有数据库实例"></a>客户端清空所有数据库实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;flushall</span><br></pre></td></tr></table></figure>

<h4 id="客户端查看当前Redis服务的配置信息"><a href="#客户端查看当前Redis服务的配置信息" class="headerlink" title="客户端查看当前Redis服务的配置信息"></a>客户端查看当前Redis服务的配置信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt;config get [param] [*]</span><br></pre></td></tr></table></figure>

<h2 id="Redis的五种数据结构"><a href="#Redis的五种数据结构" class="headerlink" title="Redis的五种数据结构"></a>Redis的五种数据结构</h2><p>Redis支持五种数据类型：string（字符串），list（列表），hash（哈希），set（集合）及zset(sorted set：有序集合)。</p>
<h3 id="string（字符串）"><a href="#string（字符串）" class="headerlink" title="string（字符串）"></a>string（字符串）</h3><p>string是redis最基本的类型，一个key对应一个value，是<strong>二进制安全</strong>的。可以包含任何数据，比如jpg图片或者序列化的对象。</p>
<p>最大能存储<strong>512MB</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">set</span> key value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; SET runoob <span class="string">&quot;菜鸟教程&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; GET runoob</span><br><span class="line"><span class="string">&quot;菜鸟教程&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="list（列表）"><a href="#list（列表）" class="headerlink" title="list（列表）"></a>list（列表）</h3><p>简单的字符串列表，按照<strong>插入顺序</strong>排序，可以添加元素到头部或者尾部</p>
<p>列表最多可存储 2^32^ - 1 元素 (4294967295, 每个列表可存储40多亿)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; lpush key member</span><br><span class="line">cli&gt; lrange key start end <span class="comment">#从start到end遍历key列表</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; lpush runoob redis</span><br><span class="line">127.0.0.1:6379&gt; lpush runoob mongodb</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange runoob 0 10</span><br><span class="line">1) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">2) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="set（集合）"><a href="#set（集合）" class="headerlink" title="set（集合）"></a>set（集合）</h3><p>字符串的<strong>无序</strong>集合（基于哈希表实现，故不能插入重复的value）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sadd key member	<span class="comment">#成功返回1，失败返回0（如重复）</span></span><br><span class="line">cli&gt; smembers key		<span class="comment">#遍历key集合</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; sadd runoob redis</span><br><span class="line">127.0.0.1:6379&gt; sadd runoob mongodb</span><br><span class="line">127.0.0.1:6379&gt; smembers runoob	</span><br><span class="line">1) <span class="string">&quot;redis&quot;</span></span><br><span class="line">2) <span class="string">&quot;mongodb&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="hash（哈希）"><a href="#hash（哈希）" class="headerlink" title="hash（哈希）"></a>hash（哈希）</h3><p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象。</p>
<p>每个 hash 可以存储 2^32^ -1 键值对（40多亿）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#存入key对象，其中属性field1的值为value1，属性filed2的值为value2</span></span><br><span class="line">cli&gt; HMSET key field1 value1 field2 value2</span><br><span class="line"><span class="comment">#获取key对象中属性为filed的值value</span></span><br><span class="line">cli&gt; HGET key filed</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; HMSET runoob field1 <span class="string">&quot;Hello&quot;</span> field2 <span class="string">&quot;World&quot;</span></span><br><span class="line"><span class="string">&quot;OK&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HGET runoob field1</span><br><span class="line"><span class="string">&quot;Hello&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; HGET runoob field2</span><br><span class="line"><span class="string">&quot;World&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="zset（有序集合）"><a href="#zset（有序集合）" class="headerlink" title="zset（有序集合）"></a>zset（有序集合）</h3><p>Redis zset 和 set 一样也是string类型元素的集合,且<strong>不允许重复</strong>的成员。</p>
<p>不同的是每个元素都会<strong>关联</strong>一个double类型的分数（score）。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p>zset的成员是唯一的,但分数(score)却可以重复。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zadd key score member</span><br><span class="line">cli&gt; zrangebyscore key start end <span class="comment">#根据具体分数（score必须在start和end范围内）排序</span></span><br><span class="line">cli&gt; zrange key start end		 <span class="comment">#排序（根据分数）</span></span><br><span class="line"></span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 redis</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 mongodb</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 rabbitmq</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd runoob 0 rabbitmq</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZRANGEBYSCORE runoob 0 1000</span><br><span class="line">1) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">2) <span class="string">&quot;rabbitmq&quot;</span></span><br><span class="line">3) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="Redis命令的基本语法"><a href="#Redis命令的基本语法" class="headerlink" title="Redis命令的基本语法"></a>Redis命令的基本语法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; COMMAND KEY_NAME</span><br></pre></td></tr></table></figure>

<p><strong>COMMAND</strong>是命令，<strong>KEY_NAME</strong>是键</p>
<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; DEL runoobkey</span><br></pre></td></tr></table></figure>

<p><strong>DEL</strong>是删除命令，<strong>runoobkey</strong>是一个键，该命令的目的是删除runoobkey</p>
<h2 id="Redis关于key的命令"><a href="#Redis关于key的命令" class="headerlink" title="Redis关于key的命令"></a><span id="redis-key">Redis关于key的命令</span></h2><h3 id="查询key的命令（keys）"><a href="#查询key的命令（keys）" class="headerlink" title="查询key的命令（keys）"></a>查询key的命令（keys）</h3><p>基本语法格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; keys [pattern]		<span class="comment">#pattern是匹配规则</span></span><br><span class="line">		[*]			<span class="comment">#匹配0个或者多个字符</span></span><br><span class="line">		[?]			<span class="comment">#只匹配1个字符</span></span><br><span class="line">		[[]]		<span class="comment">#只匹配[]中的1个字符</span></span><br><span class="line">		[a*]		<span class="comment">#以&#x27;a&#x27;字符开始的key</span></span><br><span class="line">		[a*b]		<span class="comment">#以&#x27;a&#x27;开始，&#x27;b&#x27;结尾的key</span></span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *				<span class="comment">#查看所有key</span></span><br><span class="line">1) <span class="string">&quot;ageZset&quot;</span></span><br><span class="line">2) <span class="string">&quot;name&quot;</span></span><br><span class="line">3) <span class="string">&quot;osList&quot;</span></span><br><span class="line">4) <span class="string">&quot;citySet&quot;</span></span><br><span class="line">5) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">6) <span class="string">&quot;k1&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys k*				<span class="comment">#查看以&#x27;k&#x27;字符开头的key</span></span><br><span class="line">1) <span class="string">&quot;key:__rand_int__&quot;</span></span><br><span class="line">2) <span class="string">&quot;k1&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys a*t			<span class="comment">#查看以&#x27;a&#x27;开头，t结尾的key</span></span><br><span class="line">1) <span class="string">&quot;ageZset&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys n?me			<span class="comment">#查看第1个字符为n，第34字符为me的key</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; keys n[abc]me 		<span class="comment">#查看第1个字符为n，第2个字符为[abc]其中一个，第34字符为me的key</span></span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="判断key是否存在（exists）"><a href="#判断key是否存在（exists）" class="headerlink" title="判断key是否存在（exists）"></a>判断key是否存在（exists）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; exists key	[key key key...]		<span class="comment">#判断key是否存在</span></span><br><span class="line"><span class="comment">#存在返回1（或存在的数量），否则返回0</span></span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; exists name</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; exists name osList ageZset citySet</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line">127.0.0.1:6379&gt; exists name osList ageZset citySet <span class="built_in">test</span></span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br></pre></td></tr></table></figure>



<h3 id="移动key到指定的数据库实例（move）"><a href="#移动key到指定的数据库实例（move）" class="headerlink" title="移动key到指定的数据库实例（move）"></a>移动key到指定的数据库实例（move）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; move key index					  	<span class="comment">#移动key到index数据库实例</span></span><br></pre></td></tr></table></figure>



<h3 id="查看key剩余生存时间（ttl）"><a href="#查看key剩余生存时间（ttl）" class="headerlink" title="查看key剩余生存时间（ttl）"></a>查看key剩余生存时间（ttl）</h3><p>单位是秒。（TTL：time to live）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; ttl key							<span class="comment">#查看key的剩余生存时间</span></span><br><span class="line"><span class="comment">#返回-1，永不过期（默认）</span></span><br><span class="line"><span class="comment">#返回-2，key不存在</span></span><br></pre></td></tr></table></figure>



<h3 id="设置定key的生存时间（expire）"><a href="#设置定key的生存时间（expire）" class="headerlink" title="设置定key的生存时间（expire）"></a>设置定key的生存时间（expire）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; expire key seconds					<span class="comment">#给key设置生存时间seconds秒（超出即被删除）</span></span><br></pre></td></tr></table></figure>



<h3 id="查看key的数据类型（type）"><a href="#查看key的数据类型（type）" class="headerlink" title="查看key的数据类型（type）"></a>查看key的数据类型（type）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">type</span> key								<span class="comment">#查看key的数据类型</span></span><br></pre></td></tr></table></figure>



<h3 id="重命名key（rename）"><a href="#重命名key（rename）" class="headerlink" title="重命名key（rename）"></a>重命名key（rename）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; rename key newkey</span><br></pre></td></tr></table></figure>



<h3 id="删除key（del）"><a href="#删除key（del）" class="headerlink" title="删除key（del）"></a>删除key（del）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; del key [key key key...]</span><br><span class="line">	<span class="comment">#返回成功删除key的条数</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>增</li>
<li>删<ul>
<li>del：删除key</li>
</ul>
</li>
<li>改<ul>
<li>move：移动key</li>
<li>expire：设置key的生存时间</li>
<li>rename：重命名</li>
</ul>
</li>
<li>查<ul>
<li>keys：查询key</li>
<li>exists：判断key是否存在</li>
<li>ttl：查询key的剩余生存时间</li>
<li>type：查看key的数据类型</li>
</ul>
</li>
</ul>
<h2 id="Redis操作string类型"><a href="#Redis操作string类型" class="headerlink" title="Redis操作string类型"></a><span id="redis-string">Redis操作string类型</span></h2><p>单key——单value</p>
<h3 id="存string类型数据（set）"><a href="#存string类型数据（set）" class="headerlink" title="存string类型数据（set）"></a>存string类型数据（set）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">set</span> key value</span><br><span class="line">		<span class="comment">#如果key已经存在，会发生覆盖</span></span><br></pre></td></tr></table></figure>

<h3 id="取string类型数据（get）"><a href="#取string类型数据（get）" class="headerlink" title="取string类型数据（get）"></a>取string类型数据（get）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; get key</span><br></pre></td></tr></table></figure>

<h3 id="追加字符串（append）"><a href="#追加字符串（append）" class="headerlink" title="追加字符串（append）"></a>追加字符串（append）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; append key value		<span class="comment">#往key中追加字符串value</span></span><br><span class="line">		<span class="comment">#返回值是追加后字符串长度</span></span><br><span class="line">		<span class="comment">#如果key不存在，相当于set</span></span><br></pre></td></tr></table></figure>

<h3 id="获取字符串长度（strlen）"><a href="#获取字符串长度（strlen）" class="headerlink" title="获取字符串长度（strlen）"></a>获取字符串长度（strlen）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; strlen key				<span class="comment">#返回key的字符串长度</span></span><br></pre></td></tr></table></figure>

<h3 id="将字符串数值进行加1运算（incr）"><a href="#将字符串数值进行加1运算（incr）" class="headerlink" title="将字符串数值进行加1运算（incr）"></a>将字符串数值进行加1运算（incr）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; incr key				<span class="comment">#key的value+1并且返回</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips：</p>
<ul>
<li>如果key不存在，则先创建该key-value，value初始化为0然后+1</li>
<li>key的value必须是数值，否则报错</li>
</ul>
</blockquote>
<h3 id="将字符串数值进行减1运算（decr）"><a href="#将字符串数值进行减1运算（decr）" class="headerlink" title="将字符串数值进行减1运算（decr）"></a>将字符串数值进行减1运算（decr）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;decr key</span><br></pre></td></tr></table></figure>

<p>与<strong>incr</strong>同理</p>
<h3 id="将字符串数值进行加offset（指定数值）运算（incrby）"><a href="#将字符串数值进行加offset（指定数值）运算（incrby）" class="headerlink" title="将字符串数值进行加offset（指定数值）运算（incrby）"></a>将字符串数值进行加offset（指定数值）运算（incrby）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;incrby key offset			<span class="comment">#key的vaule+offset并且返回</span></span><br></pre></td></tr></table></figure>

<h3 id="将字符串数值进行减offset（指定数值）运算（decrby）"><a href="#将字符串数值进行减offset（指定数值）运算（decrby）" class="headerlink" title="将字符串数值进行减offset（指定数值）运算（decrby）"></a>将字符串数值进行减offset（指定数值）运算（decrby）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;decrby key offset			<span class="comment">#key的vaule-offset并且返回</span></span><br></pre></td></tr></table></figure>

<h3 id="获取字符串中字符串（getrange）"><a href="#获取字符串中字符串（getrange）" class="headerlink" title="获取字符串中字符串（getrange）"></a>获取字符串中字符串（getrange）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;getrange key startIndex endIndex</span><br><span class="line">				<span class="comment">#截取key中value从startIndex到endIndex		</span></span><br></pre></td></tr></table></figure>

<h3 id="设置字符串中字符串（setrange）"><a href="#设置字符串中字符串（setrange）" class="headerlink" title="设置字符串中字符串（setrange）"></a>设置字符串中字符串（setrange）</h3><p>会改变数据库中的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;setrange key startIndex value</span><br><span class="line">				<span class="comment">#用value覆盖从下标为startIndex开始的字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="设置字符串的同时设置生命周期（setex）"><a href="#设置字符串的同时设置生命周期（setex）" class="headerlink" title="设置字符串的同时设置生命周期（setex）"></a>设置字符串的同时设置生命周期（setex）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;setex key seconds value</span><br><span class="line">				<span class="comment">#给key-value设置seconds秒后过期</span></span><br><span class="line">cli&gt; setex k1 30 v1</span><br><span class="line">OK</span><br><span class="line">cli&gt; ttl k1</span><br><span class="line">(<span class="built_in">integer</span>) 27</span><br></pre></td></tr></table></figure>

<h3 id="设置字符串数据当key不存在才设置，key存在则不设置（setnx）"><a href="#设置字符串数据当key不存在才设置，key存在则不设置（setnx）" class="headerlink" title="设置字符串数据当key不存在才设置，key存在则不设置（setnx）"></a>设置字符串数据当key不存在才设置，key存在则不设置（setnx）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;setnx key value</span><br></pre></td></tr></table></figure>

<h3 id="批量设置字符串数据（mset）"><a href="#批量设置字符串数据（mset）" class="headerlink" title="批量设置字符串数据（mset）"></a>批量设置字符串数据（mset）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;mset key1 value1 key2 value2 key3 value3 ...</span><br></pre></td></tr></table></figure>

<h3 id="批量获取字符串数据（mget）"><a href="#批量获取字符串数据（mget）" class="headerlink" title="批量获取字符串数据（mget）"></a>批量获取字符串数据（mget）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;mget key1 key2 key3 ...</span><br></pre></td></tr></table></figure>

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>Redis操作string类型</p>
<ul>
<li>增<ul>
<li>set：最基本的存储string类型数据的方式（如果存在则会覆盖）</li>
<li>setex：存储数据的同时设置生命周期</li>
<li>setnx：如果存在则不存储</li>
<li>mset：批量存储</li>
</ul>
</li>
<li>删</li>
<li>改<ul>
<li>set：修改string类型的数据（如果存在则会覆盖，也就是修改）</li>
<li>append：在原有的基础上追加数据</li>
<li>incr：数值字符串增加</li>
<li>decr：数值字符串减少</li>
<li>setrange：修改字符串中指定下标的数据</li>
</ul>
</li>
<li>查<ul>
<li>get：获得数据</li>
<li>mget：批量获得数据</li>
<li>getrange：获得字符串中子串</li>
<li>strlen：字符串长度</li>
</ul>
</li>
</ul>
<h2 id="Redis操作list类型"><a href="#Redis操作list类型" class="headerlink" title="Redis操作list类型"></a><span id="redis-list">Redis操作list类型</span></h2><p>单key——多有序value。顺序跟插入元素的顺序有关</p>
<h3 id="从左侧起存list类型数据（lpush）"><a href="#从左侧起存list类型数据（lpush）" class="headerlink" title="从左侧起存list类型数据（lpush）"></a>从左侧起存list类型数据（lpush）</h3><p>依次往左侧（头部）添加元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;lpush key value [value value...]</span><br><span class="line"></span><br><span class="line">cli&gt; lpush list1 1 2 3 4</span><br><span class="line">(<span class="built_in">integer</span>) 4</span><br><span class="line"></span><br><span class="line">cli&gt; lrange list1 0 4</span><br><span class="line">1) <span class="string">&quot;4&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;2&quot;</span></span><br><span class="line">4) <span class="string">&quot;1&quot;</span>	</span><br><span class="line">			<span class="comment">#可以看到lpush的顺序后插入的元素在列表中越靠前</span></span><br></pre></td></tr></table></figure>

<h3 id="从右侧起存list类型数据（rpush）"><a href="#从右侧起存list类型数据（rpush）" class="headerlink" title="从右侧起存list类型数据（rpush）"></a>从右侧起存list类型数据（rpush）</h3><p>依次从右侧（尾部）添加元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;rpush key value [value value...]</span><br></pre></td></tr></table></figure>



<h3 id="获取指定列表中指定下标区间的元素（lrange）"><a href="#获取指定列表中指定下标区间的元素（lrange）" class="headerlink" title="获取指定列表中指定下标区间的元素（lrange）"></a>获取指定列表中指定下标区间的元素（lrange）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;lrange key startIndex endIndex</span><br><span class="line">					<span class="comment">#获取key列表中startIndex到endIndex的元素</span></span><br><span class="line">					</span><br><span class="line">cli&gt; lrange list1 0 4</span><br><span class="line">1) <span class="string">&quot;4&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;2&quot;</span></span><br><span class="line">4) <span class="string">&quot;1&quot;</span>		</span><br><span class="line"></span><br><span class="line">cli&gt; lrange list1 0 -1 	<span class="comment">#获取从头到尾的全部元素，-1表示倒数第一个，即尾部</span></span><br><span class="line">1) <span class="string">&quot;4&quot;</span></span><br><span class="line">2) <span class="string">&quot;3&quot;</span></span><br><span class="line">3) <span class="string">&quot;2&quot;</span></span><br><span class="line">4) <span class="string">&quot;1&quot;</span>		</span><br></pre></td></tr></table></figure>



<h3 id="从指定列表中移除并返回表头（左侧）元素（lpop）"><a href="#从指定列表中移除并返回表头（左侧）元素（lpop）" class="headerlink" title="从指定列表中移除并返回表头（左侧）元素（lpop）"></a>从指定列表中移除并返回表头（左侧）元素（lpop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; lpop key</span><br></pre></td></tr></table></figure>



<h3 id="从指定列表中移除并返回表尾（右侧）元素（rpop）"><a href="#从指定列表中移除并返回表尾（右侧）元素（rpop）" class="headerlink" title="从指定列表中移除并返回表尾（右侧）元素（rpop）"></a>从指定列表中移除并返回表尾（右侧）元素（rpop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; rpop key</span><br></pre></td></tr></table></figure>



<h3 id="获取列表中指定下标的元素（lindex）"><a href="#获取列表中指定下标的元素（lindex）" class="headerlink" title="获取列表中指定下标的元素（lindex）"></a>获取列表中指定下标的元素（lindex）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; lindex key index</span><br></pre></td></tr></table></figure>



<h3 id="获取指定列表的长度（元素个数）（llen）"><a href="#获取指定列表的长度（元素个数）（llen）" class="headerlink" title="获取指定列表的长度（元素个数）（llen）"></a>获取指定列表的长度（元素个数）（llen）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; llen key</span><br></pre></td></tr></table></figure>



<h3 id="移除指定列表中数据（lrem）"><a href="#移除指定列表中数据（lrem）" class="headerlink" title="移除指定列表中数据（lrem）"></a>移除指定列表中数据（lrem）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt;lrem key count value</span><br><span class="line">			<span class="comment">#移除key列表count个中值为value的元素</span></span><br><span class="line">			<span class="comment"># count &gt; 0 从左侧起移除</span></span><br><span class="line">			<span class="comment"># count &lt; 0 从右侧起移除</span></span><br><span class="line">			<span class="comment"># count = 0 移除所有</span></span><br></pre></td></tr></table></figure>

<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>Redis操作list类型</p>
<ul>
<li>增<ul>
<li>lpush：从左边添加元素</li>
<li>rpush：从右边添加元素</li>
</ul>
</li>
<li>删<ul>
<li>lpop：从左边弹出元素</li>
<li>rpop：从右边弹出元素</li>
<li>lrem：移除指定元素</li>
</ul>
</li>
<li>改</li>
<li>查<ul>
<li>lrange：遍历</li>
<li>lindex：指定下标的元素</li>
<li>llen：长度</li>
</ul>
</li>
</ul>
<h2 id="Redis操作set类型"><a href="#Redis操作set类型" class="headerlink" title="Redis操作set类型"></a><span id="redis-set">Redis操作set类型</span></h2><p>单key——多无序且不可重复value</p>
<h3 id="将一个或多个元素添加到指定集合中（sadd）"><a href="#将一个或多个元素添加到指定集合中（sadd）" class="headerlink" title="将一个或多个元素添加到指定集合中（sadd）"></a>将一个或多个元素添加到指定集合中（sadd）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sadd key value [value value ...]	<span class="comment">#若元素重复，则忽略</span></span><br><span class="line"></span><br><span class="line">cli&gt; sadd set1 a b c a</span><br><span class="line">(<span class="built_in">integer</span>) 3			<span class="comment">#成功添加元素的个数</span></span><br><span class="line">					<span class="comment">#只添加成功三个</span></span><br></pre></td></tr></table></figure>

<h3 id="获取指定集合中的元素（smembers）"><a href="#获取指定集合中的元素（smembers）" class="headerlink" title="获取指定集合中的元素（smembers）"></a>获取指定集合中的元素（smembers）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; smembers key</span><br><span class="line"></span><br><span class="line">cli&gt; smembers set1</span><br><span class="line">1) <span class="string">&quot;c&quot;</span></span><br><span class="line">2) <span class="string">&quot;b&quot;</span></span><br><span class="line">3) <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="判断元素在集合中是否存在（sismember）"><a href="#判断元素在集合中是否存在（sismember）" class="headerlink" title="判断元素在集合中是否存在（sismember）"></a>判断元素在集合中是否存在（sismember）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sismember key member</span><br><span class="line"></span><br><span class="line">(<span class="built_in">integer</span>) 1			<span class="comment">#返回1则存在</span></span><br><span class="line">(<span class="built_in">integer</span>) 0			<span class="comment">#返回0则不存在</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的长度（scard）"><a href="#获取集合的长度（scard）" class="headerlink" title="获取集合的长度（scard）"></a>获取集合的长度（scard）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; scard key</span><br></pre></td></tr></table></figure>

<h3 id="移除集合中1个或者多个元素（srem）"><a href="#移除集合中1个或者多个元素（srem）" class="headerlink" title="移除集合中1个或者多个元素（srem）"></a>移除集合中1个或者多个元素（srem）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; srem key member [member ...]</span><br><span class="line">						<span class="comment">#返回成功移除的元素的个数</span></span><br></pre></td></tr></table></figure>

<h3 id="随机获取集合中的一个或多个元素（srandmember）"><a href="#随机获取集合中的一个或多个元素（srandmember）" class="headerlink" title="随机获取集合中的一个或多个元素（srandmember）"></a>随机获取集合中的一个或多个元素（srandmember）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; srandmember key [count]	</span><br><span class="line">						<span class="comment">#count&gt;0 随机获取的元素不会重复</span></span><br><span class="line">						<span class="comment">#count&lt;0 随机获取的元素可能重复</span></span><br></pre></td></tr></table></figure>

<h3 id="随机移除集合中的一个或多个元素（spop）"><a href="#随机移除集合中的一个或多个元素（spop）" class="headerlink" title="随机移除集合中的一个或多个元素（spop）"></a>随机移除集合中的一个或多个元素（spop）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; spop key [count]</span><br></pre></td></tr></table></figure>

<h3 id="将集合中的元素移动到另一集合（smove）"><a href="#将集合中的元素移动到另一集合（smove）" class="headerlink" title="将集合中的元素移动到另一集合（smove）"></a>将集合中的元素移动到另一集合（smove）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; smove <span class="built_in">source</span> dest member	<span class="comment">#将source集合中的member移动到dest集合</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的差集（sdiff）"><a href="#获取集合的差集（sdiff）" class="headerlink" title="获取集合的差集（sdiff）"></a>获取集合的差集（sdiff）</h3><p>即一个集合中有，但是其他集合中没有的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sdiff key1 key2 [key3 ...]</span><br><span class="line">					<span class="comment">#即key1集合中有，其他集合中没有的元素</span></span><br><span class="line">					</span><br><span class="line">cli&gt; smembers set1</span><br><span class="line">1) <span class="string">&quot;f&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;e&quot;</span></span><br><span class="line">4) <span class="string">&quot;g&quot;</span></span><br><span class="line">5) <span class="string">&quot;a&quot;</span></span><br><span class="line">6) <span class="string">&quot;b&quot;</span></span><br><span class="line">cli&gt; smembers set2</span><br><span class="line">1) <span class="string">&quot;d&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;g&quot;</span></span><br><span class="line">4) <span class="string">&quot;f&quot;</span></span><br><span class="line">5) <span class="string">&quot;e&quot;</span></span><br><span class="line">6) <span class="string">&quot;i&quot;</span></span><br><span class="line">7) <span class="string">&quot;b&quot;</span></span><br><span class="line">8) <span class="string">&quot;a&quot;</span></span><br><span class="line">9) <span class="string">&quot;h&quot;</span></span><br><span class="line">cli&gt; sdiff set2 set1		<span class="comment">#set2中有hid，但是set1中没有</span></span><br><span class="line">1) <span class="string">&quot;i&quot;</span></span><br><span class="line">2) <span class="string">&quot;d&quot;</span></span><br><span class="line">3) <span class="string">&quot;h&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的交集（sinter）"><a href="#获取集合的交集（sinter）" class="headerlink" title="获取集合的交集（sinter）"></a>获取集合的交集（sinter）</h3><p>即指定集合中都有的元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sinter key key [key key...]</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; smembers set1</span><br><span class="line">1) <span class="string">&quot;f&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;e&quot;</span></span><br><span class="line">4) <span class="string">&quot;g&quot;</span></span><br><span class="line">5) <span class="string">&quot;a&quot;</span></span><br><span class="line">6) <span class="string">&quot;b&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; smembers set2</span><br><span class="line">1) <span class="string">&quot;d&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;g&quot;</span></span><br><span class="line">4) <span class="string">&quot;f&quot;</span></span><br><span class="line">5) <span class="string">&quot;e&quot;</span></span><br><span class="line">6) <span class="string">&quot;i&quot;</span></span><br><span class="line">7) <span class="string">&quot;b&quot;</span></span><br><span class="line">8) <span class="string">&quot;a&quot;</span></span><br><span class="line">9) <span class="string">&quot;h&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; sinter set1 set2</span><br><span class="line">1) <span class="string">&quot;f&quot;</span></span><br><span class="line">2) <span class="string">&quot;c&quot;</span></span><br><span class="line">3) <span class="string">&quot;e&quot;</span></span><br><span class="line">4) <span class="string">&quot;g&quot;</span></span><br><span class="line">5) <span class="string">&quot;a&quot;</span></span><br><span class="line">6) <span class="string">&quot;b&quot;</span></span><br><span class="line">						<span class="comment">#set1和set2中都有abcefg</span></span><br></pre></td></tr></table></figure>

<h3 id="获取集合的并集（sunion）"><a href="#获取集合的并集（sunion）" class="headerlink" title="获取集合的并集（sunion）"></a>获取集合的并集（sunion）</h3><p>即指定集合中的所有元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; sunion key key [key key...]</span><br></pre></td></tr></table></figure>

<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>Redis操作set类型</p>
<ul>
<li>增<ul>
<li>sadd：新增元素到集合中</li>
</ul>
</li>
<li>删<ul>
<li>srem：移除元素</li>
<li>spop：弹出元素</li>
<li>smove：移动过元素到另一集合</li>
</ul>
</li>
<li>改<ul>
<li>sadd：新增元素到集合中，如果value已经存在则会覆盖</li>
</ul>
</li>
<li>查<ul>
<li>smembers：遍历集合元素</li>
<li>sismember：判断元素是否存在</li>
<li>scard：集合长度</li>
<li>srandmember：随机获取集合元素</li>
<li>sdiff：差集</li>
<li>sinter：交集</li>
<li>sunion：并集</li>
</ul>
</li>
</ul>
<h2 id="Redis操作hash类型"><a href="#Redis操作hash类型" class="headerlink" title="Redis操作hash类型"></a><span id="redis-hash">Redis操作hash类型</span></h2><p>单key——field-value </p>
<p>​					field-value </p>
<p>​					field-value</p>
<p>​					适合存储对象</p>
<h3 id="将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）"><a href="#将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）" class="headerlink" title="将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）"></a>将一个或多个field-value（属性—值）对存入hash表，会覆盖（hset）</h3><p>如果key中的filed之前是<strong>存在</strong>的，则会强制覆盖（使用hsetnx不会强制覆盖）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hset key field1 value1 [field2 value2 ...]</span><br><span class="line"></span><br><span class="line">cli&gt; hset student1 name wqk age 20</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<h3 id="获取指定hash表中指定field值（hget）"><a href="#获取指定hash表中指定field值（hget）" class="headerlink" title="获取指定hash表中指定field值（hget）"></a>获取指定hash表中指定field值（hget）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hget key field			<span class="comment">#获取key哈希表中field的值</span></span><br><span class="line"></span><br><span class="line">cli&gt; hget student1 name</span><br><span class="line"><span class="string">&quot;wqk&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="批量获取指定hash表中field的值（hmget）"><a href="#批量获取指定hash表中field的值（hmget）" class="headerlink" title="批量获取指定hash表中field的值（hmget）"></a>批量获取指定hash表中field的值（hmget）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hmget key field1 [field2 field3 ...]</span><br><span class="line"></span><br><span class="line">cli&gt; hmget student1 name age</span><br><span class="line">1) <span class="string">&quot;wqk&quot;</span></span><br><span class="line">2) <span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取hash表中所有的field和value（hgetall）"><a href="#获取hash表中所有的field和value（hgetall）" class="headerlink" title="获取hash表中所有的field和value（hgetall）"></a>获取hash表中所有的field和value（hgetall）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hgetall key</span><br><span class="line"></span><br><span class="line">cli&gt; hgetall student1</span><br><span class="line">1) <span class="string">&quot;name&quot;</span></span><br><span class="line">2) <span class="string">&quot;wqk&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br><span class="line">4) <span class="string">&quot;20&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="移除hash表中指定一个或者多个field（hdel）"><a href="#移除hash表中指定一个或者多个field（hdel）" class="headerlink" title="移除hash表中指定一个或者多个field（hdel）"></a>移除hash表中指定一个或者多个field（hdel）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hdel key field1 [field2 field3 ...]</span><br></pre></td></tr></table></figure>

<h3 id="统计hash表中field数量（hlen）"><a href="#统计hash表中field数量（hlen）" class="headerlink" title="统计hash表中field数量（hlen）"></a>统计hash表中field数量（hlen）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hlen key</span><br></pre></td></tr></table></figure>

<h3 id="判断hash表中是否存在某field（hexists）"><a href="#判断hash表中是否存在某field（hexists）" class="headerlink" title="判断hash表中是否存在某field（hexists）"></a>判断hash表中是否存在某field（hexists）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hexists key field</span><br><span class="line">				<span class="comment">#返回0表示不存在，1表示存在</span></span><br></pre></td></tr></table></figure>

<h3 id="获取hash表中所有的field列表（hkeys）"><a href="#获取hash表中所有的field列表（hkeys）" class="headerlink" title="获取hash表中所有的field列表（hkeys）"></a>获取hash表中所有的field列表（hkeys）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hkeys key</span><br><span class="line"></span><br><span class="line">cli&gt; hkeys student2</span><br><span class="line">1) <span class="string">&quot;id&quot;</span></span><br><span class="line">2) <span class="string">&quot;name&quot;</span></span><br><span class="line">3) <span class="string">&quot;age&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="获取hash表中所有的value（hvals）"><a href="#获取hash表中所有的value（hvals）" class="headerlink" title="获取hash表中所有的value（hvals）"></a>获取hash表中所有的value（hvals）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hvals key</span><br><span class="line"></span><br><span class="line">cli&gt; hvals student2</span><br><span class="line">1) <span class="string">&quot;10001&quot;</span></span><br><span class="line">2) <span class="string">&quot;test&quot;</span></span><br><span class="line">3) <span class="string">&quot;18&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="对hash表中指定field的value进行整数加法运算（hincrby）"><a href="#对hash表中指定field的value进行整数加法运算（hincrby）" class="headerlink" title="对hash表中指定field的value进行整数加法运算（hincrby）"></a>对hash表中指定field的value进行整数加法运算（hincrby）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hincrby key field incrment</span><br><span class="line">	<span class="comment">#对key哈希表中的field属性的值进行加incrment值运算</span></span><br><span class="line">				</span><br><span class="line">cli&gt; hget student2 age</span><br><span class="line"><span class="string">&quot;18&quot;</span></span><br><span class="line"></span><br><span class="line">cli&gt; hincrby student2 age 2 </span><br><span class="line">(<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>



<h3 id="对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）"><a href="#对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）" class="headerlink" title="对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）"></a>对hash表中指定field的value进行浮点数加法运算（hincrbyfloat）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hincrbyfloat key field incrment</span><br><span class="line"></span><br><span class="line">cli&gt; hset student2 score 85</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">cli&gt; hincrbyfloat student2 score 1.5</span><br><span class="line"><span class="string">&quot;86.5&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）"><a href="#将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）" class="headerlink" title="将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）"></a>将一个或多个field-value（属性—值）对存入hash表，不会覆盖（hsetnx）</h3><p>如果key的field已经存在则放弃设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; hsetnx key filed1 value1 [field2 value2]</span><br></pre></td></tr></table></figure>

<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><p>Redis操作hash类型</p>
<ul>
<li>增<ul>
<li>hset：存入hash类型数据</li>
<li>hsetnx：存入数据，如果存在则不存入</li>
</ul>
</li>
<li>删<ul>
<li>hdel：删除hash表中field及其value</li>
</ul>
</li>
<li>改<ul>
<li>hset：存入hash类型数据，如果field存在则会覆盖</li>
<li>hincrby：value是数值，则会增加</li>
</ul>
</li>
<li>查<ul>
<li>hget：获取hash表中指定field的value</li>
<li>hmget：批量获取hash表中指定field的value</li>
<li>hgetall：获取hash表中所有field及其value</li>
<li>hlen：获取hash表中field的数量</li>
<li>hexists：判断hash表中该field是否存在</li>
<li>hkeys：获取hash表中所有field</li>
<li>hvals：获取hash表中所有value</li>
</ul>
</li>
</ul>
<h2 id="Redis操作zset类型"><a href="#Redis操作zset类型" class="headerlink" title="Redis操作zset类型"></a><span id="redis-zset">Redis操作zset类型</span></h2><p>有序集合。顺序跟score有关</p>
<h3 id="将一个或多个member及其score值加入有序集合（zadd）"><a href="#将一个或多个member及其score值加入有序集合（zadd）" class="headerlink" title="将一个或多个member及其score值加入有序集合（zadd）"></a>将一个或多个member及其score值加入有序集合（zadd）</h3><p>score必须是数值。如果member<strong>已经存在</strong>，则会覆盖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zadd key score member [score member]</span><br><span class="line"></span><br><span class="line">cli&gt; zadd zset1 95 wqk 90 lk 98 zp</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定下标区间的元素（zrange）"><a href="#获取有序集合中指定下标区间的元素（zrange）" class="headerlink" title="获取有序集合中指定下标区间的元素（zrange）"></a>获取有序集合中指定下标区间的元素（zrange）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrange key startIndex endIndex [withscores] <span class="comment">#获取key集合startIndex到endIndex区间的元素（是否显示分数）</span></span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）"><a href="#获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）" class="headerlink" title="获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）"></a>获取有序集合中指定分数区间（闭区间）的元素（zrangebyscore）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrangebyscore key min max [withscores] <span class="comment">#获取key集合min到max分数区间的元素（是否显示分数）</span></span><br></pre></td></tr></table></figure>

<h3 id="删除有序集合中一个或者多个元素（zrem）"><a href="#删除有序集合中一个或者多个元素（zrem）" class="headerlink" title="删除有序集合中一个或者多个元素（zrem）"></a>删除有序集合中一个或者多个元素（zrem）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrem key member [member]</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中元素个数（zcard）"><a href="#获取有序集合中元素个数（zcard）" class="headerlink" title="获取有序集合中元素个数（zcard）"></a>获取有序集合中元素个数（zcard）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zcard key</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中分数在指定区间的元素个数（zcount）"><a href="#获取有序集合中分数在指定区间的元素个数（zcount）" class="headerlink" title="获取有序集合中分数在指定区间的元素个数（zcount）"></a>获取有序集合中分数在指定区间的元素个数（zcount）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zcount key min max		<span class="comment">#获取key有序集合中min到max区间的元素个数</span></span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定元素的排名（升序）（zrank）"><a href="#获取有序集合中指定元素的排名（升序）（zrank）" class="headerlink" title="获取有序集合中指定元素的排名（升序）（zrank）"></a>获取有序集合中指定元素的排名（升序）（zrank）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrank key member</span><br></pre></td></tr></table></figure>

<h3 id="获取有序集合中指定元素的排名（降序）（zrevrank）"><a href="#获取有序集合中指定元素的排名（降序）（zrevrank）" class="headerlink" title="获取有序集合中指定元素的排名（降序）（zrevrank）"></a>获取有序集合中指定元素的排名（降序）（zrevrank）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zrevrank key member</span><br></pre></td></tr></table></figure>



<h3 id="获取有序集合指定元素的分数（zscore）"><a href="#获取有序集合指定元素的分数（zscore）" class="headerlink" title="获取有序集合指定元素的分数（zscore）"></a>获取有序集合指定元素的分数（zscore）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; zscore key member</span><br></pre></td></tr></table></figure>

<h3 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h3><p>Redis操作zset类型</p>
<ul>
<li>增<ul>
<li>zadd：往集合中存入元素</li>
</ul>
</li>
<li>删<ul>
<li>zrem：移除集合中的元素</li>
</ul>
</li>
<li>改</li>
<li>查<ul>
<li>zrange：遍历集合元素</li>
<li>zrangebyscore：根据score遍历集合元素</li>
<li>zcard：集合元素个数</li>
<li>zcount：指定分数区间元素个数</li>
<li>zrank：元素的排名（正序）</li>
<li>zrevrank：元素的排名（倒序）</li>
<li>zscore：元素的分数</li>
</ul>
</li>
</ul>
<h2 id="Redis配置文件"><a href="#Redis配置文件" class="headerlink" title="Redis配置文件"></a>Redis配置文件</h2><p>Redis根目录下有个默认的配置文件：<code>.\redis.conf</code>，里面有一些redis默认的配置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; redis-server [config_name]	<span class="comment">#默认使用默认的配置的文件</span></span><br></pre></td></tr></table></figure>

<h3 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h3><ul>
<li><p>port</p>
<p>指定redis服务所使用的端口号，<strong>默认6379</strong></p>
</li>
<li><p>bind</p>
<p>指定客户端连接redis服务时，所能使用的主机地址，<strong>默认是redis服务所在主机名</strong>，一般情况下都需要指定主机名</p>
</li>
<li><p>tcp-keeplive</p>
<p>TCP连接保活策略，单位是秒。指的是Redis服务端会在指定秒内向连接他的客户端发送一次ACK请求，以确保连接有效。<strong>默认是60秒</strong></p>
</li>
</ul>
<p>如果以上配置在配置文件中生效，则在客户端中连接需使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h <span class="built_in">bind</span> -p 6380</span><br></pre></td></tr></table></figure>

<h3 id="常规配置"><a href="#常规配置" class="headerlink" title="常规配置"></a>常规配置</h3><ul>
<li><p>loglevel</p>
<p>配置日志级别，分为四个级别：debug、verbose、notice、warning。<strong>默认是notice</strong></p>
</li>
<li><p>logfile</p>
<p>日志文件持久化存储的地方。<strong>默认不会持久化，只会输出到终端</strong></p>
</li>
<li><p>databases</p>
<p>配置Redis服务默认创建的数据库实例个数。<strong>默认是16个</strong>。</p>
</li>
</ul>
<h3 id="安全配置"><a href="#安全配置" class="headerlink" title="安全配置"></a>安全配置</h3><ul>
<li><p>requirepass</p>
<p>配置Redis客户端访问Redis服务时的密码，需要<code>protected-mode = yes</code>时生效</p>
</li>
</ul>
<p>如配置了requirepass，则在客户端连接中需使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [-h hostname] [-p port] [-a <span class="built_in">pwd</span>]</span><br></pre></td></tr></table></figure>

<h2 id="Redis数据持久化"><a href="#Redis数据持久化" class="headerlink" title="Redis数据持久化"></a>Redis数据持久化</h2><p>Redis提供持久化策略，可以在适当的时机采用适当的手段把内存中的数据持久化的磁盘。</p>
<h3 id="RDB策略（Redis默认启用的持久化策略）"><a href="#RDB策略（Redis默认启用的持久化策略）" class="headerlink" title="RDB策略（Redis默认启用的持久化策略）"></a>RDB策略（Redis默认启用的持久化策略）</h3><p>RDB（Redis DataBase）策略是指，在<strong>指定时间间隔</strong>内，Redis服务执行<strong>指定次数</strong>的写操作，会自动触发一次持久化操作。如需修改可以在redis的配置文件中修改RDB相关的配置（<code>dbfilename</code>持久化数据的文件名，默认是dump.rdb，<code>dir</code>持久化数据的目录，默认是<code>./</code>，即根目录）。</p>
<h3 id="AOF策略"><a href="#AOF策略" class="headerlink" title="AOF策略"></a>AOF策略</h3><p>记录每一次Redis服务的<strong>完整写操作</strong>进入日志，每次Redis服务启动时，都会重新执行一遍完整的操作日志以便恢复数据。效率不高，默认不开启AOF（<code>appendonly</code>配置是否开启AOF策略，<code>appendfilename</code>配置操作日志文件）。</p>
<h2 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h2><p>数据库事务：一组对数据库的操作一起执行，保证操作的原子性，要么同时成功，要么同时失败。</p>
<p>Redis事务：允许一组Redis命令放在一起，将命令序列化，然后按队列执行，保证部分原子性。</p>
<h3 id="multi"><a href="#multi" class="headerlink" title="multi"></a>multi</h3><p>标记一个Redis事务的开始（与exec成对存在）。</p>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><p>标记一个Redis事务的结束（与multi成对存在），即立即开始执行上述事务。</p>
<p>一个完整的Redis事务的输入格式应该是如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi				<span class="comment">#标识事务开始了</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> k1 v1			<span class="comment">#操作1</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> k2 v2			<span class="comment">#操作2</span></span><br><span class="line">cli&gt; <span class="built_in">exec</span>				<span class="comment">#标识事务结束了（即立即开始执行）</span></span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi</span><br><span class="line">OK		<span class="comment">#事务开启</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> str1 value1</span><br><span class="line">QUEUED	<span class="comment">#操作1加入队列</span></span><br><span class="line">cli&gt; <span class="built_in">set</span> str2 value2</span><br><span class="line">QUEUED	<span class="comment">#操作2加入队列</span></span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK	<span class="comment">#操作1执行结果</span></span><br><span class="line">2) OK	<span class="comment">#操作2执行结果</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips：</strong></p>
<p>Redis事务不是脚本命令。而是在cli执行<code>multi</code>后接着<strong>一行一行输入</strong>操作的命令（操作会插入队列），最后执行<code>exec</code>才会按队列执行上述操作。为保证事务的<strong>部分</strong>原子性，Redis事务遵循以下两则规则：</p>
<ol>
<li><p>输入事务操作过程中如果发生错误，则事务输入失败，即事务无法被创建。即<code>multi</code>和<code>exec</code>中间操作语句有错误则事务无法被创建。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi		</span><br><span class="line">cli&gt; <span class="built_in">set</span> k1 v1	</span><br><span class="line">cli&gt; seta k2 v2		<span class="comment">#操作2：命令错误</span></span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">                  </span><br><span class="line">					<span class="comment">#该事务无法被创建：操作的命令错误</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>如果上述规则没有发生错误，则在最后执行操作队列时，即使其中一项操作执行异常仍会继续执行其余操作。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi</span><br><span class="line">cli&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">cli&gt; incr k1		</span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">					<span class="comment">#事务会被创建，即使incr的执行结果异常</span></span><br></pre></td></tr></table></figure></li>
</ol>
</blockquote>
<h3 id="discard"><a href="#discard" class="headerlink" title="discard"></a>discard</h3><p>清除已经存在于操作队列中的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; multi</span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">set</span> k5 v5</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; <span class="built_in">set</span> k6 v6</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; discard					<span class="comment">#清空上述操作队列</span></span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">(error) ERR EXEC without MULTI			<span class="comment">#exec执行失败的原因是操作命令的队列被清空</span></span><br></pre></td></tr></table></figure>

<h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><p>在事务开启前（<code>multi</code>）监控某一个键，在事务执行的过程中监控的键的值发生变化，则此次事务放弃执行；否则正常执行。</p>
<p>用以下事务来模拟一个场景：钱包A余额50，钱包B余额50，钱包B向钱包A转账50，那么最后钱包B余额0，钱包A余额100。并发情况下假如多个钱包需要向钱包B转账，那么就会发生错误。所以需要监控该次事务执行前的version是否还是该version。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; <span class="built_in">set</span> balanceA 50</span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">set</span> balanceB 50</span><br><span class="line">OK</span><br><span class="line">cli&gt; <span class="built_in">set</span> verison 1</span><br><span class="line">OK</span><br><span class="line">cli&gt; watch version			<span class="comment">#监控version的值</span></span><br><span class="line">OK</span><br><span class="line">cli&gt; multi</span><br><span class="line">OK</span><br><span class="line">cli&gt; incrby balanceA 50</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; decrby balanceB 50</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; incr version</span><br><span class="line">QUEUED</span><br><span class="line">cli&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 100</span><br><span class="line">2) (<span class="built_in">integer</span>) 0</span><br><span class="line">3) (<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Tips</strong></p>
<p>watch就是类似于乐观锁，A事务执行前查询一个键（该键会在其他事务进行该事务后发生改变，即标识此次事务执行成功），如果该键在A事务执行过程中发生了改变（说明其他事务对数据进行了操作），即A事务应该不执行，如果该键没有发生改变，则A事务正常执行。</p>
</blockquote>
<h3 id="unwatch"><a href="#unwatch" class="headerlink" title="unwatch"></a>unwatch</h3><p>放弃监控的所有键。</p>
<h2 id="Redis消息的发布与订阅（了解）"><a href="#Redis消息的发布与订阅（了解）" class="headerlink" title="Redis消息的发布与订阅（了解）"></a>Redis消息的发布与订阅（了解）</h2><p>Redis<strong>客户端</strong>订阅频道，订阅了同一频道的客户端可以发送或者收到来自同一频道的消息。（消息中间件）</p>
<h4 id="subscribe"><a href="#subscribe" class="headerlink" title="subscribe"></a>subscribe</h4><p>订阅频道（以便接收消息）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; subscribe channel [channel ...]			<span class="comment">#可以订阅多个频道</span></span><br></pre></td></tr></table></figure>

<p>client1：</p>
<p>订阅了ch1频道</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; subscribe ch1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;ch1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>client2：</p>
<p>订阅了ch1频道</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; subscribe ch1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;ch1&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>此时client1和client2都订阅了ch1频道，如果有客户端往ch1频道发送消息，那么client1和client2都会收到</p>
<h3 id="psubscribe"><a href="#psubscribe" class="headerlink" title="psubscribe"></a>psubscribe</h3><p>订阅频道（支持通配符）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; psubscribe pattern [pattern ...]</span><br><span class="line"></span><br><span class="line">cli&gt; psubscribe news*			<span class="comment">#订阅以news开头的频道</span></span><br></pre></td></tr></table></figure>

<h3 id="publish"><a href="#publish" class="headerlink" title="publish"></a>publish</h3><p>往频道上发布消息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; publish channel message			<span class="comment">#往channel频道发送message消息</span></span><br></pre></td></tr></table></figure>

<p>client3向ch1频道发送消息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; publish ch1 Hello,Redis!</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br></pre></td></tr></table></figure>

<p>此时client1和client2就会收到来自client3的消息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;ch1&quot;</span></span><br><span class="line">3) <span class="string">&quot;Hello,Redis!&quot;</span>            </span><br></pre></td></tr></table></figure>

<h2 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h2><h3 id="搭建一主二从的Redis集群并启动"><a href="#搭建一主二从的Redis集群并启动" class="headerlink" title="搭建一主二从的Redis集群并启动"></a>搭建一主二从的Redis集群并启动</h3><p>实际开发中应分别在三台不同的服务器上部署三个Redis服务，这里为了方便演示选择在同一台服务器启动三个配置文件不同的Redis服务来模拟，三个Redis服务端口号分别是6379、6380、6381，三份配置文件名命名为：<code>redis_6379.conf</code>、<code>redis_6380.conf</code>、<code>redis_6381.conf</code>。</p>
<p>redis_6379.conf：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port</span> <span class="string">6379						#修改端口号</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;redis_6379.log&quot;		#修改生成的日志文件名</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">redis_6379.rdb		#修改持久化的文件名</span></span><br></pre></td></tr></table></figure>

<p>同理，redis_6380.conf和redis_6381.conf也需要修改以上配置</p>
<blockquote>
<p><strong>Tips</strong></p>
<p>需要修改日志和持久化文件的文件名，不然可能会造成数据冲突。</p>
</blockquote>
<p>接下来使用<code>redis-server &lt;config_name&gt;</code>分别启动三个Redis服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis_6379.conf</span><br><span class="line">redis-server redis_6380.conf</span><br><span class="line">redis-server redis_6381.conf</span><br></pre></td></tr></table></figure>

<h3 id="使用cli分别连接三台Redis服务"><a href="#使用cli分别连接三台Redis服务" class="headerlink" title="使用cli分别连接三台Redis服务"></a>使用cli分别连接三台Redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379</span><br><span class="line">redis-cli -p 6380</span><br><span class="line">redis-cli -p 6381</span><br></pre></td></tr></table></figure>

<h3 id="查看Redis服务的主从信息"><a href="#查看Redis服务的主从信息" class="headerlink" title="查看Redis服务的主从信息"></a>查看Redis服务的主从信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; info replication</span><br><span class="line"></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master								<span class="comment">#角色：主机</span></span><br><span class="line">connected_slaves:0						<span class="comment">#已连接的从机数量：0</span></span><br><span class="line">master_replid:91792be1189896bfa47e7a99aae23b8702c8c93b</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>

<p>初始化的Redis服务的角色都是主机，即<code>role:master</code>。</p>
<h3 id="设置从机从属于主机（slaveof）"><a href="#设置从机从属于主机（slaveof）" class="headerlink" title="设置从机从属于主机（slaveof）"></a>设置从机从属于主机（slaveof）</h3><p>命令格式如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; slaveof host port     <span class="comment">#设置当前连接的服务从属于host:port的redis服务</span></span><br></pre></td></tr></table></figure>



<p>在已连接从机服务的客户端上执行：<code>slaveof 127.0.0.1 6379</code>，即</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave						<span class="comment">#角色：从机</span></span><br><span class="line">master_host:127.0.0.1			<span class="comment">#主机host地址</span></span><br><span class="line">master_port:6379				<span class="comment">#主机port端口号</span></span><br><span class="line">master_link_status:up			<span class="comment">#与主机连接状态：up（已连接）</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="全量复制"><a href="#全量复制" class="headerlink" title="全量复制"></a>全量复制</h3><p>一旦主从关系确定，主库会将所有数据立马同步到从库。</p>
<h3 id="增量复制"><a href="#增量复制" class="headerlink" title="增量复制"></a>增量复制</h3><p>在主库上写的数据，会同步到从库。</p>
<h3 id="读写分离，主写从读"><a href="#读写分离，主写从读" class="headerlink" title="读写分离，主写从读"></a>读写分离，主写从读</h3><p>主机既能读也能写（尽量写），从机只能读不能写。</p>
<h3 id="主机宕机，从机原地待命"><a href="#主机宕机，从机原地待命" class="headerlink" title="主机宕机，从机原地待命"></a>主机宕机，从机原地待命</h3><p>主机宕机后，<strong>从机仍然可以读数据</strong>，可以从<code>info replication</code>中看到与主机的连接状态变为<code>down</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave									<span class="comment">#角色仍是从机</span></span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:down						<span class="comment">#与主机的连接状态变为down（未连接）</span></span><br></pre></td></tr></table></figure>

<h3 id="主机恢复，恢复原样"><a href="#主机恢复，恢复原样" class="headerlink" title="主机恢复，恢复原样"></a>主机恢复，恢复原样</h3><p>主机恢复后，<strong>恢复到原样</strong>，从机与主机继续建立连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up						<span class="comment">#与主机的连接状态变为up（已连接）</span></span><br></pre></td></tr></table></figure>

<h3 id="从机宕机"><a href="#从机宕机" class="headerlink" title="从机宕机"></a>从机宕机</h3><p>从机宕机后，主机少一台从机，其余从机不受影响</p>
<h3 id="从机恢复"><a href="#从机恢复" class="headerlink" title="从机恢复"></a>从机恢复</h3><p>从机恢复后，会初始化到最初的状态（即变为<code>role:master</code>），需要重新设置从属主机，然后主机的数据会全量复制到从机上。</p>
<h3 id="主机宕机，从机上位"><a href="#主机宕机，从机上位" class="headerlink" title="主机宕机，从机上位"></a>主机宕机，从机上位</h3><p>主机宕机后，如果主机灾害程度无法短时间恢复则可以使用从机进行上位（即取代主机）。</p>
<ol>
<li><p>选择一个从机取消其原本的从属关系，成为新的主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; slaveof no one			<span class="comment">#取消从属关系（成为主机）</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication		<span class="comment">#查看复制关系</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master								<span class="comment">#角色：主机（新的主机）</span></span><br><span class="line">connected_slaves:0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>此时6380从机成为了新的主机，并且<strong>仍保留原有的数据</strong></p>
</li>
<li><p>其余从机重新从属于新的主机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; slaveof 127.0.0.1 6380	<span class="comment">#6381从机从属于6380</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6380</span><br><span class="line">master_link_status:up</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<p>主机可读可写，从机只能读，不能写。</p>
</blockquote>
<h2 id="Redis哨兵模式"><a href="#Redis哨兵模式" class="headerlink" title="Redis哨兵模式"></a>Redis哨兵模式</h2><p>Redis的哨兵模式会在某一Redis服务发生故障（如宕机）时，自动执行从机上位（按照一定规则），并且主机恢复后会从属于新的主机。流程如下：</p>
<ol>
<li><p>配置哨兵的配置文件</p>
<p>redis_sentinel.conf：（配置文件名称自定义）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#该哨兵的名称是sentinel-redis。作用是monitor（监控）主机127.0.0.1的6379（端口）上的Redis服务</span><br><span class="line">sentinel monitor sentinel-redis 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>


</li>
<li><p>启动哨兵</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt; redis-server redis_sentinel.conf --sentinel</span><br></pre></td></tr></table></figure>

<p>出现以下内容则启动成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt;redis-server.exe redis_sentinel.conf --sentinel</span><br><span class="line">[16228] 07 Oct 21:58:19.446 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">[16228] 07 Oct 21:58:19.446 <span class="comment"># Redis version=5.0.10, bits=64, commit=1c047b68, modified=0, pid=16228, just started</span></span><br><span class="line">[16228] 07 Oct 21:58:19.446 <span class="comment"># Configuration loaded</span></span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis 5.0.10 (1c047b68/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._</span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 16228</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line">          `-._        _.-<span class="string">&#x27;</span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span></span><br><span class="line"></span><br><span class="line">[16228] 07 Oct 21:58:19.452 <span class="comment"># Sentinel ID is 192b87ae0be76565fefed74ead2f28454a49f746</span></span><br><span class="line">[16228] 07 Oct 21:58:19.452 <span class="comment"># +monitor master sentinel-redis 127.0.0.1 6379 quorum 1</span></span><br><span class="line">[16228] 07 Oct 21:58:19.456 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ sentinel-redis 127.0.0.1 6379</span><br><span class="line">[16228] 07 Oct 21:58:19.457 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ sentinel-redis 127.0.0.1 6379</span><br></pre></td></tr></table></figure>


</li>
<li><p>监控的主机宕机，从机会在短时间后上位（变为新的主机，其余从机从属于该新主机）</p>
<p>（此时6379宕机）</p>
<p>6381成为新的主机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=22068,lag=0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<p>6380从属于6381：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6381</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br></pre></td></tr></table></figure>


</li>
<li><p>旧主机恢复，变为新主机的从机</p>
<p>（此时6379恢复）</p>
<p>6379从属于6381：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6381</span><br><span class="line">master_link_status:up</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<p>哨兵并不会在主机宕机的一瞬间就将从机上位，而是在一定间隔时间内扫描，扫描到主机宕机了再让从机上位，旧主机恢复时，哨兵将其变为新主机的从机时同理（并不会立马执行，而是在一定时间间隔内）。</p>
</blockquote>
<h3 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h3><ol>
<li><p>查看Redis服务的主从关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; info replication</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置Redis服务之间的从属关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cli&gt; slaveof host port			<span class="comment">#执行命令的当前主机从属于host:port上的Redis服务</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>开启哨兵模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd&gt; redis-sentinel &lt;sentinel_config&gt;	<span class="comment">#以sentinel_config配置文件执行哨兵</span></span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>Tips</strong></p>
<ul>
<li>主从复制原则：先全量复制，再增量复制</li>
<li>哨兵三大任务：监控、提醒、自动故障迁移</li>
</ul>
</blockquote>
<h2 id="Jedis的使用"><a href="#Jedis的使用" class="headerlink" title="Jedis的使用"></a>Jedis的使用</h2><p>Jedis是在Java上使用Redis的客户端，封装了一些命令和操作。类似jdbc，同时Spring官方还提供<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-redis">Spring Data Redis</a></p>
<h3 id="引入Jedis依赖"><a href="#引入Jedis依赖" class="headerlink" title="引入Jedis依赖"></a>引入Jedis依赖</h3><p>采用Maven项目进行演示，需要引入Jedis依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置主机和端口号"><a href="#配置主机和端口号" class="headerlink" title="配置主机和端口号"></a>配置主机和端口号</h3><p>创建Jedis的连接</p>
<p>JedisConnection.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisConnection</span> &#123;</span><br><span class="line">    <span class="comment">//host</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">REDIS_HOST</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line">    <span class="comment">//port</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">REDIS_PORT</span> <span class="operator">=</span> <span class="number">6379</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title function_">getJedis</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(REDIS_HOST,REDIS_PORT);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作key"><a href="#操作key" class="headerlink" title="操作key"></a>操作key</h3><p>具体命令参考<a href="#redis-key">Redis操作key</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisKeys</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获得Jedis对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//是否能连接上redis服务</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ping</span> <span class="operator">=</span> jedis.ping();</span><br><span class="line">        <span class="comment">//查询keys</span></span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">//k1是否存在</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">existsK1</span> <span class="operator">=</span> jedis.exists(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        <span class="comment">//k1的生存时间</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">ttlK1</span> <span class="operator">=</span> jedis.ttl(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        <span class="comment">//k1的类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">typeK1</span> <span class="operator">=</span> jedis.type(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作string"><a href="#操作string" class="headerlink" title="操作string"></a>操作string</h3><p>具体命令参考<a href="#redis-string">Redis操作string类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisString</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获得Jedis对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//存储string数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">setResult</span> <span class="operator">=</span> jedis.set(<span class="string">&quot;k3&quot;</span>, <span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//批量存储string数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">msetResult</span> <span class="operator">=</span> jedis.mset(<span class="string">&quot;k4&quot;</span>, <span class="string">&quot;v4&quot;</span>, <span class="string">&quot;k5&quot;</span>, <span class="string">&quot;v5&quot;</span>);</span><br><span class="line">        <span class="comment">//获得k3的value</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">getK3</span> <span class="operator">=</span> jedis.get(<span class="string">&quot;k3&quot;</span>);</span><br><span class="line">        <span class="comment">//存储k10并且自加</span></span><br><span class="line">        jedis.set(<span class="string">&quot;k10&quot;</span>,<span class="string">&quot;5&quot;</span>);</span><br><span class="line">        jedis.incr(<span class="string">&quot;k10&quot;</span>);</span><br><span class="line">        <span class="comment">//存储k11并且自加50</span></span><br><span class="line">        jedis.set(<span class="string">&quot;k11&quot;</span>,<span class="string">&quot;100&quot;</span>);</span><br><span class="line">        jedis.incrBy(<span class="string">&quot;k11&quot;</span>, <span class="number">50</span>);</span><br><span class="line">        <span class="comment">//获得k3的字符串长度</span></span><br><span class="line">        jedis.strlen(<span class="string">&quot;k3&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="操作list"><a href="#操作list" class="headerlink" title="操作list"></a>操作list</h3><p>具体命令参考<a href="#redis-list">Redis操作list类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从左边添加元素</span></span><br><span class="line">        jedis.lpush(<span class="string">&quot;list1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//移除左边的元素</span></span><br><span class="line">        jedis.lpop(<span class="string">&quot;list1&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历list1</span></span><br><span class="line">        List&lt;String&gt; list1 = jedis.lrange(<span class="string">&quot;list1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        list1.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//返回list1长度</span></span><br><span class="line">        jedis.llen(<span class="string">&quot;list1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从右边添加元素</span></span><br><span class="line">        jedis.rpush(<span class="string">&quot;list2&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//从右边移除元素</span></span><br><span class="line">        jedis.rpop(<span class="string">&quot;list2&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历list2</span></span><br><span class="line">        List&lt;String&gt; list2 = jedis.lrange(<span class="string">&quot;list2&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        list2.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//返回list2长度</span></span><br><span class="line">        jedis.llen(<span class="string">&quot;list2&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="操作set"><a href="#操作set" class="headerlink" title="操作set"></a>操作set</h3><p>具体命令参考<a href="#redis-set">Redis操作set类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisSet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加元素</span></span><br><span class="line">        jedis.sadd(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line">        <span class="comment">//判断元素是否存在</span></span><br><span class="line">        jedis.sismember(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        <span class="comment">//（随机）弹出元素</span></span><br><span class="line">        jedis.spop(<span class="string">&quot;set1&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//移除v1,v2元素</span></span><br><span class="line">        jedis.srem(<span class="string">&quot;set1&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历set1</span></span><br><span class="line">        Set&lt;String&gt; smembers = jedis.smembers(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line">        smembers.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//set1长度</span></span><br><span class="line">        jedis.scard(<span class="string">&quot;set1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="操作hash"><a href="#操作hash" class="headerlink" title="操作hash"></a>操作hash</h3><p>具体命令参考<a href="#redis-hash">Redis操作hash类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisHash</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存入对象student1</span></span><br><span class="line">        jedis.hset(<span class="string">&quot;student1&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;wqk&quot;</span>);</span><br><span class="line">        HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;18&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;score&quot;</span>,<span class="string">&quot;98&quot;</span>);</span><br><span class="line">        <span class="comment">//批量存入student1</span></span><br><span class="line">        jedis.hmset(<span class="string">&quot;student1&quot;</span>,map);</span><br><span class="line">        <span class="comment">//获取student1对象的name值</span></span><br><span class="line">        jedis.hget(<span class="string">&quot;student1&quot;</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="comment">//批量获取student1对象的name、age、score</span></span><br><span class="line">        jedis.hmget(<span class="string">&quot;student1&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;score&quot;</span>);</span><br><span class="line">        <span class="comment">//获取student1对象的所有field-value</span></span><br><span class="line">        jedis.hgetAll(<span class="string">&quot;student1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="操作zset"><a href="#操作zset" class="headerlink" title="操作zset"></a>操作zset</h3><p>具体命令参考<a href="#redis-zset">Redis操作zset类型</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisZset</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向zset1添加v1，v2，v3</span></span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset1&quot;</span>,<span class="number">500</span>,<span class="string">&quot;v1&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset1&quot;</span>,<span class="number">1000</span>,<span class="string">&quot;v2&quot;</span>);</span><br><span class="line">        jedis.zadd(<span class="string">&quot;zset1&quot;</span>,<span class="number">100</span>,<span class="string">&quot;v3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按照下标遍历zset1</span></span><br><span class="line">        Set&lt;String&gt; zset1 = jedis.zrange(<span class="string">&quot;zset1&quot;</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line">        zset1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//按照分数遍历zset1</span></span><br><span class="line">        Set&lt;String&gt; zset11 = jedis.zrangeByScore(<span class="string">&quot;zset1&quot;</span>, <span class="number">0</span>, <span class="number">1000</span>);</span><br><span class="line">        zset11.forEach(System.out::println);</span><br><span class="line">        <span class="comment">//zset1长度</span></span><br><span class="line">        jedis.zcard(<span class="string">&quot;zset1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis事务-1"><a href="#Redis事务-1" class="headerlink" title="Redis事务"></a>Redis事务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTransaction</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> JedisConnection.getJedis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取Redis的事务对象</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">transaction</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        <span class="comment">// start</span></span><br><span class="line">        transaction.set(<span class="string">&quot;k6&quot;</span>,<span class="string">&quot;v6&quot;</span>);</span><br><span class="line">        transaction.set(<span class="string">&quot;k7&quot;</span>,<span class="string">&quot;v7&quot;</span>);</span><br><span class="line">        <span class="comment">// end</span></span><br><span class="line">        transaction.exec(); <span class="comment">//执行事务</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Redis客户端可视化"><a href="#Redis客户端可视化" class="headerlink" title="Redis客户端可视化"></a>Redis客户端可视化</h2><p>一个开源的Redis客户端可视化工具<a target="_blank" rel="noopener" href="https://github.com/uglide/RedisDesktopManager/releases/download/0.8.8/redis-desktop-manager-0.8.8.384.exe">Redis-Desktop-Manager</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/Redis/redis%E5%85%A5%E9%97%A8/redis/" data-id="clsblyuf5002nw0k6fm8ye4bt" data-title="Redis原理和Jedis" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jedis/" rel="tag">jedis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/golang库/flag" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/golang%E5%BA%93/flag/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/golang%E5%BA%93/flag/">Go的解析命令行库flag</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>flag</code>和<code>log</code>一样是Go的标准库。<code>flag</code>用于解析命令行的选项，例如命令<code>ls -al</code>列出当前目录下所有文件和目录的详细信息，其中<code>-al</code>就是命令行选项。</p>
<p>命令行选项在实际开发中很常用，特别是在一起命令行工具当中：</p>
<ul>
<li><code>redis</code>指定配置文件的路径：<code>redis-server ./redis.conf</code>以当前目录下的<code>redis.conf</code>文件启动<code>redis</code>服务器。</li>
<li><code>curl</code>发起请求：<code>curl -X POST https://www.baidu.com</code>对<code>https://www.baidu.com</code>发起POST请求。</li>
</ul>
<h2 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	name   <span class="type">string</span></span><br><span class="line">	age    <span class="type">int</span></span><br><span class="line">	gender <span class="type">bool</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;name :&quot;</span>, name)</span><br><span class="line">	fmt.Println(<span class="string">&quot;age :&quot;</span>, age)</span><br><span class="line">	fmt.Println(<span class="string">&quot;gender :&quot;</span>, gender)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.StringVar(&amp;name, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;name&quot;</span>)</span><br><span class="line">	flag.IntVar(&amp;age, <span class="string">&quot;age&quot;</span>, <span class="number">0</span>, <span class="string">&quot;age&quot;</span>)</span><br><span class="line">	flag.BoolVar(&amp;gender, <span class="string">&quot;gender&quot;</span>, <span class="literal">false</span>, <span class="string">&quot;gender: false is man&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以使用先使用<code>go build</code>编译程序，然后再执行可执行文件，或者直接使用<code>go run</code>编译并执行程序，这里演示<code>go run</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go -name admin</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name : admin</span><br><span class="line">age : 0</span><br><span class="line">gender : <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><code>flag.TypeVar()</code>的<code>Type</code>可以为基本的数据类型，如<code>Int</code>、<code>String</code>、<code>Bool</code>等。4个参数分别是：</p>
<ol>
<li>变量的地址</li>
<li>选项名，也就是<code>-</code>后面需要跟的字符</li>
<li>默认值。</li>
<li>帮助信息，也就是在使用<code>-h或者--help</code>的时候输出的该选项的帮助信息。</li>
</ol>
<p>最后在使用<code>flag.Parse()</code>完成解析，也就是说在<code>flag.Parse()</code>调用之后不能再定义选项了。众所周知，由于<code>init()</code>函数执行顺序是要早于<code>main()</code>函数的，所以建议在<code>init()</code>里定义选项，在<code>main()</code>中完成解析。总之就是选项的定义<code>flag.TypeVar()</code>一定要早于<code>flag.Parse()</code>。</p>
<h2 id="选项格式"><a href="#选项格式" class="headerlink" title="选项格式"></a>选项格式</h2><p><code>flag</code>库支持三种命令行选项格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-flag</span><br><span class="line">-flag=x</span><br><span class="line">-flag x</span><br></pre></td></tr></table></figure>

<p>第一种只支持Bool类型的选项。如，指定了<code>-flag</code>，那么该Bool类型的选项就是true。</p>
<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="解析时间间隔time-duration"><a href="#解析时间间隔time-duration" class="headerlink" title="解析时间间隔time.duration"></a>解析时间间隔time.duration</h3><p>时间间隔支持的格式非常之多，例如”300ms”、”-1.5h”、“2h45m”等等等等。 时间单位可以是 ns&#x2F;us&#x2F;ms&#x2F;s&#x2F;m&#x2F;h&#x2F;day 等。实际上<code>flag</code>内部会调用<code>time.ParseDuration</code>。具体支持的格式可以参见<a target="_blank" rel="noopener" href="https://golang.org/pkg/time/#ParseDuration">time</a>库的文档。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	duration time.Duration</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;duration :&quot;</span>, duration.String())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.DurationVar(&amp;duration, <span class="string">&quot;duration&quot;</span>, time.Second, <span class="string">&quot;duration of time&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://darjun.github.io/2020/01/10/godailylib/flag/">每日一库之flag</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/golang%E5%BA%93/flag/" data-id="clsblyuf6002pw0k60azze5va" data-title="Go的解析命令行库flag" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flag/" rel="tag">flag</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/golang库/flags" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/golang%E5%BA%93/flags/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/golang%E5%BA%93/flags/">Go的解析命令行库go-flags</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Go的标准库<code>flag</code>由于其有不支持短选项，选项定义比较繁琐，默认只支持有限的数据类型。为了解决这些问题，出现了不少第三方解析命令行选项的库，<code>go-flags</code>就是其中一个。</p>
<p><code>go-flags</code>提供了比标准库<code>flag</code>更多的选项，它利用结构体的标签<code>tag</code>和反射提供了一个方便、简洁的接口。除了基本的功能，还提供了其他丰富的特性：</p>
<ul>
<li><p>支持短选项<code>-v</code>和长选项<code>-verbose</code></p>
</li>
<li><p>支持短选项合写，如<code>-aux</code></p>
</li>
<li><p>同一选项可以设置多个值</p>
</li>
<li><p>支持所有基础类型和map类型，甚至函数</p>
</li>
<li><p>支持命名空间和选项组</p>
<p>等等…</p>
</li>
</ul>
<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>使用<code>go get</code>安装第三方库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/jessevdk/go-flags</span><br></pre></td></tr></table></figure>

<p>快速开始</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Option <span class="keyword">struct</span> &#123;</span><br><span class="line">	Names []<span class="type">string</span> <span class="string">`short:&quot;n&quot; long:&quot;name&quot; description:&quot;names of user&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> opt Option</span><br><span class="line">	flags.Parse(&amp;opt)</span><br><span class="line"></span><br><span class="line">	fmt.Println(opt.Names)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go --name test1 --name test2 --name test3</span><br><span class="line">[test1 test2 test3]</span><br></pre></td></tr></table></figure>



<p>使用<code>go-flags</code>的一般步骤：</p>
<ol>
<li>在<code>struct</code>结构体的tag中定义选项。<code>short</code>定义短选项，<code>long</code>定义长选项，<code>description</code>设置帮助信息。</li>
<li>声明选项变量。</li>
<li>和<code>flag</code>类似地，调用<code>flags.Parse()</code>开始解析选项。</li>
</ol>
<h2 id="基本特性"><a href="#基本特性" class="headerlink" title="基本特性"></a>基本特性</h2><h3 id="支持丰富的数据类型"><a href="#支持丰富的数据类型" class="headerlink" title="支持丰富的数据类型"></a>支持丰富的数据类型</h3><p><code>go-flags</code>相比标准库<code>flag</code>支持更丰富的数据类型：</p>
<ul>
<li>所有基本的数据类型（包括符号整数和无符号整数，浮点数，布尔类型和字符串）及它们的切片</li>
<li>map类型。不过仅支持键为<code>string</code>，值为基础类型。</li>
<li>函数类型。</li>
</ul>
<blockquote>
<p>Tips</p>
<p>切片类型选项，遇到相同的选项时，值会被追加到切片中。而非切片类型选项，如果遇到相同选项，后出现的值会覆盖先出现的值。</p>
<p>选项是函数类型：函数类型的参数有且仅有一个，作为函数的入参。</p>
<p>选项是map类型：键只能是string类型，值是基本的数据类型，格式为<code>key:value</code></p>
</blockquote>
<p>示例</p>
<p>main.go:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Option <span class="keyword">struct</span> &#123;</span><br><span class="line">	Names    []<span class="type">string</span>       <span class="string">`short:&quot;n&quot; long:&quot;name&quot; description:&quot;names of users&quot;`</span></span><br><span class="line">	Age      <span class="type">int</span>            <span class="string">`short:&quot;a&quot; long:&quot;age&quot; description:&quot;age of user&quot;`</span></span><br><span class="line">	Pointers []*<span class="type">string</span>      <span class="string">`short:&quot;p&quot; long:&quot;pointer&quot; description:&quot;pointers of *string&quot;`</span></span><br><span class="line">	Call     <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span>      <span class="string">`short:&quot;c&quot; long:&quot;call&quot; description:&quot;call function&quot;`</span></span><br><span class="line">	Values   <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span> <span class="string">`short:&quot;v&quot; long:&quot;value&quot; description:&quot;values of user&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> opt Option</span><br><span class="line">	opt.Call = <span class="function"><span class="keyword">func</span><span class="params">(v <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">		<span class="comment">// 预先定义好call属性的函数类型的实现，然后parse后会自动进行调用</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;call function:&quot;</span>, v)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> _, err := flags.Parse(&amp;opt); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;flags parse failed&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(opt.Names)</span><br><span class="line">	fmt.Println(opt.Age)</span><br><span class="line">	<span class="keyword">for</span> _, p := <span class="keyword">range</span> opt.Pointers &#123;</span><br><span class="line">		fmt.Println(*p)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(opt.Values)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>terminal:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go --name test1 -n test2 -n test3 -a 18 -a 19 -p pointer -c 18 -v k1:18</span><br><span class="line">call <span class="keyword">function</span>: 18</span><br><span class="line">[test1 test2 test3]</span><br><span class="line">19</span><br><span class="line">pointer</span><br><span class="line">map[k1:18]</span><br></pre></td></tr></table></figure>

<h3 id="常用设置"><a href="#常用设置" class="headerlink" title="常用设置"></a>常用设置</h3><p><code>required</code>为true时，对应的选项必须设置值，否则会抛出<code>ErrRequired</code>错误</p>
<p><code>default</code>用于设置选项的默认值，即选项如果没有设置值的时候，会使用此默认值</p>
<p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="type">string</span> <span class="string">`short:&quot;n&quot; required_default:&quot;true&quot;`</span></span><br><span class="line">	Gender <span class="type">string</span> <span class="string">`short:&quot;g&quot; default:&quot;man&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> config Config</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> _, err := flags.Parse(&amp;config); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;parse failed:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(config.Name)</span><br><span class="line">	fmt.Println(config.Gender)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>terminal</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go -n <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">man</span><br></pre></td></tr></table></figure>



<h2 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h2><h3 id="选项分组"><a href="#选项分组" class="headerlink" title="选项分组"></a>选项分组</h3><p>main.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Option <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="type">string</span>        <span class="string">`long:&quot;name&quot;`</span></span><br><span class="line">	Info    InfoOption    <span class="string">`group:&quot;info&quot;`</span></span><br><span class="line">	Contact ContactOption <span class="string">`group:&quot;contact&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> InfoOption <span class="keyword">struct</span> &#123;</span><br><span class="line">	Gender <span class="type">bool</span> <span class="string">`long:&quot;gender&quot;`</span></span><br><span class="line">	Age    <span class="type">int</span>  <span class="string">`long:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ContactOption <span class="keyword">struct</span> &#123;</span><br><span class="line">	Email <span class="type">string</span> <span class="string">`long:&quot;email&quot;`</span></span><br><span class="line">	Phone <span class="type">string</span> <span class="string">`long:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> opt Option</span><br><span class="line">	<span class="keyword">if</span> _, err := flags.Parse(&amp;opt); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;flags parse failed:&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(opt.Name)</span><br><span class="line">	fmt.Println(opt.Info)</span><br><span class="line">	fmt.Println(opt.Contact)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将分组的选项拆分到另外两个结构体当中，并且在父结构体中使用时，加上Tag:<code>group:&quot;&quot;</code></p>
<p>terminal</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ go run main.go --name <span class="built_in">test</span> --gender --age 18 --email abc@example.com --phone 1111111</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">&#123;<span class="literal">true</span> 18&#125;</span><br><span class="line">&#123;abc@example.com 1111111&#125;</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://darjun.github.io/2020/01/10/godailylib/go-flags/">每日一库之go-flags</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/golang%E5%BA%93/flags/" data-id="clsblyuf6002rw0k6efiy8p57" data-title="Go的解析命令行库go-flags" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/flags/" rel="tag">flags</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/golang库/logrus" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/golang%E5%BA%93/logrus/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/golang%E5%BA%93/logrus/">Go的日志库logrus</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><code>logrus</code>完全兼容Go的标准日志库<code>log</code>。同时它还支持文本、JSON两种日志输出格式。</p>
<p>源码地址：<a target="_blank" rel="noopener" href="https://github.com/sirupsen/logrus">https://github.com/sirupsen/logrus</a></p>
<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><p>先安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/sirupsen/logrus</span><br></pre></td></tr></table></figure>

<p>quick start：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 手动修改日志显示的级别，即高于该级别的就会显示</span></span><br><span class="line">	logrus.SetLevel(logrus.TraceLevel)</span><br><span class="line"></span><br><span class="line">	logrus.Trace(<span class="string">&quot;trace msg&quot;</span>)</span><br><span class="line">	logrus.Debug(<span class="string">&quot;debug msg&quot;</span>)</span><br><span class="line">	logrus.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">	logrus.Warn(<span class="string">&quot;warn msg&quot;</span>)</span><br><span class="line">	logrus.Error(<span class="string">&quot;error msg&quot;</span>)</span><br><span class="line">	logrus.Fatal(<span class="string">&quot;fatal msg&quot;</span>)</span><br><span class="line">	logrus.Panic(<span class="string">&quot;panic msg&quot;</span>) <span class="comment">// Fatal会直接退出程序，所以panic不会触发</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认的日志显示级别为：<code>Info</code>。日志级别由高到低分别是：<code>Panic</code>、<code>Fatal</code>、<code>Error</code>、<code>Warn</code>、<code>Info</code>、<code>Debug</code>、<code>Trace</code>。</p>
<p>输出的日志包含：</p>
<ul>
<li>time：输出日志的时间</li>
<li>level：日志级别</li>
<li>msg：日志信息</li>
</ul>
<h2 id="手动定制"><a href="#手动定制" class="headerlink" title="手动定制"></a>手动定制</h2><h3 id="输出调用者信息"><a href="#输出调用者信息" class="headerlink" title="输出调用者信息"></a>输出调用者信息</h3><p>即输出调用的文件名以及调用的函数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logrus.SetReportCaller(<span class="literal">true</span>)</span><br><span class="line">	logrus.Trace(<span class="string">&quot;trace msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时则会打印调用者的信息。</p>
<h3 id="添加字段"><a href="#添加字段" class="headerlink" title="添加字段"></a>添加字段</h3><p>有时候需要在输出中添加一些字段，可以调用<code>logrus.WithField</code>或<code>logrus.WithFields</code>实现。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logger := logrus.WithFields(logrus.Fields&#123;</span><br><span class="line">		<span class="string">&quot;user&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">		<span class="string">&quot;host&quot;</span>: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	logger.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>WithFields</code>的参数是map，从而实现一次性添加多个字段</p>
<p>等价于</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logEntry := logrus.WithField(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">	logEntry = logEntry.WithField(<span class="string">&quot;host&quot;</span>, <span class="string">&quot;localhost&quot;</span>)</span><br><span class="line">  </span><br><span class="line">	logEntry.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>WithField</code>的参数是key，value，从而实现一次性添加一个字段。</p>
<h3 id="重定向输出"><a href="#重定向输出" class="headerlink" title="重定向输出"></a>重定向输出</h3><p>默认情况下，日志是输出到<code>io.Stderr</code>的，也就是控制台。可以通过<code>logrus.SetOutput</code>传入一个<code>io.Writer</code>从而重定向输出到不同的io。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	io1 := &amp;bytes.Buffer&#123;&#125;</span><br><span class="line">	io2 := os.Stderr</span><br><span class="line">	io3, err := os.OpenFile(<span class="string">&quot;log.txt&quot;</span>, os.O_WRONLY|os.O_CREATE, <span class="number">0755</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalf(<span class="string">&quot;create file log.txt failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	logrus.SetOutput(io.MultiWriter(io1, io2, io3))</span><br><span class="line">	logrus.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新建对象"><a href="#新建对象" class="headerlink" title="新建对象"></a>新建对象</h3><p>通常情况下，考虑到易用性或者封装性，库都支持创建新的对象，这样开发者就不需要<code>logrus.</code>一把梭了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logger := logrus.New()</span><br><span class="line"></span><br><span class="line">	logger.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从<code>logrus</code>的<code>New()</code>的源码可知：</p>
<ul>
<li>默认输出到控制台</li>
<li>默认输出的日志格式是文本格式（<code>logrus</code>还支持JSON格式）</li>
<li>默认的日志级别是<code>Info</code></li>
<li>默认不输出调用者信息</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span></span> *Logger &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Logger&#123;</span><br><span class="line">		Out:          os.Stderr,</span><br><span class="line">		Formatter:    <span class="built_in">new</span>(TextFormatter),</span><br><span class="line">		Hooks:        <span class="built_in">make</span>(LevelHooks),</span><br><span class="line">		Level:        InfoLevel,</span><br><span class="line">		ExitFunc:     os.Exit,</span><br><span class="line">		ReportCaller: <span class="literal">false</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="日志格式"><a href="#日志格式" class="headerlink" title="日志格式"></a>日志格式</h3><p>由上述得知，<code>logrus</code>默认输出的日志格式是文本格式，也就是<code>TextFormatter</code>，其实它还支持<code>JSONFormatter</code>，可以利用<code>SetFormatter()</code>手动指定。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logrus.SetFormatter(&amp;logrus.JSONFormatter&#123;&#125;)</span><br><span class="line">	logrus.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>text格式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time=<span class="string">&quot;2022-08-13T17:52:19+08:00&quot;</span> level=info msg=<span class="string">&quot;info msg&quot;</span></span><br></pre></td></tr></table></figure>

<p>JSON格式：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;level&quot;</span><span class="punctuation">:</span><span class="string">&quot;info&quot;</span><span class="punctuation">,</span><span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;info msg&quot;</span><span class="punctuation">,</span><span class="attr">&quot;time&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-08-13T17:51:35+08:00&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p>开发者可以通过实现<code>logrus.Formatter</code>接口来实现自己的日志格式。</p>
<h2 id="手动封装"><a href="#手动封装" class="headerlink" title="手动封装"></a>手动封装</h2><p>指定Logrus的参数</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyLogger <span class="keyword">struct</span> &#123;</span><br><span class="line">	logger *logrus.Entry</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span></span> MyLogger &#123;</span><br><span class="line">	logger := logrus.New()</span><br><span class="line">	logger.SetLevel(logrus.InfoLevel)</span><br><span class="line">	logger.SetReportCaller(<span class="literal">true</span>)</span><br><span class="line">  logger.SetFormatter(&amp;logrus.TextFormatter&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> MyLogger&#123;</span><br><span class="line">		logger: logger.WithFields(logrus.Fields&#123;<span class="string">&quot;app&quot;</span>: <span class="string">&quot;test_demo&quot;</span>&#125;),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时再分别对各项日志级别的输出内容进行封装，这里只演示<code>Trace()</code>和<code>Tracef()</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m MyLogger)</span></span> Trace(args ...<span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	m.logger.Trace(args...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m MyLogger)</span></span> Tracef(format <span class="type">string</span>, args ...<span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	m.logger.Tracef(format, args...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	logger := New()</span><br><span class="line"></span><br><span class="line">	logger.Info(<span class="string">&quot;info msg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/golang%E5%BA%93/logrus/" data-id="clsblyuf7002uw0k66hzw32si" data-title="Go的日志库logrus" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logrus/" rel="tag">logrus</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/golang库/godotenv" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/golang%E5%BA%93/godotenv/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/golang%E5%BA%93/godotenv/">读取配置文件库godotenv</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="加载配置文件Load"><a href="#加载配置文件Load" class="headerlink" title="加载配置文件Load"></a>加载配置文件Load</h2><p>读取配置文件，然后将读取到的键值对<strong>写入环境变量</strong></p>
<ol>
<li><code>godotenv.Load(fileName)</code>加载配置文件或者<code>godotenv.Read(filename)</code>读取配置文件</li>
<li><code>os.Getenv(key)</code>，通过key读取value</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/joho/godotenv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1 godotenv加载文件，并且set到环境变量中</span></span><br><span class="line">	<span class="comment">// 2 通过os.Getenv(key)根据key读取环境变量value</span></span><br><span class="line"></span><br><span class="line">	err := godotenv.Load()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;app_name:&quot;</span>, os.Getenv(<span class="string">&quot;app_name&quot;</span>))</span><br><span class="line">	fmt.Println(<span class="string">&quot;app_version:&quot;</span>, os.Getenv(<span class="string">&quot;app_version&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自动加载"><a href="#自动加载" class="headerlink" title="自动加载"></a>自动加载</h3><p>你可以导入<code>github.com/joho/godotenv/autoload</code>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  _ <span class="string">&quot;github.com/joho/godotenv/autoload&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>让程序自动加载配置文件，省去了<code>godotenv.Load()</code>这一步骤：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">&quot;github.com/joho/godotenv/autoload&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;app_name:&quot;</span>, os.Getenv(<span class="string">&quot;app_name&quot;</span>))</span><br><span class="line">	fmt.Println(<span class="string">&quot;app_version:&quot;</span>, os.Getenv(<span class="string">&quot;app_version&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="读取配置文件Read"><a href="#读取配置文件Read" class="headerlink" title="读取配置文件Read"></a>读取配置文件Read</h2><p>读取配置文件，然后返回<code>map[string]string</code></p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p><code>godotenv.Load()</code>默认加载的配置文件名为<code>.env</code>，该文件的格式是键值对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key = value</span><br></pre></td></tr></table></figure>



<p>还支持<code>YAML</code>格式</p>
<h2 id="多个配置文件"><a href="#多个配置文件" class="headerlink" title="多个配置文件"></a>多个配置文件</h2><p>可以使用<code>godotenv.Load(filename1, filename2)</code>或者<code>godotenv.Read(filename1, filename2)</code>的方式来读取或者加载多个配置文件</p>
<blockquote>
<p><strong>Tips</strong>：</p>
<p>如果多个配置文件中存在同一键，那么以先加载的键的值为准！而不是后加载的键覆盖后加载的键。</p>
</blockquote>
<h2 id="多环境配置"><a href="#多环境配置" class="headerlink" title="多环境配置"></a>多环境配置</h2><p>实际开发中可能有好几种不同环境的配置文件，如<code>dev</code>、<code>test</code>、<code>prod</code>三种环境的配置文件，可以使用一个总配置文件，指名当前的环境，再根据不同的环境拿到对应的配置文件即可。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>.active-env</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">active = dev</span><br></pre></td></tr></table></figure>

<p>.env.dev</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_name = dev_app</span><br></pre></td></tr></table></figure>

<p>.env.test</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_name = test_app</span><br></pre></td></tr></table></figure>

<p>.env.prod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_name = test_app</span><br></pre></td></tr></table></figure>



<p>main.go读取</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/joho/godotenv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err := godotenv.Load(<span class="string">&quot;.active-env&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 根据不同环境去加载不同的配置文件到环境变量中</span></span><br><span class="line">	activeEnv := os.Getenv(<span class="string">&quot;active&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> activeEnv == <span class="string">&quot;dev&quot;</span> || activeEnv == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := godotenv.Load(<span class="string">&quot;.env.dev&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> activeEnv == <span class="string">&quot;test&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := godotenv.Load(<span class="string">&quot;.env.test&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> activeEnv == <span class="string">&quot;prod&quot;</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := godotenv.Load(<span class="string">&quot;.env.prod&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;app_name:&quot;</span>, os.Getenv(<span class="string">&quot;app_name&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://darjun.github.io/2020/02/12/godailylib/godotenv/">Go每日一库godotenv</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/golang%E5%BA%93/godotenv/" data-id="clsblyuf9002vw0k6b650ahue" data-title="读取配置文件库godotenv" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/godotenv/" rel="tag">godotenv</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-front-end/vue/promise异步处理/ES6处理异步的方式promise" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/front-end/vue/promise%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/ES6%E5%A4%84%E7%90%86%E5%BC%82%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8Fpromise/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/front-end/vue/promise%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/ES6%E5%A4%84%E7%90%86%E5%BC%82%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8Fpromise/">ES6处理异步的方式promise</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、promise初使用"><a href="#1、promise初使用" class="headerlink" title="1、promise初使用"></a>1、promise初使用</h2><p>大多数情况我们发起网络请求的时候都是利用Ajax异步请求。所以这个时候Ajax在没有得到请求的结果时是线程是异步的。在ES6的新语法中就有了promise这样一个类来更加优美地处理异步和异步的嵌套。</p>
<p>假如我们想要发起一个请求一，然后利用请求一得到的结果再发起请求二，再利用请求二的结果发起请求三，嵌套下去，我们的代码就会像这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;<span class="comment">// 请求1</span></span><br><span class="line">  <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;<span class="comment">// 请求2</span></span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;<span class="comment">// 请求3</span></span><br><span class="line">          <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line"></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>无限套娃，就会看起来特别累，所以promise就能更加优雅地处理异步。</p>
<p>首先我们先需要new一个promise对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>();</span><br></pre></td></tr></table></figure>

<p>他的构造函数需要一个参数，这个参数是一个函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后这个函数需要两个参数，分别是resolve（解决）和reject（拒绝）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样我们就可以在这个函数里面写异步体了，比如发送一个请求：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//异步体</span></span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="comment">//请求的地址</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//请求类型</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//异步开启</span></span><br><span class="line">    <span class="keyword">async</span> :<span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//请求的参数</span></span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//请求成功的回调函数</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//请求失败的回调函数</span></span><br><span class="line">    <span class="title function_">error</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);<span class="comment">// ajax</span></span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后promise厉害的一点就是不会在异步体里处理请求成功的数据，而是在外面，相当于异步体和异步结果的处理分开了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//异步体</span></span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="comment">//请求的地址</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//请求类型</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//异步开启</span></span><br><span class="line">    <span class="keyword">async</span> :<span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//请求的参数</span></span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//请求成功的回调函数</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//请求失败的回调函数</span></span><br><span class="line">    <span class="title function_">error</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);<span class="comment">// ajax</span></span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个then函数的参数函数里就是对异步结果的处理，比如我想要打印上面ajax请求成功的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//异步体</span></span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="comment">//请求的地址</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//请求类型</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//异步开启</span></span><br><span class="line">    <span class="keyword">async</span> :<span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//请求的参数</span></span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//请求成功的回调函数</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(res);<span class="comment">// 调用resolve利用then函数来处理</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//请求失败的回调函数</span></span><br><span class="line">    <span class="title function_">error</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);<span class="comment">// ajax</span></span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="comment">// 异步成功结果处理</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>promise比较厉害的一点就是在then里定义好对异步成功结果的处理，然后在异步体里成功的地方直接调用resolve()，实际上就是调用了then函数。同理，这是异步成功，异步失败的话就定义一个catch函数来捕获失败就好了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//异步体</span></span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="comment">//请求的地址</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//请求类型</span></span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">//异步开启</span></span><br><span class="line">    <span class="keyword">async</span> :<span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//请求的参数</span></span><br><span class="line">    <span class="attr">data</span>: &#123;&#125;,</span><br><span class="line">    <span class="comment">//请求成功的回调函数</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(res);<span class="comment">// 调用resolve利用then函数来处理</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//请求失败的回调函数</span></span><br><span class="line">    <span class="title function_">error</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(res);<span class="comment">// 调用reject利用catch函数来处理</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);<span class="comment">// ajax</span></span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="comment">// 异步成功结果处理</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="comment">// 异步失败结果处理</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在catch函数里定义好异步失败结果的处理，然后在异步体里的失败处调用reject函数就可以使用catch里的代码了。</p>
<p>总结，promise实质上就是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="comment">/*异步体*/</span>).<span class="title function_">then</span>(<span class="comment">/*异步成功结果的处理*/</span>).<span class="title function_">catch</span>(<span class="comment">/*异步失败结果处理*/</span>);</span><br></pre></td></tr></table></figure>

<p>链式编程，第一个Promise需要传递的参数就是异步体，then里需要传递的就是对异步体成功结果的处理，catch就是对异步失败结果的处理。只不过这三个需要传递的参数就都是函数而已：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">  <span class="comment">/*异步体*/</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">/*异步成功结果的处理*/</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">/*异步失败结果处理*/</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="2、利用promise处理异步嵌套"><a href="#2、利用promise处理异步嵌套" class="headerlink" title="2、利用promise处理异步嵌套"></a>2、利用promise处理异步嵌套</h2><p>所以刚才上述讲到的ajax异步请求嵌套就可以利用promise来更优美的处理：</p>
<p>先写好第一个promise处理异步：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123; <span class="comment">//请求一</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">/*异步成功结果的处理*/</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后在then里写好对请求一结果的处理并且发起请求二：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123; <span class="comment">//请求一</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(res);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="comment">// 拿到res并处理</span></span><br><span class="line">  <span class="comment">// 发起请求二</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123; <span class="comment">//请求二</span></span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/*异步成功结果的处理*/</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>需要在第一层promise的then里返回一个新的Promise对象，然后像之前promise一样处理就好了，定义好异步体，异步成功的处理，异步失败的处理，所以上述三层请求嵌套就是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123; <span class="comment">//请求一</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(res);<span class="comment">// 利用promise1的then</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">  <span class="comment">// 拿到请求一的res并处理</span></span><br><span class="line">  <span class="comment">// 发起请求二</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123; <span class="comment">//请求二</span></span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(res);<span class="comment">// 利用promise2的then</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="comment">// 拿到请求二的res并处理</span></span><br><span class="line">    <span class="comment">// 发起请求三</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">      $.<span class="title function_">ajax</span>(&#123; <span class="comment">//请求三</span></span><br><span class="line">        <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res);<span class="comment">// 利用promise3的then</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="comment">/*异步3成功结果的处理*/</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="3、利用promise-all处理异步"><a href="#3、利用promise-all处理异步" class="headerlink" title="3、利用promise.all处理异步"></a>3、利用promise.all处理异步</h2><p>有的时候我们需要利用两个请求的共同结果来进行处理，比如现在有ajax1和ajax2，接下来我需要的是必须将两个请求的结果拿到，然后再将结果进行处理，少了一个就不行，这个时候我们就可以利用promise的all来处理这种异步。</p>
<p>首先，我们需要利用Promise对象的all()方法，这个all方法需要的参数是一个Promise对象数组：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([]);</span><br></pre></td></tr></table></figure>

<p>我们给他传入两个promise对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="comment">//promise1</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    <span class="comment">/*异步体*/</span></span><br><span class="line">  &#125;),</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">//promise2</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    <span class="comment">/*异步体*/</span></span><br><span class="line">  &#125;),</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>然后对两个的结果进行共同处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//promise1</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    <span class="comment">/*promise1异步体*/</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">//promise2</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    <span class="comment">/*promise1异步体*/</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">]).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">results</span>) &#123;</span><br><span class="line">  <span class="comment">/*对promise数组的结果进行共同处理*/</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>共同处理的then函数里的results就是promise异步成功结果的数组，比如promise1异步成功的结果就是results[0]，promise2异步成功的结果就是results[1]：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//promise1</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    <span class="comment">/*promise1异步体*/</span></span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">//promise2</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    <span class="comment">/*promise1异步体*/</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">]).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">results</span>) &#123;</span><br><span class="line">  <span class="comment">/*对promise数组的结果进行共同处理*/</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results[<span class="number">0</span>]);<span class="comment">// promise1的成功结果</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results[<span class="number">1</span>]);<span class="comment">// promise2的成功结果</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>比如我利用两个ajax请求模拟：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//promise1</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;<span class="comment">// 请求1</span></span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(res); <span class="comment">//将请求1的结果传递给then</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">//promise2</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve,reject</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;<span class="comment">// 请求2</span></span><br><span class="line">      <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(res); <span class="comment">//将请求2的结果传递给then</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">]).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">results</span>) &#123;</span><br><span class="line">  <span class="comment">/*对promise数组的结果进行共同处理*/</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results[<span class="number">0</span>]);<span class="comment">// promise1的成功结果</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(results[<span class="number">1</span>]);<span class="comment">// promise2的成功结果</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>总结就是利用Promise.all()同时处理多个异步，然后传递promise对象进行各自的异步处理，最后在利用Promise.all()的then来将获得的results成功结果数组进行统一处理。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/front-end/vue/promise%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/ES6%E5%A4%84%E7%90%86%E5%BC%82%E6%AD%A5%E7%9A%84%E6%96%B9%E5%BC%8Fpromise/" data-id="clsblyufb002ww0k67pxpf8ot" data-title="ES6处理异步的方式promise" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es6/" rel="tag">es6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/promise/" rel="tag">promise</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-front-end/vue/vue-cli/vue-cli" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/front-end/vue/vue-cli/vue-cli/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/front-end/vue/vue-cli/vue-cli/">vue三大重点之vue-cli</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是vue-cli？"><a href="#1、什么是vue-cli？" class="headerlink" title="1、什么是vue-cli？"></a>1、什么是vue-cli？</h2><p>vue-cli（vue脚手架）就是vue官方的基于webpack的用于快速初始化构建vue项目的工具。就像建房子最开始的骨架需要用到的脚手架一样，它是一个能提高开发者工作效率的工具。能够辅助开发者快速地搭建好vue项目所需要地项目目录以及架构。</p>
<p>因为vue-cli是基于webpack的，所以它有许多webpack的影子，但是却简化了webpack的相关配置。相当于vue-cli是webpack用于vue的个性化定制版，并且官方简化了许多配置。</p>
<h2 id="2、vue-cli-2"><a href="#2、vue-cli-2" class="headerlink" title="2、vue-cli 2"></a>2、vue-cli 2</h2><p>vue-cli 2是使用得最多的一个版本。</p>
<ol>
<li><p>利用npm安装vue-cli 2</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure>

<p>因为现在vue-cli 3已经发布了，所以上面这条命令实际上安装的是vue-cli 3（-g全局安装），所以我们想要使用vue-cli 2还需要拉取vue-cli 2的模板</p>
</li>
<li><p>利用npm拉取vue-cli 2的模板</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli-init</span><br></pre></td></tr></table></figure>

<p>依旧是全局安装</p>
</li>
<li><p>利用vue-cli 2构建vue项目</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack 项目名称</span><br></pre></td></tr></table></figure>


</li>
<li><p>vue-cli 2构建的vue项目的目录结构</p>
<p>vue-cli 2构建项目选择配置：</p>
<p><img src="/2023/07/19/front-end/vue/vue-cli/vue-cli/image-20201020182552291.png"></p>
<p>利用vue-cli 2构建好的项目：</p>
<p><img src="/2023/07/19/front-end/vue/vue-cli/vue-cli/image-20201021152508040-1606101597612.png"></p>
</li>
</ol>
<h2 id="3、vue-cli-3"><a href="#3、vue-cli-3" class="headerlink" title="3、vue-cli 3"></a>3、vue-cli 3</h2><p>因为刚刚已经使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure>

<p>已经安装了vue-cli 3脚手架了所以就不需要再重复安装了。只需要利用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名称</span><br></pre></td></tr></table></figure>

<p>来创建vue项目就好了</p>
<p>vue-cli 3构建项目是需要选择的配置：</p>
<p><img src="/2023/07/19/front-end/vue/vue-cli/vue-cli/image-20201021182647310.png"></p>
<p>vue-cli 3构建完成的项目的目录结构：</p>
<p><img src="/2023/07/19/front-end/vue/vue-cli/vue-cli/image-20201022122952874.png"></p>
<p>同时利用vue-cli 3还有一个强大的一点就是可视化项目管理：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue ui</span><br></pre></td></tr></table></figure>

<p><img src="/2023/07/19/front-end/vue/vue-cli/vue-cli/image-20201022143124750.png"></p>
<p>可以直接在web里管理项目的插件以及依赖项，甚至可以启动、重启、关闭项目。</p>
<h2 id="4、vue-cli-2和vue-cli-3主要的区别"><a href="#4、vue-cli-2和vue-cli-3主要的区别" class="headerlink" title="4、vue-cli 2和vue-cli 3主要的区别"></a>4、vue-cli 2和vue-cli 3主要的区别</h2><p>构建vue项目不同：</p>
<p>cli2：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack 项目名称</span><br></pre></td></tr></table></figure>



<p>cli3：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名称</span><br></pre></td></tr></table></figure>

<p>构建项目的配置选项也不同</p>
<p>构建好的项目的目录结构也不同</p>
<p>同时cli3还支持可视化管理项目。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/front-end/vue/vue-cli/vue-cli/" data-id="clsblyufd002zw0k609lz8ixm" data-title="vue三大重点之vue-cli" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue-cli/" rel="tag">vue-cli</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-front-end/vue/vue-element-admin/vue-element-admin整合SpringBoot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/front-end/vue/vue-element-admin/vue-element-admin%E6%95%B4%E5%90%88SpringBoot/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/front-end/vue/vue-element-admin/vue-element-admin%E6%95%B4%E5%90%88SpringBoot/">vue-element-admin整合springboot学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是vue-element-admin？"><a href="#1、什么是vue-element-admin？" class="headerlink" title="1、什么是vue-element-admin？"></a>1、什么是vue-element-admin？</h2><p><a target="_blank" rel="noopener" href="http://panjiachen.github.io/vue-element-admin">vue-element-admin</a> 是一个后台前端解决方案，它基于 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue">vue</a> 和 <a target="_blank" rel="noopener" href="https://github.com/ElemeFE/element">element-ui</a>实现。它使用了最新的前端技术栈，内置了 i18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件，它可以帮助你快速搭建企业级中后台产品原型。相信不管你的需求是什么，本项目都能帮助到你。（摘自官网）</p>
<h2 id="2、为什么要用vue-element-admin？"><a href="#2、为什么要用vue-element-admin？" class="headerlink" title="2、为什么要用vue-element-admin？"></a>2、为什么要用vue-element-admin？</h2><p>对于像我这种熟悉Java的后端程序员来说，很多时候可能也会需要用到很多前端方面的东西，但是有的时候一些前端的布局又不熟悉，然后一些css样式也不会写。那么vue-element-admin就能很好的帮助到我们这些主后端副前端的后端程序员，减少了很多样式和布局，因为vue-element-admin都已经帮你布局并且样式都已经成套帮你写好了。</p>
<h2 id="3、用vue-element-admin前我需要会什么？"><a href="#3、用vue-element-admin前我需要会什么？" class="headerlink" title="3、用vue-element-admin前我需要会什么？"></a>3、用vue-element-admin前我需要会什么？</h2><p>Vue.js、Vue Router、Vuex、VueCLI、axios以及element-UI</p>
<h2 id="4、相关官方文档"><a href="#4、相关官方文档" class="headerlink" title="4、相关官方文档"></a>4、相关官方文档</h2><p>vue-element-admin：<a target="_blank" rel="noopener" href="https://panjiachen.github.io/vue-element-admin-site/">https://panjiachen.github.io/vue-element-admin-site/</a></p>
<p>vue-element-admin（中文站点）：<a target="_blank" rel="noopener" href="https://panjiachen.gitee.io/vue-element-admin-site/">https://panjiachen.gitee.io/vue-element-admin-site/</a></p>
<p>element-UI：<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN">https://element.eleme.cn/#/zh-CN</a></p>
<p>你可能会需要用到element-UI的相关小组件，所以你需要随时参阅element-UI的相关文档。</p>
<h2 id="5、初始化项目"><a href="#5、初始化项目" class="headerlink" title="5、初始化项目"></a>5、初始化项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">克隆项目</span></span><br><span class="line">git clone https://github.com/PanJiaChen/vue-element-admin.git</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入项目目录</span></span><br><span class="line">cd vue-element-admin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖</span></span><br><span class="line">npm install</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">建议不要用 cnpm 安装 会有各种诡异的bug 可以通过如下操作解决 npm 下载速度慢的问题</span></span><br><span class="line">npm install --registry=https://registry.npm.taobao.org</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地开发 启动项目</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>这个时候在浏览器输入<a target="_blank" rel="noopener" href="http://localhost:9527/">http://localhost:9527</a> 就可以第一次看到这个项目大概的样子了。</p>
<h2 id="6、创建springboot项目"><a href="#6、创建springboot项目" class="headerlink" title="6、创建springboot项目"></a>6、创建springboot项目</h2><p>由于vue-element-admin仅仅是作为前端项目，项目中使用了mock作为模拟数据，所以我们还需要自己创建后端项目来提供数据。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建springboot项目，目前只需要这个springboot-web依赖。</p>
<p>此时的目录结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|-- admin-server		#springboot后端项目</span><br><span class="line">|-- admin-ui		    #vue-element-admin前端项目</span><br></pre></td></tr></table></figure>

<p>接下来就正式开始研究vue-element-admin项目</p>
<h2 id="7、项目目录结构"><a href="#7、项目目录结构" class="headerlink" title="7、项目目录结构"></a>7、项目目录结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">├── build                      <span class="comment"># 构建相关</span></span><br><span class="line">├── mock                       <span class="comment"># 项目mock 模拟数据</span></span><br><span class="line">├── plop-templates             <span class="comment"># 基本模板</span></span><br><span class="line">├── public                     <span class="comment"># 静态资源</span></span><br><span class="line">│   │── favicon.ico            <span class="comment"># favicon图标</span></span><br><span class="line">│   └── index.html             <span class="comment"># html模板</span></span><br><span class="line">├── src                        <span class="comment"># 源代码</span></span><br><span class="line">│   ├── api                    <span class="comment"># 所有请求</span></span><br><span class="line">│   ├── assets                 <span class="comment"># 主题 字体等静态资源</span></span><br><span class="line">│   ├── components             <span class="comment"># 全局公用组件</span></span><br><span class="line">│   ├── directive              <span class="comment"># 全局指令</span></span><br><span class="line">│   ├── filters                <span class="comment"># 全局 filter</span></span><br><span class="line">│   ├── icons                  <span class="comment"># 项目所有 svg icons</span></span><br><span class="line">│   ├── lang                   <span class="comment"># 国际化 language</span></span><br><span class="line">│   ├── layout                 <span class="comment"># 全局 layout</span></span><br><span class="line">│   ├── router                 <span class="comment"># 路由</span></span><br><span class="line">│   ├── store                  <span class="comment"># 全局 store管理</span></span><br><span class="line">│   ├── styles                 <span class="comment"># 全局样式</span></span><br><span class="line">│   ├── utils                  <span class="comment"># 全局公用方法</span></span><br><span class="line">│   ├── vendor                 <span class="comment"># 公用vendor</span></span><br><span class="line">│   ├── views                  <span class="comment"># views 所有页面</span></span><br><span class="line">│   ├── App.vue                <span class="comment"># 入口页面</span></span><br><span class="line">│   ├── main.js                <span class="comment"># 入口文件 加载组件 初始化等</span></span><br><span class="line">│   └── permission.js          <span class="comment"># 权限管理</span></span><br><span class="line">├── tests                      <span class="comment"># 测试</span></span><br><span class="line">├── .env.xxx                   <span class="comment"># 环境变量配置</span></span><br><span class="line">├── .eslintrc.js               <span class="comment"># eslint 配置项</span></span><br><span class="line">├── .babelrc                   <span class="comment"># babel-loader 配置</span></span><br><span class="line">├── .travis.yml                <span class="comment"># 自动化CI配置</span></span><br><span class="line">├── vue.config.js              <span class="comment"># vue-cli 配置</span></span><br><span class="line">├── postcss.config.js          <span class="comment"># postcss 配置</span></span><br><span class="line">└── package.json               <span class="comment"># package.json</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/front-end/vue/vue-element-admin/vue-element-admin%E6%95%B4%E5%90%88SpringBoot/" data-id="clsblyufe0031w0k65doeh6ws" data-title="vue-element-admin整合springboot学习笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue-element-admin/" rel="tag">vue-element-admin</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/4/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArrayList/" rel="tag">ArrayList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC-web/" rel="tag">GRPC-web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaSE/" rel="tag">JavaSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LinkedList/" rel="tag">LinkedList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth2-0/" rel="tag">OAuth2.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OIDC/" rel="tag">OIDC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/" rel="tag">SSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringAOP/" rel="tag">SpringAOP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/String/" rel="tag">String</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/caddy/" rel="tag">caddy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cobra/" rel="tag">cobra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dig/" rel="tag">dig</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dockerfile/" rel="tag">dockerfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/" rel="tag">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6/" rel="tag">es6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flag/" rel="tag">flag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flags/" rel="tag">flags</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gin/" rel="tag">gin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/godotenv/" rel="tag">godotenv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gorm/" rel="tag">gorm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jedis/" rel="tag">jedis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernates/" rel="tag">kubernates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/logrus/" rel="tag">logrus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/promise/" rel="tag">promise</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protobuf/" rel="tag">protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stream/" rel="tag">stream</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-cli/" rel="tag">vue-cli</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-element-admin/" rel="tag">vue-element-admin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue-router/" rel="tag">vue-router</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag">集合</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ArrayList/" style="font-size: 10px;">ArrayList</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/GRPC/" style="font-size: 12.86px;">GRPC</a> <a href="/tags/GRPC-web/" style="font-size: 10px;">GRPC-web</a> <a href="/tags/Golang/" style="font-size: 18.57px;">Golang</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaSE/" style="font-size: 12.86px;">JavaSE</a> <a href="/tags/LinkedList/" style="font-size: 10px;">LinkedList</a> <a href="/tags/Mybatis/" style="font-size: 11.43px;">Mybatis</a> <a href="/tags/OAuth2-0/" style="font-size: 10px;">OAuth2.0</a> <a href="/tags/OIDC/" style="font-size: 12.86px;">OIDC</a> <a href="/tags/SSO/" style="font-size: 10px;">SSO</a> <a href="/tags/Spring/" style="font-size: 12.86px;">Spring</a> <a href="/tags/SpringAOP/" style="font-size: 10px;">SpringAOP</a> <a href="/tags/SpringBoot/" style="font-size: 14.29px;">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size: 10px;">SpringCloud</a> <a href="/tags/String/" style="font-size: 10px;">String</a> <a href="/tags/caddy/" style="font-size: 10px;">caddy</a> <a href="/tags/cobra/" style="font-size: 10px;">cobra</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/dig/" style="font-size: 10px;">dig</a> <a href="/tags/docker/" style="font-size: 11.43px;">docker</a> <a href="/tags/dockerfile/" style="font-size: 10px;">dockerfile</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/es6/" style="font-size: 10px;">es6</a> <a href="/tags/flag/" style="font-size: 10px;">flag</a> <a href="/tags/flags/" style="font-size: 10px;">flags</a> <a href="/tags/gin/" style="font-size: 10px;">gin</a> <a href="/tags/godotenv/" style="font-size: 10px;">godotenv</a> <a href="/tags/gorm/" style="font-size: 10px;">gorm</a> <a href="/tags/http/" style="font-size: 11.43px;">http</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/jedis/" style="font-size: 10px;">jedis</a> <a href="/tags/kubernates/" style="font-size: 10px;">kubernates</a> <a href="/tags/logrus/" style="font-size: 10px;">logrus</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/promise/" style="font-size: 10px;">promise</a> <a href="/tags/protobuf/" style="font-size: 10px;">protobuf</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 11.43px;">redis</a> <a href="/tags/stream/" style="font-size: 10px;">stream</a> <a href="/tags/uni-app/" style="font-size: 10px;">uni-app</a> <a href="/tags/vue/" style="font-size: 17.14px;">vue</a> <a href="/tags/vue-cli/" style="font-size: 10px;">vue-cli</a> <a href="/tags/vue-element-admin/" style="font-size: 10px;">vue-element-admin</a> <a href="/tags/vue-router/" style="font-size: 10px;">vue-router</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 11.43px;">多线程</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.43px;">数据库</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 11.43px;">网络安全</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.43px;">设计模式</a> <a href="/tags/%E9%9B%86%E5%90%88/" style="font-size: 12.86px;">集合</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/02/04/back-end/docker/dockerfile/">docker学习</a>
          </li>
        
          <li>
            <a href="/2023/07/19/data-structure/%E6%89%8B%E5%86%99ArrayList/ArrayList%E6%95%B4%E5%90%88Java/">利用Java来手写ArrayList</a>
          </li>
        
          <li>
            <a href="/2023/07/19/data-structure/%E6%89%8B%E5%86%99LinkedList/LinkedList%E6%95%B4%E5%90%88Java/">利用Java手写LinkedList</a>
          </li>
        
          <li>
            <a href="/2023/07/19/back-end/DevOps/CI_CD/">CI_CD</a>
          </li>
        
          <li>
            <a href="/2023/07/19/design-pattern/SOLID/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84S.O.L.I.D%E5%8E%9F%E5%88%99/">面向对象的S.O.L.I.D原则</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 FanGaoXS<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>