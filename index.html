<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>FanGaoXS&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="FanGaoXS&#39;s blog">
<meta property="og:url" content="https://fangaoxs.github.io/index.html">
<meta property="og:site_name" content="FanGaoXS&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="FanGaoXS">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="FanGaoXS's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">FanGaoXS&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fangaoxs.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-back-end/go/gmp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/12/back-end/go/gmp/" class="article-date">
  <time class="dt-published" datetime="2024-03-12T09:23:39.000Z" itemprop="datePublished">2024-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/12/back-end/go/gmp/">Goroutine调度器GMP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h2><p>掌握Golang调度器原理，为什么Goroutine的调度器是很快的</p>
<h2 id="GMP模型简介"><a href="#GMP模型简介" class="headerlink" title="GMP模型简介"></a>GMP模型简介</h2><p>G：goroutine 协程</p>
<p>P：Processer 处理器</p>
<p>M：Thread 内核线程</p>
<p>全局G队列：存放等待运行的G</p>
<p>P的本地队列：存放等待运行的G，优先将新创建的G放在P的本地队列中，如果满了则会放到全局队列中。</p>
<p>P列表：程序启动时创建，最多有<code>GOMAXPROCS</code>个（可配置项）</p>
<p>M列表：当前操作系统分配到当前Go程序的内核线程数</p>
<p>P数量：环境变量<code>$GOMAXPROCS</code>；在Go程序中使用<code>GOMAXPROCS()</code>来设置。</p>
<p>M数量：Go语言限定M的最大量是10000；在Go程序中使用<code>SetMaxThreads()</code>来设置；M的数量是<strong>动态</strong>的：有M阻塞，就会创建新的M，有M空闲，就会回收M或者睡眠M。</p>
<h2 id="调度器的设计策略"><a href="#调度器的设计策略" class="headerlink" title="调度器的设计策略"></a>调度器的设计策略</h2><h3 id="复用线程"><a href="#复用线程" class="headerlink" title="复用线程"></a>复用线程</h3><p>避免频繁地创建、销毁线程，而是对线程的<strong>复用</strong>。</p>
<ul>
<li><p>work stealing机制</p>
<p>当本线程无可运行的G时，尝试去其他线程绑定的P偷取G，而不是销毁本线程。</p>
</li>
<li><p>hand off（交接）机制</p>
<p>当本线程因为G进行系统调用阻塞时，线程释放绑定的P，把P转移给其他空闲的线程（或创建新线程）执行。</p>
</li>
</ul>
<h3 id="利用并行"><a href="#利用并行" class="headerlink" title="利用并行"></a>利用并行</h3><p><code>GOMAXPROCS</code>设置P的数量，最多有GOMAXPROCS个线程分布在多个CPU上同时运行。</p>
<h3 id="抢占"><a href="#抢占" class="headerlink" title="抢占"></a>抢占</h3><p>在Coroutine设计中要等待一个协程主动让出CPU才执行下一个协程。</p>
<p>在Goroutine设计中，一个goroutine最多占用CPU 10ms，防止其他Goroutine被饿死。</p>
<h3 id="全局G队列"><a href="#全局G队列" class="headerlink" title="全局G队列"></a>全局G队列</h3><p>当M执行work stealing从其他P偷不到G时，它可以从全局G队列中获取G。</p>
<h2 id="go-func-经历了什么过程"><a href="#go-func-经历了什么过程" class="headerlink" title="go func()经历了什么过程"></a><code>go func()</code>经历了什么过程</h2><p><img src="/2024/03/12/back-end/go/gmp/image-20240311164307141.png"></p>
<h2 id="调度器的生命周期"><a href="#调度器的生命周期" class="headerlink" title="调度器的生命周期"></a>调度器的生命周期</h2><h3 id="M0"><a href="#M0" class="headerlink" title="M0"></a>M0</h3><p>M0是启动程序后的编号为0的主线程，这个M对应的实例会在全局变量runtime.m0中，不需要在heap上分配，M0负责执行初始化操作合启动第一个G，在之后M0就和其他的M一样了。</p>
<h3 id="G0"><a href="#G0" class="headerlink" title="G0"></a>G0</h3><p>G0是每次启动一个M都会创建的一个Goroutine，G0<strong>仅负责调度</strong>其他G，G0不指向任何可执行的函数，每个M都有一个自己的G0。在调度或系统调用的时会使用G0的栈空间，全局变量的G0是M0的G0。</p>
<h2 id="可视化的GMP编程"><a href="#可视化的GMP编程" class="headerlink" title="可视化的GMP编程"></a>可视化的GMP编程</h2><h3 id="使用go-tool-trace工具"><a href="#使用go-tool-trace工具" class="headerlink" title="使用go tool trace工具"></a>使用go tool trace工具</h3><p>应用程序</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime/trace&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 1 创建trace信息的输出文件</span></span><br><span class="line">	f, err := os.Create(<span class="string">&quot;trace.out&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2 启动</span></span><br><span class="line">	err = trace.Start(f)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 需要调试的业务代码</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello, world!&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3 停止</span></span><br><span class="line">	trace.Stop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行应用程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; go run main.go</span><br></pre></td></tr></table></figure>



<p>查看trace</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; go tool trace trace.out</span><br></pre></td></tr></table></figure>



<h3 id="Debug-trace查看GMP信息"><a href="#Debug-trace查看GMP信息" class="headerlink" title="Debug trace查看GMP信息"></a>Debug trace查看GMP信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; GODEBUG=schedtrace=1000 ./main</span><br></pre></td></tr></table></figure>



<h2 id="场景分析"><a href="#场景分析" class="headerlink" title="场景分析"></a>场景分析</h2><h3 id="场景1：创建G"><a href="#场景1：创建G" class="headerlink" title="场景1：创建G"></a>场景1：创建G</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312153221549.png"></p>
<h3 id="场景2：G1执行完毕"><a href="#场景2：G1执行完毕" class="headerlink" title="场景2：G1执行完毕"></a>场景2：G1执行完毕</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312153759841.png"></p>
<h3 id="场景3：G2开辟过多的G"><a href="#场景3：G2开辟过多的G" class="headerlink" title="场景3：G2开辟过多的G"></a>场景3：G2开辟过多的G</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312162114670.png"></p>
<h3 id="场景4：G2本地满再创建G"><a href="#场景4：G2本地满再创建G" class="headerlink" title="场景4：G2本地满再创建G"></a>场景4：G2本地满再创建G</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312162135419.png"></p>
<h3 id="场景5：G2本地未满再创建G"><a href="#场景5：G2本地未满再创建G" class="headerlink" title="场景5：G2本地未满再创建G"></a>场景5：G2本地未满再创建G</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312162155485.png"></p>
<h3 id="场景6：唤醒正在休眠的M"><a href="#场景6：唤醒正在休眠的M" class="headerlink" title="场景6：唤醒正在休眠的M"></a>场景6：唤醒正在休眠的M</h3><p>当一个G在创建新的G的时候都会尝试去<strong>唤醒&#x2F;创建</strong>M</p>
<p><img src="/2024/03/12/back-end/go/gmp/image-20240312162904430.png"></p>
<h3 id="场景7：被唤醒的M从全局队列取批量G"><a href="#场景7：被唤醒的M从全局队列取批量G" class="headerlink" title="场景7：被唤醒的M从全局队列取批量G"></a>场景7：被唤醒的M从全局队列取批量G</h3><p>从全局队列到P本地队列的<strong>负载均衡</strong></p>
<p> <img src="/2024/03/12/back-end/go/gmp/image-20240312163750692.png"></p>
<h3 id="场景8：M2从M1中偷取G"><a href="#场景8：M2从M1中偷取G" class="headerlink" title="场景8：M2从M1中偷取G"></a>场景8：M2从M1中偷取G</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312164244697.png"></p>
<h3 id="场景9：自旋线程的最大限制"><a href="#场景9：自旋线程的最大限制" class="headerlink" title="场景9：自旋线程的最大限制"></a>场景9：自旋线程的最大限制</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312164633519.png"></p>
<h3 id="场景10：G发生系统调用-阻塞"><a href="#场景10：G发生系统调用-阻塞" class="headerlink" title="场景10：G发生系统调用&#x2F;阻塞"></a>场景10：G发生系统调用&#x2F;阻塞</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312165016390.png"></p>
<h3 id="场景11：G发生系统调用-非阻塞"><a href="#场景11：G发生系统调用-非阻塞" class="headerlink" title="场景11：G发生系统调用&#x2F;非阻塞"></a>场景11：G发生系统调用&#x2F;非阻塞</h3><p><img src="/2024/03/12/back-end/go/gmp/image-20240312170847130.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2024/03/12/back-end/go/gmp/" data-id="cltpf7eo8000g26k64rn52hs2" data-title="Goroutine调度器GMP" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/docker/dockerfile" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/31/back-end/docker/dockerfile/" class="article-date">
  <time class="dt-published" datetime="2024-01-31T09:27:39.000Z" itemprop="datePublished">2024-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/31/back-end/docker/dockerfile/">dockerfile</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="dockerfile是什么"><a href="#dockerfile是什么" class="headerlink" title="dockerfile是什么"></a>dockerfile是什么</h2><p>Dockerfile是一种用于定义和构建Docker镜像的文本文件。它包含一系列指令和配置，用于构建一个可运行的Docker容器。</p>
<p>在Dockerfile中，您可以定义从哪个基础镜像开始构建、复制文件、设置环境变量、运行命令等操作。每个指令都代表一个步骤，按顺序执行，从而构建出一个完整的Docker镜像。</p>
<h2 id="go-build"><a href="#go-build" class="headerlink" title="go build"></a>go build</h2><p><code>go build</code>是Go语言的一个命令，用于将Go源代码编译成可执行文件或库。</p>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span> as builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /source</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /source</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go build -o app .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:noble</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /source/app /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> APP_NAME=<span class="string">&quot;app&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> APP_VERSION=<span class="string">&quot;v0.0.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/app&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>示例的Dockfile包含了Docker多阶段构建，第一个用于构建Go应用程序，另一个用于最终的容器镜像。</p>
<p><strong>第一阶段：构建Go应用程序</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> golang:<span class="number">1.20</span> as builder</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /source</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /source</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> go build -o app .</span></span><br></pre></td></tr></table></figure>

<p>首先，使用<code>golang:1.20</code>作为基础镜像命名为<code>builder</code>，接着将工作目录设置为<code>/source</code>，然后将宿主机的当前目录中的所有文件复制到容器的<code>/source</code>目录下，接着执行<code>go build</code>命令，将Go源码编译为名为<code>app</code>的可执行文件。</p>
<p><strong>第二阶段：构建运行应用程序的最终容器</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:noble</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /source/app /app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> APP_NAME=<span class="string">&quot;app&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> APP_VERSION=<span class="string">&quot;v0.0.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;/app&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>首先，使用<code>ubuntu:noble</code>作为基础镜像最终的容器镜像，接着将第一阶段（<code>builder</code>阶段）的<code>/source/app</code>文件复制到容器的<code>/app</code>目录，然后运行<code>chmod +x /app</code>为<code>/app</code>添加可执行权限，然后使用<code>ENV</code>设置了一系列环境变量，最后通过<code>CMD</code>指定了容器启动时要执行的命令，即运行<code>/app</code>可执行文件。</p>
<p>示例的dockerfile使用了多阶段的构建的方式，首先在一个专门用于构建的构建容器中编译应用程序，然后再将编译好的可执行文件复制到最终的容器镜像中，这种方式可以减小最终镜像的大小，因为这种最终得到的docker镜像只会包含最终容器和可执行文件，而没有编译该可执行文件需要的编译环境。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>使用dockerfile来构建此类应用程序简单的思路大致就是使用两个构建阶段，第一个阶段的目的就是编译该应用程序，第二阶段就是将该应用程序复制到最终容器中。</p>
<p>其中第一阶段的步骤大致是，选定基础镜像，指定工作目录，将宿主机的源代码复制到容器的工作目录中，然后执行编译得到可执行文件。</p>
<p>第二阶段的步骤大致是，选定最终容器的镜像，然后将第一阶段编译出的可执行文件复制到现容器中，设置环境变量，定义运行命令。</p>
<p>示例这里是Go的应用程序，Java的应用程序同理：第一阶段选定Java的构建环境，如<code>From:java</code>，然后将Java源码构建为jar包，接着在第二阶段指定jar文件运行需要的环境，最后执行jar应用程序。</p>
<h2 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h2><table>
<thead>
<tr>
<th>Dockfile指令</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>FROM</td>
<td>指定基础镜像，作为后续指令的基础</td>
</tr>
<tr>
<td>WORKDIR</td>
<td>设置后续指令的工作目录</td>
</tr>
<tr>
<td>RUN</td>
<td>在构建过程中执行的命令</td>
</tr>
<tr>
<td>COPY</td>
<td>将宿主机文件或目录复制到镜像中</td>
</tr>
<tr>
<td>ENV</td>
<td>设置容器内部的环境变量</td>
</tr>
<tr>
<td>CMD</td>
<td>指定容器运行时的默认命令（可以被覆盖）</td>
</tr>
<tr>
<td>ENTRYPOINT</td>
<td>指定容器运行时的主要命令（不可以被覆盖，必须执行）</td>
</tr>
</tbody></table>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p>编写好Dockerfile后，使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t &lt;image_name&gt; .</span><br><span class="line"></span><br><span class="line"><span class="comment">## -t 指定创建的目标镜像名</span></span><br></pre></td></tr></table></figure>

<p>build镜像。</p>
<h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><p>可以使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run &lt;image_name&gt;</span><br></pre></td></tr></table></figure>

<p>以容器的方式运行镜像</p>
<p>或者使用<strong>docker-compose</strong>来运行镜像。</p>
<p>始终牢记，docker的镜像无论如何都是运行在容器当中的，所以可以执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it &lt;image_name&gt; bash</span><br></pre></td></tr></table></figure>

<p>以容器的方式运行镜像，上述方法能够在编写Dockerfile的时候方便以容器的方式运行镜像并且观察镜像的环境，从而检查Dockerfile编写是否存在问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2024/01/31/back-end/docker/dockerfile/" data-id="cltpf7eo2000a26k6eoyn9oc2" data-title="dockerfile" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-network/caddy/http反向代理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/07/network/caddy/http%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2023-11-07T07:30:39.000Z" itemprop="datePublished">2023-11-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/07/network/caddy/http%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">利用Caddy实现http反向代理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-Caddy是什么"><a href="#1-Caddy是什么" class="headerlink" title="1 Caddy是什么"></a>1 Caddy是什么</h2><p>Caddy是一个开源的，使用Golang编写的，支持HTTP&#x2F;2的Web服务端。它的一个显著特征就是默认启用HTTPS。</p>
<p>和nginx类似。</p>
<h2 id="2-多个后端服务"><a href="#2-多个后端服务" class="headerlink" title="2 多个后端服务"></a>2 多个后端服务</h2><p>假如现在有3个后端http服务：分别在启动在</p>
<p>app1</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.1:8080</span><br><span class="line"></span><br><span class="line">GET /</span><br><span class="line">GET /ping</span><br></pre></td></tr></table></figure>

<p>app2</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.2:8080</span><br><span class="line"></span><br><span class="line">GET /</span><br><span class="line">GET /ping</span><br></pre></td></tr></table></figure>

<p>app3</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://10.0.0.3:8080</span><br><span class="line"></span><br><span class="line">GET /</span><br><span class="line">GET /ping</span><br></pre></td></tr></table></figure>

<h2 id="3-Caddyfile"><a href="#3-Caddyfile" class="headerlink" title="3 Caddyfile"></a>3 Caddyfile</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">localhost &#123;</span><br><span class="line">    # localhost/app1/ping -&gt; http://10.0.0.1:8080/ping</span><br><span class="line">    route /app1/* &#123;</span><br><span class="line">        uri strip_prefix /app1</span><br><span class="line">        reverse_proxy http://10.0.0.1:8080</span><br><span class="line">    &#125;</span><br><span class="line">    route /app2/* &#123;</span><br><span class="line">        uri strip_prefix /app2</span><br><span class="line">        reverse_proxy http://10.0.0.2:8080</span><br><span class="line">    &#125;</span><br><span class="line">    route /app3/* &#123;</span><br><span class="line">        uri strip_prefix /app3</span><br><span class="line">        reverse_proxy http://10.0.0.3:8080</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips</p>
<p><code>uri strip_prefix /app1</code>的作用是将url中的<code>/app1</code>给去掉然后转发到<code>reverse_proxy</code>上去。</p>
</blockquote>
<p>启动caddy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; caddy run</span><br></pre></td></tr></table></figure>



<p>此时使用curl或者浏览器访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt; curl -v http://localhost/app1/ping</span><br><span class="line">$&gt; curl -v http://localhost/app2/ping</span><br><span class="line">$&gt; curl -v http://localhost/app3/ping</span><br></pre></td></tr></table></figure>

<p>则caddy会分别反向代理到app1、app2、app3上。</p>
<h2 id="4-启用HTTPS"><a href="#4-启用HTTPS" class="headerlink" title="4 启用HTTPS"></a>4 启用HTTPS</h2><h3 id="自签证书"><a href="#自签证书" class="headerlink" title="自签证书"></a>自签证书</h3><p>本地测试的时候需要安装本地信任机构CA并且自签证书，需要借助<code>mkcert</code>工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; brew install mkcert</span><br></pre></td></tr></table></figure>

<p>安装CA到本机</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; mkcert -install</span><br></pre></td></tr></table></figure>

<p>为主机自签证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; mkcert example.org</span><br></pre></td></tr></table></figure>

<p>会在当前目录生成<code>example.org.pem</code>和<code>example.org-key.pem</code>这两个文件</p>
<h3 id="配置Hosts"><a href="#配置Hosts" class="headerlink" title="配置Hosts"></a>配置Hosts</h3><p>在hosts文件里添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 		example.org</span><br></pre></td></tr></table></figure>

<p>此时访问<code>example.org</code>就会访问到本机的<code>127.0.0.1</code></p>
<h3 id="在Caddyfile中添加tls"><a href="#在Caddyfile中添加tls" class="headerlink" title="在Caddyfile中添加tls"></a>在Caddyfile中添加tls</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">example.org &#123;</span><br><span class="line">		tls /Users/example.org.pem  /Users/example.org-key.pem</span><br><span class="line">    # example.org/app1/ping -&gt; http://10.0.0.1:8080/ping</span><br><span class="line">    route /app1/* &#123;</span><br><span class="line">        uri strip_prefix /app1</span><br><span class="line">        reverse_proxy http://10.0.0.1:8080</span><br><span class="line">    &#125;</span><br><span class="line">    route /app2/* &#123;</span><br><span class="line">        uri strip_prefix /app2</span><br><span class="line">        reverse_proxy http://10.0.0.2:8080</span><br><span class="line">    &#125;</span><br><span class="line">    route /app3/* &#123;</span><br><span class="line">        uri strip_prefix /app3</span><br><span class="line">        reverse_proxy http://10.0.0.3:8080</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是tls配置的 <code>xx.pem</code>和<code>xx-key.pem</code>文件是绝对路径。</p>
<h3 id="重启caddy"><a href="#重启caddy" class="headerlink" title="重启caddy"></a>重启caddy</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/11/07/network/caddy/http%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" data-id="cltpf7eos001c26k62xqa8fj1" data-title="利用Caddy实现http反向代理" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/" rel="tag">http</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-network/OIDC/结合OIDC和Cookie实现SSO" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/" class="article-date">
  <time class="dt-published" datetime="2023-07-25T07:30:39.000Z" itemprop="datePublished">2023-07-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/">结合OIDC和Cookie实现SSO</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-什么是SSO"><a href="#1-什么是SSO" class="headerlink" title="1 什么是SSO"></a>1 什么是SSO</h2><p>SSO（Single Sign On，即单点登录），允许用户在多个网站或者应用程序之间使用一组凭据（例如用户名和密码）进行身份验证。用户只需要在登录一个网站或者应用程序后，就可以访问其他网站或者应用程序，而无需再输入凭据。</p>
<blockquote>
<p>Tips</p>
<p>重点是在<strong>多个</strong>网站之间使用<strong>一组</strong>凭据，并且用户只需要登录<strong>一个</strong>网站或应用程序，其他网站或者应用程序就<strong>无需</strong>再输入凭据了。</p>
</blockquote>
<p>目前实现SSO的协议或标准很多，如SAML、OAuth、LADP和OIDC等，都能实现SSO。</p>
<h2 id="2-什么是OIDC"><a href="#2-什么是OIDC" class="headerlink" title="2 什么是OIDC"></a>2 什么是OIDC</h2><p>OIDC是一个协议，简单来讲就是OIDC规定有一个中心的Provider能够认证用户的凭据并且授权，即会返回AccessToken和IDToken等给受信任的Client，因为IDToken是JWT格式且包含登录用户的唯一标识，所以Client能够轻松地解析IDToken获取用户信息甚至存储到自身的数据库中。</p>
<p>这里选用OIDC的原因是Client能够很好地<strong>解析IDToken获取用户信息</strong>。</p>
<p>这里的OIDC Provider的实现是golang的dex库：<a target="_blank" rel="noopener" href="https://dexidp.io/docs/getting-started/">https://dexidp.io/docs/getting-started/</a></p>
<h2 id="3-什么是Cookie"><a href="#3-什么是Cookie" class="headerlink" title="3 什么是Cookie"></a>3 什么是Cookie</h2><p>Cookie是一种在Web服务器和Web浏览器之间传递的小型文本。当访问Web应用程序或者浏览器时，Web服务器可能通过设置Cookie将一些信息存储到用户的浏览器上。接着Web浏览器在发送HTTP请求时，会将该网站相关的Cookie一并发送给Web服务器，Web服务器可以非常轻松的读取这些Cookie。</p>
<p>Cookie通常由一个名称（Name）、一个值（Value）、一个过期时间（Expires）和一个域名（Domain）组成。名称和值指定了Cookie中存储的信息，过期时间指定了Cookie的有效期，域名指定了允许访问该Cookie的域名。</p>
<p>这里选用Cookie的原因是利用了Cookie的域的特性：如果Cookie的域是<code>.example.com</code>，那么<code>a.example.com</code>和<code>b.example.com</code>都能够访问到这个域。</p>
<p>所以我如果在A网站的服务器中设置Cookie的域为<code>.example.com</code>，那么在B网站中可以使用到该Cookie，反之亦然。</p>
<blockquote>
<p>Tips</p>
<p>如果想要<strong>结合OIDC和Cookie实现SSO</strong>，那么网站的域名应该拥有相同的父域名。</p>
</blockquote>
<h2 id="4-需求"><a href="#4-需求" class="headerlink" title="4 需求"></a>4 需求</h2><p>现在学校有一个课程系统（lessons）和书籍系统（books），要求就是用户在要求登录一次后，访问另一系统就不需要再登录了。</p>
<h2 id="5-实现"><a href="#5-实现" class="headerlink" title="5 实现"></a>5 实现</h2><p>使用OIDC Provider进行用户认证和授权，返回AccessToken和IDToken给Client，并且Client要求浏览器使用Cookie保存AccessToken和IDToken，并且域设置为课程系统和书籍系统都能访问到的域。在访问课程系统和书籍系统对应的服务器的时候读取存放在Cookie中的token并且访问后端。</p>
<p>要点：</p>
<ul>
<li>Client从OIDC Provider处获得token，获取到token保存到Cookie中</li>
<li>Client在接受来自浏览器的请求时读取Cookie获得token，验证token并获取用户个人信息。</li>
</ul>
<h2 id="6-Books-Client"><a href="#6-Books-Client" class="headerlink" title="6 Books Client"></a>6 Books Client</h2><h3 id="获得token并写入Cookie"><a href="#获得token并写入Cookie" class="headerlink" title="获得token并写入Cookie"></a>获得token并写入Cookie</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	OidcProvider = <span class="string">&quot;http://sso.college.edu:5556/dex&quot;</span></span><br><span class="line">	ClientId     = <span class="string">&quot;books-college&quot;</span></span><br><span class="line">	ClientSecret = <span class="string">&quot;books-college-secret&quot;</span></span><br><span class="line">	RedirectURL  = <span class="string">&quot;http://books.college.edu:8000/callback&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">()</span></span> http.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		ctx := r.Context()</span><br><span class="line"></span><br><span class="line">		provider, err := oidc.NewProvider(ctx, OidcProvider)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(w, fmt.Sprintf(<span class="string">&quot;init oidc provider failed: %s&quot;</span>, err), http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		oauth2Config := Oauth2Config(provider)</span><br><span class="line">		url := oauth2Config.AuthCodeURL(<span class="string">&quot;state&quot;</span>)</span><br><span class="line">		http.Redirect(w, r, url, http.StatusFound)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LoginCallback</span><span class="params">()</span></span> http.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		ctx := r.Context()</span><br><span class="line"></span><br><span class="line">		provider, err := oidc.NewProvider(ctx, OidcProvider)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(w, fmt.Sprintf(<span class="string">&quot;init oidc provider failed: %s&quot;</span>, err), http.StatusInternalServerError)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		config := Oauth2Config(provider)</span><br><span class="line">		oauth2Token, err := config.Exchange(ctx, r.URL.Query().Get(<span class="string">&quot;code&quot;</span>))</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(w, fmt.Sprintf(<span class="string">&quot;exchange token with server failed: %s&quot;</span>, err), http.StatusUnauthorized)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		rawIDToken, ok := oauth2Token.Extra(<span class="string">&quot;id_token&quot;</span>).(<span class="type">string</span>)</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			http.Error(w, fmt.Sprintf(<span class="string">&quot;get rawIDToken with token failed&quot;</span>), http.StatusUnauthorized)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		idTokenVerifier := provider.Verifier(&amp;oidc.Config&#123;ClientID: ClientId&#125;)</span><br><span class="line">		idToken, err := idTokenVerifier.Verify(ctx, rawIDToken)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Error(w, fmt.Sprintf(<span class="string">&quot;verify IDToken with oidc provider failed: %s&quot;</span>, err), http.StatusUnauthorized)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		setTokenIntoCookie(w, oauth2Token)</span><br><span class="line">		bytes, _ := json.Marshal(idToken)</span><br><span class="line">		w.Write(bytes)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="将token写入Cookie中并设置合适的域"><a href="#将token写入Cookie中并设置合适的域" class="headerlink" title="将token写入Cookie中并设置合适的域"></a>将token写入Cookie中并设置合适的域</h3><p>这样<code>books.college.edu</code>和<code>lessons.college.edu</code>都能访问到该Cookie</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	CookieDomain = <span class="string">&quot;.college.edu&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setTokenIntoCookie</span><span class="params">(w http.ResponseWriter, oauth2Token *oauth2.Token)</span></span> &#123;</span><br><span class="line">	rawIDToken, _ := oauth2Token.Extra(<span class="string">&quot;id_token&quot;</span>).(<span class="type">string</span>)</span><br><span class="line">	cookies := []*http.Cookie&#123;</span><br><span class="line">		&#123;Name: <span class="string">&quot;access_token&quot;</span>, Value: oauth2Token.AccessToken&#125;,</span><br><span class="line">		&#123;Name: <span class="string">&quot;token_type&quot;</span>, Value: oauth2Token.TokenType&#125;,</span><br><span class="line">		&#123;Name: <span class="string">&quot;refresh_token&quot;</span>, Value: oauth2Token.RefreshToken&#125;,</span><br><span class="line">		&#123;Name: <span class="string">&quot;expiry&quot;</span>, Value: oauth2Token.Expiry.Format(time.RFC3339)&#125;,</span><br><span class="line">		&#123;Name: <span class="string">&quot;id_token&quot;</span>, Value: rawIDToken&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, c := <span class="keyword">range</span> cookies &#123;</span><br><span class="line">		c.Domain = CookieDomain</span><br><span class="line">		c.Path = <span class="string">&quot;/&quot;</span></span><br><span class="line">		c.MaxAge = <span class="number">60</span> * <span class="number">5</span> <span class="comment">// 5 minutes</span></span><br><span class="line">		c.HttpOnly = <span class="literal">true</span></span><br><span class="line">		http.SetCookie(w, c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="访问接口时，读取来自Cookie中的token"><a href="#访问接口时，读取来自Cookie中的token" class="headerlink" title="访问接口时，读取来自Cookie中的token"></a>访问接口时，读取来自Cookie中的token</h3><p>如果读取token失败（Cookie中不存在token，token过期等）则要求用户<strong>重新登录</strong>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">MyBook</span><span class="params">()</span></span> http.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		ctx := r.Context()</span><br><span class="line"></span><br><span class="line">		ui, err := auth.GetUserInfo(ctx, r)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			http.Redirect(w, r, <span class="string">&quot;/login&quot;</span>, http.StatusFound)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		msg := fmt.Sprintf(<span class="string">&quot;These are your books, %s!&quot;</span>, ui.Name)</span><br><span class="line">		w.Write([]<span class="type">byte</span>(msg))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="验证token是否合法，并解析token获得用户的个人信息"><a href="#验证token是否合法，并解析token获得用户的个人信息" class="headerlink" title="验证token是否合法，并解析token获得用户的个人信息"></a>验证token是否合法，并解析token获得用户的个人信息</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetUserInfo</span><span class="params">(ctx context.Context, r *http.Request)</span></span> (*userinfo.UserInfo, <span class="type">error</span>) &#123;</span><br><span class="line">	token, err := getTokenFromCookie(r)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;get userinfo failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	provider, err := oidc.NewProvider(ctx, OidcProvider)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;initialize provider failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	idTokenVerifier := provider.Verifier(&amp;oidc.Config&#123;SkipClientIDCheck: <span class="literal">true</span>&#125;)</span><br><span class="line">	idToken, err := idTokenVerifier.Verify(ctx, token)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;verify rawIDToken failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> ui *userinfo.UserInfo</span><br><span class="line">	<span class="keyword">if</span> err = idToken.Claims(&amp;ui); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;parse idToken failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ui, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getTokenFromCookie</span><span class="params">(r *http.Request)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	rawExpiry, err := r.Cookie(<span class="string">&quot;expiry&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;get token from cookie failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	expiry, err := time.Parse(time.RFC3339, rawExpiry.Value)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;parse expiry which is from cookie failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> expiry.Before(time.Now()) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;token is expired&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	rawIDToken, err := r.Cookie(<span class="string">&quot;id_token&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;get token from cookie failed: %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> rawIDToken.Value, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="7-Lessons-Client"><a href="#7-Lessons-Client" class="headerlink" title="7 Lessons Client"></a>7 Lessons Client</h2><p>课程系统和书籍系统同理。</p>
<h2 id="8-演示测试"><a href="#8-演示测试" class="headerlink" title="8 演示测试"></a>8 演示测试</h2><ol>
<li><p>配置host模拟真实环境</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## sso-demo</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	books.college.edu</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	lessons.college.edu</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	sso.college.edu</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置dex的config-dev.yaml，将books和lessons加入staticClients</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">staticClients:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">books-college</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">books-college-secret</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#x27;Books College&#x27;</span></span><br><span class="line">  <span class="attr">redirectURIs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;http://books.college.edu:8000/callback&#x27;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">lessons-college</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">lessons-college-secret</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#x27;Lessons College&#x27;</span></span><br><span class="line">  <span class="attr">redirectURIs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;http://lessons.college.edu:8001/callback&#x27;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>首次访问books：<code>http://books.college.edu:8000/</code>，要求登录</p>
<p><img src="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/image-20230725190722810.png"></p>
</li>
<li><p>登录完成</p>
<p><img src="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/image-20230725190738410.png"></p>
</li>
<li><p>访问lessons：<code>http://lessons.college.edu:8001/</code>，成功访问并且不需要登录</p>
<p><img src="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/image-20230725190755971.png"></p>
</li>
<li><p>再次访问books</p>
<p><img src="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/image-20230725190812858.png"></p>
</li>
</ol>
<p><strong>至此，实现了只需要在某一系统中登录过一次，在另外的系统就不需要再次登录直接就能进行访问了。</strong></p>
<h2 id="缺陷"><a href="#缺陷" class="headerlink" title="缺陷"></a>缺陷</h2><ul>
<li><p>依赖Cookie</p>
<p>显而易见，该实现依赖于Cookie中存储token，并且在访问Web服务器的时候携带Cookie。在无法使用Cookie或浏览器禁用Cookie的时候就需要使用其他的方法了，如URL参数或者Web Storage等。</p>
</li>
<li><p>父域名必须相同</p>
<p>由于浏览器限制，只有父域名相同才能使用同一以<code>.</code>开头的域的Cookie。</p>
</li>
<li><p>没有记录登录状态</p>
<p>以上代码没有在OIDC Provider处记录用户的登录状态，即如果用户在某一系统中退出了账号，但是只要其他任何地方的浏览器Cookie中存有该token，仍然可以使用token进行访问，所以用户其实并没有完全退出，只是在某一个浏览器中退出了而已。解决办法是在OIDC Provider中添加对用户的登录状态管理即可。</p>
</li>
</ul>
<h2 id="演示代码"><a href="#演示代码" class="headerlink" title="演示代码"></a>演示代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/FanGaoXS/sso-demo">https://github.com/FanGaoXS/sso-demo</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/" data-id="cltpf7eor001b26k6h9jhcl60" data-title="结合OIDC和Cookie实现SSO" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OIDC/" rel="tag">OIDC</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/Java/Java容器/集合" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/" class="article-date">
  <time class="dt-published" datetime="2023-07-24T07:30:39.000Z" itemprop="datePublished">2023-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/">Java集合</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="集合概述"><a href="#集合概述" class="headerlink" title="集合概述"></a>集合概述</h2><h3 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h3><p>一个一个存</p>
<ul>
<li><p>List</p>
<p><strong>有序</strong>集合，并且<strong>允许放重复</strong>的数据（按存入顺序排列）</p>
</li>
<li><p>Set</p>
<p><strong>无序</strong>集合，<strong>不允许放重复</strong>的数据（没有顺序，打乱的）</p>
</li>
</ul>
<h4 id="主要继承结构图："><a href="#主要继承结构图：" class="headerlink" title="主要继承结构图："></a>主要继承结构图：</h4><p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200715113654272.png"></p>
<ol>
<li><p><code>Iterable</code>接口：<strong>可迭代的</strong></p>
<p>里面有<code>iterator()</code>方法，返回一个<code>Iterator</code>迭代器</p>
</li>
<li><p><code>Iterator</code>接口：<strong>迭代器</strong></p>
<p>里面有<code>hasNext()</code>、<code>next()</code>、<code>remove()</code>等方法。</p>
<p><code>hasNext()</code>：判断集合中是否有下一个元素，有的话就返回true，否则返回false</p>
<p><code>next()</code>：返回集合中的下一个元素</p>
<p><code>remove()</code>：删除集合中最后一个元素</p>
</li>
<li><p><code>Collection</code>接口继承自<code>Iterable</code>接口：<strong>集合</strong></p>
<p>所有的集合都要实现<code>Iterable</code>接口需要实现它里面的<code>iterator()</code>方法然后得到迭代器，所以所有的集合都是可迭代的。</p>
</li>
<li><p><code>List</code>和<code>Set</code>接口也都继承自<code>Collection</code>接口</p>
<p>LIst：<strong>有序可以重复</strong></p>
<p>Set：<strong>无序不可重复</strong></p>
</li>
<li><p><code>ArrayList</code>实现了<code>List</code>接口</p>
<p>ArrayList顾名思义底层采用的是数组来存储元素的，所以ArrayList集合适合查询，不适合频繁增删元素。因为数组存的都是一组相同数据类型的集合，在内存里是连续存储的，只是通过数组名的地址来指引，数组中的元素是连续内存地址排列的，如果按下标增加或者删除的话数组的地址就会发生偏移，但是查询就不会，查询因为内存地址连续，所以查询的效率就会提高。</p>
</li>
<li><p><code>LinkedList</code>实现了<code>List</code>接口</p>
<p>底层采用<strong>双向链表</strong>存储数据。适合增删元素，不适合查询。</p>
</li>
<li><p><code>Vector</code>实现了<code>List</code>接口</p>
<p>底层和ArrayList集合相同，但是Vector在多线程是安全的，效率较低，现在很少使用。</p>
</li>
<li><p><code>HashSet</code>实现了<code>Set</code>接口</p>
<p>底层是哈希表（又叫散列表）</p>
</li>
<li><p><code>SortedSet</code>继承了<code>set</code>接口</p>
<p>存进去的数据是无序且不可重复的，但是存储进去之后会自动按照元素大小排序</p>
</li>
<li><p><code>TreeSet</code>实现了<code>SortedSet</code>接口</p>
</li>
</ol>
<h4 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h4><ol>
<li><code>Collection</code>接口继承<code>Iterable</code>（可迭代的）接口，实现里面的<code>iterator()</code>方法，这个方法的返回<code>Itertor</code>接口，利用返回的<code>Iterator</code>接口里的<code>hasnext()</code>判断是否有下一个元素，<code>next()</code>返回下一个元素，<code>remove()</code>删除其中的元素。</li>
<li>其中<code>List</code>和<code>Set</code>都继承<code>Collection</code>接口，都能够实现上述方法。</li>
<li><code>ArrayList</code>、<code>LinkedList</code>、<code>Vector</code>实现了<code>List</code>接口</li>
<li><code>HashSet</code>实现了<code>Set</code>接口，<code>SortedSet</code>继承了<code>Set</code>接口，而<code>TreeSet</code>实现了<code>SortedSet</code>接口</li>
</ol>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>一对一对存</p>
<ul>
<li><p>Map</p>
<p><strong>无序</strong>集合，集合中是用键值对（Key—Value）来存储的，<strong>键是无序不可重复的</strong>，在Map里起决定性作用的是键key，值只是key存的值而已。</p>
</li>
</ul>
<h4 id="主要继承结构图：-1"><a href="#主要继承结构图：-1" class="headerlink" title="主要继承结构图："></a>主要继承结构图：</h4><p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200715191015470.png"></p>
<ol>
<li><p><code>Map</code>是顶层接口</p>
<p>Map里的数据都是key—value键值对来存储的</p>
</li>
<li><p><code>HashMap</code>实现了<code>Map</code>接口</p>
<p>HashMap里的key等同于set集合，<strong>无序且不可重复</strong></p>
</li>
<li><p><code>Hashtable</code>实现了<code>Map</code>接口</p>
<p>线程是安全的，但是效率很低</p>
</li>
<li><p><code>Properties</code>继承了<code>Hashtable</code>接口</p>
<p>属性类，也是以key—value的方式存的，只是键和值都是字符串</p>
</li>
<li><p><code>SortedMap</code>继承了<code>Map</code>接口</p>
<p>存入的key是无序且不可重复的，但是存储的key可以自动排序，key等同于SortedSet</p>
</li>
<li><p><code>TreeMap</code>实现了<code>SortedMap</code></p>
<p>里面的key就是一个TreeSet</p>
</li>
</ol>
<h3 id="集合实现类总结："><a href="#集合实现类总结：" class="headerlink" title="集合实现类总结："></a>集合实现类总结：</h3><ul>
<li><p>List</p>
<p>有序且可重复</p>
<p>有序：存入和取出的顺序一样，有下标</p>
<p>可重复：可以存储相同的数据</p>
<ol>
<li><p>ArrayList</p>
<p>底层是数组；适合查询元素</p>
</li>
<li><p>LinkedList</p>
<p>底层是双向链表；适合增删元素</p>
</li>
<li><p>Vector</p>
<p>底层是数组；线程安全，但是效率不高；不常用</p>
</li>
</ol>
</li>
<li><p>Set</p>
<p>无序且不可以重复</p>
<p>无序：存入和取出的顺序不一样，没有下标</p>
<p>不可重复：不可以存储相同的数据</p>
<ol>
<li><p>HashSet</p>
<p>底层是HashMap；</p>
</li>
<li><p>TreeSet</p>
<p>实现了SortedSet；底层是TreeMap；能够排序</p>
</li>
</ol>
</li>
<li><p>Map</p>
<p>key—value（键值对）；键是无序且不可重复的</p>
<p>无序：存入和取出的顺序不一样</p>
<p>不可重复：不可以存储相同的数据</p>
<ol>
<li><p>HashMap</p>
<p>底层是哈希表；</p>
</li>
<li><p>Hashtable</p>
<p>底层是哈希表；线程安全，效率不高；不常用</p>
</li>
<li><p>Properties</p>
<p>线程安全；键和值都是String类型</p>
</li>
<li><p>TreeMap</p>
<p>底层是二叉树；key能够自动排序</p>
</li>
</ol>
</li>
</ul>
<h2 id="Collection接口"><a href="#Collection接口" class="headerlink" title="Collection接口"></a>Collection接口</h2><p>Collection接口继承自Iteratable接口，它的常用方法有以下这些：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>boolean add(E e)</td>
<td>向集合末尾添加元素（object类型）</td>
</tr>
<tr>
<td>void clear()</td>
<td>移除这个集合中的所有元素（清空）</td>
</tr>
<tr>
<td>boolean contains(Object o)</td>
<td>如果集合中包含o元素，返回true</td>
</tr>
<tr>
<td>boolean isEmpty()</td>
<td>如果集合中不包含任何元素，返回true</td>
</tr>
<tr>
<td>Iterator iterator()</td>
<td>返回该集合的元素的迭代器</td>
</tr>
<tr>
<td>boolean remove(Object o)</td>
<td>从集合中移除元素o（前提o元素存在）</td>
</tr>
<tr>
<td>int size()</td>
<td>返回此集合中元素的个数</td>
</tr>
<tr>
<td>object[] toArray()</td>
<td>将该集合转换成Object数组</td>
</tr>
</tbody></table>
<p>List集合接口和Set集合接口都需要实现上述方法，需要重点掌握<code>contains()</code>、<code>remove()</code>、<code>iterator()</code>方法，需要注意的是集合中不能添加基本数据类型，而是添加的数据类型的引用。</p>
<ol>
<li><p>iterator()方法</p>
<p>Collection集合对象调用该方法返回该集合对象的迭代器（所谓迭代器就是供迭代的东西，有点像游标或者指针，是Collection集合独有的，Map集合没有），返回的迭代器对象有三个方法，分别是：是否有下一个元素<code>boolean hasNext()</code>，返回下一个元素<code>Object next()</code>，移除下一个元素<code>void remove()</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCollection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建集合对象，因为Collection是一个接口，创建对象必须要类才行</span></span><br><span class="line">        Collection c=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//向集合中添加元素</span></span><br><span class="line">        c.add(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//尝试存入重复的100</span></span><br><span class="line">        c.add(<span class="number">100</span>);</span><br><span class="line">        c.add(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">        c.add(<span class="number">3.14</span>);</span><br><span class="line">        c.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;测试&quot;</span>));</span><br><span class="line">        c.add(<span class="number">5644</span>);</span><br><span class="line">        c.add(<span class="number">56456</span>);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//调用iterator方法获得c集合对象的迭代器iterator</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> c.iterator();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//用hasNext()方法判断集合里是否有元素，有就返回true</span></span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            <span class="comment">//next()就返回这个元素</span></span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到ArrayList输出的是有序且可重复的</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200721221642443.png"></p>
<p>在需要用<code>System.out.println()</code>打印的地方里，需要重写<code>toString()</code>方法，如果不重写<code>toString()</code>方法，那么打印的时候就会调用Object类的toString()方法：输出对象的地址（所有的类都是继承自Object类），其中List和Set利用迭代器输出的时候方式有所不同，这也跟他们的特性有关，List是有序且可重复的，Set是无序且不可重复的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCollection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建集合对象，因为Collection是一个接口，创建对象必须要类才行</span></span><br><span class="line">        Collection c=<span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//向集合中添加元素</span></span><br><span class="line">        c.add(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//尝试存入重复的100</span></span><br><span class="line">        c.add(<span class="number">100</span>);</span><br><span class="line">        c.add(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">        c.add(<span class="number">3.14</span>);</span><br><span class="line">        c.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;测试&quot;</span>));</span><br><span class="line">        c.add(<span class="number">5644</span>);</span><br><span class="line">        c.add(<span class="number">56456</span>);</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//调用iterator方法获得c集合对象的迭代器iterator</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> c.iterator();</span><br><span class="line">        <span class="comment">//用hasNext()方法判断集合里是否有元素，有就返回true</span></span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            <span class="comment">//next()就返回这个元素</span></span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从输出的结果当中可以看到，HashSet里存入的顺序和取出的顺序明显不同，并且没有重复</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200721221348826.png"></p>
<p>这是较底层的遍历方式，也可以通过forEach直接遍历。</p>
<p><strong>集合结构发生改变，必须重新获取迭代器。</strong>如果在使用迭代器遍历的时候如果采用集合的remove()方法删除元素的时候这个时候集合结构发生变化了，必须再次获取迭代器，或者使用迭代器的remove()方法，因为Iterator迭代器更像是集合在那一个状态的快照，不会随着集合的状态发生改变而刷新。</p>
<p>每次集合移除元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRemove</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建集合对象c</span></span><br><span class="line">        Collection c=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向c集合中添加元素</span></span><br><span class="line">        c.add(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">        c.add(<span class="number">100</span>);</span><br><span class="line">        c.add(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得c集合的迭代器i</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">i</span> <span class="operator">=</span> c.iterator();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用迭代器i进行遍历</span></span><br><span class="line">        <span class="keyword">while</span> (i.hasNext())&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> i.next();</span><br><span class="line">            <span class="comment">//利用集合c直接移除元素，此时集合的结构发生改变</span></span><br><span class="line">            c.remove(o);</span><br><span class="line">            <span class="comment">//因为集合的结构发生改变，所以必须重新获取迭代器，否则将会出现java.util.ConcurrentModificationException异常</span></span><br><span class="line">            i = c.iterator();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取集合的长度</span></span><br><span class="line">        System.out.println(<span class="string">&quot;集合长度=&quot;</span>+c.size());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用迭代器的remove方法来移除元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRemove</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建集合对象c</span></span><br><span class="line">        Collection c=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向c集合中添加元素</span></span><br><span class="line">        c.add(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;test&quot;</span>));</span><br><span class="line">        c.add(<span class="number">100</span>);</span><br><span class="line">        c.add(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得c集合的迭代器i</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">i</span> <span class="operator">=</span> c.iterator();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用迭代器i进行遍历</span></span><br><span class="line">        <span class="keyword">while</span> (i.hasNext())&#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> i.next();</span><br><span class="line">            <span class="comment">//利用迭代器i移除元素</span></span><br><span class="line">            i.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取集合的长度</span></span><br><span class="line">        System.out.println(<span class="string">&quot;集合长度=&quot;</span>+c.size());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>contains(Object o)方法</p>
<p>判断集合中是否包含o元素，如果包含则返回true，否则返回false，需要注意的是contains方法底层是根据对象的equals方法来判断的，如果你自己创建的类没有重写equals方法的话，那么比较的时候就会调用用Object类的equals方法（比较地址，因为所有的类都继承自Object）。</p>
<p>Student类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="comment">//如果object对象为空或者不是Student类，返回false</span></span><br><span class="line">        <span class="keyword">if</span> ( o==<span class="literal">null</span> || !(o <span class="keyword">instanceof</span> Student) ) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//如果object对象就是这个对象，返回true</span></span><br><span class="line">        <span class="keyword">if</span> ( o==<span class="built_in">this</span> ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//将Object对象转换为Student类对象</span></span><br><span class="line">        Student student= (Student) o;</span><br><span class="line">        <span class="comment">//返回Objecmeit类型对象的name与该对象的name的比较结果</span></span><br><span class="line">        <span class="keyword">return</span> student.name.equals(<span class="built_in">this</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果不重写Student类里的equals方法就会返回false，重写了则返回true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestContains</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Collection c=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;测试&quot;</span>);</span><br><span class="line">        c.add(student);</span><br><span class="line">        <span class="comment">//比较</span></span><br><span class="line">        System.out.println(c.contains(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;测试&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>remove(Object o)方法</p>
<p>remove方法跟contains方法类似，remove方法也是先利用对象的equals方法判断集合中是否存在该对象，如果存在则移除，否则则不移除。同样注意需要重写类对象中的equals方法，不然比较的仍然是地址，remove()则无法匹配集合中的对象则无法移除。</p>
</li>
</ol>
<h2 id="List接口"><a href="#List接口" class="headerlink" title="List接口"></a>List接口</h2><p>List接口继承自Collection，它不仅包含Collection接口中的方法，还有以下特有的常用方法：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void add(int index, E element)（重载）</td>
<td>向列表中指定位置index（下标）插入指定元素element（新增）</td>
</tr>
<tr>
<td>E set(int index,E element)</td>
<td>用element元素替换指定位置index的元素（覆盖）</td>
</tr>
<tr>
<td>E get(int index)</td>
<td>返回该列表中指定位置的元素</td>
</tr>
<tr>
<td>int indexOf(Object o)</td>
<td>返回该列表第一次出现o元素的索引，没有返回-1</td>
</tr>
<tr>
<td>int lastIndexOf(Object o)</td>
<td>返回该列表最后一次出现o元素的索引，反正则返回-1</td>
</tr>
</tbody></table>
<p>因为List接口中多了一个get方法能够得到元素的下标，所以我们多了一种新的遍历方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestList</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建List列表对象list</span></span><br><span class="line">        List list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//往列表list中添加元素</span></span><br><span class="line">        list.add(<span class="number">100</span>);</span><br><span class="line">        list.add(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        list.add(<span class="number">4564</span>);</span><br><span class="line">        <span class="comment">//给列表list中下标为3的地方新增</span></span><br><span class="line">        list.add(<span class="number">3</span>,<span class="string">&quot;index为3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//用for循环遍历list</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            <span class="comment">//根据列表下标i来遍历</span></span><br><span class="line">            System.out.println(list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ArrayList类"><a href="#ArrayList类" class="headerlink" title="ArrayList类"></a>ArrayList类</h2><p>ArrayList是List的实现类，所以它也要实现List接口的所有方法。ArrayList的初始容量是10，它有一个重载的有参构造方法可以传递初始化ArrayList初始容量（如果容量不够，后面ArrayLIst会自动扩容），扩容机制就是扩容到原容量的1.5倍。</p>
<p>构造方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认初始化容量是10</span></span><br><span class="line">      List list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">      <span class="comment">//自定义初始化容量100</span></span><br><span class="line">      List list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>ArrayList的特点：底层是数组，元素之间都是相邻的内存地址，查询效率高，向指定下标add效率低，增删效率低。</p>
<h2 id="LinkedList类"><a href="#LinkedList类" class="headerlink" title="LinkedList类"></a>LinkedList类</h2><p>LinkedList也是List的实现类，所以它也要实现List接口的所有方法。LinkedList底层是双向链表，将双向链表之前先看看单向链表</p>
<h3 id="单向链表"><a href="#单向链表" class="headerlink" title="单向链表"></a>单向链表</h3><p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200715205411302.png"></p>
<ol>
<li><p>单向链表的查询效率比较低</p>
<p>是因为单向链表的每个元素在内存中的存储位置是不规律的，并且没有顺序，仅仅是靠上一个节点里存储的下一个节点的内存地址才能找到下一个元素，所以我想要查询元素的时候每次都要从头节点开始找，依次从元素里存储的下个节点的内存地址找，很慢。</p>
</li>
<li><p>单向链表的增删效率比较高</p>
<p>是因为单向链表的每个元素里存储得有下个元素的内存地址，想要删掉某一个元素的话就直接将指向该元素的上一个元素的内存地址指向下一个元素就好了，因为这个元素没有被任何元素指向了所以Java的垃圾回收机制就会将这个内存回收。增加某个元素的话就只需要让指向另外元素的存的内存地址指向新增的这个，新增的这个里面再存刚刚另外的元素存的。相比数组增加或者删除会使这个元素后面所有的元素的内存地址发生位移。</p>
</li>
<li><p>单链表中删除元素</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200715210903724.png"></p>
<p>想要删除B节点只需要将B节点里存储的C的内存地址赋给A节点，这样AB都同时指向C了，但是并没有元素指向B节点，B节点就会被Java垃圾机制回收掉。C节点什么都不需要操心。</p>
</li>
<li><p>单链表中添加元素</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200715211639474.png"></p>
<p>想要将B节点添加进AC节点之间，只需要将原本A节点里存储的C节点的内存地址丢给B节点这样B就可以指向C了，然后A节点再存储B节点的内存地址这样A节点就可以指向B了。C节点也是什么都不需要操心。</p>
</li>
<li><p>节点的前后结点</p>
<p>节点的前结点等于上一个元素的后结点；同理，节点的后结点是下一个元素的前结点。</p>
</li>
</ol>
<h3 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h3><p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200722220404448.png"></p>
<p>LinkedList的特点：底层是双向链表，查询效率较低，随机增删的效率较高。</p>
<h2 id="Vector类"><a href="#Vector类" class="headerlink" title="Vector类"></a>Vector类</h2><p>Vector也是List的实现类，它是线程安全的。初始化容量是10，每次扩容是扩容到原容量的2倍。它里面的所有方法都是有syschronized关键字的（线程同步的）。</p>
<p>Vector类的特点：底层是数组，线程安全的；不常用。</p>
<h2 id="将ArrayList转化为线程安全的"><a href="#将ArrayList转化为线程安全的" class="headerlink" title="将ArrayList转化为线程安全的"></a>将ArrayList转化为线程安全的</h2><p><code>java.util.collections</code>包下的<code>synchronizedList(List&lt;T&gt; list)</code>静态方法可以将List列表变成线程安全的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建ArrayList列表</span></span><br><span class="line">      List arrayList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//向列表中添加元素</span></span><br><span class="line">      arrayList.add(<span class="number">1</span>);</span><br><span class="line">      arrayList.add(<span class="number">2</span>);</span><br><span class="line">      arrayList.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//将ArrayList列表变成线程安全的</span></span><br><span class="line">      <span class="type">List</span> <span class="variable">synchronizedList</span> <span class="operator">=</span> Collections.synchronizedList(arrayList);</span><br></pre></td></tr></table></figure>

<h2 id="泛型机制"><a href="#泛型机制" class="headerlink" title="泛型机制"></a>泛型机制</h2><p>在JDK5里Java新增了一个新特性：泛型机制。</p>
<p>泛型的本质是参数化类型，这种参数类型可以用在类、变量、接口和方法的创建中，分别称为泛型类、泛型变量、泛型接口、泛型方法。</p>
<p>在Java集合框架中就大量使用泛型，所以我们有必要搞懂。先举个例子看看在集合中没有使用泛型和使用泛型的区别。</p>
<ul>
<li><p>没有使用泛型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestList03</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建没有使用泛型的集合对象List1</span></span><br><span class="line">        List list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向List1中添加元素</span></span><br><span class="line">        list1.add(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        list1.add(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">        list1.add(<span class="number">100</span>);</span><br><span class="line">        list1.add(<span class="number">23123</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//利用迭代器进行遍历</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> list1.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(obj);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有使用泛型限制前，我们可以往集合中添加任意类型的元素，比如String、Integer类型。</p>
</li>
<li><p>使用泛型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestList04</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建有泛型限制的集合对象list2</span></span><br><span class="line">        List&lt;String&gt; list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向集合list2中添加元素</span></span><br><span class="line">        list2.add(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        list2.add(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">        list2.add(<span class="string">&quot;test3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//利用迭代器遍历元素</span></span><br><span class="line">        Iterator&lt;String&gt; iterator = list2.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加上泛型之后，我们就只能往元素中添加String类型的元素了，也就是只能添加你用泛型限制的那个类型的元素和这个类型的子类。</p>
<p>同时定义泛型对象的写法有三种</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//完整写法</span></span><br><span class="line">List&lt;String&gt; list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="comment">//钻石表达式：去掉后面的String</span></span><br><span class="line">List&lt;String&gt; list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//省略写法：去掉后面的&lt;String&gt;</span></span><br><span class="line">List&lt;String&gt; list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br></pre></td></tr></table></figure>

<p>所以可以理解为没有加上泛型限制的集合对象，实质上有一个隐藏泛型限制（Object）</p>
</li>
</ul>
<h2 id="自定义泛型"><a href="#自定义泛型" class="headerlink" title="自定义泛型"></a>自定义泛型</h2><p>我们也可以在创建类的时候使用自定义泛型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span>&lt;E&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    E <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(E e)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在创建类的时候类名后面加上<code>&lt;E&gt;</code>或者<code>&lt;T&gt;</code>甚至随便什么名字，指定这个类可以使用泛型，E和T只是一个标识符，用了泛型后，下面get方法的返回值就是这个泛型，下面set方法的参数也是这个泛型。比如我创建User类对象的时候使用了<code>User&lt;Sring&gt;</code>，那么get方法的返回值就是String，set的参数就应该是String类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">//创建不带泛型的User对象</span></span><br><span class="line">       <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">       <span class="comment">//返回值是Object类型</span></span><br><span class="line">       <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> user1.get();</span><br><span class="line">       <span class="comment">//参数类型也是Object</span></span><br><span class="line">       user1.set(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       <span class="comment">//创建带泛型的User对象</span></span><br><span class="line">       User&lt;String&gt; user2=<span class="keyword">new</span> <span class="title class_">User</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//返回值就是String类型</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> user2.get();</span><br><span class="line">       <span class="comment">//参数也是String类型</span></span><br><span class="line">       user2.set(<span class="keyword">new</span> <span class="title class_">String</span>());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>所以可以理解为如果没有指定泛型那么那个泛型就是所有类型的父类（Object）</p>
<h2 id="增加for循环：foreach"><a href="#增加for循环：foreach" class="headerlink" title="增加for循环：foreach"></a>增加for循环：foreach</h2><ol>
<li><p>使用集合迭代器进行循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">   </span><br><span class="line">      list1.add(<span class="number">1</span>);</span><br><span class="line">      list1.add(<span class="number">2</span>);</span><br><span class="line">      list1.add(<span class="number">3</span>);</span><br><span class="line">      list1.add(<span class="number">4</span>);</span><br><span class="line">      list1.add(<span class="number">5</span>);</span><br><span class="line">   </span><br><span class="line">      <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> list1.iterator();</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">          System.out.println(iterator.next());</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>获得迭代器，然后利用迭代器的hasNext方法判断是否有下一个元素，再利用next获取元素</p>
</li>
<li><p>使用集合的get得到下标进行循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">List list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">   </span><br><span class="line">      list1.add(<span class="number">1</span>);</span><br><span class="line">      list1.add(<span class="number">2</span>);</span><br><span class="line">      list1.add(<span class="number">3</span>);</span><br><span class="line">      list1.add(<span class="number">4</span>);</span><br><span class="line">      list1.add(<span class="number">5</span>);</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list1.size() ; i++) &#123;</span><br><span class="line">          System.out.println(list1.get(i));</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>利用i作为循环数循环，利用集合对象的get方法下标得到对象</p>
</li>
<li><p>使用增强for循环</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">List list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">   </span><br><span class="line">      list1.add(<span class="number">1</span>);</span><br><span class="line">      list1.add(<span class="number">2</span>);</span><br><span class="line">      list1.add(<span class="number">3</span>);</span><br><span class="line">      list1.add(<span class="number">4</span>);</span><br><span class="line">      list1.add(<span class="number">5</span>);</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">for</span> (Object o : list1) &#123;</span><br><span class="line">          System.out.println(o);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>利用<code>for(集合中单个元素的数据类型 变量名：集合对象)&#123;&#125;</code>来循环</p>
<p>增强for循环的特点：效率很高，但是缺点是没有下标，有的时候可能需要下标。</p>
</li>
</ol>
<h2 id="Map接口"><a href="#Map接口" class="headerlink" title="Map接口"></a>Map接口</h2><p>Map跟Collection是并列的，Map存储数据的方法是以键值对（Key-Value）的方式存储的，键才是主要的，值只是键的附属。</p>
<p>Map接口中的常用方法如下：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>V put(K key,V value)</td>
<td>以键值对的方式将元素添加到集合</td>
</tr>
<tr>
<td>V get(Object key)</td>
<td>根据Key来查询Value，返回值是Value的数据类型</td>
</tr>
<tr>
<td>int size()</td>
<td>返回集合中键的数目</td>
</tr>
<tr>
<td>boolean containsKey(Object key)</td>
<td>查询集合中是否包含这个key，包含返回true，否则返回false</td>
</tr>
<tr>
<td>boolean containsValue(Object value)</td>
<td>查询集合中是否包含这个value，包含返回true，否则返回false</td>
</tr>
<tr>
<td>boolean isEmpty()</td>
<td>判断集合中元素是否为空，是返回true，否则返回false</td>
</tr>
<tr>
<td>void clear()</td>
<td>清空集合</td>
</tr>
<tr>
<td>V remove(Object key)</td>
<td>根据key来移除这个键值对（前提是该键存在）</td>
</tr>
<tr>
<td>Collection&lt;V&gt; values()</td>
<td>以Collect集合的类型返回该集合的所有value</td>
</tr>
<tr>
<td>Set&lt;K&gt; keySet()</td>
<td>以Set集合的类型返回该集合的所有key</td>
</tr>
<tr>
<td>Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet()</td>
<td>以Set集合的类型返回该集合的所有键值对</td>
</tr>
</tbody></table>
<p>测试以下常用的添加和查询还有判断方法，其中Map集合的<code>containsKey()</code>、<code>containsValue()</code>、<code>remove()</code>方法底层都是用equals方法进行比较的，如果自定义类没有重写equals方法就会用Object类的equals方法比较地址。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建key为Integer类型，value为String类型的Map集合map</span></span><br><span class="line">        Map&lt;Integer,String&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向集合中以键值对的方式添加元素</span></span><br><span class="line">        map.put(<span class="number">1</span>,<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        map.put(<span class="number">2</span>,<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">        map.put(<span class="number">3</span>,<span class="string">&quot;test3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据key是1来得到值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> map.get(<span class="number">1</span>);<span class="comment">// s=&quot;test1&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否有1这个key</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> map.containsKey(<span class="number">1</span>);<span class="comment">// b=true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否有test4这个value</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b1</span> <span class="operator">=</span> map.containsValue(<span class="string">&quot;test4&quot;</span>); <span class="comment">//b1=false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断集合元素是否为空</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b2</span> <span class="operator">=</span> map.isEmpty(); <span class="comment">//b2=false</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得集合长度</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> map.size(); <span class="comment">//i=3</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得集合的所有key</span></span><br><span class="line">        Set&lt;Integer&gt; keys = map.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历key</span></span><br><span class="line">        <span class="keyword">for</span> (Integer key : keys) &#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得集合的所有value</span></span><br><span class="line">        Collection&lt;String&gt; values = map.values();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历value</span></span><br><span class="line">        <span class="keyword">for</span> (String value : values) &#123;</span><br><span class="line">            System.out.println(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map集合的遍历方式"><a href="#Map集合的遍历方式" class="headerlink" title="Map集合的遍历方式"></a>Map集合的遍历方式</h2><ol>
<li><p>先遍历出所有的key，然后通过集合的get方法得到key对应的value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMap02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建Map集合对象</span></span><br><span class="line">        Map&lt;Integer,String&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向集合中以键值对的方式添加元素</span></span><br><span class="line">        map.put(<span class="number">1</span>,<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        map.put(<span class="number">2</span>,<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">        map.put(<span class="number">3</span>,<span class="string">&quot;test3&quot;</span>);</span><br><span class="line">        map.put(<span class="number">4</span>,<span class="string">&quot;test4&quot;</span>);</span><br><span class="line">        map.put(<span class="number">5</span>,<span class="string">&quot;test5&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得集合中的所有key</span></span><br><span class="line">        Set&lt;Integer&gt; keys = map.keySet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            遍历方式1：得到key的迭代器，通过key得到value</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Iterator&lt;Integer&gt; iterator = keys.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">            System.out.println(key+<span class="string">&quot;---&gt;&gt;&quot;</span>+value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;===============================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            遍历方式2：用增强for循环遍历</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">for</span> (Integer key : keys) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> map.get(key);</span><br><span class="line">            System.out.println(key+<span class="string">&quot;---&gt;&gt;&quot;</span>+value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用<code>entrySet()</code>方法，得到所有的键值对集合，然后再分别取出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">          遍历方式3：</span></span><br><span class="line"><span class="comment">          1、得到Map.Entry对象</span></span><br><span class="line"><span class="comment">          2、通过Entry.getKey()得到key属性</span></span><br><span class="line"><span class="comment">          3、通过Entry.getValue()得到value属性</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      Set&lt;Map.Entry&lt;Integer, String&gt;&gt; entrySet = map.entrySet();</span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : entrySet) &#123;</span><br><span class="line">          <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">          <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">          System.out.println(key+<span class="string">&quot;---&gt;&gt;&quot;</span>+value);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>其中Entry是Map的内部类。key和value是Map.Entry内部类的属性</p>
</li>
</ol>
<p>方式2的效率比方式1高一些，因为方式1先遍历出了所有的key之后还需要通过key去查询value，而第二种方式就直接能遍历出key-value整个对象。</p>
<h2 id="HashMap数据结构"><a href="#HashMap数据结构" class="headerlink" title="HashMap数据结构"></a>HashMap数据结构</h2><p>数组：内存地址连续，查询效率高，随机增删效率低；</p>
<p>单向链表：内存地址没有规律，查询效率低，随机增删效率高。</p>
<p>哈希表：将数组和单向链表结合</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200723214300081.png"></p>
<p>哈希表由node节点类似于数组以及每个数组里存的单向链表组成。实际是<code>Hashset集合</code>+<code>单向链表</code>，其中set集合中的单个元素的hash值是相同的</p>
<p>其中node节点由key、value、下个节点的地址next以及这个node节点的hash值组成。</p>
<ol>
<li><p>HashMap的put方法的原理：</p>
<p>put(key,value)方法是将键值对参数key、value封装成node节点，然后key再调用<code>hashCode()</code>方法得出key的hash值，然后hash值经过哈希算法得到存放在数组中的下标，如果没有这个链表，那么这个元素就放在数组的第一个，否则再拿着key和有着同一个下标的链表中用equals方法进行比较key，如果key都不一样，那么这个元素会被放在最后一个，其中有一个一样的话就会将其覆盖。</p>
</li>
<li><p>HashMap的get方法的原理：</p>
<p>get(k)，get方法需要的参数是k，get方法会将k经过<code>hashCode()</code>方法将他k的hash值算出来，hash值再经过哈希算法得出数组的下标，如果有这个下标的这一条链表，它就继续找，否则就直接返回null（没有对应的value）。找到了和k下标值的链表，那么就继续寻找，和这条链表上的k用equals方法进行比较，如果equals返回成功，那么说明有这个元素就返回这个元素的value。</p>
</li>
</ol>
<p>所以，我们在存放<code>HashSet</code>和<code>HashMap</code>的key部分的时候中<strong>尽量重写equals方法和hashCode方法</strong>。因为如果没有重写的话这两个方法默认的都是（Object类里）返回的对象内存地址，对象的内存地址是肯定不会相同的，所以equals比较起来肯定不同，就会造成k重复，并且hashCode返回的也是内存地址，那么所有的对象的内存地址肯定不同，在数组中存的hash值也肯定不同，哈希表的作用没有发挥到最大。</p>
<p>就有点像字典，这个set集合存放的hash值就是目录里的偏旁，然后这个单向链表就是这个偏旁的哪些字。</p>
<p>问题：</p>
<ol>
<li><p>如果不重写<code>hashCode()</code>会怎样？</p>
<p>如果不重写<code>hashCode()</code>方法，那么返回的hash值就是对象的内存地址，对象的内存地址肯定是不相同的，所以set集合里存放的hash值就特别多，单向链表就特别短，甚至每条单向链表只有一个元素，那就完全成了一个一维数组。这叫散列分布不均匀。</p>
</li>
<li><p>如果重写了<code>hashCode()</code>返回的hash值是固定的会怎样</p>
<p>如果返回的是固定的hash值那么所有元素都在一条单向链表上，那就完全成了一个单向链表。这叫散列分布不均匀。</p>
</li>
<li><p>如果没有重写<code>equals()</code>会怎样？</p>
<p>如果不重写<code>equals()</code>方法，那么比较的时候就会采用Object类的equals方法比较内存地址，内存地址肯定是不相同的，所有即使内容一模一样但是内存地址不一样也会导致程序判断不相同，所以put存数据永远是存最后一个，get查询永远查不到。</p>
</li>
</ol>
<p>HashMap的默认初始化容量是16，默认加载因子是0.75（数组元素达到容量的75%时数组开始扩容，扩容后是原容量的二倍）。同时Java强烈推荐HashMap的初始化容量是2的次幂（2，4，8，16，32，64），这是为了达到散列均匀，提高效率。</p>
<h2 id="Hashtable"><a href="#Hashtable" class="headerlink" title="Hashtable"></a>Hashtable</h2><p>Hashtable接口继承自Map</p>
<p>底层的数据结构是哈希表，它是线程安全的（方法都带有syschronized关键字）默认初始化容量是11，默认加载因子是0.75f，扩容是原容量x2+1</p>
<p>Hashtable的k,v不允许null；HashMap的k,v运行null</p>
<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><p>Properties类是Hashtable的实现类，只能以键值对的方式存储数据，它也是线程安全的。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>void setProperty(String key,String value)</td>
<td>向集合里存以键值对的方式存数据</td>
</tr>
<tr>
<td>String getProperty(String key)</td>
<td>通过key得到value</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建properties集合对象</span></span><br><span class="line">        Properties properties=<span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向properties集合对象中存键值对</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;url&quot;</span>,<span class="string">&quot;localhost:8080&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从properties集合对象中去键值对</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> properties.getProperty(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出</span></span><br><span class="line">        System.out.println(url);        <span class="comment">//localhost:8080</span></span><br><span class="line">        System.out.println(username);   <span class="comment">//root</span></span><br><span class="line">        System.out.println(password);   <span class="comment">//123456</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h2><p>TreeSet实现了SortedSet接口，能够对存入的数据自动进行排序；TreeSet和TreeMap的key部分的排序原理是一样的，底层都是采用的二叉树中序遍历进行排序。TreeSet调用add方法的时候底层实际上调用了TreeMap的put方法，然后把Object赋给了key部分。</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200724155205704.png"></p>
<p>一个树节点由5部分组成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Node left;			<span class="comment">//左子树地址</span></span><br><span class="line">Node rigth;			<span class="comment">//右子树地址</span></span><br><span class="line">Node parent;		<span class="comment">//父子树地址</span></span><br><span class="line">Object key;			<span class="comment">//键</span></span><br><span class="line">Object value;		<span class="comment">//值</span></span><br></pre></td></tr></table></figure>

<p>TreeSet能够很快进行排序就是因为底层采用的是中序遍历排序，在TreeSet调用add方法（实质上调用TreeMap的put）方法的时候就已经排好序了，就是边放置边排序。</p>
<p>比如：</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200724161314926.png"></p>
<p>就可以将存入的随机顺序经过二叉树排序取出的时候就能排序了。其中不难想象，中间肯定要经过key与key之间的比较，如果一样则覆盖，如果后存入的数大就放在右边，后存入的数小就放在左边。所以这里就涉及到key这个对象的compareTo()方法。因为Integer、String类都继承了Comparable接口并且重写了compareTo()方法，所以才能比较。就好像你比较两个对象总得有个条件才行，不然两个对象比较毫无意义。</p>
<p>所以我们想要自定义类就可以在里面添加自定义比较规则：</p>
<ol>
<li><p>创建类继承Comparable接口并且重写comparable()方法，在comparable里指定比较规则</p>
<p>User类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;User&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  根据用户的年龄升序排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> u 先存入的对象（父子树）对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果后存入的对象大于先存入的对象则返回正数，放到右子树</span></span><br><span class="line"><span class="comment">     *          如果后存入的对象小于先存入的对象则返回负数，放到左子树</span></span><br><span class="line"><span class="comment">     *          如果后存入的对象等于先存入的对象则返回0，覆盖</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(User u)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.age-u.age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里<strong>需要特别特别特别注意的是</strong>，重写的compareTo(Object o)方法里接收到的o参数是先存入的对象，实质上就是后存入的对象调用了这个方法与后存入的对象进行比较，再根据返回的是正负数或者0来进行比较的。</p>
<p>就是<code>后存入的对象.compareTo(先存入的对象)</code>（TreeMap的put方法中源代码是这样写的）</p>
<p>如果返回的数值大于0，则后存入的对象放到右子树；</p>
<p>如果返回的数值小于0，则后存入的对象放到左子树；</p>
<p>如果返回的数值等于0，则后存入的对象覆盖先存入的对象。</p>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTreeSet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建users集合对象</span></span><br><span class="line">        TreeSet&lt;User&gt; users=<span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向users集合中添加元素</span></span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test1&quot;</span>,<span class="number">45</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test3&quot;</span>,<span class="number">68</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test2&quot;</span>,<span class="number">78</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test4&quot;</span>,<span class="number">11</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历users集合</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<p><img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200724170612976.png"></p>
</li>
<li><p>创建一个比较器comparator类继承Comparator接口，将它作为参数传递给TreeSet</p>
<p>User类就不再实现Comparable接口，也不再重写compareTo()方法了，直接创建一个比较器对象UserComparator实现Comparator，并且重写compare方法，在compare方法指定比较规则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTreeSet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建比较器对象</span></span><br><span class="line">        UserComparator userComparator=<span class="keyword">new</span> <span class="title class_">UserComparator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建users集合对象，并且将比较器作为对象传递给集合</span></span><br><span class="line">        TreeSet&lt;User&gt; users=<span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(userComparator);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向users集合中添加元素</span></span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test1&quot;</span>,<span class="number">45</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test3&quot;</span>,<span class="number">68</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test2&quot;</span>,<span class="number">78</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test4&quot;</span>,<span class="number">11</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历users集合</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;User&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  根据用户的年龄升序排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> u1 后存入的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> u2 先存入的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 后存入的对象的年龄大于先存入对象的年龄返回正数，放到右子树</span></span><br><span class="line"><span class="comment">     *          后存入的对象年龄小于先存入对象的年龄返回负数，放到左子树</span></span><br><span class="line"><span class="comment">     *          后存入的对象年龄等于先存入对象的年龄返回0，覆盖</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(User u1, User u2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> u1.getAge()-u2.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者直接用匿名内部类实现Comparator接口指定规则</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestTreeSet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建users集合对象，并且使用匿名内部类实现Comparator接口</span></span><br><span class="line">        TreeSet&lt;User&gt; users=<span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;User&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(User u1, User u2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> u1.getAge()-u2.getAge();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//向users集合中添加元素</span></span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test1&quot;</span>,<span class="number">45</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test3&quot;</span>,<span class="number">68</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test2&quot;</span>,<span class="number">78</span>));</span><br><span class="line">        users.add(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;test4&quot;</span>,<span class="number">11</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历users集合</span></span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>第一个方法是在类里实现<code>java.lang.Comparable</code>（可比较的）接口，重写compareTo(先存入的对象)方法：这个t就是父子树（先存入的对象）<img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200724172351165.png"></p>
<p>第二个方式是创建比较器对象实现<code>java.util.Comparator</code>（比较器）接口，重写compare(后存入的对象，先存入的对象)：<img src="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/image-20200724172331740.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/" data-id="cltpf7ep4002026k6almj3czr" data-title="Java集合" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/DevOps/CI_CD" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/DevOps/CI_CD/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/DevOps/CI_CD/">CI_CD</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><p><img src="/2023/07/19/back-end/DevOps/CI_CD/image-20220419170621946.png"></p>
<h2 id="CI"><a href="#CI" class="headerlink" title="CI"></a>CI</h2><p><strong>Continuous Integration</strong>，持续集成</p>
<p><img src="/2023/07/19/back-end/DevOps/CI_CD/image-20220420154045759.png"></p>
<h2 id="CD"><a href="#CD" class="headerlink" title="CD"></a>CD</h2><p><strong>Continuous Delivery</strong>，持续交付</p>
<p><strong>Continuous Deployment</strong>，持续部署</p>
<p><img src="/2023/07/19/back-end/DevOps/CI_CD/image-20220420154129435.png"></p>
<h2 id="GitLab-CI-CD"><a href="#GitLab-CI-CD" class="headerlink" title="GitLab CI&#x2F;CD"></a>GitLab CI&#x2F;CD</h2><ol>
<li>注册Runner并且为代码仓库配置<code>gitlab-runner</code>服务，它是用来实际执行CI任务的服务器；</li>
<li>提交代码的时候，确保根目录有一个文件名为<code>.gitlab-ci.yml</code>的文件，该文件是用来指定CI流程（如：build、test、deploy），指定某流程触发时候的脚本（script）</li>
<li>GitLab对根目录有文件名为<code>.gitlab-ci.yml</code>的代码进行检测，如果当前提交符合文件中的指定出发条件，则会分配对应的<code>gitlab-runner</code>进行CI的某一流程。</li>
<li>若该次CI流程中的某个脚本运行失败，则判定此次CI不通过，需要提交者修复问题再次提交，直至CI通过。</li>
</ol>
<h3 id="gitlab-ci-yaml文件编写"><a href="#gitlab-ci-yaml文件编写" class="headerlink" title=".gitlab-ci.yaml文件编写"></a>.gitlab-ci.yaml文件编写</h3><p><img src="/2023/07/19/back-end/DevOps/CI_CD/image-20220420165831888.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/DevOps/CI_CD/" data-id="cltpf7eny000726k6cqkc295c" data-title="CI_CD" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/devops/" rel="tag">devops</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/go/gorm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/go/gorm/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/go/gorm/">GORM框架的学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="什么是ORM？"><a href="#什么是ORM？" class="headerlink" title="什么是ORM？"></a>什么是ORM？</h1><p>ORM是Object Relation Mapping（对象关系映射）<img src="/2023/07/19/back-end/go/gorm/image-20211101182158366.png"></p>
<h1 id="什么是GORM？"><a href="#什么是GORM？" class="headerlink" title="什么是GORM？"></a>什么是GORM？</h1><p>是一个有国人开发的，目前较为流行的，基于Go开发的ORM框架，用于对数据库进行操作。</p>
<p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/">中文官方文档</a></p>
<h1 id="在项目中安装GORM"><a href="#在项目中安装GORM" class="headerlink" title="在项目中安装GORM"></a>在项目中安装GORM</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">go get -u gorm.io/gorm</span><br><span class="line">go get -u gorm.io/driver/mysql		<span class="comment">#根据需求安装适合的数据库驱动</span></span><br><span class="line">		  gorm.io/driver/postgres</span><br><span class="line">		  gorm.io/driver/sqlite</span><br><span class="line">		  gorm.io/driver/sqlserver</span><br><span class="line">		  ...</span><br></pre></td></tr></table></figure>

<h1 id="连接MySQL数据库"><a href="#连接MySQL数据库" class="headerlink" title="连接MySQL数据库"></a>连接MySQL数据库</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line">	<span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	username = <span class="string">&quot;root&quot;</span></span><br><span class="line">	password = <span class="string">&quot;&quot;</span></span><br><span class="line">	host = <span class="string">&quot;127.0.0.1:3306&quot;</span></span><br><span class="line">	dbName = <span class="string">&quot;gorm_demo1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	dsn := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>, username, password, host, dbName)</span><br><span class="line">	<span class="comment">//dsn := &quot;root@tcp(127.0.0.1:3306)/gorm_demo1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	<span class="comment">//连接MySQL数据库</span></span><br><span class="line">	db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="comment">//panic处理错误</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">//连接数据库失败</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用<code>gorm.Open()</code>连接对应的数据库</p>
<h1 id="自动创建表"><a href="#自动创建表" class="headerlink" title="自动创建表"></a>自动创建表</h1><h3 id="创建结构体对象"><a href="#创建结构体对象" class="headerlink" title="创建结构体对象"></a>创建结构体对象</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id 		<span class="type">uint</span></span><br><span class="line">	Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建表并且插入数据"><a href="#创建表并且插入数据" class="headerlink" title="创建表并且插入数据"></a>创建表并且插入数据</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	dsn := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s)/%s?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span>, username, password, host, dbName)</span><br><span class="line">	<span class="comment">//dsn := &quot;root@tcp(127.0.0.1:3306)/gorm_demo1?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	<span class="comment">//连接MySQL数据库</span></span><br><span class="line">	db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="comment">//panic处理错误</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">//连接数据库失败</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//自动创建数据表并且把结构体属性和数据库字段一一对应（自动迁移）</span></span><br><span class="line">	db.AutoMigrate(&amp;User&#123;&#125;)	<span class="comment">//即会自动根据User结构体创建User表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>db.AutoMigrate(结构体指针)</code>会在连接数据库的时候根据结构体的属性自动创建数据表。</p>
<h1 id="定义模型（Model）"><a href="#定义模型（Model）" class="headerlink" title="定义模型（Model）"></a>定义模型（Model）</h1><h2 id="gorm-Model"><a href="#gorm-Model" class="headerlink" title="gorm.Model"></a>gorm.Model</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Model <span class="keyword">struct</span> &#123;</span><br><span class="line">   ID        <span class="type">uint</span> <span class="string">`gorm:&quot;primarykey&quot;`</span></span><br><span class="line">   CreatedAt time.Time</span><br><span class="line">   UpdatedAt time.Time</span><br><span class="line">   DeletedAt DeletedAt <span class="string">`gorm:&quot;index&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>gorm.Model是gorm推荐的模型，可以在自定义的结构体中嵌套（继承）它</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID        <span class="type">uint</span> <span class="string">`gorm:&quot;primarykey&quot;`</span></span><br><span class="line">    CreatedAt time.Time</span><br><span class="line">    UpdatedAt time.Time</span><br><span class="line">    DeletedAt DeletedAt <span class="string">`gorm:&quot;index&quot;`</span></span><br><span class="line">    Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="主键、表名"><a href="#主键、表名" class="headerlink" title="主键、表名"></a>主键、表名</h2><h3 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h3><p>GORM默认使用名为ID的字段作为表的主键，也可以使用tag:<code>gorm:primary_key</code>来手动指定表的主键</p>
<h3 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h3><p>表名默认就是结构体名称的复数，例如：User结构体默认的表名是Users</p>
<p>手动指定表名</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	gorm.Model</span><br><span class="line">	Name 	<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableName 手动指定User结构体的表名</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;user&quot;</span>	<span class="comment">//自定义的表名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="字段标签"><a href="#字段标签" class="headerlink" title="字段标签"></a>字段标签</h2><p>声明model时，tag是可选的，参看：<a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/models.html#%E5%AD%97%E6%AE%B5%E6%A0%87%E7%AD%BE">字段标签</a>。tag 名大小写不敏感，但建议使用 <code>camelCase</code> 风格，常用如下：<code>primaryKey</code>指定列为主键，<code>unique</code>指定列为唯一，<code>default</code>指定列的默认值，<code>not null</code>指定列不为null等</p>
<h2 id="时间戳跟踪"><a href="#时间戳跟踪" class="headerlink" title="时间戳跟踪"></a>时间戳跟踪</h2><h3 id="CreatedAt"><a href="#CreatedAt" class="headerlink" title="CreatedAt"></a>CreatedAt</h3><p>如果模型有<code>CreatedAt</code>字段，该字段的值将会是初次创建记录的时间。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.Create(&amp;u)	<span class="comment">//新建时的时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以利用update来修改CreatedAt字段</span></span><br><span class="line">db.Model(&amp;u).Update(<span class="string">&quot;CreatedAt&quot;</span>,time.Now())	</span><br></pre></td></tr></table></figure>

<h3 id="UpdatedAt"><a href="#UpdatedAt" class="headerlink" title="UpdatedAt"></a>UpdatedAt</h3><p>如果模型有<code>UpdatedAt</code>字段，该字段的值会是每次更新记录的时间</p>
<h3 id="DeletedAt"><a href="#DeletedAt" class="headerlink" title="DeletedAt"></a>DeletedAt</h3><p>如果模型有<code>DeletedAt</code>字段，调用<code>Delete</code>删除该记录时，将会设置<code>DeletedAt</code>字段为删除的时间，而不是直接将记录删除（软删除）</p>
<h1 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h1><h2 id="增加（Create）"><a href="#增加（Create）" class="headerlink" title="增加（Create）"></a>增加（Create）</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/create.html">https://gorm.io/zh_CN/docs/create.html</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建新的结构体对象</span></span><br><span class="line">u := &amp;User&#123;</span><br><span class="line">    Model: gorm.Model&#123;&#125;,</span><br><span class="line">    Name:  <span class="string">&quot;test&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//插入记录</span></span><br><span class="line">result := db.Create(&amp;u)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	u.ID				返回成功插入后的主键</span></span><br><span class="line"><span class="comment">    result.Error		返回error报错信息</span></span><br><span class="line"><span class="comment">    result.RowsAffected	返回成功插入的条数</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p><strong>TIps</strong></p>
<p>可以在数据库实例对象后加<code>.Debug()</code>来查看具体执行的SQL语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Debug().Create(&amp;u)</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="查询（First、Take、Last、Find）"><a href="#查询（First、Take、Last、Find）" class="headerlink" title="查询（First、Take、Last、Find）"></a>查询（First、Take、Last、Find）</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/query.html">https://gorm.io/zh_CN/docs/query.html</a></p>
<h2 id="更新（Save、Update）"><a href="#更新（Save、Update）" class="headerlink" title="更新（Save、Update）"></a>更新（Save、Update）</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/update.html">https://gorm.io/zh_CN/docs/update.html</a></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p><a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/delete.html">https://gorm.io/zh_CN/docs/delete.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/go/gorm/" data-id="cltpf7eoc000l26k6ea5vffpd" data-title="GORM框架的学习" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-back-end/python/python3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/back-end/python/python3/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/back-end/python/python3/">初学python3</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="list列表"><a href="#list列表" class="headerlink" title="list列表"></a>list列表</h2><p>list是个有序集合，可以随时添加和删除其中的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classmates = [<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Tracy&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h3 id="append-追加元素"><a href="#append-追加元素" class="headerlink" title="append()追加元素"></a>append()追加元素</h3><h3 id="insert-向指定位置插入元素"><a href="#insert-向指定位置插入元素" class="headerlink" title="insert()向指定位置插入元素"></a>insert()向指定位置插入元素</h3><h3 id="pop-删除末尾元素或者指定位置元素"><a href="#pop-删除末尾元素或者指定位置元素" class="headerlink" title="pop()删除末尾元素或者指定位置元素"></a>pop()删除末尾元素或者指定位置元素</h3><h2 id="tuple元组"><a href="#tuple元组" class="headerlink" title="tuple元组"></a>tuple元组</h2><p>tuple一旦<strong>初始化就不能修改（指向不变）</strong>，比如同样是列出同学的名字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classmates = (<span class="string">&#x27;Michael&#x27;</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;Tracy&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="dict字典"><a href="#dict字典" class="headerlink" title="dict字典"></a>dict字典</h2><p>类似map，以key-value的方式存储</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;Michael&#x27;</span>: <span class="number">95</span>, <span class="string">&#x27;Bob&#x27;</span>: <span class="number">75</span>, <span class="string">&#x27;Tracy&#x27;</span>: <span class="number">85</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="pop-删除元素"><a href="#pop-删除元素" class="headerlink" title="pop()删除元素"></a>pop()删除元素</h3><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>set和dict类似，也是一组key的集合，但不存储value。由于key不能重复，所以，在set中，没有重复的key。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>



<h3 id="add-添加元素"><a href="#add-添加元素" class="headerlink" title="add()添加元素"></a>add()添加元素</h3><h3 id="remove-删除元素"><a href="#remove-删除元素" class="headerlink" title="remove()删除元素"></a>remove()删除元素</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/back-end/python/python3/" data-id="cltpf7eog000q26k6e1zh4tph" data-title="初学python3" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/" rel="tag">python</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-design-pattern/design-pattern/结合Java和Golang学习设计模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/design-pattern/design-pattern/%E7%BB%93%E5%90%88Java%E5%92%8CGolang%E5%AD%A6%E4%B9%A0%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/design-pattern/design-pattern/%E7%BB%93%E5%90%88Java%E5%92%8CGolang%E5%AD%A6%E4%B9%A0%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">结合Java和Golang学习设计模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="设计模式是什么？"><a href="#设计模式是什么？" class="headerlink" title="设计模式是什么？"></a>设计模式是什么？</h2><p>设计模式是软件设计中常见问题的<strong>典型</strong>解决方案。它们就像能根据需求进行调整的预制蓝图， 可用于解决代码中反复出现的设计问题。</p>
<p>算法更像是菜谱： 提供达成目标的明确步骤。 而模式更像是蓝图： 你可以看到最终的结果和模式的功能， 但需要自己确定实现步骤。</p>
<h2 id="设计模式的分类"><a href="#设计模式的分类" class="headerlink" title="设计模式的分类"></a>设计模式的分类</h2><ol>
<li><strong>创建型模式</strong>提供<strong>创建对象</strong>的机制， 增加已有代码的灵活性和可复用性。<ul>
<li>工厂方法（Factory Method）</li>
<li>抽象工厂（Abstract Factoy）</li>
<li>生成器（Builder）</li>
<li>原型（Prototype）</li>
<li>单例（Singleton）</li>
</ul>
</li>
<li><strong>结构型模式</strong>介绍如何将对象和类组装成较大的结构， 并同时保持结构的灵活和高效。</li>
<li><strong>行为模式</strong>负责对象间的高效沟通和职责委派</li>
</ol>
<h2 id="工厂方法（Factory-Method）"><a href="#工厂方法（Factory-Method）" class="headerlink" title="工厂方法（Factory Method）"></a>工厂方法（Factory Method）</h2><p>工厂模式建议使用特殊的<strong>工厂方法</strong>来代替对于对象的构造函数的直接调用。</p>
<ol>
<li>工厂方法返回统一的产品<code>product</code>接口：其中工厂里面根据某种条件确定返回哪种产品</li>
<li>统一的产品<code>product</code>接口</li>
<li>客户端执行产品<code>product</code>接口的方法。</li>
</ol>
<p>在工厂方法的内部依据某种条件确定需要生产的实际产品<code>product</code>，调用者其实是根据产品<code>product</code>接口来调用的，不需要关系这种产品真正内部实现，即达到了使用工厂方法对不同产品的调用。</p>
<h3 id="Go实现简单工厂"><a href="#Go实现简单工厂" class="headerlink" title="Go实现简单工厂"></a>Go实现简单工厂</h3><p>由于 Go 中缺少类和继承等 OOP 特性， 所以无法使用 Go 来实现经典的工厂方法模式。 不过， 我们仍然能实现模式的基础版本， 即简单工厂。</p>
<h4 id="产品接口（product）：iGun"><a href="#产品接口（product）：iGun" class="headerlink" title="产品接口（product）：iGun"></a>产品接口（product）：iGun</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> iGun <span class="keyword">interface</span> &#123;</span><br><span class="line">	getName() <span class="type">string</span> <span class="comment">// 返回武器的名称</span></span><br><span class="line">	getPower() <span class="type">int</span>   <span class="comment">// 返回武器的能量大小</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="产品接口的实现：AK和M4"><a href="#产品接口的实现：AK和M4" class="headerlink" title="产品接口的实现：AK和M4"></a>产品接口的实现：AK和M4</h4><p>AK：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AK <span class="keyword">struct</span> &#123;</span><br><span class="line">	name  <span class="type">string</span></span><br><span class="line">	power <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newAK</span><span class="params">()</span></span> iGun &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;AK&#123;</span><br><span class="line">		name:  <span class="string">&quot;ak47&quot;</span>,</span><br><span class="line">		power: <span class="number">5</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a AK)</span></span> getName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a AK)</span></span> getPower() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a.power</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>M4：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> M4 <span class="keyword">struct</span> &#123;</span><br><span class="line">	name  <span class="type">string</span></span><br><span class="line">	power <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newM4</span><span class="params">()</span></span> iGun &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;M4&#123;</span><br><span class="line">		name:  <span class="string">&quot;m4a1&quot;</span>,</span><br><span class="line">		power: <span class="number">1</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m M4)</span></span> getName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m M4)</span></span> getPower() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m.power</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="工厂方法（factory）：gunFactory"><a href="#工厂方法（factory）：gunFactory" class="headerlink" title="工厂方法（factory）：gunFactory"></a>工厂方法（factory）：gunFactory</h4><p>根据调用者传入的gunType返回具体某种gun。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getGun</span><span class="params">(gunType <span class="type">string</span>)</span></span> (iGun, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">switch</span> gunType &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;ak&quot;</span>:</span><br><span class="line">		<span class="keyword">return</span> newAK(), <span class="literal">nil</span></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;m4&quot;</span>:</span><br><span class="line">		<span class="keyword">return</span> newM4(), <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;wrong gun type passed&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ak, _ := getGun(<span class="string">&quot;ak&quot;</span>)</span><br><span class="line">	m4, _ := getGun(<span class="string">&quot;m4&quot;</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;ak = %#v\n&quot;</span>, ak)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;m4 = %#v\n&quot;</span>, m4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="抽象工厂（Abstract-Factory）"><a href="#抽象工厂（Abstract-Factory）" class="headerlink" title="抽象工厂（Abstract Factory）"></a>抽象工厂（Abstract Factory）</h2><p><strong>抽象工厂模式</strong>是一种创建型设计模式， 它能创建一系列相关的对象， 而无需指定其具体类。</p>
<h2 id="生成器（Builder）"><a href="#生成器（Builder）" class="headerlink" title="生成器（Builder）"></a>生成器（Builder）</h2><p><strong>生成器模式</strong>是一种创建型设计模式， 使你能够分步骤创建复杂对象。 该模式允许你使用相同的创建代码生成不同类型和形式的对象。常见的使用场景是使用多个<code>build()</code>来构建某一对象</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BuildCPU()</span><br><span class="line">BuildScreen()</span><br><span class="line">BuildBattery()</span><br></pre></td></tr></table></figure>

<h2 id="原型（Prototype）"><a href="#原型（Prototype）" class="headerlink" title="原型（Prototype）"></a>原型（Prototype）</h2><p><strong>原型模式</strong>是一种创建型设计模式， 使你能够复制已有对象， 而又无需使代码依赖它们所属的类。</p>
<h2 id="单例（Singleton）"><a href="#单例（Singleton）" class="headerlink" title="单例（Singleton）"></a>单例（Singleton）</h2><p><strong>单例模式</strong>是一种创建型设计模式， 让你能够保证一个类只有一个实例， 并提供一个访问该实例的全局节点。</p>
<h2 id="代理（Proxy）"><a href="#代理（Proxy）" class="headerlink" title="代理（Proxy）"></a>代理（Proxy）</h2><p><strong>代理模式</strong>是一种结构型设计模式， 让你能够提供对象的替代品或其占位符。 代理控制着对于原对象的访问， 并允许在将请求提交给对象前后进行一些处理。</p>
<h2 id="适配器（Adapter）"><a href="#适配器（Adapter）" class="headerlink" title="适配器（Adapter）"></a>适配器（Adapter）</h2><p><strong>适配器模式</strong>是一种结构型设计模式， 它能使接口不兼容的对象能够相互合作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/design-pattern/design-pattern/%E7%BB%93%E5%90%88Java%E5%92%8CGolang%E5%AD%A6%E4%B9%A0%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-id="cltpf7eoi000u26k61k4ya88i" data-title="结合Java和Golang学习设计模式" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-front-end/uni-app/uni-app" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/07/19/front-end/uni-app/uni-app/" class="article-date">
  <time class="dt-published" datetime="2023-07-19T07:30:39.000Z" itemprop="datePublished">2023-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/07/19/front-end/uni-app/uni-app/">uni-app学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、什么是uni-app？"><a href="#1、什么是uni-app？" class="headerlink" title="1、什么是uni-app？"></a>1、什么是uni-app？</h2><p><code>uni-app</code> 是一个使用 <a target="_blank" rel="noopener" href="https://vuejs.org/">Vue.js</a> 开发所有前端应用的框架，开发者编写一套代码，可发布到iOS、Android、Web（响应式）、以及各种小程序（微信&#x2F;支付宝&#x2F;百度&#x2F;头条&#x2F;QQ&#x2F;钉钉&#x2F;淘宝）、快应用等多个平台。</p>
<p><code>uni-app</code>在手，做啥都不愁。即使不跨端，<code>uni-app</code>也是更好的小程序开发框架（<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35947">详见</a>）、更好的App跨平台框架、更方便的H5开发框架。不管领导安排什么样的项目，你都可以快速交付，不需要转换开发思维、不需要更改开发习惯。</p>
<p>uni-app功能框架：</p>
<p><img src="https://bjetxgzv.cdn.bspapp.com/VKCEYUGU-uni-app-doc/87a0a0d0-60aa-11eb-8ff1-d5dcf8779628.png"></p>
<h2 id="2、为什么要使用uni-app？"><a href="#2、为什么要使用uni-app？" class="headerlink" title="2、为什么要使用uni-app？"></a>2、为什么要使用uni-app？</h2><p>对于开发者来说，如果你想要写一套代码，然后可以适用iOS、Android、Web（响应式），以及小程序（微信、支付宝），节省了开发时间，提高了开发效率，只是可能程序运行的效率会比微信原生差一些而已。</p>
<p>对于公司来说，如果你想要开发软件并且适用于iOS、Android、Web、以及各种小程序，那么你就得聘请iOS开发、Android开发、Web开发、以及各种小程序开发，这样不仅会提高成本，还可能降低开发效率。（这种说法仅限于为了敏捷开发，注重功能性，忽略质量以及程序运行效率）。所以这个时候只需要一个会uni-app开发的程序员（或者团队）就可以了。</p>
<p>需要注意的是：使用uni-app开发肯定没有iOS原生或者Android原生或者微信小程序原生或者Web原生开发效率高并且质量好（指的是程序的流程程度等），所以uni-app仅适合小而快的开发，而不适合大而精的开发。uni-app在web端还好，如果在iOS和Android是各种套浏览器各种套WebView体验肯定不可能会有原生好。</p>
<p>即使不需要跨端，uni-app也是很好的小程序开发框架</p>
<h2 id="3、学习uni-app需要用到的技术"><a href="#3、学习uni-app需要用到的技术" class="headerlink" title="3、学习uni-app需要用到的技术"></a>3、学习uni-app需要用到的技术</h2><p>前端知识：npm、vue.js、微信小程序开发。可以了解过微信小程序开发，但是必须掌握vue.js</p>
<p>开发工具：uni-app官方推荐的<a target="_blank" rel="noopener" href="https://www.dcloud.io/hbuilderx.html">HBuilderX</a>和<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html">微信开发者工具</a>。利用HBuilder开发uni-app如果想要打包成微信开发者工具就必须要到微信开发者工具。</p>
<h2 id="4、第一个uni-app项目"><a href="#4、第一个uni-app项目" class="headerlink" title="4、第一个uni-app项目"></a>4、第一个uni-app项目</h2><ol>
<li><p>下载HBuilderX和微信开发者工具并且安装完成</p>
<p>注意安装完微信开发者工具需要打开然后登录后切记一定要开启“设置”-&gt;“安全”的服务端口：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115704092.png"></p>
</li>
<li><p>打开HBuilderX：选择“文件”-&gt;“新建”-&gt;“项目”，然后创建第一个uni-app项目：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115511406.png"></p>
<p>也可以使用<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/quickstart-cli">vue-cli的方式创建uni-app项目</a></p>
</li>
<li><p>运行到chrome浏览器或者微信小程序模拟：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115821793.png"></p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407115902594.png"></p>
<p>等待编译器编译完成即可在chrome或者微信开发者工具中预览</p>
</li>
</ol>
<h2 id="5、uni-app项目的基本结构目录"><a href="#5、uni-app项目的基本结构目录" class="headerlink" title="5、uni-app项目的基本结构目录"></a>5、uni-app项目的基本结构目录</h2><p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407120408702.png"></p>
<h2 id="6、uni-app开发的基本规范"><a href="#6、uni-app开发的基本规范" class="headerlink" title="6、uni-app开发的基本规范"></a>6、uni-app开发的基本规范</h2><ul>
<li>页面文件遵循<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/single-file-components.html">Vue的单文件组件（SFC）</a></li>
<li>组件标签遵循小程序规范（可以自定义组件），<a target="_blank" rel="noopener" href="https://uniapp.dcloud.net.cn/component/README?id=%E5%9F%BA%E7%A1%80%E7%BB%84%E4%BB%B6">uni-app组件</a></li>
<li>接口调用（JS API）靠近小程序开发规范，比如将<code>wx.</code>替换为<code>uni.</code>，<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/README">uni-app接口</a></li>
<li>数据绑定以及事件处理遵循vue规范，同时uni-app补充了app以及页面的生命周期</li>
<li>为了兼容多端运行，建议使用flex布局开发</li>
</ul>
<h2 id="7、globalStyle全局外观配置"><a href="#7、globalStyle全局外观配置" class="headerlink" title="7、globalStyle全局外观配置"></a>7、globalStyle全局外观配置</h2><p>可以在项目根目录的pages.json里定义全局的外观配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">//pages数组中第一项表示应用启动页，参考：https://uniapp.dcloud.io/collocation/pages</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uni-app&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;globalStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;uni-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>pages里配置单个页面的样式，globalStyle里配置全局页面的样式。具体对应的键和值可以参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=globalstyle">globalStyle文档</a></p>
<h2 id="8、创建一个页面并且配置路径和基本样式"><a href="#8、创建一个页面并且配置路径和基本样式" class="headerlink" title="8、创建一个页面并且配置路径和基本样式"></a>8、创建一个页面并且配置路径和基本样式</h2><p>在pages里创建目录，然后创建目录同名的vue文件，同时切记需要在根目录下的pages.json的pages里配置新的对象（类似vue-router），path就是刚刚创建的页面的路径，style就是创建的页面的基本样式。同vue-router类似，pages数组的第一个代表启动页。同globalStyle一样，单页面的style也可以参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=style">pages文档</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;pages/login/login&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;style&quot;</span> <span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;登录&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;enablePullDownRefresh&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;h5&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;pullToRefresh&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;#F1F1F1&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/index/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">				<span class="comment">// &quot;navigationBarTitleText&quot;: &quot;uni-app&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;globalStyle&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarTitleText&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello,uni-app!&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;navigationBarBackgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;backgroundColor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#F8F8F8&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;enablePullDownRefresh&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时还可以给当前页配置特定端的特定样式，比如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;h5&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pullToRefresh&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;#F1F1F1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>配置h5的下拉刷新的按钮是白色，然后其他端的下拉刷新不会受影响</p>
<h2 id="9、配置一个基本的tabBar"><a href="#9、配置一个基本的tabBar" class="headerlink" title="9、配置一个基本的tabBar"></a>9、配置一个基本的tabBar</h2><p>创建三个页面，分别是home（首页）、contact（通讯录）、profile（我的），并且在pages.json中的pages数组中配置他们的path和style</p>
<p>创建pages数组和globalStyle对象同级的tabBar对象：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;tabBar&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span><span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/home/home&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;首页&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/contact/contact&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;通讯录&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;pagePath&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/profile/profile&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span><span class="string">&quot;我的&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要包含基本的list数组，在list数组中配置单击跳转到的页面，pagePath就是路径，text就是显示的文字。切记需要先在pages数组中配置好页面，再在pagePath中配置他们。更多tabBar的配置项请参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=tabbar">tabBar文档</a></p>
<p>查看效果：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407132013585.png"></p>
<h2 id="10、配置condition以便调试具体页面"><a href="#10、配置condition以便调试具体页面" class="headerlink" title="10、配置condition以便调试具体页面"></a>10、配置condition以便调试具体页面</h2><p>在根目录的pages.json中配置跟pages数组和tabBar同级的condition以便调试具体某个页面。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;调试详情页&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/detail/detail&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;id=80&amp;name=test&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;调试我的页面&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;pages/profile/profile&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;id=80&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，query参数在页面的生命周期函数onload中可以取到：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onLoad</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> id = params.<span class="property">id</span></span><br><span class="line">    <span class="keyword">let</span> name = params.<span class="property">name</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;id-&gt;&#x27;</span>,id)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;name-&gt;&#x27;</span>,name)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<p>可以配置多个页面，然后在微信开发者工具中调试多个页面：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407152447731.png"></p>
<p>具体condition的配置请参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=condition">condtion文档</a></p>
<h2 id="11、基础内容组件之text"><a href="#11、基础内容组件之text" class="headerlink" title="11、基础内容组件之text"></a>11、基础内容组件之text</h2><p>text类似于html里的span标签，是行内标签。view类似于html里的div标签，是容器组件。</p>
<p>同时text组件有有很多可选属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>唱跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">selectable</span>&gt;</span>唱跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&quot;ensp&quot;</span>&gt;</span>唱    跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 四个空格被解析成了四个中文字符的一半 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&quot;emsp&quot;</span>&gt;</span>唱    跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 四个空格被解析成了四个中文字符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">&quot;nbsp&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-size: 30px;&quot;</span>&gt;</span>唱    跳rap<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 四个空格被解析成了一个30px的字符 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体效果：</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210407155216577.png"></p>
<p>具体属性说明请参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/component/text">text组件文档</a></p>
<h2 id="12、基础容器组件之view"><a href="#12、基础容器组件之view" class="headerlink" title="12、基础容器组件之view"></a>12、基础容器组件之view</h2><p>view是类似于html里的div标签，是个容器组件。</p>
<p>view也有很多可选属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;box-big&quot;</span> <span class="attr">hover-class</span>=<span class="string">&quot;box-big-hover&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">class</span>=<span class="string">&quot;box-small&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">hover-class</span>=<span class="string">&quot;box-small-hover&quot;</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">hover-stop-propagation</span> </span></span><br><span class="line"><span class="tag">                  <span class="attr">:hover-start-time</span>=<span class="string">&quot;2000&quot;</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">:hover-stay-time</span>=<span class="string">&quot;3000&quot;</span>&gt;</span>内盒子<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-big</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: green;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-big-hover</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: <span class="number">#999999</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-small</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background</span>: <span class="number">#007AFF</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.box-small-hover</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: <span class="number">#008000</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>class就是该组件的基本样式，hover-class就是该组件点击后的样式，hover-stop-propagation就是阻止冒泡样式，就是只是当前组件会有点击后的样式，而外层组件则不会，hover-start-time点击后多少毫米开始有样式，hover-stay-time点击后产生的样式会持续多少毫秒。</p>
<p>具体view容器组件可参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/component/view">view容器组件文档</a></p>
<h2 id="13、uni-app样式规范"><a href="#13、uni-app样式规范" class="headerlink" title="13、uni-app样式规范"></a>13、uni-app样式规范</h2><ul>
<li>rpx即响应式px，一种根据屏幕宽度自适应的动态像素单位，以750px宽的屏幕为基准，750rpx恰好为屏幕宽度。实际屏幕宽度增大，则rpx会根据宽度等比变大。比如750rpx在750px宽度的屏幕上显示满屏，此时宽度为750px，同样也会在375px的宽度的屏幕上显示满屏，此时宽度为375px</li>
<li>定义在App.vue中的样式为全局样式，会作用在全局的同名的类选择器或者id选择器上。在当前页面的样式为局部样式，只作用于当前页，同时同名局部样式会覆盖全局样式。</li>
</ul>
<h2 id="14、事件监听"><a href="#14、事件监听" class="headerlink" title="14、事件监听"></a>14、事件监听</h2><p>如果没有给事件传递参数，那么事件就可以拿到事件对象<code>$event</code>；如果传递了参数，同样可以使用<code>$event</code>来获取事件对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 不传递参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;buttonClick1&quot;</span>&gt;</span>按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 传递参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;buttonClick2(20,$event)&quot;</span>&gt;</span>按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buttonClick1</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击按钮1&#x27;</span>,e);</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buttonClick2</span>(<span class="params">number,$event</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;点击按钮2&#x27;</span>,number,$event);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="15、应用生命周期和页面生命周期"><a href="#15、应用生命周期和页面生命周期" class="headerlink" title="15、应用生命周期和页面生命周期"></a>15、应用生命周期和页面生命周期</h2><p>不仅仅是小程序，其实Android应用和iOS应用都会涉及到生命周期这个概念。</p>
<p>首选需要分清楚应用和页面的区别：</p>
<ul>
<li>应用是指整个app（iOS、Android）、整个小程序，顾名思义就是整个app的生命周期相关</li>
<li>页面是指这整个app中的某一个页面，所以页面的生命周期就是指该页面的生命周期，然后一个应用又有n多个页面组成。</li>
</ul>
<p>列举了一些uni-app可能会用到的常用的一些生命周期，具体可以参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/frame/lifecycle">生命周期的文档</a>。</p>
<h3 id="应用生命周期："><a href="#应用生命周期：" class="headerlink" title="应用生命周期："></a>应用生命周期：</h3><p>（挂载在App.vue上）</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onLaunch</td>
<td>当<code>uni-app</code> 初始化完成时触发（全局只触发一次）</td>
</tr>
<tr>
<td>onShow</td>
<td>当 <code>uni-app</code> 启动，或从后台进入前台显示</td>
</tr>
<tr>
<td>onHide</td>
<td>当 <code>uni-app</code> 从前台进入后台</td>
</tr>
<tr>
<td>onError</td>
<td>当 <code>uni-app</code> 报错时触发</td>
</tr>
</tbody></table>
<p>App.vue：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onLaunch</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用打开了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onShow</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用显示了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onHide</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用隐藏了&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onError</span>: <span class="keyword">function</span>(<span class="params">error</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;应用加载失败了&#x27;</span>,error);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="页面生命周期："><a href="#页面生命周期：" class="headerlink" title="页面生命周期："></a>页面生命周期：</h3><p>（挂载在具体某个页面）</p>
<table>
<thead>
<tr>
<th>函数名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>onLoad</td>
<td>监听页面加载，其参数为上个页面传递的数据，参数类型为 Object（用于页面传参），参考<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/router?id=navigateto">示例</a></td>
</tr>
<tr>
<td>onShow</td>
<td>监听页面显示。页面每次出现在屏幕上都触发，包括从下级页面点返回露出当前页面</td>
</tr>
<tr>
<td>onReady</td>
<td>监听页面初次渲染完成。注意如果渲染速度快，会在页面进入动画完成前触发</td>
</tr>
<tr>
<td>onHide</td>
<td>监听页面隐藏</td>
</tr>
<tr>
<td>onUnload</td>
<td>监听页面卸载</td>
</tr>
</tbody></table>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onLoad</span>(<span class="params">options</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;加载了，上个页面传递来的参数：&#x27;</span>,options);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onShow</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;显示了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onReady</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;初次渲染完成了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onHide</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;隐藏了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">title</span>+<span class="string">&#x27;被销毁了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是：onLoad的形参能够接收来自上一个页面传递过来的参数（仅仅是上一个页面），onShow和onHide分别是页面显示和页面隐藏时会调用的生命周期函数。</p>
<p><strong>Tips：</strong>由于内存管理机制相关，tabBar在切换时并不会重新加载和渲染页面，而只是会显示和隐藏页面。<strong>所以被tabBar管理的页面，只会执行一次onLoad和onShow。切记切记切记！！！除非强制刷新！！！</strong></p>
<h2 id="16、页面下拉刷新"><a href="#16、页面下拉刷新" class="headerlink" title="16、页面下拉刷新"></a>16、页面下拉刷新</h2><p>想要实现页面下拉刷新有两种方式，一种是在页面真正下拉以达到刷新页面的目的，另一种是使用uni内置的api模拟达到页面刷新的效果。</p>
<h3 id="真实下拉："><a href="#真实下拉：" class="headerlink" title="真实下拉："></a>真实下拉：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">addList</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//往数组中添加元素</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">movieList</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>:<span class="number">5</span>, <span class="attr">name</span>:<span class="string">&#x27;Agent Of Shiled&#x27;</span> &#125;) </span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先定义一个函数模拟向数组中添加元素（实际开发应该是重新获取数据，我这里模拟成了添加一个元素）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环遍历出数组 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in movieList&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;index&#125;&#125;-&#123;&#123;item.name&#125;&#125;-&#123;&#123;item.id&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: <span class="string">&#x27;列表页&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">movieList</span>: [</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;钢铁侠&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;美国队长&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;复仇者联盟&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;雷神&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                ]</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再定义一组数组，并且利用v-for遍历出来</p>
<p>定义生命周期函数<code>onPullDownRefresh()</code>（注：这个是生命周期函数）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生命周期函数监听页面下拉事件</span></span><br><span class="line"><span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面下拉了&#x27;</span>);</span><br><span class="line">    <span class="comment">//利用setTimeout模拟延时操作</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">addList</span>() <span class="comment">//执行元素刷新操作</span></span><br><span class="line">        uni.<span class="title function_">stopPullDownRefresh</span>() <span class="comment">//停止下拉刷新的动画</span></span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p> 只要在页面上下拉了就会执行<code>onPullDownRefresh()</code>生命周期函数，然后执行元素刷新操作，然后关掉下拉刷新的动画。</p>
<h3 id="模拟下拉："><a href="#模拟下拉：" class="headerlink" title="模拟下拉："></a>模拟下拉：</h3><p>同时我们还可以通过定义事件来触发下拉，从而执行页面下拉这个生命周期函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">buttonClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;手动刷新&#x27;</span>);</span><br><span class="line">    uni.<span class="title function_">startPullDownRefresh</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义按钮点击事件，然后执行<code>uni.startPullDownRefresh()</code>此时页面就会下拉，就会触发页面下拉这个生命周期函数，从而刷新页面，达到了和真实下拉一样的效果（我们只需要点击按钮就可以了）。</p>
<p>所以，<code>uni.startPullDownRefresh()</code>等价于用户真实下拉页面这个操作。</p>
<p>完整代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 按钮模拟下拉刷新 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;buttonClick&quot;</span>&gt;</span>按钮下拉刷新<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 循环遍历出数组 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in movieList&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123;index&#125;&#125;-&#123;&#123;item.name&#125;&#125;-&#123;&#123;item.id&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">title</span>: <span class="string">&#x27;列表页&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">movieList</span>: [</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;钢铁侠&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;美国队长&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;复仇者联盟&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;雷神&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                ]</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 生命周期函数监听页面下拉事件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">onPullDownRefresh</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面下拉了&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="title function_">addList</span>() <span class="comment">//添加元素</span></span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">addList</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">this</span>.<span class="property">movieList</span>.<span class="title function_">push</span>(&#123; <span class="attr">id</span>:<span class="number">5</span>, <span class="attr">name</span>:<span class="string">&#x27;Agent Of Shiled&#x27;</span> &#125;) <span class="comment">//往数组中添加元素</span></span></span><br><span class="line"><span class="language-javascript">                    uni.<span class="title function_">stopPullDownRefresh</span>() <span class="comment">//停止下拉刷新的动画</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,<span class="number">1000</span>)</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buttonClick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;手动刷新&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                uni.<span class="title function_">startPullDownRefresh</span>()</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="17、页面上划触底"><a href="#17、页面上划触底" class="headerlink" title="17、页面上划触底"></a>17、页面上划触底</h2><p>同样的，有一个页面的生命周期函数<code>onReachBottom()</code>是会在用户上划到页面底部后调用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onReachBottom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;页面到底了&#x27;</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">addList</span>() <span class="comment">//添加元素</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>但是不可以模拟手动上划触底。需要注意的是默认页面底部是距离屏幕底部50px，你也可以进行手动更改，在根目录下的pages.json里修改当前页面的style里的<code>&quot;onReachBottomDistance&quot;: 200</code>单位是px，详情参看uni-app的<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/collocation/pages?id=pages">pages.json文档</a></p>
<h2 id="18、发送网络请求"><a href="#18、发送网络请求" class="headerlink" title="18、发送网络请求"></a>18、发送网络请求</h2><p>由于很多端都不支持xhr，所以自然的并不是所有端都支持ajax。</p>
<p>关于网络请求，uni-app为了跨端使用封装了<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/request/request?id=request">uni.request API</a>，uni.request是极其类似ajax的：</p>
<p>基本用法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://www.example.com/request&#x27;</span>, <span class="comment">//仅为示例，并非真实接口地址。</span></span><br><span class="line">    <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;uni.request&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">header</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;custom-header&#x27;</span>: <span class="string">&#x27;hello&#x27;</span> <span class="comment">//自定义请求头信息</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">text</span> = <span class="string">&#x27;request success&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但是我觉得自带的uni.request并不是很方便，于是自己在uni-app的插件市场寻找了一个叫<code>luch-request</code>的基于promise封装的很类似axios的网络请求组件，具体使用方式以及安装方式还有配置参数请参看：<a target="_blank" rel="noopener" href="https://www.quanzhan.co/luch-request/guide/3.x/#%E4%BB%8B%E7%BB%8D">luch-request</a></p>
<p>推荐采用npm的方式进行安装：</p>
<ol>
<li><p>生产package.json和node_modules</p>
<p>由于uni-app本身是没有自带package.json和node_modules的，所以我们需要以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>从而就会在项目目录下生成一个package.json和node_modules</p>
</li>
<li><p>利用npm install安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install luch-request</span><br></pre></td></tr></table></figure></li>
</ol>
<p>我的具体封装：</p>
<p>先在根目录建一个utils文件夹：存放request请求相关，主要配置好全局的baseURL和timeout以及request和response拦截器：</p>
<p>request.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入luch-request</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Request</span> <span class="keyword">from</span> <span class="string">&#x27;luch-request&#x27;</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="keyword">new</span> <span class="title class_">Request</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局配置</span></span><br><span class="line">http.<span class="property">config</span>.<span class="property">baseURL</span> = <span class="string">&#x27;http://localhost:8096&#x27;</span></span><br><span class="line">http.<span class="property">config</span>.<span class="property">timeout</span> = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//request拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span>=&gt;</span>&#123;</span><br><span class="line">	config.<span class="property">header</span>[<span class="string">&#x27;X-Client&#x27;</span>] = <span class="string">&#x27;manage-web&#x27;</span></span><br><span class="line">	<span class="comment">// console.log(&#x27;request config&#x27;,config);</span></span><br><span class="line">	<span class="keyword">return</span> config</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;request error&#x27;</span>,error);</span><br><span class="line">	<span class="keyword">throw</span> error</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//response拦截器</span></span><br><span class="line">http.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">// console.log(&#x27;response&#x27;,response);</span></span><br><span class="line">	<span class="keyword">return</span> response.<span class="property">data</span></span><br><span class="line">&#125;,<span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;response error&#x27;</span>,error);</span><br><span class="line">	<span class="keyword">throw</span> error</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">config</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> http.<span class="title function_">middware</span>(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再在根目录创建一个api文件夹：存放具体请求相关：</p>
<p>user.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有工程用具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">getUserList</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;user/selectList&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据编号删除车辆</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; id	编号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">deleteUser</span>(<span class="params">id</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&#x27;engineer/deleteUser&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="attr">params</span>: &#123;</span><br><span class="line">            <span class="attr">id</span>: id</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先导入刚刚在utils文件夹里创建好的request，然后就传入url、method、params进行请求就可以了。最后在具体页面中使用：</p>
<p>list.vue：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	&lt;view&gt;</span><br><span class="line">    &lt;button @click=&quot;buttonClick&quot;&gt;发送请求&lt;/button&gt;</span><br><span class="line">    &lt;view v-for=&quot;item in list&quot;&gt;</span><br><span class="line">        &#123;&#123;item&#125;&#125;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    import &#123;</span><br><span class="line">        getEngineerList,</span><br><span class="line">        deleteVehicle</span><br><span class="line">    &#125; from &#x27;@/api/engineer.js&#x27;</span><br><span class="line">    export default &#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                list: []</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            buttonClick()&#123;</span><br><span class="line">                this.getData1()</span><br><span class="line">                this.getData2()</span><br><span class="line">            &#125;,</span><br><span class="line">            getData1()&#123;</span><br><span class="line">                getEngineerList().then(res=&gt;&#123;</span><br><span class="line">                    console.log(res);</span><br><span class="line">                &#125;).catch(error=&gt;&#123;</span><br><span class="line">                    console.log(error);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            getData2()&#123;</span><br><span class="line">                deleteVehicle(10).then(res=&gt;&#123;</span><br><span class="line">                    console.log(res);</span><br><span class="line">                &#125;).catch(error=&gt;&#123;</span><br><span class="line">                    console.log(error);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>先从api中import他们，然后就可以利用Promise的方法使用他们啦。</p>
<p><strong>Tips：</strong>需要注意的是在跨端开发中，下载和上传请求的method的请求类型是<code>DOWNLOAD</code>和<code>UPLOAD</code>，然后最基本的两个请求类型是<code>GET</code>和<code>POST</code>。所以我认为掌握这最基本的4个请求类型就可以了。具体各端的method支持的情况:</p>
<p><img src="/2023/07/19/front-end/uni-app/uni-app/image-20210413103532057.png"></p>
<p>封装方法很类似vue-element-admin的网络请求，如果你有这个框架的开发经验，那你肯定很快就能上手。<a target="_blank" rel="noopener" href="https://panjiachen.gitee.io/vue-element-admin-site/zh/guide/essentials/server.html">vue-element-admin与服务端交互</a></p>
<h2 id="19、路由和页面跳转"><a href="#19、路由和页面跳转" class="headerlink" title="19、路由和页面跳转"></a>19、路由和页面跳转</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://fangaoxs.github.io/2023/07/19/front-end/uni-app/uni-app/" data-id="cltpf7eon001326k6hjz77od4" data-title="uni-app学习笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cookie/" rel="tag">Cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GRPC/" rel="tag">GRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JWT/" rel="tag">JWT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OIDC/" rel="tag">OIDC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/echarts/" rel="tag">echarts</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kubernates/" rel="tag">kubernates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redis/" rel="tag">redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uni-app/" rel="tag">uni-app</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/websocket/" rel="tag">websocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" rel="tag">网络安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/GRPC/" style="font-size: 13.33px;">GRPC</a> <a href="/tags/Golang/" style="font-size: 18.33px;">Golang</a> <a href="/tags/JWT/" style="font-size: 10px;">JWT</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/OIDC/" style="font-size: 13.33px;">OIDC</a> <a href="/tags/Spring/" style="font-size: 13.33px;">Spring</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 11.67px;">docker</a> <a href="/tags/echarts/" style="font-size: 10px;">echarts</a> <a href="/tags/http/" style="font-size: 11.67px;">http</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/kubernates/" style="font-size: 10px;">kubernates</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/redis/" style="font-size: 11.67px;">redis</a> <a href="/tags/uni-app/" style="font-size: 10px;">uni-app</a> <a href="/tags/vue/" style="font-size: 16.67px;">vue</a> <a href="/tags/webpack/" style="font-size: 10px;">webpack</a> <a href="/tags/websocket/" style="font-size: 10px;">websocket</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.67px;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 11.67px;">数据结构</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 11.67px;">网络安全</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 10px;">计算机网络</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 11.67px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">七月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/12/back-end/go/gmp/">Goroutine调度器GMP</a>
          </li>
        
          <li>
            <a href="/2024/01/31/back-end/docker/dockerfile/">dockerfile</a>
          </li>
        
          <li>
            <a href="/2023/11/07/network/caddy/http%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/">利用Caddy实现http反向代理</a>
          </li>
        
          <li>
            <a href="/2023/07/25/network/OIDC/%E7%BB%93%E5%90%88OIDC%E5%92%8CCookie%E5%AE%9E%E7%8E%B0SSO/">结合OIDC和Cookie实现SSO</a>
          </li>
        
          <li>
            <a href="/2023/07/24/back-end/Java/Java%E5%AE%B9%E5%99%A8/%E9%9B%86%E5%90%88/">Java集合</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 FanGaoXS<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>